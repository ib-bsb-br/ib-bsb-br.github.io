<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        TreeSheets Hierarchy Swap documentation - infoBAG
      
    </title>
    <meta name="title" content="TreeSheets Hierarchy Swap documentation - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/ts-swap/">
    <meta property="og:title" content="TreeSheets Hierarchy Swap documentation - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/ts-swap/">
    <meta name="twitter:title" content="TreeSheets Hierarchy Swap documentation - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/ts-swap/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          TreeSheets Hierarchy Swap documentation
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2026-01-01T00:00:00+00:00" class="post-date">
          01 Jan 2026
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2026-01-01T23:34:40+00:00">
              01 Jan 2026
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/ts-swap" class="tag">ts-swap</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        21839 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        3221 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2026-01-01-ts-swap.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  Improve this page
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2026-01-01-ts-swap.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#command-surface">Command Surface</a></li><li><a href="#code-map">Code Map</a><ul><li><a href="#how-these-pieces-cooperate">How these pieces cooperate</a></li></ul></li><li><a href="#algorithm-from-the-current-implementation">Algorithm (from the current implementation)</a><ul><li><a href="#behavioral-notes">Behavioral Notes</a></li><li><a href="#implementation-walkthrough-annotated-pseudocode">Implementation Walkthrough (annotated pseudocode)</a></li></ul></li><li><a href="#examples">Examples</a><ul><li><a href="#1-baseline-single-match-promotion">1) Baseline: Single Match Promotion</a></li><li><a href="#2-multiple-matches-at-different-depths">2) Multiple Matches at Different Depths</a></li><li><a href="#3-single-path-with-repeated-tags">3) Single-Path with Repeated Tags</a></li><li><a href="#4-grid-merge-with-existing-hierarchy">4) Grid Merge with Existing Hierarchy</a></li><li><a href="#5-deep-match-with-mixed-siblings-depth-dependent-passes">5) Deep Match with Mixed Siblings (depth-dependent passes)</a></li><li><a href="#6-flat-sibling-merge-single-pass-no-depth-hops">6) Flat Sibling Merge (single pass, no depth hops)</a></li><li><a href="#7-partial-empty-parents-slot-deletion">7) Partial Empty Parents (slot deletion)</a></li></ul></li><li><a href="#practical-testing-checklist">Practical Testing Checklist</a></li><li><a href="#faq-code-grounded">FAQ (code-grounded)</a></li><li><a href="#quick-regression-matrix-who-to-press-where">Quick Regression Matrix (who to press where)</a></li></ul>
          <h2 id="command-surface">
    
    
     <a href="#command-surface">#</a><a href="#" aria-label="Back to top">Command Surface</a>
        
    
  </h2>
      
<ul>
  <li><strong>Menu / Shortcut:</strong> Organization → Hierarchy Swap (F8), defined in <a href="../src/tsframe.h#L333-L348"><code class="language-plaintext highlighter-rouge">tsframe.h</code></a>. The label reads “Hierarchy Swap” and the tooltip explains that all cells with the selected text are swapped with their parents at the current level (or above). The menu entry lives under the “Organization” cascade, grouped with flattening and hierarchify commands.</li>
  <li><strong>Action ID:</strong> <code class="language-plaintext highlighter-rouge">A_HSWAP</code> in <a href="../src/main.cpp#L130-L180"><code class="language-plaintext highlighter-rouge">main.cpp</code></a>. This ID connects the menu, keyboard shortcut, and dispatcher switch statement; it is also used in the toolbar accelerator table.</li>
  <li><strong>Validation and dispatch:</strong> <code class="language-plaintext highlighter-rouge">Document::Action()</code> at <a href="../src/document.h#L1860-L1920"><code class="language-plaintext highlighter-rouge">document.h</code></a> enforces:
    <ul>
      <li>The selected cell has a parent and grandparent (minimum depth requirement) and therefore the command is disabled at the document root.</li>
      <li>Both parent and grandparent grids are 1×N or N×1 (unidimensional constraint). If either grid fails the shape test, the action aborts before any structural edits occur.</li>
      <li>An undo step is recorded before calling the swap, so the operation is fully reversible.</li>
      <li>The returned <code class="language-plaintext highlighter-rouge">Selection</code> is installed, and the layout is reset plus canvas refresh is requested to reflect the new tree topology.</li>
    </ul>
  </li>
  <li><strong>Failure modes (user-facing):</strong>
    <ul>
      <li>No grandparent → “Cannot move this cell up in the hierarchy.”</li>
      <li>Parent grid not 1×N or N×1 → “Can only move this cell from a Nx1 or 1xN grid.”</li>
      <li>Grandparent grid not 1×N or N×1 → “Can only move this cell into a Nx1 or 1xN grid.”</li>
      <li>Selection has no grid ancestry because the document is a single flat row/column → the menu item will be disabled due to the grandparent check.</li>
    </ul>
  </li>
  <li><strong>Selection rule:</strong> The operation is invoked on the currently selected cell; the returned selection usually points to the promoted/merged tag at the grandparent level. If merges occur, the earliest tag inserted into the target grid becomes the selection anchor and is reused for subsequent merges.</li>
  <li><strong>UI invariants to watch:</strong> because <code class="language-plaintext highlighter-rouge">HierarchySwap</code> runs inside a single undo step, the canvas redraw and layout reset happen once per keypress, even when multiple promotions/merges occur via <code class="language-plaintext highlighter-rouge">goto lookformore</code>.</li>
</ul>
  <h2 id="code-map">
    
    
     <a href="#code-map">#</a><a href="#" aria-label="Back to top">Code Map</a>
        
    
  </h2>
      
<p>| Area | Location | Role |
| — | — | — |
| Grid-level search | <a href="../src/grid.h#L867-L888"><code class="language-plaintext highlighter-rouge">Grid::FindExact</code></a> | Recursively finds the first cell whose text matches the selected tag. Walks depth-first through a child grid. |
| Main algorithm | <a href="../src/grid.h#L889-L938"><code class="language-plaintext highlighter-rouge">Grid::HierarchySwap</code></a> | Promotes each match, rebuilds its parent chain under it, merges like-tag peers, and restarts the search until no matches remain. |
| Parent cleanup | <a href="../src/grid.h#L940-L964"><code class="language-plaintext highlighter-rouge">Grid::DeleteTagParent</code></a> | Removes the promoted node from its old location, deleting empty 1×1 ancestors on the way up. |
| Merge helpers | <a href="../src/grid.h#L966-L991"><code class="language-plaintext highlighter-rouge">Grid::MergeTagCell</code></a> and <a href="../src/grid.h#L993-L1000"><code class="language-plaintext highlighter-rouge">Grid::MergeTagAll</code></a> | Merge promoted cells (and their grids) when the target level already contains the same tag. |
| Parent pointer fix-up | <a href="../src/grid.h#L1010-L1014"><code class="language-plaintext highlighter-rouge">Grid::ReParent</code></a> | Retargets parent pointers whenever a grid is transplanted. |
| Cell-level match | <a href="../src/cell.h#L484-L503"><code class="language-plaintext highlighter-rouge">Cell::FindExact</code></a> | Base-case exact-text comparison used by <code class="language-plaintext highlighter-rouge">Grid::FindExact</code>. |</p>
  <h3 id="how-these-pieces-cooperate">
    
    
     <a href="#how-these-pieces-cooperate">#</a><a href="#" aria-label="Back to top">How these pieces cooperate</a>
        
    
  </h3>
      
<ol>
  <li><code class="language-plaintext highlighter-rouge">Document::Action()</code> validates shape/depth, then calls <code class="language-plaintext highlighter-rouge">HierarchySwap</code> on the grandparent grid, passing the selected cell text.</li>
  <li><code class="language-plaintext highlighter-rouge">HierarchySwap</code> iterates each direct child cell of that grid that has a subgrid, scanning it with <code class="language-plaintext highlighter-rouge">FindExact</code>.</li>
  <li>When a match is found, the ancestor chain is reversed into nested children (using <code class="language-plaintext highlighter-rouge">ReParent</code> for correctness), original containers are removed (<code class="language-plaintext highlighter-rouge">DeleteTagParent</code>), and the promoted tag is merged (<code class="language-plaintext highlighter-rouge">MergeTagCell</code>/<code class="language-plaintext highlighter-rouge">MergeTagAll</code>).</li>
  <li>The search restarts (<code class="language-plaintext highlighter-rouge">goto lookformore</code>) so newly created structure is considered; the returned <code class="language-plaintext highlighter-rouge">Selection</code> points to the first merged tag at the target grid.</li>
</ol>
  <h2 id="algorithm-from-the-current-implementation">
    
    
     <a href="#algorithm-from-the-current-implementation">#</a><a href="#" aria-label="Back to top">Algorithm (from the current implementation)</a>
        
    
  </h2>
      
<p>The following is a line-by-line translation of the active codepath, emphasizing what actually happens rather than a simplified mental model.</p>

<ol>
  <li><strong>Search scope:</strong> Start in the grandparent grid of the selected cell (the grid that owns the parent’s parent). Iterate each direct child that has a grid. The current child being scanned is referenced by <code class="language-plaintext highlighter-rouge">cell</code> inside the function.</li>
  <li><strong>Find first match:</strong> Use <code class="language-plaintext highlighter-rouge">Grid::FindExact(tag)</code> to locate the first cell in that child grid whose text equals the selected tag (case-sensitive). If none, continue to the next sibling with a grid.</li>
  <li><strong>Build reversed chain:</strong> For the found cell <code class="language-plaintext highlighter-rouge">f</code>, walk its parent chain up to (but not including) the grandparent cell that owns the running grid. For each ancestor <code class="language-plaintext highlighter-rouge">p</code>:
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">p-&gt;text</code> matches the tag, set <code class="language-plaintext highlighter-rouge">done = true</code> to stop after this promotion and avoid infinite swaps through same-named ancestors.</li>
      <li>Clone <code class="language-plaintext highlighter-rouge">p</code> into a new cell attached under <code class="language-plaintext highlighter-rouge">f</code>, transfer <code class="language-plaintext highlighter-rouge">f</code>’s current grid to that clone, call <code class="language-plaintext highlighter-rouge">ReParent</code>, and give <code class="language-plaintext highlighter-rouge">f</code> a fresh 1×1 grid containing the clone. This makes every ancestor become a child nested under the promoted tag, preserving the original ordering from nearest to farthest parent.</li>
    </ul>
  </li>
  <li><strong>Detach the original chain:</strong> Call <code class="language-plaintext highlighter-rouge">DeleteTagParent</code> repeatedly while walking upward, deleting empty 1×1 ancestors and cleaning up the spot where the match used to live. This pruning happens before any merge so that empties are not left behind in the original branch.</li>
  <li><strong>Merge at target level:</strong>
    <ul>
      <li>If the target grid was empty, place <code class="language-plaintext highlighter-rouge">f</code> there and mark it as the selection.</li>
      <li>Otherwise call <code class="language-plaintext highlighter-rouge">MergeTagCell</code>, which either merges <code class="language-plaintext highlighter-rouge">f</code> into an existing like-named cell (combining grids via <code class="language-plaintext highlighter-rouge">MergeTagAll</code> when both have grids) or appends it if no duplicate exists. The first merged/added cell becomes the returned selection, and subsequent merges fold into that.</li>
    </ul>
  </li>
  <li><strong>Restart search:</strong> <code class="language-plaintext highlighter-rouge">goto lookformore</code> restarts the sweep so newly created structure is also scanned. The loop ends when no further matches remain or <code class="language-plaintext highlighter-rouge">done</code> was set because an ancestor already matched the tag (the ancestor-match guard).</li>
  <li><strong>Return selection:</strong> The function returns a <code class="language-plaintext highlighter-rouge">Selection</code> pointing to the promoted/merged tag at the target level. The caller re-applies the selection and refreshes layout/UI.</li>
</ol>
  <h3 id="behavioral-notes">
    
    
     <a href="#behavioral-notes">#</a><a href="#" aria-label="Back to top">Behavioral Notes</a>
        
    
  </h3>
      
<ul>
  <li><strong>Grid shape:</strong> The operation only runs on 1×N or N×1 grids (checked before calling the algorithm). This keeps parent/child inversion unambiguous and ensures <code class="language-plaintext highlighter-rouge">DeleteCells</code> can safely collapse rows/columns when null slots appear.</li>
  <li><strong>Exact text match:</strong> Matching is literal and case-sensitive (<code class="language-plaintext highlighter-rouge">Cell::FindExact</code>), so “Red” ≠ “red”. Hidden formatting (bold/italic) does not affect the match because only <code class="language-plaintext highlighter-rouge">text.t</code> is compared.</li>
  <li><strong>Search order:</strong> Because the search restarts after every promotion, newly merged structures can be processed in subsequent passes; order is depth-first within each child grid. This restart is why multi-match merges can happen within one keypress.</li>
  <li><strong>Ancestor protection:</strong> If an ancestor already has the same tag, <code class="language-plaintext highlighter-rouge">done</code> stops further promotions after that chain is processed to prevent cycling the same text upward forever. That means repeated-tag chains only promote once, even when additional matches exist deeper in the tree.</li>
  <li><strong>Merge semantics:</strong> When the target grid already contains the tag, children from both structures are merged under the surviving tag cell. Subgrid merging preserves existing rows/columns as appended sibling rows, and <code class="language-plaintext highlighter-rouge">MergeTagAll</code> will recursively merge duplicate-tag grandchildren as well. If a promoted match brings in a cloned ancestor with the same name but no grid, <code class="language-plaintext highlighter-rouge">MergeTagCell</code> short-circuits on the first match and leaves only one copy.</li>
  <li><strong>Two-level hops:</strong> Each keypress works against the selected cell’s grandparent grid, so very deep matches may need multiple presses to bubble all the way to the top-level grid where siblings live. The “press-count” tables below assume this two-level stride.</li>
  <li><strong>Undo/redo alignment:</strong> An undo point is established before running the algorithm; all structural edits (promote, delete, merge) live inside that single undo step. Redo will replay the full set of promotions, merges, and deletions.</li>
  <li><strong>Selection stability:</strong> The first promoted/merged cell at the target grid is returned as the new selection; subsequent merges do not change that pointer. This stability matters for keyboard users repeating swaps.</li>
  <li><strong>Empty-shell cleanup:</strong> Because <code class="language-plaintext highlighter-rouge">DeleteTagParent</code> prunes empty 1×1 ancestors, the final tree omits placeholder shells that lost all children during promotion. When the grid has multiple rows, empty rows are physically removed via <code class="language-plaintext highlighter-rouge">DeleteCells</code>.</li>
  <li><strong>Grid ownership:</strong> <code class="language-plaintext highlighter-rouge">ReParent</code> is called every time a grid is re-attached so parent pointers remain accurate for all transplanted children. This invariant is critical for subsequent operations such as copy/paste or further swaps.</li>
  <li><strong>Shape preservation for bystanders:</strong> Cells in the grandparent grid that do not contain a matching tag remain in place (apart from row removal when a null slot is deleted). Use this property to predict stable ordering of unrelated siblings.</li>
</ul>
  <h3 id="implementation-walkthrough-annotated-pseudocode">
    
    
     <a href="#implementation-walkthrough-annotated-pseudocode">#</a><a href="#" aria-label="Back to top">Implementation Walkthrough (annotated pseudocode)</a>
        
    
  </h3>
      
<p>Below is an exact-structure pseudocode sketch that matches the current C++ implementation, including the restart logic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>HierarchySwap(tag):
    selcell = nullptr
    done = false
lookformore:
    for each cell in this grid where cell has a subgrid:
        found = cell-&gt;grid-&gt;FindExact(tag)
        if not found: continue

        // Reverse the ancestor chain into children under `found`
        for p = found-&gt;parent; p != cell; p = p-&gt;parent:
            if p-&gt;text == tag: done = true
            clone = new Cell(found, p)
            clone-&gt;text = p-&gt;text
            clone-&gt;grid = found-&gt;grid
            if clone-&gt;grid: clone-&gt;grid-&gt;ReParent(clone)
            found-&gt;grid = new Grid(1, 1)
            found-&gt;grid-&gt;cell = found
            *found-&gt;grid-&gt;cells = clone

        // Remove the original chain (prunes empties)
        for r = found; r &amp;&amp; r != cell; r = r-&gt;parent-&gt;grid-&gt;DeleteTagParent(r, cell, found);

        // Merge or insert at the target level
        if !cells[0]:
            *cells = found
            selcell = found
        else:
            MergeTagCell(found, selcell)

        if !done: goto lookformore
    return Selection(this, selcell)
</code></section></div></div>
<p>Key takeaways from this structure:</p>
<ul>
  <li>The <code class="language-plaintext highlighter-rouge">goto</code> intentionally restarts the <code class="language-plaintext highlighter-rouge">for</code> so the modified grid is scanned anew.</li>
  <li><code class="language-plaintext highlighter-rouge">done</code> only flips when a same-named ancestor exists; otherwise every match reachable from the scanning grid will be processed.</li>
  <li>The merge target is always the grid on which <code class="language-plaintext highlighter-rouge">HierarchySwap</code> is called (the grandparent grid chosen by the caller).</li>
  <li>The loop condition <code class="language-plaintext highlighter-rouge">p != cell</code> stops cloning at the grid’s owning cell (the grandparent), so only ancestors strictly below that owning cell are nested under the promoted tag.</li>
</ul>
  <h2 id="examples">
    
    
     <a href="#examples">#</a><a href="#" aria-label="Back to top">Examples</a>
        
    
  </h2>
      
<p>The following scenarios are constructed directly against the algorithm above:</p>
  <h3 id="1-baseline-single-match-promotion">
    
    
     <a href="#1-baseline-single-match-promotion">#</a><a href="#" aria-label="Back to top">1) Baseline: Single Match Promotion</a>
        
    
  </h3>
      
<p><strong>Before</strong> (select “Alice”, grandparent grid owns <code class="language-plaintext highlighter-rouge">Project</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Projects
   Project A
      Alice
   Project B
      Bob
</code></section></div></div>

<p><strong>After F8 on “Alice”:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Projects
   Project B
      Bob
   Alice
      Project A
</code></section></div></div>
<ul>
  <li>The <code class="language-plaintext highlighter-rouge">Alice</code> branch moves to the grandparent grid. <code class="language-plaintext highlighter-rouge">Project A</code> becomes a child under <code class="language-plaintext highlighter-rouge">Alice</code>. Other siblings stay put.</li>
  <li>No merge occurs because only one <code class="language-plaintext highlighter-rouge">Alice</code> exists. Undo reverses the promotion cleanly.</li>
  <li>Plain text before: <code class="language-plaintext highlighter-rouge">Projects\n  Project A\n    Alice\n  Project B\n    Bob\n</code></li>
  <li>Plain text after: <code class="language-plaintext highlighter-rouge">Projects\n  Project B\n    Bob\n  Alice\n    Project A\n</code></li>
</ul>
  <h3 id="2-multiple-matches-at-different-depths">
    
    
     <a href="#2-multiple-matches-at-different-depths">#</a><a href="#" aria-label="Back to top">2) Multiple Matches at Different Depths</a>
        
    
  </h3>
      
<p><strong>Before</strong> (grandparent grid is <code class="language-plaintext highlighter-rouge">Colors</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Colors
   Warm
      Red
      Orange
   Cool
      Blue
   Mixed
      Purple
         Red
</code></section></div></div>

<p><strong>After F8 on either “Red”:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Colors
   Warm
      Orange
   Cool
      Blue
   Red
      Warm
      Mixed
         Purple
</code></section></div></div>
<ul>
  <li>First match promotes <code class="language-plaintext highlighter-rouge">Warm</code> under <code class="language-plaintext highlighter-rouge">Red</code>, leaving <code class="language-plaintext highlighter-rouge">Orange</code> behind.</li>
  <li>Second match promotes <code class="language-plaintext highlighter-rouge">Mixed → Purple</code> under another <code class="language-plaintext highlighter-rouge">Red</code>.</li>
  <li>The two <code class="language-plaintext highlighter-rouge">Red</code> results merge at the <code class="language-plaintext highlighter-rouge">Colors</code> level; children from both chains are preserved.</li>
  <li>Merge order is deterministic because the scan restarts after each promotion: the first child grid containing a match is processed fully before later siblings are scanned again.</li>
  <li>Plain text (pre-swap): <code class="language-plaintext highlighter-rouge">colors\n  warm\n    red\n    orange\n  cool\n    blue\n  mixed\n    purple\n      red\n</code></li>
  <li>Plain text (post-swap): <code class="language-plaintext highlighter-rouge">colors\n  warm\n    orange\n  cool\n    blue\n  red\n    warm\n    mixed\n      purple\n</code></li>
  <li>XML (pre) mirrors the hierarchical listing; XML (post) reflects the merged <code class="language-plaintext highlighter-rouge">Red</code> node with <code class="language-plaintext highlighter-rouge">Warm</code> and <code class="language-plaintext highlighter-rouge">Mixed</code> children.</li>
</ul>
  <h3 id="3-single-path-with-repeated-tags">
    
    
     <a href="#3-single-path-with-repeated-tags">#</a><a href="#" aria-label="Back to top">3) Single-Path with Repeated Tags</a>
        
    
  </h3>
      
<p><strong>Before</strong> (select the deeper “Tag”, grandparent grid is the root):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Root
   Tag
      Tag
         Item
</code></section></div></div>

<p><strong>After F8 on inner “Tag”:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Root
   Tag
      Tag
         Item
</code></section></div></div>
<ul>
  <li>The inner match is promoted to the root grid.</li>
  <li>The original outer tag is preserved as a child under the promoted tag (the ancestor clone step).</li>
  <li>Because an ancestor shared the tag, <code class="language-plaintext highlighter-rouge">done</code> stops further passes after this promotion. That guard prevents repeatedly flipping the two tags back and forth.</li>
  <li>Variants to test: add a third nested <code class="language-plaintext highlighter-rouge">Tag</code> to confirm only one promotion occurs when a same-named ancestor exists.</li>
</ul>
  <h3 id="4-grid-merge-with-existing-hierarchy">
    
    
     <a href="#4-grid-merge-with-existing-hierarchy">#</a><a href="#" aria-label="Back to top">4) Grid Merge with Existing Hierarchy</a>
        
    
  </h3>
      
<p><strong>Before</strong> (select any <code class="language-plaintext highlighter-rouge">tag</code> cell; grandparent grid is <code class="language-plaintext highlighter-rouge">main</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>main
   branch1
      tag
         a
         b
         c
   branch2
      tag
         d
         e
         f
</code></section></div></div>

<p><strong>After F8 on <code class="language-plaintext highlighter-rouge">tag</code>:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>main
   tag
      branch1
         a
         b
         c
      branch2
         d
         e
         f
</code></section></div></div>
<ul>
  <li>Each <code class="language-plaintext highlighter-rouge">tag</code> is promoted; their parent chains (<code class="language-plaintext highlighter-rouge">branch1</code>, <code class="language-plaintext highlighter-rouge">branch2</code>) become children under the promoted tags.</li>
  <li>The promoted tags merge at the <code class="language-plaintext highlighter-rouge">main</code> level, combining both sub-branches under one <code class="language-plaintext highlighter-rouge">tag</code>.</li>
  <li>Empty intermediate grids do not survive because <code class="language-plaintext highlighter-rouge">DeleteTagParent</code> prunes 1×1 shells.</li>
  <li>Regression hint: if a third <code class="language-plaintext highlighter-rouge">tag</code> existed under <code class="language-plaintext highlighter-rouge">branch3</code>, it would also merge into the single top-level <code class="language-plaintext highlighter-rouge">tag</code> during the same keypress because the search restarts until no matches remain.</li>
</ul>
  <h3 id="5-deep-match-with-mixed-siblings-depth-dependent-passes">
    
    
     <a href="#5-deep-match-with-mixed-siblings-depth-dependent-passes">#</a><a href="#" aria-label="Back to top">5) Deep Match with Mixed Siblings (depth-dependent passes)</a>
        
    
  </h3>
      
<p>This example illustrates the “two-level hop” rule: each keypress processes the current selection’s grandparent grid. Deeper matches can require multiple presses to reach the shared ancestor where merging occurs.</p>

<p><strong>Before (same starting state for all runs):</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Sales
      Q4
         Jamie
   Support
      Jamie
   Engineering
      Backend
         Team A
            Jamie
</code></section></div></div>

<p><strong>If you press F8 on the shallow Jamie (under <code class="language-plaintext highlighter-rouge">Sales → Q4</code>):</strong></p>
<ul>
  <li><em>After the first press (scope = <code class="language-plaintext highlighter-rouge">Sales</code> grid):</em>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Sales
      Jamie
         Q4
   Support
      Jamie
   Engineering
      Backend
         Team A
            Jamie
</code></section></div>    </div>
  </li>
  <li><em>After the second press (scope = <code class="language-plaintext highlighter-rouge">Departments</code> grid):</em>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Jamie
      Sales
         Q4
      Support
      Engineering
         Backend
            Team A
</code></section></div>    </div>
    <ul>
      <li>First press bubbles the match two levels (grandparent = <code class="language-plaintext highlighter-rouge">Sales</code>).</li>
      <li>Second press runs at <code class="language-plaintext highlighter-rouge">Departments</code>, finds all three <code class="language-plaintext highlighter-rouge">Jamie</code> matches, promotes each, and merges them at the top level.</li>
    </ul>
  </li>
</ul>

<p><strong>If you press F8 on the mid-depth Jamie (under <code class="language-plaintext highlighter-rouge">Support</code>):</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Jamie
      Sales
         Q4
      Support
      Engineering
         Backend
            Team A
</code></section></div></div>
<ul>
  <li>One press is enough because the selected cell’s grandparent grid is already <code class="language-plaintext highlighter-rouge">Departments</code>, so all three matches are discovered and merged in a single pass. The scan restarts after each promotion, but all matches reside directly in the processed scope, so the merge completes immediately.</li>
</ul>

<p><strong>If you press F8 on the deep Jamie (under <code class="language-plaintext highlighter-rouge">Engineering → Backend → Team A</code>):</strong></p>
<ul>
  <li><em>After one press (scope = <code class="language-plaintext highlighter-rouge">Backend</code> grid):</em>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Sales
      Q4
         Jamie
   Support
      Jamie
   Engineering
      Backend
         Jamie
            Team A
</code></section></div>    </div>
  </li>
  <li><em>After two presses (scope = <code class="language-plaintext highlighter-rouge">Engineering</code> grid):</em>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Sales
      Q4
         Jamie
   Support
      Jamie
   Engineering
      Jamie
         Backend
            Team A
</code></section></div>    </div>
  </li>
  <li><em>After three presses (scope = <code class="language-plaintext highlighter-rouge">Departments</code> grid):</em>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Departments
   Jamie
      Sales
         Q4
      Support
      Engineering
         Backend
            Team A
</code></section></div>    </div>
  </li>
  <li>Each press operates two levels up from the current selection, so the deep match must be swapped three times to reach the shared <code class="language-plaintext highlighter-rouge">Departments</code> grid where the merge can occur. At that point, all <code class="language-plaintext highlighter-rouge">Jamie</code> nodes are coalesced.</li>
</ul>

<p><strong>Press counts by depth:</strong>
| Selected <code class="language-plaintext highlighter-rouge">Jamie</code> | Initial depth relative to <code class="language-plaintext highlighter-rouge">Departments</code> | Presses to merge all three | Why |
| — | — | — | — |
| Shallow (<code class="language-plaintext highlighter-rouge">Sales → Q4 → Jamie</code>) | Great-grandchild | 2 | First press moves into the parent’s parent (<code class="language-plaintext highlighter-rouge">Sales</code>); second press runs in <code class="language-plaintext highlighter-rouge">Departments</code> and merges everything. |
| Mid-depth (<code class="language-plaintext highlighter-rouge">Support → Jamie</code>) | Grandchild | 1 | Already two levels below <code class="language-plaintext highlighter-rouge">Departments</code>; one pass finds all matches. |
| Deep (<code class="language-plaintext highlighter-rouge">Engineering → Backend → Team A → Jamie</code>) | Great-great-grandchild | 3 | Needs three hops (Backend → Engineering → Departments) because each swap uses the current grandparent grid. |</p>

<p><strong>Alternate representations for automated checks:</strong></p>
<ul>
  <li>Pre-swap plain text: <code class="language-plaintext highlighter-rouge">Departments\n  Sales\n    Q4\n      Jamie\n  Support\n    Jamie\n  Engineering\n    Backend\n      Team A\n        Jamie\n</code></li>
  <li>Post-merge plain text (after mid-depth or second shallow press or third deep press): <code class="language-plaintext highlighter-rouge">Departments\n  Jamie\n    Sales\n      Q4\n    Support\n    Engineering\n      Backend\n        Team A\n</code></li>
  <li>XML versions can mirror these structures to diff serialized <code class="language-plaintext highlighter-rouge">.cts</code> files.</li>
</ul>
  <h3 id="6-flat-sibling-merge-single-pass-no-depth-hops">
    
    
     <a href="#6-flat-sibling-merge-single-pass-no-depth-hops">#</a><a href="#" aria-label="Back to top">6) Flat Sibling Merge (single pass, no depth hops)</a>
        
    
  </h3>
      
<p>This mirrors a shallow multi-match merge with no ancestor reuse beyond the shared parent. The grandparent grid is the document root; its only child with a subgrid is <code class="language-plaintext highlighter-rouge">Root</code>.</p>

<p><strong>Before</strong> (select any <code class="language-plaintext highlighter-rouge">Tag</code>; grandparent grid = document root, scanning the <code class="language-plaintext highlighter-rouge">Root</code> grid):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>&lt;doc root&gt;
   Root
      Tag
      Tag
      Tag
      Other
</code></section></div></div>

<p><strong>After one F8 on any <code class="language-plaintext highlighter-rouge">Tag</code>:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>&lt;doc root&gt;
   Root
      Other
   Tag
      Root
</code></section></div></div>
<ul>
  <li>Each <code class="language-plaintext highlighter-rouge">Tag</code> is promoted out of <code class="language-plaintext highlighter-rouge">Root</code> and merged at the document root grid in a single pass because the restart (<code class="language-plaintext highlighter-rouge">goto lookformore</code>) continues scanning until no matches remain.</li>
  <li>The ancestor-clone step adds a <code class="language-plaintext highlighter-rouge">Root</code> child under every promoted <code class="language-plaintext highlighter-rouge">Tag</code>, but because clones share the same text and carry no grids, <code class="language-plaintext highlighter-rouge">MergeTagCell</code> collapses them into a single <code class="language-plaintext highlighter-rouge">Root</code> child on the surviving <code class="language-plaintext highlighter-rouge">Tag</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">Root</code> keeps only the non-matching <code class="language-plaintext highlighter-rouge">Other</code> child because <code class="language-plaintext highlighter-rouge">DeleteTagParent</code> removes each <code class="language-plaintext highlighter-rouge">Tag</code> row from its grid but does not delete the grid itself (it is not 1×1).</li>
  <li>Regression tip: if one of the <code class="language-plaintext highlighter-rouge">Tag</code> nodes had its own grid, that grid would merge into the surviving <code class="language-plaintext highlighter-rouge">Tag</code> as well via <code class="language-plaintext highlighter-rouge">MergeTagAll</code>; duplicates without grids are dropped as shown here.</li>
</ul>
  <h3 id="7-partial-empty-parents-slot-deletion">
    
    
     <a href="#7-partial-empty-parents-slot-deletion">#</a><a href="#" aria-label="Back to top">7) Partial Empty Parents (slot deletion)</a>
        
    
  </h3>
      
<p>This showcases how null slots are deleted when a promoted child leaves behind an empty 1×1 grid, while non-empty siblings remain.</p>

<p><strong>Before</strong> (select the first <code class="language-plaintext highlighter-rouge">Target</code>; grandparent grid = <code class="language-plaintext highlighter-rouge">Main</code>’s parent):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Main
   Holder1
      Target
      Sibling
   Holder2
      Target
</code></section></div></div>

<p><strong>After F8 on <code class="language-plaintext highlighter-rouge">Target</code>:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>Main
   Holder1
      Sibling
   Target
      Holder1
      Holder2
</code></section></div></div>
<ul>
  <li>The first promotion clones <code class="language-plaintext highlighter-rouge">Holder1</code> under the new <code class="language-plaintext highlighter-rouge">Target</code> and removes the original <code class="language-plaintext highlighter-rouge">Target</code> row, leaving <code class="language-plaintext highlighter-rouge">Holder1</code> with only <code class="language-plaintext highlighter-rouge">Sibling</code>.</li>
  <li>The second promotion clones <code class="language-plaintext highlighter-rouge">Holder2</code> under a second <code class="language-plaintext highlighter-rouge">Target</code>; because <code class="language-plaintext highlighter-rouge">Holder2</code>’s grid becomes empty (1×1), <code class="language-plaintext highlighter-rouge">DeleteTagParent</code> removes that grid and returns the <code class="language-plaintext highlighter-rouge">Holder2</code> cell to the caller.</li>
  <li><code class="language-plaintext highlighter-rouge">MergeTagCell</code> folds the second promoted <code class="language-plaintext highlighter-rouge">Target</code> into the first, merging the two cloned parents (<code class="language-plaintext highlighter-rouge">Holder1</code>, <code class="language-plaintext highlighter-rouge">Holder2</code>) under the surviving <code class="language-plaintext highlighter-rouge">Target</code> while keeping the <code class="language-plaintext highlighter-rouge">Holder1</code> branch with <code class="language-plaintext highlighter-rouge">Sibling</code> intact.</li>
  <li>This example is a good probe for the <code class="language-plaintext highlighter-rouge">DeleteCells</code> path that removes a null slot from a multi-row grid and for the merge helper when one parent clone already exists.</li>
</ul>
  <h2 id="practical-testing-checklist">
    
    
     <a href="#practical-testing-checklist">#</a><a href="#" aria-label="Back to top">Practical Testing Checklist</a>
        
    
  </h2>
      
<p>Use these focused checks to validate behavior after any code change touching the swap logic:</p>
<ul>
  <li>Verify swaps only run when both parent and grandparent grids are 1×N or N×1 (exercise all three error messages).</li>
  <li>Confirm merged results keep every child grid (use Examples 2 and 4 to see that no payload is dropped during merges).</li>
  <li>Exercise the ancestor-tag guard by creating a chain with repeated tags (Example 3) and ensure only one promotion occurs.</li>
  <li>Walk the depth-dependent paths (Example 5) to ensure press counts still match the two-level-hop rule.</li>
  <li>Ensure undo works: perform a swap and Ctrl+Z to restore; redo should reapply the promotion without divergence.</li>
  <li>Serialize to <code class="language-plaintext highlighter-rouge">.cts</code> and diff the XML snippets above to confirm structural equivalence in file form.</li>
</ul>
  <h2 id="faq-code-grounded">
    
    
     <a href="#faq-code-grounded">#</a><a href="#" aria-label="Back to top">FAQ (code-grounded)</a>
        
    
  </h2>
      
<ul>
  <li><strong>Why restart with <code class="language-plaintext highlighter-rouge">goto</code>?</strong> The grid topology changes during promotion and merge. Restarting ensures newly attached grids are eligible for immediate scanning without complex iterator management.</li>
  <li><strong>Why prune empty 1×1 grids?</strong> Promotion often hollows out ancestor shells. Cleaning them avoids empty visual rows/columns and keeps selection paths short.</li>
  <li><strong>Why does an ancestor tag stop further passes?</strong> Without <code class="language-plaintext highlighter-rouge">done</code>, a repeated tag could ping-pong upward indefinitely. The guard enforces a single promotion when the chain already contains the tag.</li>
  <li><strong>Can swaps occur across unrelated branches?</strong> No. The scope is the selected cell’s grandparent grid; only descendants of each child grid under that grandparent are scanned.</li>
  <li><strong>What happens when both merge candidates have grids?</strong> <code class="language-plaintext highlighter-rouge">MergeTagAll</code> merges every cell from the source grid into the destination grid, preserving ordering; if one side lacks a grid, the other grid is kept intact.</li>
</ul>
  <h2 id="quick-regression-matrix-who-to-press-where">
    
    
     <a href="#quick-regression-matrix-who-to-press-where">#</a><a href="#" aria-label="Back to top">Quick Regression Matrix (who to press where)</a>
        
    
  </h2>
      
<p>| Scenario | Selection | Expected presses | Expected top-level result |
| — | — | — | — |
| Single match | <code class="language-plaintext highlighter-rouge">Alice</code> under <code class="language-plaintext highlighter-rouge">Project A</code> | 1 | <code class="language-plaintext highlighter-rouge">Alice</code> at Projects with <code class="language-plaintext highlighter-rouge">Project A</code> child |
| Two matches, differing depths | Any <code class="language-plaintext highlighter-rouge">Red</code> | 1 | Single <code class="language-plaintext highlighter-rouge">Red</code> at <code class="language-plaintext highlighter-rouge">Colors</code> with <code class="language-plaintext highlighter-rouge">Warm</code> and <code class="language-plaintext highlighter-rouge">Mixed → Purple</code> children |
| Repeated ancestor tag | Inner <code class="language-plaintext highlighter-rouge">Tag</code> | 1 | Two nested <code class="language-plaintext highlighter-rouge">Tag</code> nodes under <code class="language-plaintext highlighter-rouge">Root</code>, no further passes |
| Parallel tag merges | Any <code class="language-plaintext highlighter-rouge">tag</code> under <code class="language-plaintext highlighter-rouge">branch1/2</code> | 1 | Single <code class="language-plaintext highlighter-rouge">tag</code> under <code class="language-plaintext highlighter-rouge">main</code> with both branches merged |
| Depth-varied siblings | Shallow <code class="language-plaintext highlighter-rouge">Jamie</code> | 2 | Single <code class="language-plaintext highlighter-rouge">Jamie</code> under <code class="language-plaintext highlighter-rouge">Departments</code> with all departments beneath |
| Depth-varied siblings | Mid <code class="language-plaintext highlighter-rouge">Jamie</code> | 1 | Same as above |
| Depth-varied siblings | Deep <code class="language-plaintext highlighter-rouge">Jamie</code> | 3 | Same as above |</p>

        </div>
        
          URL: https://ib.bsb.br/ts-swap
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/txt-swap/" title="content swap" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/regexnedit/" title="xnedit regex" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/opengl-status/" title="verify OpenGL+OpenGL ES within Bullseye" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/rk3588-custom/" title="rk3588 custom documentation" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2026-01-21 19:10:29
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/ts-swap/"
        },
        "headline": "TreeSheets Hierarchy Swap documentation",
        "description": "",
        "datePublished": "2026-01-01T00:00:00+00:00",
        "dateModified": "2026-01-01T23:34:40+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
