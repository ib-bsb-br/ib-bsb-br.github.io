<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        restic to transfer files - infoBAG
      
    </title>
    <meta name="title" content="restic to transfer files - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/restic-to-transfer-files/">
    <meta property="og:title" content="restic to transfer files - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/restic-to-transfer-files/">
    <meta name="twitter:title" content="restic to transfer files - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/restic-to-transfer-files/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="aid&gt;software">
      
        <meta property="article:tag" content="aid&gt;software">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          restic to transfer files
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-05-13T00:00:00+00:00" class="post-date">
          13 May 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-06-16T19:12:19+00:00">
              16 Jun 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/restic-to-transfer-files" class="tag">restic-to-transfer-files</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#aid-software" class="tag">aid>software</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        43987 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        5204 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-05-13-restic-to-transfer-files.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-05-13-restic-to-transfer-files.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#using-restic-to-transfer-a-large-img-file-in-debian">Using <code class="language-plaintext highlighter-rouge">restic</code> to Transfer a Large <code class="language-plaintext highlighter-rouge">.img</code> File in Debian</a><ul><li><a href="#1-install-restic">1. Install <code class="language-plaintext highlighter-rouge">restic</code></a></li><li><a href="#2-set-repository-password">2. Set Repository Password</a></li><li><a href="#3-initialize-the-restic-repository">3. Initialize the <code class="language-plaintext highlighter-rouge">restic</code> Repository</a></li><li><a href="#4-back-up-the-img-file-to-the-repository">4. Back Up the <code class="language-plaintext highlighter-rouge">.img</code> File to the Repository</a></li><li><a href="#5-restore-the-img-file-from-the-repository">5. Restore the <code class="language-plaintext highlighter-rouge">.img</code> File from the Repository</a></li><li><a href="#6-move-the-restored-file-to-its-final-location">6. Move the Restored File to its Final Location</a></li><li><a href="#7-verify-file-integrity">7. Verify File Integrity</a></li><li><a href="#important-notes">Important Notes</a></li></ul></li><li><a href="#integrating-restic-with-storj-for-decentralized-cloud-backups">Integrating Restic with Storj for Decentralized Cloud Backups</a><ul><li><a href="#1-introduction-to-storj-for-restic-users">1. Introduction to Storj for Restic Users</a></li><li><a href="#2-prerequisites">2. Prerequisites</a></li><li><a href="#3-rclone-configuration-for-storj">3. Rclone Configuration for Storj</a><ul><li><a href="#31-method-1-configuring-rclone-for-storj-via-s3-compatible-gateway">3.1. Method 1: Configuring Rclone for Storj via S3-Compatible Gateway</a></li><li><a href="#32-method-2-configuring-rclone-for-native-storj-integration-uplink">3.2. Method 2: Configuring Rclone for Native Storj Integration (Uplink)</a></li></ul></li><li><a href="#4-restic-repository-setup-on-storj">4. Restic Repository Setup on Storj</a></li><li><a href="#5-backup-operations-with-storj">5. Backup Operations with Storj</a></li><li><a href="#6-restore-operations-from-storj">6. Restore Operations from Storj</a></li><li><a href="#7-repository-maintenance-on-storj">7. Repository Maintenance on Storj</a></li><li><a href="#8-performance-considerations-and-troubleshooting-with-storj">8. Performance Considerations and Troubleshooting with Storj</a></li><li><a href="#9-security-and-cost-considerations">9. Security and Cost Considerations</a></li></ul></li></ul></li><li><a href="#integrating-restic-with-google-drive-for-cloud-backups-and-maintenance">Integrating Restic with Google Drive for Cloud backups and maintenance</a><ul><li><a href="#the-backup-script-gdrive-backup">The Backup Script: <code class="language-plaintext highlighter-rouge">gdrive-backup</code></a><ul><li><a href="#line-by-line-explanation">Line-by-Line Explanation:</a></li></ul></li></ul></li><li><a href="#the-maintenance-script-gdrive-maintenance">The Maintenance Script: <code class="language-plaintext highlighter-rouge">gdrive-maintenance</code></a><ul><li><a href="#explanation-of-components">Explanation of Components:</a><ul><li><a href="#option-1-check-integrity"><strong>Option 1: Check Integrity</strong></a></li><li><a href="#option-2-prune-old-snapshots"><strong>Option 2: Prune Old Snapshots</strong></a></li></ul></li></ul></li></ul></li></ul></li></ul>
          <p>This guide uses the following specific paths:</p>
<ul>
  <li><strong>Source File:</strong> <code class="language-plaintext highlighter-rouge">/opt/data_files/original_large.img</code></li>
  <li><strong>External Drive Mount Point:</strong> <code class="language-plaintext highlighter-rouge">/media/my_external_drive</code></li>
  <li><strong>Restic Repository on External Drive:</strong> <code class="language-plaintext highlighter-rouge">/media/my_external_drive/restic_img_repo</code></li>
  <li><strong>Final Destination for Restored File:</strong> <code class="language-plaintext highlighter-rouge">/media/my_external_drive/final_copied_image.img</code></li>
</ul>

<p>Adjust these paths to match your actual file locations and drive configuration.</p><hr />
  <h1 id="using-restic-to-transfer-a-large-img-file-in-debian">
    
    
     <a href="#using-restic-to-transfer-a-large-img-file-in-debian">#</a><a href="#" aria-label="Back to top">Using <code class="language-plaintext highlighter-rouge">restic</code> to Transfer a Large <code class="language-plaintext highlighter-rouge">.img</code> File in Debian</a>
        
    
  </h1>
      
  <h2 id="1-install-restic">
    
    
     <a href="#1-install-restic">#</a><a href="#" aria-label="Back to top">1. Install <code class="language-plaintext highlighter-rouge">restic</code></a>
        
    
  </h2>
      

<p>If <code class="language-plaintext highlighter-rouge">restic</code> is not already installed:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>restic <span class="nt">-y</span>
</code></section></div></div>
  <h2 id="2-set-repository-password">
    
    
     <a href="#2-set-repository-password">#</a><a href="#" aria-label="Back to top">2. Set Repository Password</a>
        
    
  </h2>
      

<p><code class="language-plaintext highlighter-rouge">restic</code> encrypts all data in its repository. You need to set a password for it. Choose a strong, unique password and <strong>store it securely</strong>. If you lose this password, your backed-up data will be irrecoverable.</p>

<p>Export the password as an environment variable for the current terminal session:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">export </span><span class="nv">RESTIC_PASSWORD</span><span class="o">=</span><span class="s1">'your-chosen-strong-password'</span>
</code></section></div></div>
<p>(Replace <code class="language-plaintext highlighter-rouge">'your-chosen-strong-password'</code> with your actual password). You’ll need to do this in any new terminal or add it to your shell’s startup file (e.g., <code class="language-plaintext highlighter-rouge">~/.bashrc</code>) for persistence.</p>
  <h2 id="3-initialize-the-restic-repository">
    
    
     <a href="#3-initialize-the-restic-repository">#</a><a href="#" aria-label="Back to top">3. Initialize the <code class="language-plaintext highlighter-rouge">restic</code> Repository</a>
        
    
  </h2>
      

<p>Create the <code class="language-plaintext highlighter-rouge">restic</code> repository on your external drive. This only needs to be done once for a new repository.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-r</span> /media/my_external_drive/restic_img_repo init
</code></section></div></div>
<p><strong>Expected output on success:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>created restic repository XXXXXXXX at /media/my_external_drive/restic_img_repo

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irreversibly lost.
</code></section></div></div>
  <h2 id="4-back-up-the-img-file-to-the-repository">
    
    
     <a href="#4-back-up-the-img-file-to-the-repository">#</a><a href="#" aria-label="Back to top">4. Back Up the <code class="language-plaintext highlighter-rouge">.img</code> File to the Repository</a>
        
    
  </h2>
      

<p>This step copies the source file into the <code class="language-plaintext highlighter-rouge">restic</code> repository. <code class="language-plaintext highlighter-rouge">restic</code> shows progress and can resume if interrupted; simply re-run the same command.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-r</span> /media/my_external_drive/restic_img_repo backup /opt/data_files/original_large.img <span class="nt">--verbose</span>
</code></section></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">-r /media/my_external_drive/restic_img_repo</code>: Specifies the repository.</li>
  <li><code class="language-plaintext highlighter-rouge">backup /opt/data_files/original_large.img</code>: Backs up the specified file.</li>
  <li><code class="language-plaintext highlighter-rouge">--verbose</code>: Provides detailed progress (percentage, speed, ETA).</li>
</ul>

<p>Note the snapshot ID outputted upon completion (e.g., <code class="language-plaintext highlighter-rouge">snapshot abcdef01 saved</code>). You can usually use <code class="language-plaintext highlighter-rouge">latest</code> instead of the ID.</p>
  <h2 id="5-restore-the-img-file-from-the-repository">
    
    
     <a href="#5-restore-the-img-file-from-the-repository">#</a><a href="#" aria-label="Back to top">5. Restore the <code class="language-plaintext highlighter-rouge">.img</code> File from the Repository</a>
        
    
  </h2>
      

<p>This step extracts the file from the repository to a standard file on your external drive.
<code class="language-plaintext highlighter-rouge">restic</code> restores files with their original path structure relative to the backup root, under the <code class="language-plaintext highlighter-rouge">--target</code> directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-r</span> /media/my_external_drive/restic_img_repo restore latest <span class="nt">--target</span> /media/my_external_drive/restore_temp <span class="nt">--include</span> /opt/data_files/original_large.img <span class="nt">--verbose</span>
</code></section></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">restore latest</code>: Restores from the most recent snapshot.</li>
  <li><code class="language-plaintext highlighter-rouge">--target /media/my_external_drive/restore_temp</code>: Base directory for restoration. A temporary directory name is used here for clarity before the final move.</li>
  <li><code class="language-plaintext highlighter-rouge">--include /opt/data_files/original_large.img</code>: Specifies only this file should be restored from the snapshot.</li>
</ul>

<p>This command will restore the file to: <code class="language-plaintext highlighter-rouge">/media/my_external_drive/restore_temp/opt/data_files/original_large.img</code>.</p>
  <h2 id="6-move-the-restored-file-to-its-final-location">
    
    
     <a href="#6-move-the-restored-file-to-its-final-location">#</a><a href="#" aria-label="Back to top">6. Move the Restored File to its Final Location</a>
        
    
  </h2>
      

<p>Move the restored file from the temporary restoration path to your desired final path and name.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">mv</span> /media/my_external_drive/restore_temp/opt/data_files/original_large.img /media/my_external_drive/final_copied_image.img
</code></section></div></div>
<p>After the move, you can remove the temporary directory structure if it’s empty:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">rmdir</span> <span class="nt">-p</span> /media/my_external_drive/restore_temp/opt/data_files
</code></section></div></div>
<p>(The <code class="language-plaintext highlighter-rouge">-p</code> option removes parent directories if they become empty).</p>
  <h2 id="7-verify-file-integrity">
    
    
     <a href="#7-verify-file-integrity">#</a><a href="#" aria-label="Back to top">7. Verify File Integrity</a>
        
    
  </h2>
      

<p>Compare checksums of the original source file and the final restored file.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sha256sum</span> /opt/data_files/original_large.img /media/my_external_drive/final_copied_image.img
</code></section></div></div>
<p>The two checksums <strong>must match exactly</strong>. You can also use <code class="language-plaintext highlighter-rouge">md5sum</code>.</p>
  <h2 id="important-notes">
    
    
     <a href="#important-notes">#</a><a href="#" aria-label="Back to top">Important Notes</a>
        
    
  </h2>
      

<ul>
  <li><strong>Password:</strong> Your <code class="language-plaintext highlighter-rouge">RESTIC_PASSWORD</code> is vital. Loss of the password means loss of data.</li>
  <li><strong>Disk Space:</strong> The external drive needs space for the <code class="language-plaintext highlighter-rouge">restic</code> repository (roughly the size of the <code class="language-plaintext highlighter-rouge">.img</code> file) AND for the fully restored <code class="language-plaintext highlighter-rouge">.img</code> file simultaneously during this process.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">restic</code> is a Backup Tool:</strong> This method uses backup/restore. The repository contains a versioned, deduplicated, and encrypted copy.</li>
  <li><strong>Metadata:</strong> <code class="language-plaintext highlighter-rouge">restic</code> preserves file permissions and modification times.</li>
  <li><strong>Interrupts:</strong> <code class="language-plaintext highlighter-rouge">restic backup</code> and <code class="language-plaintext highlighter-rouge">restic restore</code> operations are generally resumable by re-running the same command.</li>
  <li><strong>Cleanup (Optional):</strong> If you no longer need the backup in the <code class="language-plaintext highlighter-rouge">restic</code> repository after confirming the transfer:
    <ol>
      <li>List snapshots: <code class="language-plaintext highlighter-rouge">restic -r /media/my_external_drive/restic_img_repo snapshots</code></li>
      <li>Forget the snapshot(s) and prune data: <code class="language-plaintext highlighter-rouge">restic -r /media/my_external_drive/restic_img_repo forget &lt;SNAPSHOT_ID_or_latest&gt; --prune</code></li>
      <li>To completely remove the repository: <code class="language-plaintext highlighter-rouge">rm -rf /media/my_external_drive/restic_img_repo</code> (Use <code class="language-plaintext highlighter-rouge">rm -rf</code> with extreme caution).</li>
    </ol>
  </li>
</ul>
  <h1 id="integrating-restic-with-storj-for-decentralized-cloud-backups">
    
    
     <a href="#integrating-restic-with-storj-for-decentralized-cloud-backups">#</a><a href="#" aria-label="Back to top">Integrating Restic with Storj for Decentralized Cloud Backups</a>
        
    
  </h1>
      

<p>Storj is a decentralized cloud object storage platform that offers a compelling backend solution for Restic backups due to its distributed architecture, S3 compatibility, end-to-end encryption principles, and potentially competitive pricing. This section provides a comprehensive guide to configuring and using Restic with Storj, primarily leveraging Rclone as the intermediary.</p>
  <h3 id="1-introduction-to-storj-for-restic-users">
    
    
     <a href="#1-introduction-to-storj-for-restic-users">#</a><a href="#" aria-label="Back to top">1. Introduction to Storj for Restic Users</a>
        
    
  </h3>
      

<p>Storj provides enterprise-grade, globally distributed cloud object storage. Its key features relevant to Restic users include:</p>
<ul>
  <li><strong>Decentralization:</strong> Files are encrypted, erasure-coded, and spread across a vast network of independent storage nodes, enhancing durability and availability.</li>
  <li><strong>Security:</strong> Storj emphasizes zero-trust security. When combined with Restic’s client-side end-to-end encryption, your backup data remains confidential even from Storj and its node operators.</li>
  <li><strong>S3-Compatible API:</strong> Storj offers an Amazon S3-compatible API, allowing tools like Rclone (and by extension, Restic) to interact with it seamlessly.</li>
  <li><strong>Native Integration Potential:</strong> Rclone also supports a native Storj integration (via Uplink CLI concepts), which can offer client-side erasure coding for path encryption and potentially optimized performance.</li>
  <li><strong>Cost-Effectiveness:</strong> Storj’s pricing model (typically per GB stored and per GB downloaded) can be attractive, especially when paired with Restic’s efficient deduplication, which minimizes storage footprint.</li>
</ul>

<p>Using Restic with Storj via Rclone allows you to combine Restic’s robust backup features with Storj’s resilient and secure decentralized storage.</p>
  <h3 id="2-prerequisites">
    
    
     <a href="#2-prerequisites">#</a><a href="#" aria-label="Back to top">2. Prerequisites</a>
        
    
  </h3>
      

<p>Before you begin, ensure you have the following:</p>
<ol>
  <li><strong>A Storj Account:</strong> Sign up at <a href="https://storj.io/signup?partner=restic">Storj.io</a>. New accounts often come with a free trial allowance.</li>
  <li><strong>Restic Installed:</strong> Download and install the Restic binary for your operating system from the <a href="https://github.com/restic/restic/releases">official Restic releases page</a> or via your system’s package manager. Ensure it’s in your PATH.</li>
  <li><strong>Rclone Installed:</strong> Download and install Rclone from the <a href="https://rclone.org/install/">official Rclone website</a>. Ensure it’s in your PATH.</li>
</ol>
  <h3 id="3-rclone-configuration-for-storj">
    
    
     <a href="#3-rclone-configuration-for-storj">#</a><a href="#" aria-label="Back to top">3. Rclone Configuration for Storj</a>
        
    
  </h3>
      

<p>Rclone is the bridge between Restic and Storj. You need to configure an Rclone “remote” that points to your Storj account. Storj can be accessed by Rclone in two main ways. The <strong>S3-Compatible Gateway</strong> (Method 1) is often simpler to set up if you’re familiar with S3 credentials and offers broad compatibility. The <strong>Native Storj Integration</strong> (Method 2) uses Storj’s Uplink protocols, may offer client-side erasure coding for path encryption, and could have different performance characteristics. Choose the method that best fits your technical comfort and requirements.</p>
  <h4 id="31-method-1-configuring-rclone-for-storj-via-s3-compatible-gateway">
    
    
     <a href="#31-method-1-configuring-rclone-for-storj-via-s3-compatible-gateway">#</a><a href="#" aria-label="Back to top">3.1. Method 1: Configuring Rclone for Storj via S3-Compatible Gateway</a>
        
    
  </h4>
      

<p>This method uses Storj’s S3-compatible API endpoint and requires S3 credentials (access key and secret key).</p>

<p><strong>Step 1: Generate S3 Credentials in Storj Console</strong></p>
<ol>
  <li>Log in to your Storj account.</li>
  <li>Navigate to <strong>Access Keys</strong> (or a similarly named section for S3 credentials).</li>
  <li>Create a new Access Key.
    <ul>
      <li>Give it a descriptive name (e.g., <code class="language-plaintext highlighter-rouge">restic-backup-s3-creds</code>).</li>
      <li>Set appropriate permissions (Read, Write, List, Delete for the buckets Restic will use).</li>
      <li>Note down the <strong>Access Key ID</strong>, <strong>Secret Access Key</strong>, and the <strong>S3 Gateway Endpoint</strong> (e.g., <code class="language-plaintext highlighter-rouge">gateway.storjshare.io</code>).</li>
    </ul>
  </li>
</ol>

<p><strong>Step 2: Configure Rclone Remote for S3 Gateway</strong>
You can configure Rclone by editing its configuration file directly (find its location with <code class="language-plaintext highlighter-rouge">rclone config file</code>) or by using the interactive <code class="language-plaintext highlighter-rouge">rclone config</code> setup.</p>

<ul>
  <li><strong>Editing <code class="language-plaintext highlighter-rouge">rclone.conf</code> directly:</strong>
Add a new remote section to your <code class="language-plaintext highlighter-rouge">rclone.conf</code> file (e.g., <code class="language-plaintext highlighter-rouge">~/.config/rclone/rclone.conf</code>):
    <div class="language-ini highlighter-rouge"><div class="highlight"><section><code><span class="nn">[storj_s3]</span>
<span class="py">type</span> <span class="p">=</span> <span class="s">s3</span>
<span class="py">provider</span> <span class="p">=</span> <span class="s">Storj</span>
<span class="py">access_key_id</span> <span class="p">=</span> <span class="s">YOUR_STORJ_ACCESS_KEY_ID</span>
<span class="py">secret_access_key</span> <span class="p">=</span> <span class="s">YOUR_STORJ_SECRET_ACCESS_KEY</span>
<span class="py">endpoint</span> <span class="p">=</span> <span class="s">gateway.storjshare.io</span>
<span class="c"># Optional: Define a specific region if needed, though often not required for Storj's global gateway
# region = us-east-1
# Optional: Storj docs sometimes recommend disabling checksum for S3 gateway with rclone
# disable_checksum = true
# Optional: Rclone's 'chunk_size' (e.g., '64M') controls how Rclone itself chunks large files (Restic packs in this case) 
# for multipart upload to S3-compatible storage. This is distinct from Restic's '--pack-size'. 
# Adjusting Rclone's 'chunk_size' might be relevant for optimizing uploads of very large Restic packs 
# over unstable connections, but Restic's default pack handling is usually sufficient.
# chunk_size = 64M 
</span></code></section></div>    </div>
    <p>Replace <code class="language-plaintext highlighter-rouge">YOUR_STORJ_ACCESS_KEY_ID</code> and <code class="language-plaintext highlighter-rouge">YOUR_STORJ_SECRET_ACCESS_KEY</code> with the credentials you generated.</p>
  </li>
  <li><strong>Using <code class="language-plaintext highlighter-rouge">rclone config</code> (Interactive):</strong>
    <ol>
      <li>Run <code class="language-plaintext highlighter-rouge">rclone config</code>.</li>
      <li>Choose <code class="language-plaintext highlighter-rouge">n</code> for a new remote.</li>
      <li>Enter a name, e.g., <code class="language-plaintext highlighter-rouge">storj_s3</code>.</li>
      <li>For “Type of storage to configure,” choose <code class="language-plaintext highlighter-rouge">s3</code> (Amazon S3 Compliant Storage Providers).</li>
      <li>For “S3 Provider,” choose <code class="language-plaintext highlighter-rouge">Storj</code>.</li>
      <li>Enter your <code class="language-plaintext highlighter-rouge">access_key_id</code> and <code class="language-plaintext highlighter-rouge">secret_access_key</code>.</li>
      <li>For “Endpoint for S3 API,” enter the Storj S3 gateway (e.g., <code class="language-plaintext highlighter-rouge">gateway.storjshare.io</code>).</li>
      <li>You can typically leave other options (region, location_constraint, acl) as default or blank unless you have specific requirements.</li>
      <li>Save the configuration.</li>
    </ol>
  </li>
</ul>
  <h4 id="32-method-2-configuring-rclone-for-native-storj-integration-uplink">
    
    
     <a href="#32-method-2-configuring-rclone-for-native-storj-integration-uplink">#</a><a href="#" aria-label="Back to top">3.2. Method 2: Configuring Rclone for Native Storj Integration (Uplink)</a>
        
    
  </h4>
      

<p>This method uses Storj’s native protocols via the Uplink library integrated into Rclone. It might offer client-side erasure coding and potentially different performance characteristics. It typically uses an Access Grant or an API Key and Encryption Passphrase.</p>

<p><strong>Step 1: Obtain Native Access Credentials</strong></p>
<ul>
  <li><strong>Access Grant:</strong> This is a serialized string that bundles permissions, API key, satellite address, and encryption passphrase. You might generate this via the Uplink CLI or receive it if someone is granting you access.</li>
  <li><strong>API Key &amp; Encryption Passphrase:</strong> You can generate an API key from the Storj console and then use it with your chosen encryption passphrase.</li>
</ul>

<p><strong>Step 2: Configure Rclone Remote for Native Storj</strong>
Use the <code class="language-plaintext highlighter-rouge">rclone config</code> interactive setup:</p>
<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">rclone config</code>.</li>
  <li>Choose <code class="language-plaintext highlighter-rouge">n</code> for a new remote.</li>
  <li>Enter a name, e.g., <code class="language-plaintext highlighter-rouge">storj_native</code>.</li>
  <li>For “Type of storage to configure,” find and choose <code class="language-plaintext highlighter-rouge">storj</code> (Storj Decentralized Cloud Storage).</li>
  <li>Rclone will then prompt for the authentication method:
    <ul>
      <li><strong>Existing Access Grant:</strong> If you have an access grant string, choose this option and paste the grant.</li>
      <li><strong>New Access Grant (API Key &amp; Passphrase):</strong> If you have an API key and want to use a new or existing encryption passphrase:
        <ul>
          <li>Select the appropriate satellite address (e.g., <code class="language-plaintext highlighter-rouge">us-central-1.storj.io</code>, <code class="language-plaintext highlighter-rouge">europe-west-1.storj.io</code>, <code class="language-plaintext highlighter-rouge">asia-east-1.storj.io</code>).</li>
          <li>Enter your API Key.</li>
          <li>Enter your encryption passphrase (this is critical for encrypting/decrypting file paths and metadata <em>before</em> Restic’s own encryption layer).</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Review the summary and save the configuration.
    <ul>
      <li><em>Note:</em> Remote-specific tuning flags for the native Storj Rclone remote (like a hypothetical <code class="language-plaintext highlighter-rouge">upload_nolarge_chunks = true</code>) would be added directly to this remote’s section in <code class="language-plaintext highlighter-rouge">rclone.conf</code> if needed, rather than typically passed via <code class="language-plaintext highlighter-rouge">restic -o rclone.args</code>.</li>
    </ul>
  </li>
</ol>

<p><strong>Step 3: Verify Rclone Remote</strong>
After configuring, test your Rclone remote:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>rclone lsd storj_s3:  <span class="c"># or storj_native:</span>
<span class="c"># This should list any buckets you have. If it's a new account, it will be empty.</span>
</code></section></div></div>
  <h3 id="4-restic-repository-setup-on-storj">
    
    
     <a href="#4-restic-repository-setup-on-storj">#</a><a href="#" aria-label="Back to top">4. Restic Repository Setup on Storj</a>
        
    
  </h3>
      

<p><strong>Step 1: Create a Storj Bucket</strong>
Restic needs a bucket (and optionally a path within it) to store its repository. Use Rclone to create a bucket if it doesn’t exist.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Replace 'your-restic-bucket' with your desired bucket name</span>
<span class="c"># Replace 'storj_s3' with your configured Rclone remote name (storj_s3 or storj_native)</span>
rclone <span class="nb">mkdir </span>storj_s3:your-restic-bucket
</code></section></div></div>
<p>Bucket names must be globally unique if using the S3 gateway, or unique within your project for native access.</p>

<p><strong>Step 2: Initialize the Restic Repository</strong>
Now, initialize the Restic repository within the bucket using the Rclone backend.
Choose a strong, unique password for your Restic repository. <strong>Losing this Restic password means your backup data is irrecoverably lost, regardless of Storj access.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Define your Restic repository location using the Rclone remote</span>
<span class="c"># Format: rclone:&lt;rclone-remote-name&gt;:&lt;bucket-name&gt;/&lt;path-within-bucket&gt;</span>
<span class="c"># The path-within-bucket is optional but recommended for organization.</span>
<span class="nb">export </span><span class="nv">RESTIC_REPOSITORY</span><span class="o">=</span><span class="s2">"rclone:storj_s3:your-restic-bucket/my-server-backups"</span>

<span class="c"># Set your Restic password (choose one method)</span>
<span class="nb">export </span><span class="nv">RESTIC_PASSWORD</span><span class="o">=</span><span class="s1">'your-super-strong-restic-password'</span>
<span class="c"># OR use a password file:</span>
<span class="c"># echo 'your-super-strong-restic-password' &gt; ~/.restic-storj-pass</span>
<span class="c"># chmod 600 ~/.restic-storj-pass</span>
<span class="c"># export RESTIC_PASSWORD_FILE=~/.restic-storj-pass</span>

<span class="c"># Initialize the repository</span>
restic init
</code></section></div></div>
<p>On success, Restic will confirm repository creation.</p>
  <h3 id="5-backup-operations-with-storj">
    
    
     <a href="#5-backup-operations-with-storj">#</a><a href="#" aria-label="Back to top">5. Backup Operations with Storj</a>
        
    
  </h3>
      

<p>With the repository initialized, you can start backing up data.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Example: Backing up your home directory</span>
restic backup ~/ <span class="nt">--verbose</span> <span class="nt">--tag</span> home_backup_<span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span>

<span class="c"># Example: Backing up specific project directories</span>
restic backup /srv/projectA /var/www/projectB <span class="nt">--verbose</span> <span class="nt">--tag</span> web_projects
</code></section></div></div>

<p><strong>Storj-Specific Optimizations and Considerations:</strong></p>

<ul>
  <li><strong>Pack Size (<code class="language-plaintext highlighter-rouge">--pack-size</code>):</strong>
The Storj documentation (from <code class="language-plaintext highlighter-rouge">raw_data</code>) recommends setting Restic’s pack size to 60 MiB. This is suggested because it aligns well with Storj’s underlying segment sizes (often around 64MiB), potentially minimizing padding or overhead per segment and improving storage efficiency or transfer performance on their network.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic backup /data/to/backup <span class="nt">--pack-size</span><span class="o">=</span>60
</code></section></div>    </div>
    <p>While Restic might be “not very precise” and actual pack files may be slightly larger, this is a good target.</p>
  </li>
  <li><strong>Rclone Options via Restic (<code class="language-plaintext highlighter-rouge">-o</code> or <code class="language-plaintext highlighter-rouge">--option</code>):</strong>
You can pass arguments to the underlying <code class="language-plaintext highlighter-rouge">rclone serve restic</code> command that Restic invokes. These are best used for flags affecting the <code class="language-plaintext highlighter-rouge">serve</code> command itself or general Rclone behavior during that operation.
    <ul>
      <li><strong>Connection Parallelism (<code class="language-plaintext highlighter-rouge">rclone.connections</code>):</strong>
The Storj documentation draft mentions: <code class="language-plaintext highlighter-rouge">Passing -o rclone.connections=1 reduces the Rclone parallelism to a single upload. The Storj backend will still open multiple connections to storage nodes. Use this option to reduce the stress on your router in case of failing uploads with the default parallelism.</code>
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-o</span> rclone.connections<span class="o">=</span>1 backup /data/to/backup
</code></section></div>        </div>
        <p>Conversely, on very stable, high-bandwidth connections, you <em>might</em> experiment with higher values (e.g., <code class="language-plaintext highlighter-rouge">rclone.connections=4</code> or <code class="language-plaintext highlighter-rouge">8</code>), but monitor for errors. The default for Restic’s Rclone backend is 5 connections.</p>
      </li>
      <li><strong>Bandwidth Limiting (via <code class="language-plaintext highlighter-rouge">rclone.args</code>):</strong>
If backups saturate your internet connection or cause instability, you can limit Rclone’s bandwidth by passing the <code class="language-plaintext highlighter-rouge">--bwlimit</code> flag to Rclone:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Limit to 5 MiB/s</span>
restic <span class="nt">-o</span> rclone.args<span class="o">=</span><span class="s2">"serve restic --stdio --bwlimit 5M"</span> backup /data/to/backup
</code></section></div>        </div>
      </li>
      <li><strong>Other Rclone Arguments (<code class="language-plaintext highlighter-rouge">rclone.args</code>):</strong>
For other Rclone flags specific to the <code class="language-plaintext highlighter-rouge">rclone serve restic</code> command:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-o</span> rclone.args<span class="o">=</span><span class="s2">"serve restic --stdio --stats 1m"</span> backup /data/to/backup
<span class="c"># --stats 1m would make rclone print transfer stats every minute during the 'serve restic' operation.</span>
</code></section></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Unix Root Backups:</strong>
When backing up the root directory (<code class="language-plaintext highlighter-rouge">/</code>) on Unix systems, always use <code class="language-plaintext highlighter-rouge">--one-file-system</code> to prevent Restic from trying to back up virtual filesystems like <code class="language-plaintext highlighter-rouge">/proc</code>, <code class="language-plaintext highlighter-rouge">/sys</code>, or other mounted filesystems you don’t intend to include:
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>restic backup / <span class="nt">--one-file-system</span> <span class="nt">--exclude</span> /mnt <span class="nt">--exclude</span> /media <span class="nt">--exclude</span> /var/cache <span class="nt">--exclude</span> /tmp
</code></section></div>    </div>
  </li>
</ul>
  <h3 id="6-restore-operations-from-storj">
    
    
     <a href="#6-restore-operations-from-storj">#</a><a href="#" aria-label="Back to top">6. Restore Operations from Storj</a>
        
    
  </h3>
      

<p>Restoring data is straightforward:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Restore the latest snapshot to ~/restore_dir</span>
restic restore latest <span class="nt">--target</span> ~/restore_dir <span class="nt">--verbose</span>

<span class="c"># Restore a specific snapshot by ID</span>
restic restore &lt;snapshot_ID&gt; <span class="nt">--target</span> ~/restore_dir

<span class="c"># Restore specific files/folders from the latest snapshot</span>
restic restore latest <span class="nt">--target</span> ~/restore_dir <span class="nt">--include</span> <span class="s2">"/path/within/snapshot/to/file.txt"</span> <span class="nt">--include</span> <span class="s2">"/another/path/*"</span>
</code></section></div></div>
<p><strong>Considerations:</strong></p>
<ul>
  <li><strong>Egress Costs:</strong> Restoring large amounts of data from any cloud storage, including Storj, will incur download (egress) bandwidth charges. Factor this into your recovery plan.</li>
  <li><strong>Time:</strong> Download speeds will depend on your internet connection, Storj network performance, and the number/size of files.</li>
</ul>
  <h3 id="7-repository-maintenance-on-storj">
    
    
     <a href="#7-repository-maintenance-on-storj">#</a><a href="#" aria-label="Back to top">7. Repository Maintenance on Storj</a>
        
    
  </h3>
      

<p>Regular maintenance is crucial for managing storage space and ensuring repository health.</p>

<ul>
  <li><strong>Forgetting Old Snapshots (<code class="language-plaintext highlighter-rouge">restic forget</code>):</strong>
Define a retention policy to remove old, unneeded snapshots. Always use <code class="language-plaintext highlighter-rouge">--prune</code> with <code class="language-plaintext highlighter-rouge">forget</code> when interacting with cloud backends to reclaim space.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Keep the last 7 daily, 4 weekly, 6 monthly, 1 yearly snapshots, and prune data</span>
restic forget <span class="nt">--keep-daily</span> 7 <span class="nt">--keep-weekly</span> 4 <span class="nt">--keep-monthly</span> 6 <span class="nt">--keep-yearly</span> 1 <span class="nt">--prune</span>

<span class="c"># Forget a specific snapshot and prune</span>
<span class="c"># restic forget &lt;snapshot_ID&gt; --prune</span>
</code></section></div>    </div>
  </li>
  <li><strong>Checking Repository Integrity (<code class="language-plaintext highlighter-rouge">restic check</code>):</strong>
Periodically verify the repository’s consistency.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic check
</code></section></div>    </div>
    <p>For a more thorough check that reads all data packs (slower and incurs more download operations/costs on cloud storage):</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic check <span class="nt">--read-data</span>
<span class="c"># Or check a subset of data:</span>
<span class="c"># restic check --read-data-subset=10%</span>
</code></section></div>    </div>
  </li>
</ul>
  <h3 id="8-performance-considerations-and-troubleshooting-with-storj">
    
    
     <a href="#8-performance-considerations-and-troubleshooting-with-storj">#</a><a href="#" aria-label="Back to top">8. Performance Considerations and Troubleshooting with Storj</a>
        
    
  </h3>
      

<p>Based on community discussions (e.g., the Storj forum thread in <code class="language-plaintext highlighter-rouge">raw_data</code>):</p>
<ul>
  <li><strong>“Successful puts less than success threshold” Errors:</strong> This error, sometimes seen with Rclone and Storj, indicates that Rclone couldn’t upload enough erasure-coded pieces of a segment to enough storage nodes to meet the success threshold.
    <ul>
      <li><strong>Possible Causes:</strong> Network instability, router issues (too many connections), very slow individual nodes, or aggressive Rclone transfer settings.</li>
      <li><strong>Mitigation:</strong>
        <ul>
          <li>Try reducing Rclone’s parallelism: <code class="language-plaintext highlighter-rouge">restic -o rclone.connections=1 ...</code></li>
          <li>Limit bandwidth: <code class="language-plaintext highlighter-rouge">restic -o rclone.args="serve restic --stdio --bwlimit &lt;rate&gt;" ...</code></li>
          <li>Ensure your Rclone and Restic versions are up-to-date.</li>
          <li>Check the Storj status page and community forums for any ongoing network issues.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Upload/Download Speeds:</strong>
    <ul>
      <li>Heavily dependent on your internet connection’s upload/download capacity.</li>
      <li>Storj’s decentralized nature means performance can vary.</li>
      <li>Small files can have higher per-file overhead than large files. Restic’s packing helps, but very numerous tiny files can still be slower.</li>
      <li>Initial backups are often slower than subsequent incremental backups due to Restic’s deduplication.</li>
    </ul>
  </li>
  <li><strong>Rclone &amp; Restic Logging:</strong>
    <ul>
      <li>To get detailed logs from Rclone during a Restic operation, you can instruct Restic to pass logging flags to Rclone:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-o</span> rclone.args<span class="o">=</span><span class="s2">"serve restic --stdio -vv --log-file /tmp/rclone-restic.log"</span> backup ...
</code></section></div>        </div>
        <p>This will make Rclone itself very verbose. Inspect <code class="language-plaintext highlighter-rouge">/tmp/rclone-restic.log</code>.</p>
      </li>
      <li>For debugging Restic’s own operations and progress, use Restic’s verbosity flags (e.g., <code class="language-plaintext highlighter-rouge">restic -vv backup ...</code>) or set <code class="language-plaintext highlighter-rouge">export RESTIC_PROGRESS_FPS=10</code> for more frequent progress updates from Restic.</li>
    </ul>
  </li>
</ul>

<p>Refer to the <a href="https://forum.storj.io/">Storj Community Forum</a> for ongoing discussions and support, particularly the thread mentioned in the initial draft: <a href="https://forum.storj.io/t/two-more-tech-previews-rclone-and-restic/6072">Two more Tech Previews - RClone and Restic</a> (though note this thread is from 2020 and information may have evolved).</p>
  <h3 id="9-security-and-cost-considerations">
    
    
     <a href="#9-security-and-cost-considerations">#</a><a href="#" aria-label="Back to top">9. Security and Cost Considerations</a>
        
    
  </h3>
      

<ul>
  <li><strong>Security:</strong>
    <ul>
      <li><strong>Restic’s End-to-End Encryption:</strong> Your data is encrypted on your machine <em>before</em> it’s sent to Rclone and then to Storj. Only you, with the Restic repository password, can decrypt it. A key benefit of Restic’s client-side encryption is that Storj (or any cloud provider used as a backend) only ever stores encrypted blobs of data. They cannot access your actual file contents or metadata, ensuring a high degree of privacy.</li>
      <li><strong>Storj’s Security:</strong> Storj further encrypts data segments and distributes them. If using native Rclone integration with an encryption passphrase, that adds another layer for metadata path encryption.</li>
      <li><strong>Access Credentials:</strong> Protect your Storj S3 credentials, Access Grants, API keys, and especially your Restic repository password diligently.</li>
    </ul>
  </li>
  <li><strong>Cost:</strong>
    <ul>
      <li><strong>Storage:</strong> Storj charges for the amount of data stored per month (after erasure coding, so 1GB of your data might consume ~2.7GB on the network, but you are typically billed for the 1GB). Restic’s deduplication significantly reduces the actual data stored over time for versioned backups.</li>
      <li><strong>Egress (Download):</strong> Storj charges for data downloaded from the network. This is relevant for restores.</li>
      <li><strong>Operations:</strong> There might be minor charges for certain API operations, but these are usually less significant for typical Restic usage.</li>
      <li>Always refer to the <a href="https://storj.io/dcs/pricing">official Storj pricing page</a> for current details. Restic’s efficiency helps in making Storj a cost-effective option for long-term, secure backups.</li>
    </ul>
  </li>
</ul>
  <h1 id="integrating-restic-with-google-drive-for-cloud-backups-and-maintenance">
    
    
     <a href="#integrating-restic-with-google-drive-for-cloud-backups-and-maintenance">#</a><a href="#" aria-label="Back to top">Integrating Restic with Google Drive for Cloud backups and maintenance</a>
        
    
  </h1>
      

<p>The <strong><code class="language-plaintext highlighter-rouge">gdrive-backup</code></strong> script is for <em>adding</em> data to your backup, while the <strong><code class="language-plaintext highlighter-rouge">gdrive-maintenance</code></strong> script is for <em>managing</em> that data to ensure it remains healthy and efficient over the long term.</p>

<section class="code-block-container" role="group" aria-label="Bash Code Block" data-filename="bash_code_block.sh" data-code="#!/bin/bash
#
# This script automates the setup for a &quot;Backup-First&quot; model using rclone and restic.
# It intelligently installs/upgrades the latest tools, interactively guides the user
# through the complex rclone Google Drive authentication, verifies success at each
# step, and deploys easy-to-use scripts for backups and maintenance.
#
# Target System: Debian 11 (Bullseye) on ARM64 RK3588
# Executed from: User&#39;s home directory (~/)

# --- Strict Mode &amp; Error Handling ---
set -euo pipefail

# --- Global Configuration (Can be customized) ---
RESTIC_REPO_PATH=&quot;ResticBackups/my-linux-desktop&quot;
RESTIC_PASSWORD_FILE=&quot;$HOME/.config/restic/gdrive_password&quot;
USER_SCRIPT_DIR=&quot;$HOME/bin&quot;
BACKUP_SCRIPT_NAME=&quot;gdrive-backup&quot;
MAINTENANCE_SCRIPT_NAME=&quot;gdrive-maintenance&quot;

# This will be determined dynamically.
RCLONE_REMOTE_NAME=&quot;&quot;

# --- Color Setup ---
setup_colors() {
    if tput setaf 1 &gt;/dev/null 2&gt;&amp;1; then
        C_RESET=$(tput sgr0); C_INFO=$(tput setaf 2); C_WARN=$(tput setaf 3)
        C_ACTION=$(tput setaf 6); C_ERROR=$(tput setaf 1); C_BOLD=$(tput bold)
    else
        C_RESET=&quot;&quot;; C_INFO=&quot;&quot;; C_WARN=&quot;&quot;; C_ACTION=&quot;&quot;; C_ERROR=&quot;&quot;; C_BOLD=&quot;&quot;
    fi
}

# --- Helper Functions ---

cleanup_on_exit() {
    if [ -n &quot;${TEMP_DOWNLOAD_DIR:-}&quot; ] &amp;&amp; [ -d &quot;$TEMP_DOWNLOAD_DIR&quot; ]; then
        echo; echo &quot;${C_INFO}INFO: Cleaning up temporary directory...${C_RESET}&quot;
        rm -rf &quot;$TEMP_DOWNLOAD_DIR&quot;
    fi
}

ensure_tool_installed() {
    local tool_name=&quot;$1&quot;
    local package_name=&quot;${2:-$tool_name}&quot;
    if ! command -v &quot;$tool_name&quot; &gt;/dev/null 2&gt;&amp;1; then
        echo &quot;${C_INFO}INFO: Tool &#39;${C_BOLD}$tool_name${C_RESET}${C_INFO}&#39; not found. Installing &#39;${C_BOLD}$package_name${C_RESET}${C_INFO}&#39;...${C_RESET}&quot;
        if ! sudo apt-get install -y &quot;$package_name&quot;; then
            echo &quot;${C_ERROR}ERROR: Failed to install &#39;$package_name&#39;. Please install it manually.${C_RESET}&quot; &gt;&amp;2; exit 1
        fi
        echo &quot;${C_INFO}SUCCESS: &#39;$package_name&#39; installed.${C_RESET}&quot;
    else
        echo &quot;${C_INFO}INFO: Tool &#39;${C_BOLD}$tool_name${C_RESET}${C_INFO}&#39; is already installed.${C_RESET}&quot;
    fi
}

ensure_path() {
    echo &quot;${C_INFO}INFO: Ensuring &#39;${C_BOLD}$USER_SCRIPT_DIR${C_RESET}${C_INFO}&#39; is in your PATH...${C_RESET}&quot;
    mkdir -p &quot;$USER_SCRIPT_DIR&quot;
    if [[ &quot;:$PATH:&quot; != *&quot;:$USER_SCRIPT_DIR:&quot;* ]]; then
        echo &quot;${C_WARN}WARNING: &#39;${C_BOLD}$USER_SCRIPT_DIR${C_RESET}${C_WARN}&#39; is not in your active PATH.${C_RESET}&quot;
        local profile_file=&quot;$HOME/.profile&quot;
        if [ -f &quot;$HOME/.bash_profile&quot; ]; then profile_file=&quot;$HOME/.bash_profile&quot;; elif [ -f &quot;$HOME/.zshrc&quot; ]; then profile_file=&quot;$HOME/.zshrc&quot;; elif [ -f &quot;$HOME/.bashrc&quot; ]; then profile_file=&quot;$HOME/.bashrc&quot;; fi
        if ! grep -q &#39;export PATH=&quot;$HOME/bin:$PATH&quot;&#39; &quot;$profile_file&quot;; then
            echo &quot;${C_ACTION}ACTION: Adding PATH export to &#39;${C_BOLD}$profile_file${C_RESET}${C_ACTION}&#39;.${C_RESET}&quot;
            { echo &#39;&#39;; echo &#39;# Add local bin directory to PATH&#39;; echo &#39;export PATH=&quot;$HOME/bin:$PATH&quot;&#39;; } &gt;&gt; &quot;$profile_file&quot;
            echo &quot;${C_WARN}You must run &#39;${C_BOLD}source \&quot;$profile_file\&quot;${C_RESET}${C_WARN}&#39; or restart your terminal for changes to take effect.${C_RESET}&quot;
        fi
    fi
}

install_restic() {
    echo &quot;${C_INFO}INFO: Checking Restic version...${C_RESET}&quot;
    local latest_version installed_version
    latest_version=$(curl -s &quot;https://api.github.com/repos/restic/restic/releases/latest&quot; | jq -r .tag_name | sed &#39;s/v//&#39;)
    installed_version=$(restic version 2&gt;/dev/null | awk &#39;{print $2}&#39; || echo &quot;0.0.0&quot;)

    if dpkg --compare-versions &quot;$installed_version&quot; &quot;lt&quot; &quot;$latest_version&quot;; then
        echo &quot;${C_INFO}INFO: A new Restic version (${C_BOLD}$latest_version${C_RESET}${C_INFO}) is available (you have $installed_version). Upgrading...${C_RESET}&quot;
        local restic_url
        restic_url=$(curl -s &quot;https://api.github.com/repos/restic/restic/releases/latest&quot; | jq -r &#39;.assets[] | select(.name | contains(&quot;linux_arm64.bz2&quot;)) | .browser_download_url&#39;)
        if [ -z &quot;$restic_url&quot; ]; then echo &quot;${C_ERROR}ERROR: Could not find Restic ARM64 release URL.${C_RESET}&quot; &gt;&amp;2; exit 1; fi

        echo &quot;${C_INFO}INFO: Downloading from: ${C_BOLD}$restic_url${C_RESET}&quot;
        local TEMP_DOWNLOAD_DIR; TEMP_DOWNLOAD_DIR=$(mktemp -d)
        curl -Lfo &quot;${TEMP_DOWNLOAD_DIR}/restic.bz2&quot; &quot;${restic_url}&quot;
        bunzip2 &quot;${TEMP_DOWNLOAD_DIR}/restic.bz2&quot;
        sudo mv &quot;${TEMP_DOWNLOAD_DIR}/restic&quot; /usr/local/bin/restic
        sudo chmod +x /usr/local/bin/restic
        echo &quot;${C_INFO}SUCCESS: Restic upgraded to version $(restic version | awk &#39;{print $2}&#39;).${C_RESET}&quot;
    else
        echo &quot;${C_INFO}INFO: Your Restic version (${C_BOLD}$installed_version${C_RESET}${C_INFO}) is up to date.${C_RESET}&quot;
    fi
}

configure_rclone_remote() {
    local gdrive_remotes
    gdrive_remotes=$(rclone listremotes | sed &#39;s/://&#39; || true)

    if [ -n &quot;$gdrive_remotes&quot; ]; then
        echo &quot;${C_ACTION}ACTION: Found existing rclone remotes. Please choose one or create a new one:${C_RESET}&quot;
        select remote in $gdrive_remotes &quot;CREATE_A_NEW_REMOTE&quot;; do
            if [ &quot;$remote&quot; == &quot;CREATE_A_NEW_REMOTE&quot; ]; then
                break # Break to the creation part
            elif [ -n &quot;$remote&quot; ]; then
                RCLONE_REMOTE_NAME=$remote
                return
            else
                echo &quot;${C_ERROR}Invalid selection.${C_RESET}&quot;
            fi
        done
    fi

    # This section runs if no remotes exist or user chose to create a new one
    echo
    echo &quot;${C_ACTION}------------------------- IMPORTANT: Rclone Setup Instructions -------------------------${C_RESET}&quot;
    echo &quot;${C_WARN}You will now be guided through creating a Google Drive remote.${C_RESET}&quot;
    echo &quot;1. When prompted for &#39;name&#39;, choose a simple name (e.g., &#39;gdrive_hub&#39;).&quot;
    echo &quot;2. When prompted for &#39;Storage&#39;, select &#39;drive&#39; (Google Drive).&quot;
    echo &quot;3. For &#39;client_id&#39; and &#39;client_secret&#39;, you must provide your own credentials from the Google Cloud Console.&quot;
    echo &quot;   ${C_ERROR}CRITICAL: When you copy your Client ID, copy ONLY the ID string, like:${C_RESET}&quot;
    echo &quot;   ${C_BOLD}1234567890-abcdefghijklmnopqrstuvwxyz.apps.googleusercontent.com${C_RESET}&quot;
    echo &quot;   ${C_ERROR}DO NOT paste the full URL or anything else.${C_RESET}&quot;
    echo &quot;4. For all other options, pressing Enter for the default is usually safe.&quot;
    echo &quot;5. Your web browser should open for you to authorize the connection.&quot;
    echo &quot;${C_ACTION}--------------------------------------------------------------------------------------${C_RESET}&quot;
    read -r -p &quot;Press ENTER to begin...&quot;
    
    rclone config
    
    # After creation, ask the user to confirm the name of the new remote
    echo &quot;${C_ACTION}ACTION: Please enter the name of the remote you just created:${C_RESET}&quot;
    read -r RCLONE_REMOTE_NAME
    if [ -z &quot;$RCLONE_REMOTE_NAME&quot; ]; then
        echo &quot;${C_ERROR}ERROR: No remote name provided. Exiting.${C_RESET}&quot; &gt;&amp;2
        exit 1
    fi
}

# --- Main Execution ---

main() {
    setup_colors
    trap cleanup_on_exit EXIT SIGINT SIGTERM

    echo &quot;${C_BOLD}====================================================================${C_RESET}&quot;
    echo &quot;${C_BOLD}=== Robust Rclone + Restic Backup Setup for Debian             ===${C_RESET}&quot;
    echo &quot;${C_BOLD}====================================================================${C_RESET}&quot;
    echo

    # --- Step 1: Install Prerequisites ---
    echo &quot;--- [Step 1/7] Installing prerequisite tools...&quot;
    sudo apt-get update -qq
    ensure_tool_installed &quot;curl&quot; &quot;curl&quot;
    ensure_tool_installed &quot;unzip&quot; &quot;unzip&quot;
    ensure_tool_installed &quot;rclone&quot; &quot;rclone&quot;
    ensure_tool_installed &quot;jq&quot; &quot;jq&quot;
    ensure_tool_installed &quot;bunzip2&quot; &quot;bzip2&quot;
    echo

    # --- Step 2: Ensure PATH is configured ---
    echo &quot;--- [Step 2/7] Verifying PATH environment...&quot;
    ensure_path
    echo

    # --- Step 3: Install/Upgrade Restic ---
    echo &quot;--- [Step 3/7] Installing/Upgrading Restic...&quot;
    install_restic
    echo

    # --- Step 4: Configure Rclone Remote ---
    echo &quot;--- [Step 4/7] Configuring Rclone remote for Google Drive...&quot;
    configure_rclone_remote
    echo

    # --- Step 5: Verify Rclone Authentication ---
    echo &quot;--- [Step 5/7] Verifying rclone authentication for &#39;${C_BOLD}${RCLONE_REMOTE_NAME}${C_RESET}&#39;...&quot;
    while ! rclone lsd &quot;${RCLONE_REMOTE_NAME}:&quot; &gt;/dev/null 2&gt;&amp;1; do
        echo &quot;${C_ERROR}ERROR: Rclone cannot authenticate with &#39;${C_BOLD}${RCLONE_REMOTE_NAME}${C_RESET}${C_ERROR}&#39;.${C_RESET}&quot;
        echo &quot;${C_WARN}This is likely due to an incomplete or incorrect initial setup.${C_RESET}&quot;
        echo &quot;${C_ACTION}ACTION: Let&#39;s try to fix this by reconnecting the remote.${C_RESET}&quot;
        read -r -p &quot;Press ENTER to run &#39;rclone config reconnect ${RCLONE_REMOTE_NAME}:&#39;...&quot;
        rclone config reconnect &quot;${RCLONE_REMOTE_NAME}:&quot;
        echo &quot;${C_INFO}INFO: Re-checking connection...${C_RESET}&quot;
    done
    echo &quot;${C_INFO}SUCCESS: Rclone authentication for &#39;${C_BOLD}${RCLONE_REMOTE_NAME}${C_RESET}${C_INFO}&#39; is working.${C_RESET}&quot;
    echo

    # --- Step 6: Setup Restic Repository &amp; Password ---
    local restic_repository=&quot;rclone:${RCLONE_REMOTE_NAME}:${RESTIC_REPO_PATH}&quot;
    echo &quot;--- [Step 6/7] Setting up Restic repository and password...&quot;
    echo &quot;Configuration that will be used:&quot;
    echo &quot;  - Rclone Remote:  ${C_BOLD}$RCLONE_REMOTE_NAME${C_RESET}&quot;
    echo &quot;  - Repository Path:  ${C_BOLD}$restic_repository${C_RESET}&quot;
    echo &quot;  - Password File:    ${C_BOLD}$RESTIC_PASSWORD_FILE${C_RESET}&quot;
    
    mkdir -p &quot;$(dirname &quot;$RESTIC_PASSWORD_FILE&quot;)&quot;
    if [ ! -f &quot;$RESTIC_PASSWORD_FILE&quot; ]; then
        echo &quot;${C_ACTION}ACTION: Please create a new, strong password for your backup repository.${C_RESET}&quot;
        read -s -p &quot;Enter repository password: &quot; restic_pass; echo
        read -s -p &quot;Confirm password: &quot; restic_pass_confirm; echo
        if [ &quot;$restic_pass&quot; = &quot;$restic_pass_confirm&quot; ] &amp;&amp; [ -n &quot;$restic_pass&quot; ]; then
            echo &quot;$restic_pass&quot; &gt; &quot;$RESTIC_PASSWORD_FILE&quot; &amp;&amp; chmod 600 &quot;$RESTIC_PASSWORD_FILE&quot;
            echo &quot;${C_INFO}SUCCESS: Password file created.${C_RESET}&quot;
        else
            echo &quot;${C_ERROR}ERROR: Passwords do not match or are empty. Please re-run the script.${C_RESET}&quot; &gt;&amp;2; exit 1
        fi
    else
        echo &quot;${C_INFO}INFO: Existing password file found. Using it.${C_RESET}&quot;
    fi

    if restic -r &quot;$restic_repository&quot; --password-file &quot;$RESTIC_PASSWORD_FILE&quot; cat config &gt;/dev/null 2&gt;&amp;1; then
        echo &quot;${C_INFO}INFO: Restic repository already initialized. Skipping.${C_RESET}&quot;
    else
        echo &quot;${C_WARN}WARNING: Restic repository not found. Initializing...${C_RESET}&quot;
        if ! restic -r &quot;$restic_repository&quot; --password-file &quot;$RESTIC_PASSWORD_FILE&quot; init; then
            echo &quot;${C_ERROR}ERROR: Failed to initialize restic repository.${C_RESET}&quot; &gt;&amp;2; exit 1
        fi
        echo &quot;${C_INFO}SUCCESS: Restic repository initialized.${C_RESET}&quot;
    fi
    echo

    # --- Step 7: Deploy User Scripts ---
    echo &quot;--- [Step 7/7] Deploying helper scripts to &#39;${C_BOLD}$USER_SCRIPT_DIR${C_RESET}&#39;...&quot;
    # Deploy Backup Script
    cat &lt;&lt; EOF &gt; &quot;${USER_SCRIPT_DIR}/${BACKUP_SCRIPT_NAME}&quot;
#!/bin/bash
set -euo pipefail
if [ -z &quot;\${1:-}&quot; ] || [ &quot;\$1&quot; == &quot;--help&quot; ]; then echo &quot;Usage: \$(basename &quot;\$0&quot;) /path/to/backup&quot;; exit 1; fi
if [ ! -d &quot;\$1&quot; ]; then echo &quot;Error: Path &#39;\$1&#39; is not a valid directory.&quot; &gt;&amp;2; exit 1; fi
echo &quot;--- Starting Restic Backup for &#39;\$1&#39; ---&quot;
restic -r &quot;${restic_repository}&quot; --password-file &quot;${RESTIC_PASSWORD_FILE}&quot; --verbose \\
    -o rclone.connections=8 -o rclone.drive-skip-gdocs=true \\
    backup &quot;\$1&quot; --tag &quot;\$(date +%Y%m%d)&quot;
echo &quot;--- Backup Finished ---&quot;
EOF
    chmod +x &quot;${USER_SCRIPT_DIR}/${BACKUP_SCRIPT_NAME}&quot;
    echo &quot;${C_INFO}SUCCESS: Deployed &#39;${C_BOLD}${BACKUP_SCRIPT_NAME}${C_RESET}${C_INFO}&#39;.${C_RESET}&quot;

    # Deploy Maintenance Script
    cat &lt;&lt; EOF &gt; &quot;${USER_SCRIPT_DIR}/${MAINTENANCE_SCRIPT_NAME}&quot;
#!/bin/bash
set -euo pipefail
echo &quot;--- Restic Repository Maintenance ---&quot;
echo &quot;Repository: ${restic_repository}&quot;
echo
PS3=&quot;Please choose a maintenance action: &quot;
select action in &quot;Check Integrity&quot; &quot;Prune Old Snapshots&quot; &quot;Exit&quot;; do
    case \$action in
        &quot;Check Integrity&quot;)
            echo &quot;--- Running integrity check... ---&quot;
            restic -r &quot;${restic_repository}&quot; --password-file &quot;${RESTIC_PASSWORD_FILE}&quot; check
            echo &quot;--- Check complete. ---&quot;; break;;
        &quot;Prune Old Snapshots&quot;)
            echo &quot;--- Applying retention policy (keep 7 daily, 4 weekly, 12 monthly) and pruning... ---&quot;
            restic -r &quot;${restic_repository}&quot; --password-file &quot;${RESTIC_PASSWORD_FILE}&quot; forget \\
                --keep-daily 7 --keep-weekly 4 --keep-monthly 12 --keep-yearly 99 --prune
            echo &quot;--- Prune complete. ---&quot;; break;;
        &quot;Exit&quot;) break;;
        *) echo &quot;Invalid option \$REPLY&quot;;;
    esac
done
EOF
    chmod +x &quot;${USER_SCRIPT_DIR}/${MAINTENANCE_SCRIPT_NAME}&quot;
    echo &quot;${C_INFO}SUCCESS: Deployed &#39;${C_BOLD}${MAINTENANCE_SCRIPT_NAME}${C_RESET}${C_INFO}&#39;.${C_RESET}&quot;
    echo
    echo &quot;${C_BOLD}=========================== SETUP COMPLETE ===========================${C_RESET}&quot;
    echo
    echo &quot;${C_INFO}You are now ready to back up your data!${C_RESET}&quot;
    echo &quot;${C_WARN}If this is a new terminal, remember to run &#39;${C_BOLD}source ~/.profile${C_RESET}${C_WARN}&#39; (or similar).${C_RESET}&quot;
    echo
    echo &quot;  ${C_ACTION}To run a backup:${C_RESET}              ${C_BOLD}${BACKUP_SCRIPT_NAME} /path/to/your/data${C_RESET}&quot;
    echo &quot;  ${C_ACTION}To run repository maintenance:${C_RESET}   ${C_BOLD}${MAINTENANCE_SCRIPT_NAME}${C_RESET}&quot;
    echo
}

main
exit 0" data-download-link="" data-download-label="Download Bash">
  <code class="language-bash">#!/bin/bash
#
# This script automates the setup for a &quot;Backup-First&quot; model using rclone and restic.
# It intelligently installs/upgrades the latest tools, interactively guides the user
# through the complex rclone Google Drive authentication, verifies success at each
# step, and deploys easy-to-use scripts for backups and maintenance.
#
# Target System: Debian 11 (Bullseye) on ARM64 RK3588
# Executed from: User&#39;s home directory (~/)

# --- Strict Mode &amp; Error Handling ---
set -euo pipefail

# --- Global Configuration (Can be customized) ---
RESTIC_REPO_PATH=&quot;ResticBackups/my-linux-desktop&quot;
RESTIC_PASSWORD_FILE=&quot;$HOME/.config/restic/gdrive_password&quot;
USER_SCRIPT_DIR=&quot;$HOME/bin&quot;
BACKUP_SCRIPT_NAME=&quot;gdrive-backup&quot;
MAINTENANCE_SCRIPT_NAME=&quot;gdrive-maintenance&quot;

# This will be determined dynamically.
RCLONE_REMOTE_NAME=&quot;&quot;

# --- Color Setup ---
setup_colors() {
    if tput setaf 1 &gt;/dev/null 2&gt;&amp;1; then
        C_RESET=$(tput sgr0); C_INFO=$(tput setaf 2); C_WARN=$(tput setaf 3)
        C_ACTION=$(tput setaf 6); C_ERROR=$(tput setaf 1); C_BOLD=$(tput bold)
    else
        C_RESET=&quot;&quot;; C_INFO=&quot;&quot;; C_WARN=&quot;&quot;; C_ACTION=&quot;&quot;; C_ERROR=&quot;&quot;; C_BOLD=&quot;&quot;
    fi
}

# --- Helper Functions ---

cleanup_on_exit() {
    if [ -n &quot;${TEMP_DOWNLOAD_DIR:-}&quot; ] &amp;&amp; [ -d &quot;$TEMP_DOWNLOAD_DIR&quot; ]; then
        echo; echo &quot;${C_INFO}INFO: Cleaning up temporary directory...${C_RESET}&quot;
        rm -rf &quot;$TEMP_DOWNLOAD_DIR&quot;
    fi
}

ensure_tool_installed() {
    local tool_name=&quot;$1&quot;
    local package_name=&quot;${2:-$tool_name}&quot;
    if ! command -v &quot;$tool_name&quot; &gt;/dev/null 2&gt;&amp;1; then
        echo &quot;${C_INFO}INFO: Tool &#39;${C_BOLD}$tool_name${C_RESET}${C_INFO}&#39; not found. Installing &#39;${C_BOLD}$package_name${C_RESET}${C_INFO}&#39;...${C_RESET}&quot;
        if ! sudo apt-get install -y &quot;$package_name&quot;; then
            echo &quot;${C_ERROR}ERROR: Failed to install &#39;$package_name&#39;. Please install it manually.${C_RESET}&quot; &gt;&amp;2; exit 1
        fi
        echo &quot;${C_INFO}SUCCESS: &#39;$package_name&#39; installed.${C_RESET}&quot;
    else
        echo &quot;${C_INFO}INFO: Tool &#39;${C_BOLD}$tool_name${C_RESET}${C_INFO}&#39; is already installed.${C_RESET}&quot;
    fi
}

ensure_path() {
    echo &quot;${C_INFO}INFO: Ensuring &#39;${C_BOLD}$USER_SCRIPT_DIR${C_RESET}${C_INFO}&#39; is in your PATH...${C_RESET}&quot;
    mkdir -p &quot;$USER_SCRIPT_DIR&quot;
    if [[ &quot;:$PATH:&quot; != *&quot;:$USER_SCRIPT_DIR:&quot;* ]]; then
        echo &quot;${C_WARN}WARNING: &#39;${C_BOLD}$USER_SCRIPT_DIR${C_RESET}${C_WARN}&#39; is not in your active PATH.${C_RESET}&quot;
        local profile_file=&quot;$HOME/.profile&quot;
        if [ -f &quot;$HOME/.bash_profile&quot; ]; then profile_file=&quot;$HOME/.bash_profile&quot;; elif [ -f &quot;$HOME/.zshrc&quot; ]; then profile_file=&quot;$HOME/.zshrc&quot;; elif [ -f &quot;$HOME/.bashrc&quot; ]; then profile_file=&quot;$HOME/.bashrc&quot;; fi
        if ! grep -q &#39;export PATH=&quot;$HOME/bin:$PATH&quot;&#39; &quot;$profile_file&quot;; then
            echo &quot;${C_ACTION}ACTION: Adding PATH export to &#39;${C_BOLD}$profile_file${C_RESET}${C_ACTION}&#39;.${C_RESET}&quot;
            { echo &#39;&#39;; echo &#39;# Add local bin directory to PATH&#39;; echo &#39;export PATH=&quot;$HOME/bin:$PATH&quot;&#39;; } &gt;&gt; &quot;$profile_file&quot;
            echo &quot;${C_WARN}You must run &#39;${C_BOLD}source \&quot;$profile_file\&quot;${C_RESET}${C_WARN}&#39; or restart your terminal for changes to take effect.${C_RESET}&quot;
        fi
    fi
}

install_restic() {
    echo &quot;${C_INFO}INFO: Checking Restic version...${C_RESET}&quot;
    local latest_version installed_version
    latest_version=$(curl -s &quot;https://api.github.com/repos/restic/restic/releases/latest&quot; | jq -r .tag_name | sed &#39;s/v//&#39;)
    installed_version=$(restic version 2&gt;/dev/null | awk &#39;{print $2}&#39; || echo &quot;0.0.0&quot;)

    if dpkg --compare-versions &quot;$installed_version&quot; &quot;lt&quot; &quot;$latest_version&quot;; then
        echo &quot;${C_INFO}INFO: A new Restic version (${C_BOLD}$latest_version${C_RESET}${C_INFO}) is available (you have $installed_version). Upgrading...${C_RESET}&quot;
        local restic_url
        restic_url=$(curl -s &quot;https://api.github.com/repos/restic/restic/releases/latest&quot; | jq -r &#39;.assets[] | select(.name | contains(&quot;linux_arm64.bz2&quot;)) | .browser_download_url&#39;)
        if [ -z &quot;$restic_url&quot; ]; then echo &quot;${C_ERROR}ERROR: Could not find Restic ARM64 release URL.${C_RESET}&quot; &gt;&amp;2; exit 1; fi

        echo &quot;${C_INFO}INFO: Downloading from: ${C_BOLD}$restic_url${C_RESET}&quot;
        local TEMP_DOWNLOAD_DIR; TEMP_DOWNLOAD_DIR=$(mktemp -d)
        curl -Lfo &quot;${TEMP_DOWNLOAD_DIR}/restic.bz2&quot; &quot;${restic_url}&quot;
        bunzip2 &quot;${TEMP_DOWNLOAD_DIR}/restic.bz2&quot;
        sudo mv &quot;${TEMP_DOWNLOAD_DIR}/restic&quot; /usr/local/bin/restic
        sudo chmod +x /usr/local/bin/restic
        echo &quot;${C_INFO}SUCCESS: Restic upgraded to version $(restic version | awk &#39;{print $2}&#39;).${C_RESET}&quot;
    else
        echo &quot;${C_INFO}INFO: Your Restic version (${C_BOLD}$installed_version${C_RESET}${C_INFO}) is up to date.${C_RESET}&quot;
    fi
}

configure_rclone_remote() {
    local gdrive_remotes
    gdrive_remotes=$(rclone listremotes | sed &#39;s/://&#39; || true)

    if [ -n &quot;$gdrive_remotes&quot; ]; then
        echo &quot;${C_ACTION}ACTION: Found existing rclone remotes. Please choose one or create a new one:${C_RESET}&quot;
        select remote in $gdrive_remotes &quot;CREATE_A_NEW_REMOTE&quot;; do
            if [ &quot;$remote&quot; == &quot;CREATE_A_NEW_REMOTE&quot; ]; then
                break # Break to the creation part
            elif [ -n &quot;$remote&quot; ]; then
                RCLONE_REMOTE_NAME=$remote
                return
            else
                echo &quot;${C_ERROR}Invalid selection.${C_RESET}&quot;
            fi
        done
    fi

    # This section runs if no remotes exist or user chose to create a new one
    echo
    echo &quot;${C_ACTION}------------------------- IMPORTANT: Rclone Setup Instructions -------------------------${C_RESET}&quot;
    echo &quot;${C_WARN}You will now be guided through creating a Google Drive remote.${C_RESET}&quot;
    echo &quot;1. When prompted for &#39;name&#39;, choose a simple name (e.g., &#39;gdrive_hub&#39;).&quot;
    echo &quot;2. When prompted for &#39;Storage&#39;, select &#39;drive&#39; (Google Drive).&quot;
    echo &quot;3. For &#39;client_id&#39; and &#39;client_secret&#39;, you must provide your own credentials from the Google Cloud Console.&quot;
    echo &quot;   ${C_ERROR}CRITICAL: When you copy your Client ID, copy ONLY the ID string, like:${C_RESET}&quot;
    echo &quot;   ${C_BOLD}1234567890-abcdefghijklmnopqrstuvwxyz.apps.googleusercontent.com${C_RESET}&quot;
    echo &quot;   ${C_ERROR}DO NOT paste the full URL or anything else.${C_RESET}&quot;
    echo &quot;4. For all other options, pressing Enter for the default is usually safe.&quot;
    echo &quot;5. Your web browser should open for you to authorize the connection.&quot;
    echo &quot;${C_ACTION}--------------------------------------------------------------------------------------${C_RESET}&quot;
    read -r -p &quot;Press ENTER to begin...&quot;
    
    rclone config
    
    # After creation, ask the user to confirm the name of the new remote
    echo &quot;${C_ACTION}ACTION: Please enter the name of the remote you just created:${C_RESET}&quot;
    read -r RCLONE_REMOTE_NAME
    if [ -z &quot;$RCLONE_REMOTE_NAME&quot; ]; then
        echo &quot;${C_ERROR}ERROR: No remote name provided. Exiting.${C_RESET}&quot; &gt;&amp;2
        exit 1
    fi
}

# --- Main Execution ---

main() {
    setup_colors
    trap cleanup_on_exit EXIT SIGINT SIGTERM

    echo &quot;${C_BOLD}====================================================================${C_RESET}&quot;
    echo &quot;${C_BOLD}=== Robust Rclone + Restic Backup Setup for Debian             ===${C_RESET}&quot;
    echo &quot;${C_BOLD}====================================================================${C_RESET}&quot;
    echo

    # --- Step 1: Install Prerequisites ---
    echo &quot;--- [Step 1/7] Installing prerequisite tools...&quot;
    sudo apt-get update -qq
    ensure_tool_installed &quot;curl&quot; &quot;curl&quot;
    ensure_tool_installed &quot;unzip&quot; &quot;unzip&quot;
    ensure_tool_installed &quot;rclone&quot; &quot;rclone&quot;
    ensure_tool_installed &quot;jq&quot; &quot;jq&quot;
    ensure_tool_installed &quot;bunzip2&quot; &quot;bzip2&quot;
    echo

    # --- Step 2: Ensure PATH is configured ---
    echo &quot;--- [Step 2/7] Verifying PATH environment...&quot;
    ensure_path
    echo

    # --- Step 3: Install/Upgrade Restic ---
    echo &quot;--- [Step 3/7] Installing/Upgrading Restic...&quot;
    install_restic
    echo

    # --- Step 4: Configure Rclone Remote ---
    echo &quot;--- [Step 4/7] Configuring Rclone remote for Google Drive...&quot;
    configure_rclone_remote
    echo

    # --- Step 5: Verify Rclone Authentication ---
    echo &quot;--- [Step 5/7] Verifying rclone authentication for &#39;${C_BOLD}${RCLONE_REMOTE_NAME}${C_RESET}&#39;...&quot;
    while ! rclone lsd &quot;${RCLONE_REMOTE_NAME}:&quot; &gt;/dev/null 2&gt;&amp;1; do
        echo &quot;${C_ERROR}ERROR: Rclone cannot authenticate with &#39;${C_BOLD}${RCLONE_REMOTE_NAME}${C_RESET}${C_ERROR}&#39;.${C_RESET}&quot;
        echo &quot;${C_WARN}This is likely due to an incomplete or incorrect initial setup.${C_RESET}&quot;
        echo &quot;${C_ACTION}ACTION: Let&#39;s try to fix this by reconnecting the remote.${C_RESET}&quot;
        read -r -p &quot;Press ENTER to run &#39;rclone config reconnect ${RCLONE_REMOTE_NAME}:&#39;...&quot;
        rclone config reconnect &quot;${RCLONE_REMOTE_NAME}:&quot;
        echo &quot;${C_INFO}INFO: Re-checking connection...${C_RESET}&quot;
    done
    echo &quot;${C_INFO}SUCCESS: Rclone authentication for &#39;${C_BOLD}${RCLONE_REMOTE_NAME}${C_RESET}${C_INFO}&#39; is working.${C_RESET}&quot;
    echo

    # --- Step 6: Setup Restic Repository &amp; Password ---
    local restic_repository=&quot;rclone:${RCLONE_REMOTE_NAME}:${RESTIC_REPO_PATH}&quot;
    echo &quot;--- [Step 6/7] Setting up Restic repository and password...&quot;
    echo &quot;Configuration that will be used:&quot;
    echo &quot;  - Rclone Remote:  ${C_BOLD}$RCLONE_REMOTE_NAME${C_RESET}&quot;
    echo &quot;  - Repository Path:  ${C_BOLD}$restic_repository${C_RESET}&quot;
    echo &quot;  - Password File:    ${C_BOLD}$RESTIC_PASSWORD_FILE${C_RESET}&quot;
    
    mkdir -p &quot;$(dirname &quot;$RESTIC_PASSWORD_FILE&quot;)&quot;
    if [ ! -f &quot;$RESTIC_PASSWORD_FILE&quot; ]; then
        echo &quot;${C_ACTION}ACTION: Please create a new, strong password for your backup repository.${C_RESET}&quot;
        read -s -p &quot;Enter repository password: &quot; restic_pass; echo
        read -s -p &quot;Confirm password: &quot; restic_pass_confirm; echo
        if [ &quot;$restic_pass&quot; = &quot;$restic_pass_confirm&quot; ] &amp;&amp; [ -n &quot;$restic_pass&quot; ]; then
            echo &quot;$restic_pass&quot; &gt; &quot;$RESTIC_PASSWORD_FILE&quot; &amp;&amp; chmod 600 &quot;$RESTIC_PASSWORD_FILE&quot;
            echo &quot;${C_INFO}SUCCESS: Password file created.${C_RESET}&quot;
        else
            echo &quot;${C_ERROR}ERROR: Passwords do not match or are empty. Please re-run the script.${C_RESET}&quot; &gt;&amp;2; exit 1
        fi
    else
        echo &quot;${C_INFO}INFO: Existing password file found. Using it.${C_RESET}&quot;
    fi

    if restic -r &quot;$restic_repository&quot; --password-file &quot;$RESTIC_PASSWORD_FILE&quot; cat config &gt;/dev/null 2&gt;&amp;1; then
        echo &quot;${C_INFO}INFO: Restic repository already initialized. Skipping.${C_RESET}&quot;
    else
        echo &quot;${C_WARN}WARNING: Restic repository not found. Initializing...${C_RESET}&quot;
        if ! restic -r &quot;$restic_repository&quot; --password-file &quot;$RESTIC_PASSWORD_FILE&quot; init; then
            echo &quot;${C_ERROR}ERROR: Failed to initialize restic repository.${C_RESET}&quot; &gt;&amp;2; exit 1
        fi
        echo &quot;${C_INFO}SUCCESS: Restic repository initialized.${C_RESET}&quot;
    fi
    echo

    # --- Step 7: Deploy User Scripts ---
    echo &quot;--- [Step 7/7] Deploying helper scripts to &#39;${C_BOLD}$USER_SCRIPT_DIR${C_RESET}&#39;...&quot;
    # Deploy Backup Script
    cat &lt;&lt; EOF &gt; &quot;${USER_SCRIPT_DIR}/${BACKUP_SCRIPT_NAME}&quot;
#!/bin/bash
set -euo pipefail
if [ -z &quot;\${1:-}&quot; ] || [ &quot;\$1&quot; == &quot;--help&quot; ]; then echo &quot;Usage: \$(basename &quot;\$0&quot;) /path/to/backup&quot;; exit 1; fi
if [ ! -d &quot;\$1&quot; ]; then echo &quot;Error: Path &#39;\$1&#39; is not a valid directory.&quot; &gt;&amp;2; exit 1; fi
echo &quot;--- Starting Restic Backup for &#39;\$1&#39; ---&quot;
restic -r &quot;${restic_repository}&quot; --password-file &quot;${RESTIC_PASSWORD_FILE}&quot; --verbose \\
    -o rclone.connections=8 -o rclone.drive-skip-gdocs=true \\
    backup &quot;\$1&quot; --tag &quot;\$(date +%Y%m%d)&quot;
echo &quot;--- Backup Finished ---&quot;
EOF
    chmod +x &quot;${USER_SCRIPT_DIR}/${BACKUP_SCRIPT_NAME}&quot;
    echo &quot;${C_INFO}SUCCESS: Deployed &#39;${C_BOLD}${BACKUP_SCRIPT_NAME}${C_RESET}${C_INFO}&#39;.${C_RESET}&quot;

    # Deploy Maintenance Script
    cat &lt;&lt; EOF &gt; &quot;${USER_SCRIPT_DIR}/${MAINTENANCE_SCRIPT_NAME}&quot;
#!/bin/bash
set -euo pipefail
echo &quot;--- Restic Repository Maintenance ---&quot;
echo &quot;Repository: ${restic_repository}&quot;
echo
PS3=&quot;Please choose a maintenance action: &quot;
select action in &quot;Check Integrity&quot; &quot;Prune Old Snapshots&quot; &quot;Exit&quot;; do
    case \$action in
        &quot;Check Integrity&quot;)
            echo &quot;--- Running integrity check... ---&quot;
            restic -r &quot;${restic_repository}&quot; --password-file &quot;${RESTIC_PASSWORD_FILE}&quot; check
            echo &quot;--- Check complete. ---&quot;; break;;
        &quot;Prune Old Snapshots&quot;)
            echo &quot;--- Applying retention policy (keep 7 daily, 4 weekly, 12 monthly) and pruning... ---&quot;
            restic -r &quot;${restic_repository}&quot; --password-file &quot;${RESTIC_PASSWORD_FILE}&quot; forget \\
                --keep-daily 7 --keep-weekly 4 --keep-monthly 12 --keep-yearly 99 --prune
            echo &quot;--- Prune complete. ---&quot;; break;;
        &quot;Exit&quot;) break;;
        *) echo &quot;Invalid option \$REPLY&quot;;;
    esac
done
EOF
    chmod +x &quot;${USER_SCRIPT_DIR}/${MAINTENANCE_SCRIPT_NAME}&quot;
    echo &quot;${C_INFO}SUCCESS: Deployed &#39;${C_BOLD}${MAINTENANCE_SCRIPT_NAME}${C_RESET}${C_INFO}&#39;.${C_RESET}&quot;
    echo
    echo &quot;${C_BOLD}=========================== SETUP COMPLETE ===========================${C_RESET}&quot;
    echo
    echo &quot;${C_INFO}You are now ready to back up your data!${C_RESET}&quot;
    echo &quot;${C_WARN}If this is a new terminal, remember to run &#39;${C_BOLD}source ~/.profile${C_RESET}${C_WARN}&#39; (or similar).${C_RESET}&quot;
    echo
    echo &quot;  ${C_ACTION}To run a backup:${C_RESET}              ${C_BOLD}${BACKUP_SCRIPT_NAME} /path/to/your/data${C_RESET}&quot;
    echo &quot;  ${C_ACTION}To run repository maintenance:${C_RESET}   ${C_BOLD}${MAINTENANCE_SCRIPT_NAME}${C_RESET}&quot;
    echo
}

main
exit 0</code>
</section>
  <h2 id="the-backup-script-gdrive-backup">
    
    
     <a href="#the-backup-script-gdrive-backup">#</a><a href="#" aria-label="Back to top">The Backup Script: <code class="language-plaintext highlighter-rouge">gdrive-backup</code></a>
        
    
  </h2>
      

<p>This script is your day-to-day tool. Its only job is to take a directory you specify and back it up securely to your Google Drive repository.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"--help"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2"> /path/to/backup"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi
if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Error: Path '</span><span class="nv">$1</span><span class="s2">' is not a valid directory."</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi
</span><span class="nb">echo</span> <span class="s2">"--- Starting Restic Backup for '</span><span class="nv">$1</span><span class="s2">' ---"</span>
restic <span class="nt">-r</span> <span class="s2">"rclone:gdrive_hub:ResticBackups/my-linux-desktop"</span> <span class="nt">--password-file</span> <span class="s2">"/home/linaro/.config/restic/gdrive_password"</span> <span class="nt">--verbose</span> <span class="se">\</span>
    <span class="nt">-o</span> rclone.connections<span class="o">=</span>8 <span class="nt">-o</span> rclone.drive-skip-gdocs<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    backup <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="nt">--tag</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"--- Backup Finished ---"</span>
</code></section></div></div>
  <h4 id="line-by-line-explanation">
    
    
     <a href="#line-by-line-explanation">#</a><a href="#" aria-label="Back to top">Line-by-Line Explanation:</a>
        
    
  </h4>
      

<ol>
  <li><code class="language-plaintext highlighter-rouge">#!/bin/bash</code>: This is the “shebang.” It tells the system to execute this script using the Bash interpreter.</li>
  <li><code class="language-plaintext highlighter-rouge">set -euo pipefail</code>: This is a crucial line for safety, especially in a backup script.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">set -e</code>: Exit immediately if any command fails. This prevents the script from continuing in an unpredictable state if a step goes wrong.</li>
      <li><code class="language-plaintext highlighter-rouge">set -u</code>: Treat unset variables as an error. This catches typos in variable names.</li>
      <li><code class="language-plaintext highlighter-rouge">set -o pipefail</code>: If a command in a pipeline fails, the entire pipeline’s exit status is that of the failed command.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">if [ -z "${1:-}" ] ...</code>: This is the first input validation.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">$1</code> is the first argument you pass to the script (e.g., in <code class="language-plaintext highlighter-rouge">gdrive-backup /home/linaro/Documents</code>, <code class="language-plaintext highlighter-rouge">$1</code> is <code class="language-plaintext highlighter-rouge">/home/linaro/Documents</code>).</li>
      <li>This line checks if you provided an argument. If <code class="language-plaintext highlighter-rouge">$1</code> is empty (<code class="language-plaintext highlighter-rouge">-z</code>) or if you asked for help (<code class="language-plaintext highlighter-rouge">--help</code>), it prints the correct usage instructions and exits.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">if [ ! -d "$1" ] ...</code>: This is the second input validation. It checks if the argument you provided is actually a directory (<code class="language-plaintext highlighter-rouge">-d</code>). If not, it prints an error and exits.</li>
  <li><code class="language-plaintext highlighter-rouge">echo "--- Starting..."</code>: A simple message to let you know the backup process has started.</li>
  <li>The <code class="language-plaintext highlighter-rouge">restic ...</code> command is the main event. Let’s break down its components:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">restic</code>: The backup program itself.</li>
      <li><code class="language-plaintext highlighter-rouge">-r "rclone:gdrive_hub:..."</code>: Specifies the <strong>r</strong>epository. This tells restic to use the <code class="language-plaintext highlighter-rouge">rclone</code> backend to connect to your remote named <code class="language-plaintext highlighter-rouge">gdrive_hub</code> and find the <code class="language-plaintext highlighter-rouge">ResticBackups/my-linux-desktop</code> folder inside it.</li>
      <li><code class="language-plaintext highlighter-rouge">--password-file "..."</code>: Tells restic where to find the repository password. This is much more secure than typing it every time or saving it in a script.</li>
      <li><code class="language-plaintext highlighter-rouge">--verbose</code>: Makes restic print more detailed information about what it’s doing, which files it’s scanning, and its progress.</li>
      <li><code class="language-plaintext highlighter-rouge">-o rclone.connections=8</code>: The <code class="language-plaintext highlighter-rouge">-o</code> flag passes an <strong>o</strong>ption to the rclone backend. This specifically tells rclone to use up to 8 parallel connections to upload data, which can significantly speed up your backup.</li>
      <li><code class="language-plaintext highlighter-rouge">-o rclone.drive-skip-gdocs=true</code>: Another option passed to rclone. This is very important for Google Drive. It tells rclone to ignore Google’s proprietary files (Docs, Sheets, Slides) because they can’t be downloaded as regular files and would cause errors.</li>
      <li><code class="language-plaintext highlighter-rouge">backup "$1"</code>: This is the core command. It tells restic to perform a <code class="language-plaintext highlighter-rouge">backup</code> on the directory you provided (<code class="language-plaintext highlighter-rouge">$1</code>).</li>
      <li><code class="language-plaintext highlighter-rouge">--tag "$(date +%Y%m%d)"</code>: This applies a label, or <strong>tag</strong>, to this specific backup snapshot. The <code class="language-plaintext highlighter-rouge">$(date +%Y%m%d)</code> part dynamically generates the current date in <code class="language-plaintext highlighter-rouge">YYYYMMDD</code> format (e.g., <code class="language-plaintext highlighter-rouge">20250616</code>). This is useful for finding backups from a specific day later on.</li>
    </ul>
  </li>
</ol>
  <h2 id="the-maintenance-script-gdrive-maintenance">
    
    
     <a href="#the-maintenance-script-gdrive-maintenance">#</a><a href="#" aria-label="Back to top">The Maintenance Script: <code class="language-plaintext highlighter-rouge">gdrive-maintenance</code></a>
        
    
  </h2>
      

<p>A backup system needs care. This script provides an easy-to-use menu for two critical maintenance tasks: checking for corruption and cleaning up old backups.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nb">echo</span> <span class="s2">"--- Restic Repository Maintenance ---"</span>
<span class="nb">echo</span> <span class="s2">"Repository: rclone:gdrive_hub:ResticBackups/my-linux-desktop"</span>
<span class="nb">echo
</span><span class="nv">PS3</span><span class="o">=</span><span class="s2">"Please choose a maintenance action: "</span>
<span class="k">select </span>action <span class="k">in</span> <span class="s2">"Check Integrity"</span> <span class="s2">"Prune Old Snapshots"</span> <span class="s2">"Exit"</span><span class="p">;</span> <span class="k">do
    case</span> <span class="nv">$action</span> <span class="k">in</span>
        <span class="s2">"Check Integrity"</span><span class="p">)</span>
            <span class="c"># ...</span>
            <span class="p">;;</span>
        <span class="s2">"Prune Old Snapshots"</span><span class="p">)</span>
            <span class="c"># ...</span>
            <span class="p">;;</span>
        <span class="s2">"Exit"</span><span class="p">)</span> <span class="nb">break</span><span class="p">;;</span>
        <span class="k">*</span><span class="p">)</span> <span class="nb">echo</span> <span class="s2">"Invalid option </span><span class="nv">$REPLY</span><span class="s2">"</span><span class="p">;;</span>
    <span class="k">esac</span>
<span class="k">done</span>
</code></section></div></div>
  <h4 id="explanation-of-components">
    
    
     <a href="#explanation-of-components">#</a><a href="#" aria-label="Back to top">Explanation of Components:</a>
        
    
  </h4>
      

<ol>
  <li><code class="language-plaintext highlighter-rouge">select action in ...</code>: This is a special Bash loop that creates an interactive menu. It displays the options (“Check Integrity”, etc.) numbered, and waits for you to type a number and press Enter. The chosen text is put into the <code class="language-plaintext highlighter-rouge">$action</code> variable.</li>
  <li><code class="language-plaintext highlighter-rouge">case $action in ... esac</code>: This statement checks the value of the <code class="language-plaintext highlighter-rouge">$action</code> variable and runs the code for the matching option.</li>
</ol>
  <h5 id="option-1-check-integrity">
    
    
     <a href="#option-1-check-integrity">#</a><a href="#" aria-label="Back to top"><strong>Option 1: Check Integrity</strong></a>
        
    
  </h5>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-r</span> <span class="s2">"..."</span> <span class="nt">--password-file</span> <span class="s2">"..."</span> check
</code></section></div></div>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">restic check</code> command is vital. It scans the entire repository on Google Drive, verifies all the data structures, and ensures there is no corruption. It confirms that the data you’ve backed up can be successfully restored. It’s a good idea to run this periodically (e.g., once a month).</li>
</ul>
  <h5 id="option-2-prune-old-snapshots">
    
    
     <a href="#option-2-prune-old-snapshots">#</a><a href="#" aria-label="Back to top"><strong>Option 2: Prune Old Snapshots</strong></a>
        
    
  </h5>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>restic <span class="nt">-r</span> <span class="s2">"..."</span> <span class="nt">--password-file</span> <span class="s2">"..."</span> forget <span class="se">\</span>
    <span class="nt">--keep-daily</span> 7 <span class="nt">--keep-weekly</span> 4 <span class="nt">--keep-monthly</span> 12 <span class="nt">--keep-yearly</span> 99 <span class="nt">--prune</span>
</code></section></div></div>

<ul>
  <li>This is a two-part command combined into one (<code class="language-plaintext highlighter-rouge">forget</code> and <code class="language-plaintext highlighter-rouge">prune</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">forget</code>: This command applies a retention policy. The <code class="language-plaintext highlighter-rouge">--keep-*</code> flags tell it which backup snapshots to keep:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">--keep-daily 7</code>: Keep the last 7 daily backups (one for each of the last 7 days that has a backup).</li>
      <li><code class="language-plaintext highlighter-rouge">--keep-weekly 4</code>: Keep the last 4 weekly backups (one for each of the last 4 weeks).</li>
      <li><code class="language-plaintext highlighter-rouge">--keep-monthly 12</code>: Keep the last 12 monthly backups.</li>
      <li><code class="language-plaintext highlighter-rouge">--keep-yearly 99</code>: Keep the last 99 yearly backups (effectively forever).</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">--prune</code>: After <code class="language-plaintext highlighter-rouge">forget</code> has decided which snapshots to remove, <code class="language-plaintext highlighter-rouge">--prune</code> does the actual cleanup. It scans the repository and permanently deletes all the data chunks that are no longer needed by any of the remaining snapshots, freeing up space on your Google Drive.</li>
</ul>

        </div>
        
          URL: https://ib.bsb.br/restic-to-transfer-files
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/fixing-rk3588-init-scripts/" title="Fixing rk3588 Init Scripts" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/copying-data-in-linux/" title="Copying data in Linux" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "aid>software"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-aid-software" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/docker/" title="how to manage multiple Docker containers" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="javascript:void(0)" class="disabled" aria-disabled="true" title="No next in tag">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="No next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-06-17 12:43:28
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="aid-software">
                  aid>software
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/restic-to-transfer-files/"
        },
        "headline": "restic to transfer files",
        "description": "",
        "datePublished": "2025-05-13T00:00:00+00:00",
        "dateModified": "2025-06-16T19:12:19+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
