<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    
      SRWare Iron Browser launcher in C++ — infoBAG
    
  </title>
  <meta name="title" content="SRWare Iron Browser launcher in C++">
  <meta name="description" content="can't steer unless already moving">
  <meta property="og:title" content="SRWare Iron Browser launcher in C++ — infoBAG">
  <meta property="og:description" content="can't steer unless already moving">
  <meta property="og:url" content="https://ib.bsb.br/browser-srware-iron/">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="infoBAG">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="SRWare Iron Browser launcher in C++ — infoBAG">
  <meta name="twitter:description" content="can't steer unless already moving">
  

  <link rel="canonical" href="https://ib.bsb.br/browser-srware-iron/">
  <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">

  
    <meta name="keywords" content="software>windows">
    
      <meta property="article:tag" content="software>windows">
    
  
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  

  <link href="/style.css" rel="stylesheet">
</head>
<body class="post-content-body">
  <header class="header-container">
    <nav aria-label="Main navigation" class="header-content">
      <a href="/" aria-label="Home">
        <img src="/favicon.ico" alt="Home" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/tags" aria-label="Tags">
        <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/archive" aria-label="Archive">
        <img src="/assets/Loose_Stone_Pile.gif" alt="Archive" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/events" aria-label="Events">
        <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/archive-created" aria-label="Archive created">
          <img src="/assets/Hole_(Rock).gif" alt="Archive created" class="favicon search-link" width="32" height="32" loading="lazy">
      </a>
      <a href="/rot64" aria-label="rot">
          <img src="/assets/rot.gif" alt="rot" class="favicon search-link" width="32" height="32" loading="lazy">
      </a>
    </nav>
    <h5 class="post-title">
      <a href="#bottom-of-page" aria-label="Go to bottom">
        SRWare Iron Browser launcher in C++
      </a>
    </h5>
    <div class="post-meta">
      <time datetime="2024-12-19T00:00:00+00:00" class="post-date">
        19 Dec 2024
      </time>
      
        <span class="post-updated">
          ↣
          <time datetime="2025-01-18T23:08:41+00:00">18 Jan 2025</time>
        </span>
      
      
        <p class="post-slug">
          Slug: <a href="https://ib.bsb.br/browser-srware-iron" class="tag">browser-srware-iron</a>
        </p>
      
      
        <p class="post-tags">
          Tags:
          
            <a href="https://ib.bsb.br/tags/#software-windows" class="tag">software>windows</a>
          
        </p>
      
    </div>
    <div class="post-actions">
      <div class="page-stats mt-3" role="status" aria-label="Page statistics">
        <span class="badge bg-primary">
          114537 characters
        </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
          6874 words
        </span>
      </div>
      <div class="action-buttons d-flex flex-wrap gap-2">
        
          
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2024-12-19-browser-srware-iron.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                <span class="button-text">Improve this page?</span>
                <span class="info-text">aberto.</span>
              </button>
            </form>
          
          <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2024-12-19-browser-srware-iron.md"
                method="GET"
                target="_blank"
                rel="noopener noreferrer"
                class="d-inline-block">
            <button type="submit" class="btn btn-danger" aria-label="View page revision history">
              View revision history
            </button>
          </form>
        
      </div>
    </div>
  </header>
  <main class="content">
    <article class="post-wrapper">
      <div class="post-content-body">
        
<ul><li><a href="#introduction">Introduction</a></li><li><a href="#configuration">Configuration</a></li><li><a href="#c-implementation">C++ Implementation</a></li><li><a href="#build-instructions">Build Instructions</a></li><li><a href="#deployment-and-updates">Deployment and Updates</a></li><li><a href="#usage">Usage</a></li><li><a href="#simplified-version-without-update-checking">Simplified Version without Update Checking</a></li></ul>
        <h2 id="introduction">
    
    
     <a href="#introduction">#</a><a href="#" aria-label="Back to top">Introduction</a>
        
    
  </h2>
      

<p>This document outlines the process of creating a browser launcher, a wrapper executable designed to launch a web browser with predefined settings, including permanently integrated command-line flags. This approach offers several benefits, such as centralized configuration management, persistent flag integration without modifying the original browser executable, and the ability to manage multiple browser configurations from a single point. The launcher is particularly useful for users who frequently use specific browser flags or need to manage different browser profiles for various tasks.</p>
  <h2 id="configuration">
    
    
     <a href="#configuration">#</a><a href="#" aria-label="Back to top">Configuration</a>
        
    
  </h2>
      

<p>The browser launcher utilizes a configuration file named <code class="language-plaintext highlighter-rouge">browser_config.ini</code> to manage browser settings and launch parameters. This file is divided into sections:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">[Browser]</code> Section:</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Executable</code>: Specifies the path to the browser executable (e.g., <code class="language-plaintext highlighter-rouge">G:\05-portable\IronPortable64\Iron\chrome.exe</code>).</li>
      <li><code class="language-plaintext highlighter-rouge">VersionUrl</code>: Provides a URL for checking updates. For example, for Thorium, you might use <code class="language-plaintext highlighter-rouge">https://api.github.com/repos/Alex313031/Thorium-Win/releases/latest</code>. The launcher fetches the latest version information from this URL and compares it with the current browser version.</li>
      <li><code class="language-plaintext highlighter-rouge">Flags</code>: Contains custom command-line flags to be passed to the browser (e.g., <code class="language-plaintext highlighter-rouge">--user-data-dir="G:\05-portable\IronPortable64\Iron\User Data" --no-default-browser-check --disable-logging --disable-breakpad --disable-features=PrintCompositorLPAC --enable-quic</code>).</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">[General]</code> Section:</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">UpdateCheck</code>: A boolean value (<code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>) that determines whether the launcher should check for updates.</li>
    </ul>
  </li>
</ul>

<p>Multiple <code class="language-plaintext highlighter-rouge">[Browser]</code> sections (e.g., <code class="language-plaintext highlighter-rouge">[Browser2]</code>, <code class="language-plaintext highlighter-rouge">[Browser3]</code>) can be added to define settings for different browsers. The launcher can handle multiple <code class="language-plaintext highlighter-rouge">[Browser]</code> sections, and the user can select a specific browser using the <code class="language-plaintext highlighter-rouge">--browser=</code> command-line argument followed by the number of the browser section (e.g., <code class="language-plaintext highlighter-rouge">--browser=2</code> to use <code class="language-plaintext highlighter-rouge">[Browser2]</code>).</p>

<p><strong>Example <code class="language-plaintext highlighter-rouge">browser_config.ini</code>:</strong></p>

<div class="language-ini highlighter-rouge"><div class="highlight"><section><code><span class="nn">[Browser]</span>
<span class="py">Executable</span><span class="p">=</span><span class="s">G:</span><span class="se">\0</span><span class="s">5-portable</span><span class="se">\I</span><span class="s">ronPortable64</span><span class="se">\I</span><span class="s">ron</span><span class="se">\c</span><span class="s">hrome.exe</span>
<span class="py">VersionUrl</span><span class="p">=</span>
<span class="py">Flags</span><span class="p">=</span><span class="s">--user-data-dir="G:</span><span class="se">\0</span><span class="s">5-portable</span><span class="se">\I</span><span class="s">ronPortable64</span><span class="se">\I</span><span class="s">ron</span><span class="se">\U</span><span class="s">ser Data" --no-default-browser-check --disable-logging --disable-breakpad --disable-features=PrintCompositorLPAC --enable-quic</span>

<span class="nn">[Browser2]</span>
<span class="py">Executable</span><span class="p">=</span><span class="s">C:</span><span class="se">\B</span><span class="s">rowsers</span><span class="se">\T</span><span class="s">horium</span><span class="se">\t</span><span class="s">horium.exe</span>
<span class="py">VersionUrl</span><span class="p">=</span><span class="s">https://api.github.com/repos/Alex313031/Thorium-Win/releases/latest</span>
<span class="py">Flags</span><span class="p">=</span><span class="s">--user-data-dir="C:</span><span class="se">\B</span><span class="s">rowsers</span><span class="se">\T</span><span class="s">horium</span><span class="se">\U</span><span class="s">ser Data" --no-default-browser-check --disable-logging --disable-breakpad --disable-features=PrintCompositorLPAC</span>

<span class="nn">[General]</span>
<span class="py">UpdateCheck</span><span class="p">=</span><span class="s">true</span>
</code></section></div></div>

<p>An alternative configuration method using <code class="language-plaintext highlighter-rouge">browser.conf</code> and <code class="language-plaintext highlighter-rouge">browser_flags.conf</code> is also available, where <code class="language-plaintext highlighter-rouge">browser.conf</code> specifies the browser executable and user data directory, and <code class="language-plaintext highlighter-rouge">browser_flags.conf</code> contains additional flags. However, the <code class="language-plaintext highlighter-rouge">browser_config.ini</code> approach is recommended for its flexibility and ability to manage multiple browsers.</p>
  <h2 id="c-implementation">
    
    
     <a href="#c-implementation">#</a><a href="#" aria-label="Back to top">C++ Implementation</a>
        
    
  </h2>
      

<p>The core functionality of the browser launcher is implemented in C++. The following code provides a comprehensive example:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><section><code><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;shlwapi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;winhttp.h&gt;</span><span class="cp">
</span>
<span class="cp">#pragma comment(lib, "shlwapi.lib")
#pragma comment(lib, "Version.lib")
#pragma comment(lib, "winhttp.lib")
</span>
<span class="cp">#define MAX_CMD_LENGTH 32768
#define LOG_FILE "browser_wrapper.log"
#define CONFIG_FILE "browser_config.ini"
</span>
<span class="c1">// Function to log messages to a file</span>
<span class="kt">void</span> <span class="nf">log_message</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">,</span> <span class="n">DWORD</span> <span class="n">error_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">log_file</span><span class="p">(</span><span class="n">LOG_FILE</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">log_file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">SYSTEMTIME</span> <span class="n">st</span><span class="p">;</span>
        <span class="n">GetLocalTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">);</span>
        <span class="kt">char</span> <span class="n">timestamp</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
        <span class="n">sprintf_s</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">timestamp</span><span class="p">),</span> <span class="s">"[%02d:%02d:%02d]"</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">wHour</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">wMinute</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">wSecond</span><span class="p">);</span>
        <span class="n">log_file</span> <span class="o">&lt;&lt;</span> <span class="n">timestamp</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">message</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">log_file</span> <span class="o">&lt;&lt;</span> <span class="s">" (Error: "</span> <span class="o">&lt;&lt;</span> <span class="n">error_code</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">log_file</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">log_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Handle error: Cannot open log file</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error: Could not open log file "</span> <span class="o">&lt;&lt;</span> <span class="n">LOG_FILE</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Function to sanitize command-line arguments</span>
<span class="kt">void</span> <span class="nf">sanitize_command</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmdLine</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">dangerous_chars</span> <span class="o">=</span> <span class="s">"&amp;|;`$&lt;&gt;^()[]{}"</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">cmdLine</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="n">cmdLine</span><span class="p">;</span> <span class="o">*</span><span class="n">src</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="o">++</span><span class="n">src</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strchr</span><span class="p">(</span><span class="n">dangerous_chars</span><span class="p">,</span> <span class="o">*</span><span class="n">src</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function to read the configuration file</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">read_config_file</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">config_file</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">section</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">settings</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">file</span><span class="p">(</span><span class="n">config_file</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">in_section</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to open config file: "</span> <span class="o">+</span> <span class="n">config_file</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">settings</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// Remove leading/trailing whitespace</span>
        <span class="n">line</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="n">find_first_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">));</span>
        <span class="n">line</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">find_last_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

        <span class="c1">// Skip comments and empty lines</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'['</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Check if we are entering the desired section</span>
            <span class="n">in_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="s">"["</span> <span class="o">+</span> <span class="n">section</span> <span class="o">+</span> <span class="s">"]"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">in_section</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Parse key-value pairs</span>
            <span class="kt">size_t</span> <span class="n">delimiter_pos</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delimiter_pos</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delimiter_pos</span><span class="p">);</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">delimiter_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="c1">// Remove leading/trailing whitespace from key and value</span>
                <span class="n">key</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">key</span><span class="p">.</span><span class="n">find_first_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">));</span>
                <span class="n">key</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">find_last_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">value</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">.</span><span class="n">find_first_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">));</span>
                <span class="n">value</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">find_last_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">settings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">in_section</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Configuration section "</span> <span class="o">+</span> <span class="n">section</span> <span class="o">+</span> <span class="s">" in file "</span> <span class="o">+</span> <span class="n">config_file</span> <span class="o">+</span> <span class="s">" is empty or invalid."</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">settings</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function to get the browser version</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">get_browser_version</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">browser_path</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">verHandle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">UINT</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">LPBYTE</span> <span class="n">lpBuffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"Unknown"</span><span class="p">;</span>

    <span class="n">DWORD</span> <span class="n">verSize</span> <span class="o">=</span> <span class="n">GetFileVersionInfoSizeA</span><span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">verHandle</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to get version info size for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">verData</span><span class="p">(</span><span class="n">verSize</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetFileVersionInfoA</span><span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">verHandle</span><span class="p">,</span> <span class="n">verSize</span><span class="p">,</span> <span class="n">verData</span><span class="p">.</span><span class="n">data</span><span class="p">()))</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to get version info for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">VerQueryValueA</span><span class="p">(</span><span class="n">verData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">VOID</span> <span class="n">FAR</span> <span class="o">*</span> <span class="n">FAR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">lpBuffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">)</span> <span class="o">||</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to query version value for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">VS_FIXEDFILEINFO</span><span class="o">*</span> <span class="n">verInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">VS_FIXEDFILEINFO</span><span class="o">*</span><span class="p">)</span><span class="n">lpBuffer</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwSignature</span> <span class="o">!=</span> <span class="mh">0xfeef04bd</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Invalid version info signature for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionMS</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span>
              <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionMS</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span>
              <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionLS</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span>
              <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionLS</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function to perform a basic update check</span>
<span class="kt">bool</span> <span class="nf">check_for_updates</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">current_version</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">version_url</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">version_url</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">HINTERNET</span> <span class="n">hSession</span> <span class="o">=</span> <span class="n">WinHttpOpen</span><span class="p">(</span><span class="s">L"BrowserUpdateChecker/1.0"</span><span class="p">,</span> <span class="n">WINHTTP_ACCESS_TYPE_DEFAULT_PROXY</span><span class="p">,</span> <span class="n">WINHTTP_NO_PROXY_NAME</span><span class="p">,</span> <span class="n">WINHTTP_NO_PROXY_BYPASS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hSession</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to open HTTP session"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">URL_COMPONENTS</span> <span class="n">urlComponents</span><span class="p">;</span>
    <span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">urlComponents</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">urlComponents</span><span class="p">));</span>
    <span class="n">urlComponents</span><span class="p">.</span><span class="n">dwStructSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">urlComponents</span><span class="p">);</span>
    <span class="n">urlComponents</span><span class="p">.</span><span class="n">dwHostNameLength</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">urlComponents</span><span class="p">.</span><span class="n">dwUrlPathLength</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WinHttpCrackUrl</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">wstring</span><span class="p">(</span><span class="n">version_url</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">version_url</span><span class="p">.</span><span class="n">end</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">version_url</span><span class="p">.</span><span class="n">length</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">urlComponents</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to parse URL: "</span> <span class="o">+</span> <span class="n">version_url</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">wstring</span> <span class="nf">hostName</span><span class="p">(</span><span class="n">urlComponents</span><span class="p">.</span><span class="n">lpszHostName</span><span class="p">,</span> <span class="n">urlComponents</span><span class="p">.</span><span class="n">dwHostNameLength</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">wstring</span> <span class="nf">urlPath</span><span class="p">(</span><span class="n">urlComponents</span><span class="p">.</span><span class="n">lpszUrlPath</span><span class="p">,</span> <span class="n">urlComponents</span><span class="p">.</span><span class="n">dwUrlPathLength</span><span class="p">);</span>

    <span class="n">HINTERNET</span> <span class="n">hConnect</span> <span class="o">=</span> <span class="n">WinHttpConnect</span><span class="p">(</span><span class="n">hSession</span><span class="p">,</span> <span class="n">hostName</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">INTERNET_DEFAULT_HTTPS_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hConnect</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to connect to host: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">hostName</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">hostName</span><span class="p">.</span><span class="n">end</span><span class="p">()),</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">HINTERNET</span> <span class="n">hRequest</span> <span class="o">=</span> <span class="n">WinHttpOpenRequest</span><span class="p">(</span><span class="n">hConnect</span><span class="p">,</span> <span class="s">L"GET"</span><span class="p">,</span> <span class="n">urlPath</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">WINHTTP_NO_REFERER</span><span class="p">,</span> <span class="n">WINHTTP_DEFAULT_ACCEPT_TYPES</span><span class="p">,</span> <span class="n">WINHTTP_FLAG_SECURE</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hRequest</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to open HTTP request"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hConnect</span><span class="p">);</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WinHttpSendRequest</span><span class="p">(</span><span class="n">hRequest</span><span class="p">,</span> <span class="n">WINHTTP_NO_ADDITIONAL_HEADERS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WINHTTP_NO_REQUEST_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to send HTTP request"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hRequest</span><span class="p">);</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hConnect</span><span class="p">);</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WinHttpReceiveResponse</span><span class="p">(</span><span class="n">hRequest</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to receive HTTP response"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hRequest</span><span class="p">);</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hConnect</span><span class="p">);</span>
        <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">responseData</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">bytesRead</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WinHttpReadData</span><span class="p">(</span><span class="n">hRequest</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">bytesRead</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to read HTTP data"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
            <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hRequest</span><span class="p">);</span>
            <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hConnect</span><span class="p">);</span>
            <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">responseData</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">bytesRead</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">bytesRead</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hRequest</span><span class="p">);</span>
    <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hConnect</span><span class="p">);</span>
    <span class="n">WinHttpCloseHandle</span><span class="p">(</span><span class="n">hSession</span><span class="p">);</span>

    <span class="c1">// Basic JSON parsing for latest version</span>
    <span class="kt">size_t</span> <span class="n">tag_name_pos</span> <span class="o">=</span> <span class="n">responseData</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">tag_name</span><span class="se">\"</span><span class="s">"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tag_name_pos</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to find tag_name in response"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">size_t</span> <span class="n">version_start_pos</span> <span class="o">=</span> <span class="n">responseData</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="n">tag_name_pos</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">version_end_pos</span> <span class="o">=</span> <span class="n">responseData</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="n">version_start_pos</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">version_start_pos</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span> <span class="o">||</span> <span class="n">version_end_pos</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to parse version from response"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">latest_version</span> <span class="o">=</span> <span class="n">responseData</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">version_start_pos</span><span class="p">,</span> <span class="n">version_end_pos</span> <span class="o">-</span> <span class="n">version_start_pos</span><span class="p">);</span>

    <span class="c1">// Compare versions</span>
    <span class="n">log_message</span><span class="p">(</span><span class="s">"Current version: "</span> <span class="o">+</span> <span class="n">current_version</span> <span class="o">+</span> <span class="s">", Latest version: "</span> <span class="o">+</span> <span class="n">latest_version</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">latest_version</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">current_version</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">||</span> <span class="p">(</span><span class="n">latest_version</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="n">current_version</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">latest_version</span> <span class="o">&gt;</span> <span class="n">current_version</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A new version is available: "</span> <span class="o">&lt;&lt;</span> <span class="n">latest_version</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">WINAPI</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span> <span class="n">LPSTR</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmdShow</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">SetErrorMode</span><span class="p">(</span><span class="n">SEM_FAILCRITICALERRORS</span> <span class="o">|</span> <span class="n">SEM_NOOPENFILEERRORBOX</span><span class="p">);</span>

        <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetCurrentDirectoryA</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">cwd</span><span class="p">),</span> <span class="n">cwd</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to get current directory"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Determine which browser section to use based on command-line arguments or default to "Browser"</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_section</span> <span class="o">=</span> <span class="s">"Browser"</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lpCmdLine</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">lpCmdLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cmdLineStr</span><span class="p">(</span><span class="n">lpCmdLine</span><span class="p">);</span>
            <span class="kt">size_t</span> <span class="n">browser_arg_pos</span> <span class="o">=</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"--browser="</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">browser_arg_pos</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">size_t</span> <span class="n">browser_name_start</span> <span class="o">=</span> <span class="n">browser_arg_pos</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
                <span class="kt">size_t</span> <span class="n">browser_name_end</span> <span class="o">=</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="n">browser_name_start</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">browser_name_end</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">browser_name_end</span> <span class="o">=</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="n">browser_section</span> <span class="o">=</span> <span class="s">"Browser"</span> <span class="o">+</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">browser_name_start</span><span class="p">,</span> <span class="n">browser_name_end</span> <span class="o">-</span> <span class="n">browser_name_start</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Read configuration</span>
        <span class="k">auto</span> <span class="n">browser_settings</span> <span class="o">=</span> <span class="n">read_config_file</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="p">,</span> <span class="n">browser_section</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">general_settings</span> <span class="o">=</span> <span class="n">read_config_file</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="p">,</span> <span class="s">"General"</span><span class="p">);</span>

        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_path</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_flags</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">version_url</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">update_check</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">setting</span> <span class="o">:</span> <span class="n">browser_settings</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="s">"Executable"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">browser_path</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="s">"Flags"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">browser_flags</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="s">"VersionUrl"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">version_url</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">setting</span> <span class="o">:</span> <span class="n">general_settings</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="s">"UpdateCheck"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">update_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">second</span> <span class="o">==</span> <span class="s">"true"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Validate browser path</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="n">PathFileExistsA</span><span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Browser executable not found or not specified in config file: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">);</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error: Browser executable not found or not specified in config file: "</span> <span class="o">&lt;&lt;</span> <span class="n">browser_path</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Get and display browser version</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_version</span> <span class="o">=</span> <span class="n">get_browser_version</span><span class="p">(</span><span class="n">browser_path</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Launching "</span> <span class="o">&lt;&lt;</span> <span class="n">browser_section</span> <span class="o">&lt;&lt;</span> <span class="s">" Version: "</span> <span class="o">&lt;&lt;</span> <span class="n">browser_version</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

        <span class="c1">// Perform update check if enabled</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">update_check</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">check_for_updates</span><span class="p">(</span><span class="n">browser_version</span><span class="p">,</span> <span class="n">version_url</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Construct command line</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">final_cmd</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span> <span class="o">+</span> <span class="n">browser_path</span> <span class="o">+</span> <span class="s">"</span><span class="se">\"</span><span class="s"> "</span> <span class="o">+</span> <span class="n">browser_flags</span><span class="p">;</span>

        <span class="c1">// Append user-provided arguments</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lpCmdLine</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">lpCmdLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">char</span> <span class="n">sanitized_args</span><span class="p">[</span><span class="n">MAX_CMD_LENGTH</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
            <span class="n">strncpy_s</span><span class="p">(</span><span class="n">sanitized_args</span><span class="p">,</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="n">MAX_CMD_LENGTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">sanitize_command</span><span class="p">(</span><span class="n">sanitized_args</span><span class="p">);</span>
            <span class="n">final_cmd</span> <span class="o">+=</span> <span class="s">" "</span><span class="p">;</span>
            <span class="n">final_cmd</span> <span class="o">+=</span> <span class="n">sanitized_args</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Check for command-line length</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">final_cmd</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">MAX_CMD_LENGTH</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">log_message</span><span class="p">(</span><span class="s">"Command-line arguments are too long"</span><span class="p">);</span>
          <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error: Command-line arguments are too long"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
          <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Create process</span>
        <span class="n">STARTUPINFOA</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="n">si</span><span class="p">.</span><span class="n">cb</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">si</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcessA</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">final_cmd</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span>
            <span class="n">CREATE_NEW_PROCESS_GROUP</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to create process: "</span> <span class="o">+</span> <span class="n">final_cmd</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error: Failed to create process: "</span> <span class="o">&lt;&lt;</span> <span class="n">final_cmd</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">);</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hThread</span><span class="p">);</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"An exception occurred: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error: An exception occurred: "</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></section></div></div>

<p><strong>Key Features:</strong></p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">read_config_file</code>:</strong> Reads the <code class="language-plaintext highlighter-rouge">browser_config.ini</code> file and parses the specified section, returning a vector of key-value pairs. It handles missing or invalid configuration files by logging an error and returning an empty vector. It also checks if the configuration section is empty or invalid after parsing.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">get_browser_version</code>:</strong> Retrieves the version of the specified browser executable using the Windows Version API. It handles cases where the version information cannot be retrieved or is invalid.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">check_for_updates</code>:</strong> Performs an update check by fetching the latest version from the specified <code class="language-plaintext highlighter-rouge">VersionUrl</code> (if provided) and comparing it with the current version. It uses WinHTTP for making HTTP requests and includes error handling for various stages of the process, such as network issues, URL parsing, and JSON parsing.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">sanitize_command</code>:</strong> Sanitizes command-line arguments by removing potentially dangerous characters that could be used for command injection, such as <code class="language-plaintext highlighter-rouge">&amp;</code>, <code class="language-plaintext highlighter-rouge">|</code>, <code class="language-plaintext highlighter-rouge">;</code>, <code class="language-plaintext highlighter-rouge">`</code>, <code class="language-plaintext highlighter-rouge">$</code>, <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">^</code>, <code class="language-plaintext highlighter-rouge">(</code>, <code class="language-plaintext highlighter-rouge">)</code>, <code class="language-plaintext highlighter-rouge">[</code>, <code class="language-plaintext highlighter-rouge">]</code>, <code class="language-plaintext highlighter-rouge">{</code>, <code class="language-plaintext highlighter-rouge">}</code>.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">WinMain</code>:</strong> The main entry point of the application. It performs the following actions:
    <ul>
      <li>Sets the error mode to prevent error dialogs from appearing.</li>
      <li>Gets the current working directory.</li>
      <li>Determines the browser section to use based on command-line arguments (if provided) using the <code class="language-plaintext highlighter-rouge">--browser=</code> argument.</li>
      <li>Reads the configuration from <code class="language-plaintext highlighter-rouge">browser_config.ini</code>.</li>
      <li>Validates the browser path, logging an error and exiting if the path is invalid or the executable is not found.</li>
      <li>Retrieves and displays the browser version.</li>
      <li>Performs an update check if enabled.</li>
      <li>Constructs the final command line by combining the browser path, flags, and user-provided arguments.</li>
      <li>Appends sanitized user-provided arguments to the command line.</li>
      <li>Checks for command-line length, logging an error and exiting if the command line is too long.</li>
      <li>Creates a new process to launch the browser using <code class="language-plaintext highlighter-rouge">CreateProcessA</code>, logging an error and exiting if the process creation fails.</li>
      <li>Closes the process and thread handles.</li>
      <li>Includes exception handling to catch and log any exceptions that occur during the process.</li>
    </ul>
  </li>
</ul>
  <h2 id="build-instructions">
    
    
     <a href="#build-instructions">#</a><a href="#" aria-label="Back to top">Build Instructions</a>
        
    
  </h2>
      

<p>To build the browser launcher, you’ll need a C++ compiler that supports Windows development, such as MinGW or Visual Studio.</p>

<ul>
  <li><strong>Using Visual Studio:</strong>
    <ol>
      <li>Open the Visual Studio Developer Command Prompt.</li>
      <li>Navigate to the directory where you saved the C++ code (e.g., <code class="language-plaintext highlighter-rouge">browser_launcher.cpp</code>).</li>
      <li>
        <p>Compile using the following command:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code> cl /EHsc /W4 /Ox /std:c++17 browser_launcher.cpp /link shlwapi.lib Version.lib winhttp.lib
</code></section></div>        </div>
      </li>
    </ol>
  </li>
  <li><strong>Using MinGW:</strong>
    <ol>
      <li>Open the MinGW command prompt.</li>
      <li>Navigate to the directory where you saved the C++ code.</li>
      <li>
        <p>Compile using the following command:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code> g++ <span class="nt">-o</span> browser_launcher.exe browser_launcher.cpp <span class="nt">-lshlwapi</span> <span class="nt">-lversion</span> <span class="nt">-lwinhttp</span> <span class="nt">-std</span><span class="o">=</span>c++17
</code></section></div>        </div>
      </li>
    </ol>
  </li>
</ul>
  <h2 id="deployment-and-updates">
    
    
     <a href="#deployment-and-updates">#</a><a href="#" aria-label="Back to top">Deployment and Updates</a>
        
    
  </h2>
      

<p>After building the launcher, you can deploy it by placing the executable (<code class="language-plaintext highlighter-rouge">browser_launcher.exe</code>) and the <code class="language-plaintext highlighter-rouge">browser_config.ini</code> file in the desired location. To update the browser, you can use the following script:</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><section><code>@echo <span class="na">off</span>
<span class="kd">set</span> <span class="kd">BROWSER_DIR</span><span class="o">=</span>
<span class="nb">cd</span> <span class="na">/d </span><span class="nv">%BROWSER_DIR%</span>

<span class="k">if</span> <span class="ow">exist</span> .exe.new <span class="o">(</span>
    <span class="nb">move</span> <span class="na">/y </span>.exe .exe.old
    <span class="nb">move</span> <span class="na">/y </span>.exe.new .orig.exe
    <span class="nb">copy</span> <span class="na">/y </span><span class="kd">wrapper</span><span class="err">.exe</span> .exe
<span class="o">)</span>
</code></section></div></div>

<p>This script assumes that the new browser executable is named <code class="language-plaintext highlighter-rouge">.exe.new</code> and the wrapper executable is named <code class="language-plaintext highlighter-rouge">wrapper.exe</code>. It renames the existing browser executable, moves the new executable into place, and copies the wrapper executable over the original browser executable. You may need to modify this script based on your specific browser and directory structure. For example, for Iron Portable, the script would be:</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><section><code>@echo <span class="na">off</span>
<span class="kd">set</span> <span class="kd">BROWSER_DIR</span><span class="o">=</span>\IronPortable64\Iron
<span class="nb">cd</span> <span class="na">/d </span><span class="nv">%BROWSER_DIR%</span>

<span class="k">if</span> <span class="ow">exist</span> <span class="kd">IronPortable</span><span class="err">.exe</span>.new <span class="o">(</span>
    <span class="nb">move</span> <span class="na">/y </span><span class="kd">IronPortable</span><span class="err">.exe</span> <span class="kd">IronPortable</span><span class="err">.exe</span>.old
    <span class="nb">move</span> <span class="na">/y </span><span class="kd">IronPortable</span><span class="err">.exe</span>.new <span class="kd">IronPortable</span>.orig.exe
    <span class="nb">copy</span> <span class="na">/y </span><span class="kd">browser_launcher</span><span class="err">.exe</span> <span class="kd">IronPortable</span><span class="err">.exe</span>
<span class="o">)</span> <span class="k">else</span> <span class="o">(</span>
    <span class="k">if</span> <span class="ow">exist</span> <span class="kd">IronPortable</span><span class="err">.exe</span> <span class="o">(</span>
        <span class="nb">move</span> <span class="na">/y </span><span class="kd">IronPortable</span><span class="err">.exe</span> <span class="kd">IronPortable</span>.orig.exe
        <span class="nb">copy</span> <span class="na">/y </span><span class="kd">browser_launcher</span><span class="err">.exe</span> <span class="kd">IronPortable</span><span class="err">.exe</span>
    <span class="o">)</span>
<span class="o">)</span>
</code></section></div></div>

<p><strong>Update Process:</strong></p>

<ol>
  <li>The launcher checks for updates if <code class="language-plaintext highlighter-rouge">UpdateCheck</code> is set to <code class="language-plaintext highlighter-rouge">true</code> in the <code class="language-plaintext highlighter-rouge">[General]</code> section of <code class="language-plaintext highlighter-rouge">browser_config.ini</code> and a <code class="language-plaintext highlighter-rouge">VersionUrl</code> is provided in the <code class="language-plaintext highlighter-rouge">[Browser]</code> section.</li>
  <li>The <code class="language-plaintext highlighter-rouge">check_for_updates</code> function fetches the latest version information from the <code class="language-plaintext highlighter-rouge">VersionUrl</code> using WinHTTP.</li>
  <li>It parses the JSON response (assuming the response is in JSON format) to extract the latest version number.</li>
  <li>It compares the latest version with the current browser version.</li>
  <li>If a newer version is available, it notifies the user.</li>
  <li>The actual download and installation of the new version are not handled by the launcher and would typically be performed manually or through a separate update mechanism.</li>
</ol>

<p><strong>Error Handling:</strong></p>

<p>The launcher includes error handling for various scenarios:</p>

<ul>
  <li><strong>Missing or Invalid Configuration File:</strong> If <code class="language-plaintext highlighter-rouge">browser_config.ini</code> is missing or cannot be opened, the launcher logs an error and terminates. If a specific section is missing or invalid, it logs an error and uses default values or terminates, depending on the criticality of the missing information.</li>
  <li><strong>Missing Browser Executable:</strong> If the specified browser executable is not found, the launcher logs an error and terminates.</li>
  <li><strong>Failed Update Check:</strong> If the update check fails (e.g., due to network issues or invalid URL), the launcher logs an error and continues launching the browser with the existing version.</li>
  <li><strong>Failed Version Retrieval:</strong> If the launcher cannot retrieve the browser version, it logs an error and uses a default version or terminates, depending on whether the version information is critical.</li>
  <li><strong>Command-line Arguments Too Long:</strong> If the combined length of the command line exceeds the maximum allowed length, the launcher logs an error, truncates the arguments, or terminates.</li>
  <li><strong>Failed Process Creation:</strong> If the launcher fails to create a new process for the browser, it logs an error and terminates.</li>
  <li><strong>Log File Error:</strong> If the launcher cannot open the log file, it logs an error to the standard error stream.</li>
</ul>
  <h2 id="usage">
    
    
     <a href="#usage">#</a><a href="#" aria-label="Back to top">Usage</a>
        
    
  </h2>
      

<p>To use the launcher:</p>

<ol>
  <li><strong>Modify Configuration:</strong> Edit <code class="language-plaintext highlighter-rouge">browser_config.ini</code> to specify the browser executable, flags, and update settings for each browser you want to manage.</li>
  <li><strong>Run Launcher:</strong> Execute <code class="language-plaintext highlighter-rouge">browser_launcher.exe</code> to start the browser with custom configurations.</li>
  <li><strong>Additional Arguments:</strong> Pass extra command-line arguments; they are sanitized and forwarded to the browser.</li>
  <li>
    <p><strong>Select Browser Configuration:</strong> Use the <code class="language-plaintext highlighter-rouge">--browser=</code> argument to choose a specific browser configuration:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code> browser_launcher.exe <span class="nt">--browser</span><span class="o">=</span>2
</code></section></div>    </div>

    <p>This selects the <code class="language-plaintext highlighter-rouge">[Browser2]</code> section from the configuration file.</p>
  </li>
  <li><strong>Update Checks:</strong> Ensure <code class="language-plaintext highlighter-rouge">UpdateCheck=true</code> in the <code class="language-plaintext highlighter-rouge">[General]</code> section to enable update checking. Provide a valid <code class="language-plaintext highlighter-rouge">VersionUrl</code> in the browser section for update verification.</li>
</ol>
  <h2 id="simplified-version-without-update-checking">
    
    
     <a href="#simplified-version-without-update-checking">#</a><a href="#" aria-label="Back to top">Simplified Version without Update Checking</a>
        
    
  </h2>
      

<p>If you don’t need the update checking functionality, you can use a simplified version of the C++ code without the <code class="language-plaintext highlighter-rouge">check_for_updates</code> function and the related code in <code class="language-plaintext highlighter-rouge">WinMain</code>. This will reduce the complexity of the launcher and remove the dependency on the <code class="language-plaintext highlighter-rouge">WinHTTP</code> library. You can remove the <code class="language-plaintext highlighter-rouge">VersionUrl</code> parameter from the configuration file in this case.</p>

<p>Here’s the simplified C++ code without the update checking functionality:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><section><code><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;shlwapi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span>
<span class="cp">#pragma comment(lib, "shlwapi.lib")
#pragma comment(lib, "Version.lib")
</span>
<span class="cp">#define MAX_CMD_LENGTH 32768
#define LOG_FILE "browser_wrapper.log"
#define CONFIG_FILE "browser_config.ini"
</span>
<span class="c1">// Function to log messages to a file</span>
<span class="kt">void</span> <span class="nf">log_message</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">,</span> <span class="n">DWORD</span> <span class="n">error_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">log_file</span><span class="p">(</span><span class="n">LOG_FILE</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">log_file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">SYSTEMTIME</span> <span class="n">st</span><span class="p">;</span>
        <span class="n">GetLocalTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">);</span>
        <span class="kt">char</span> <span class="n">timestamp</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
        <span class="n">sprintf_s</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">timestamp</span><span class="p">),</span> <span class="s">"[%02d:%02d:%02d]"</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">wHour</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">wMinute</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">wSecond</span><span class="p">);</span>
        <span class="n">log_file</span> <span class="o">&lt;&lt;</span> <span class="n">timestamp</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">message</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">log_file</span> <span class="o">&lt;&lt;</span> <span class="s">" (Error: "</span> <span class="o">&lt;&lt;</span> <span class="n">error_code</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">log_file</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">log_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Function to sanitize command-line arguments</span>
<span class="kt">void</span> <span class="nf">sanitize_command</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmdLine</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">dangerous_chars</span> <span class="o">=</span> <span class="s">"&amp;|;`$&lt;&gt;^()[]{}"</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">cmdLine</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="n">cmdLine</span><span class="p">;</span> <span class="o">*</span><span class="n">src</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="o">++</span><span class="n">src</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strchr</span><span class="p">(</span><span class="n">dangerous_chars</span><span class="p">,</span> <span class="o">*</span><span class="n">src</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function to read the configuration file</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">read_config_file</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">config_file</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">section</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">settings</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">file</span><span class="p">(</span><span class="n">config_file</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">in_section</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to open config file: "</span> <span class="o">+</span> <span class="n">config_file</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">settings</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// Remove leading/trailing whitespace</span>
        <span class="n">line</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="n">find_first_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">));</span>
        <span class="n">line</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">find_last_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

        <span class="c1">// Skip comments and empty lines</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'['</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Check if we are entering the desired section</span>
            <span class="n">in_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="s">"["</span> <span class="o">+</span> <span class="n">section</span> <span class="o">+</span> <span class="s">"]"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">in_section</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Parse key-value pairs</span>
            <span class="kt">size_t</span> <span class="n">delimiter_pos</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">delimiter_pos</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delimiter_pos</span><span class="p">);</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">delimiter_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="c1">// Remove leading/trailing whitespace from key and value</span>
                <span class="n">key</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">key</span><span class="p">.</span><span class="n">find_first_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">));</span>
                <span class="n">key</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">find_last_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">value</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">.</span><span class="n">find_first_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">));</span>
                <span class="n">value</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">find_last_not_of</span><span class="p">(</span><span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">settings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">settings</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function to get the browser version</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">get_browser_version</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">browser_path</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">verHandle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">UINT</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">LPBYTE</span> <span class="n">lpBuffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"Unknown"</span><span class="p">;</span>

    <span class="n">DWORD</span> <span class="n">verSize</span> <span class="o">=</span> <span class="n">GetFileVersionInfoSizeA</span><span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">verHandle</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to get version info size for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">verData</span><span class="p">(</span><span class="n">verSize</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetFileVersionInfoA</span><span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">verHandle</span><span class="p">,</span> <span class="n">verSize</span><span class="p">,</span> <span class="n">verData</span><span class="p">.</span><span class="n">data</span><span class="p">()))</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to get version info for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">VerQueryValueA</span><span class="p">(</span><span class="n">verData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">VOID</span> <span class="n">FAR</span> <span class="o">*</span> <span class="n">FAR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">lpBuffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">)</span> <span class="o">||</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to query version value for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">VS_FIXEDFILEINFO</span><span class="o">*</span> <span class="n">verInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">VS_FIXEDFILEINFO</span><span class="o">*</span><span class="p">)</span><span class="n">lpBuffer</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwSignature</span> <span class="o">!=</span> <span class="mh">0xfeef04bd</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"Invalid version info signature for: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionMS</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span>
              <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionMS</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span>
              <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionLS</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span>
              <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">((</span><span class="n">verInfo</span><span class="o">-&gt;</span><span class="n">dwFileVersionLS</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">version</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">WINAPI</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span> <span class="n">LPSTR</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmdShow</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">SetErrorMode</span><span class="p">(</span><span class="n">SEM_FAILCRITICALERRORS</span> <span class="o">|</span> <span class="n">SEM_NOOPENFILEERRORBOX</span><span class="p">);</span>

        <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetCurrentDirectoryA</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">cwd</span><span class="p">),</span> <span class="n">cwd</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to get current directory"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Determine which browser section to use based on command-line arguments or default to "Browser"</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_section</span> <span class="o">=</span> <span class="s">"Browser"</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lpCmdLine</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">lpCmdLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cmdLineStr</span><span class="p">(</span><span class="n">lpCmdLine</span><span class="p">);</span>
            <span class="kt">size_t</span> <span class="n">browser_arg_pos</span> <span class="o">=</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"--browser="</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">browser_arg_pos</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">size_t</span> <span class="n">browser_name_start</span> <span class="o">=</span> <span class="n">browser_arg_pos</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
                <span class="kt">size_t</span> <span class="n">browser_name_end</span> <span class="o">=</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="n">browser_name_start</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">browser_name_end</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">browser_name_end</span> <span class="o">=</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="n">browser_section</span> <span class="o">=</span> <span class="s">"Browser"</span> <span class="o">+</span> <span class="n">cmdLineStr</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">browser_name_start</span><span class="p">,</span> <span class="n">browser_name_end</span> <span class="o">-</span> <span class="n">browser_name_start</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Read configuration</span>
        <span class="k">auto</span> <span class="n">browser_settings</span> <span class="o">=</span> <span class="n">read_config_file</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="p">,</span> <span class="n">browser_section</span><span class="p">);</span>

        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_path</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_flags</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">setting</span> <span class="o">:</span> <span class="n">browser_settings</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="s">"Executable"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">browser_path</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="s">"Flags"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">browser_flags</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Validate browser path</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="n">PathFileExistsA</span><span class="p">(</span><span class="n">browser_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Browser executable not found or not specified in config file: "</span> <span class="o">+</span> <span class="n">browser_path</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Get and display browser version</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">browser_version</span> <span class="o">=</span> <span class="n">get_browser_version</span><span class="p">(</span><span class="n">browser_path</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Launching "</span> <span class="o">&lt;&lt;</span> <span class="n">browser_section</span> <span class="o">&lt;&lt;</span> <span class="s">" Version: "</span> <span class="o">&lt;&lt;</span> <span class="n">browser_version</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

        <span class="c1">// Construct command line</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">final_cmd</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span> <span class="o">+</span> <span class="n">browser_path</span> <span class="o">+</span> <span class="s">"</span><span class="se">\"</span><span class="s"> "</span> <span class="o">+</span> <span class="n">browser_flags</span><span class="p">;</span>

        <span class="c1">// Append user-provided arguments</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lpCmdLine</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">lpCmdLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">char</span> <span class="n">sanitized_args</span><span class="p">[</span><span class="n">MAX_CMD_LENGTH</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
            <span class="n">strncpy_s</span><span class="p">(</span><span class="n">sanitized_args</span><span class="p">,</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="n">MAX_CMD_LENGTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">sanitize_command</span><span class="p">(</span><span class="n">sanitized_args</span><span class="p">);</span>
            <span class="n">final_cmd</span> <span class="o">+=</span> <span class="s">" "</span><span class="p">;</span>
            <span class="n">final_cmd</span> <span class="o">+=</span> <span class="n">sanitized_args</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Create process</span>
        <span class="n">STARTUPINFOA</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="n">si</span><span class="p">.</span><span class="n">cb</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">si</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcessA</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">final_cmd</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span>
            <span class="n">CREATE_NEW_PROCESS_GROUP</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s">"Failed to create process: "</span> <span class="o">+</span> <span class="n">final_cmd</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">);</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hThread</span><span class="p">);</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">log_message</span><span class="p">(</span><span class="s">"An exception occurred: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></section></div></div>

<p><strong>Building the Simplified Version:</strong></p>

<p>The build instructions for the simplified version are the same as for the full version, except that you don’t need to link the <code class="language-plaintext highlighter-rouge">winhttp.lib</code> library.</p>

<p><strong>Using Visual Studio:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>cl /EHsc /W4 /Ox /std:c++17 browser_launcher_simple.cpp /link shlwapi.lib Version.lib
</code></section></div></div>

<p><strong>Using MinGW:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>g++ <span class="nt">-o</span> browser_launcher_simple.exe browser_launcher_simple.cpp <span class="nt">-lshlwapi</span> <span class="nt">-lversion</span> <span class="nt">-std</span><span class="o">=</span>c++17
</code></section></div></div>

      </div>
      
        URL: https://ib.bsb.br/browser-srware-iron
      
    </article>
        <nav class="post-navigation same-tag-navigation" aria-label="Posts sharing the same tag">
          
          
        </nav>
    
    
      
      
      
        
      
        
      
        
          
          
      
    
    
  </main>
  <footer id="bottom-of-page" class="site-footer">
    <p>
      <a
        href="#"
        aria-label="Back to top"
        class="back-to-top-link">
        <span class="sr-only">Back to top</span>
      </a>
      
      
      
      <a href="https://ib.bsb.br/404" aria-label="404">
        2025-01-28 21:53:32
      </a>
      &hArr;
      <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">&#8505;</a>
      <a href="/" aria-label="Homepage">
        infoBAG
      </a>
      <button id="copyAllButton" aria-label="Copy all code">
        &copy;
      </button>
    </p>
  </footer>
  <style>
  .back-to-top-link {
    display: inline-block;
    width: 32px;
    height: 32px;
    background: url("/assets/Rope_(Old).gif") center center no-repeat;
    background-size: contain; /* or cover */
    text-decoration: none;
    vertical-align: middle;
  }
  .sr-only {
    /* Utility class to hide text visually but keep it accessible */
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  </style>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://ib.bsb.br/browser-srware-iron/"
    },
    "headline": "SRWare Iron Browser launcher in C++",
    "description": "",
    "datePublished": "2024-12-19T00:00:00+00:00",
    "dateModified": "2025-01-18T23:08:41+00:00",
    "author": {
      "@type": "Person",
      "name": "Author"
    },
    "publisher": {
      "@type": "Organization",
      "name": "infoBAG"
      
    }
    
  }
  </script>
  <script src="/assets/js/prism.js" defer></script>
  <script src="/assets/js/copy-all-code.js"></script>
</body>
</html>
