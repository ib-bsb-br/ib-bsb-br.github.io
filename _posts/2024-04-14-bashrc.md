---

title: "/.bashrc"
date: 2024-04-14
tags: [linux>dotfile]
comment: 
info: aberto.
type: post
layout: post
---

## Introduction
This guide walks through configuring a robust interactive shell on Debian 11 “Bullseye,” including environment variables (Go, Rust, Python), Flatpak, aliases, and a systemd-user–managed SSH agent. It separates user-level and root-level steps, clarifies placeholders, and includes verification commands.

---

## 1. System Update & Core Utilities  
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y \
  build-essential git curl wget unzip zip bash-completion \
  python3-pip nodejs npm libpulse-dev flatpak swaks
```

## 2. Language Runtimes  
### Go (≥1.20)  
```bash
GO_VER=1.20.5
wget https://go.dev/dl/go${GO_VER}.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go${GO_VER}.linux-amd64.tar.gz
rm go${GO_VER}.linux-amd64.tar.gz
```

### Rust  
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
```

---

## 3. Shell Configuration  
### 3.1 ~/.bash_profile (User)  
```bash
# Source ~/.bashrc for interactive login shells
if [[ $- == *i* ]]; then
  source ~/.bashrc
fi
```

### 3.2 ~/.bashrc (User)  
```bash
# 1. Exit if not interactive
case "$-" in *i*) ;; *) return;; esac

# 2. History
HISTCONTROL=ignoreboth
shopt -s histappend
HISTSIZE=1000
HISTFILESIZE=2000

# 3. XDG directories
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_DIRS="/var/lib/flatpak/exports/share:$HOME/.local/share/flatpak/exports/share:$XDG_DATA_DIRS"
export XDG_RUNTIME_DIR="$XDG_RUNTIME_DIR"

# 4. PATH updates
export GOPATH="$HOME/go"
export PATH="$PATH:/usr/local/go/bin:$GOPATH/bin:$HOME/.local/bin"

# 5. Rust environment
[ -f "$HOME/.cargo/env" ] && source "$HOME/.cargo/env"

# 6. Bash completion
if ! shopt -oq posix; then
  source /usr/share/bash-completion/bash_completion 2>/dev/null \
    || source /etc/bash_completion 2>/dev/null
fi

# 7. SSH agent via systemd-user
export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.sock"
if ! ssh-add -l &>/dev/null; then
  ssh-add ~/.ssh/id_rsa 2>/dev/null || true
fi

# 8. GNOME Keyring fallback
if [ -n "$DESKTOP_SESSION" ]; then
  eval "$(gnome-keyring-daemon --start --components=secrets,ssh)"
  export SSH_AUTH_SOCK
fi

# 9. Prompt
PS1='\u@\h:\w\$ '

# 10. Aliases (fill placeholders)
alias ll='ls -alF'
alias p='ping example.com'
alias Z='swaks -4 -tls -f you@domain.com -t you@domain.com -s smtp.gmail.com:587 -au you@domain.com -ap your_app_pass -d'
alias pull='cd ~/projects/REPO && git pull'
alias push='cd ~/projects/REPO && git push'
```

---

## 4. systemd-user SSH Agent Service (User)  
Create `~/.config/systemd/user/ssh-agent.service`:
```ini
[Unit]
Description=SSH Agent per user
After=network.target

[Service]
Type=forking
Environment=SSH_AUTH_SOCK=%t/ssh-agent.sock
ExecStart=/usr/bin/ssh-agent -a $SSH_AUTH_SOCK

[Install]
WantedBy=default.target
```

Enable and start:
```bash
systemctl --user daemon-reload
systemctl --user enable ssh-agent.service
systemctl --user start ssh-agent.service
```

Verify:
```bash
systemctl --user status ssh-agent.service
ls -l "$XDG_RUNTIME_DIR/ssh-agent.sock"
ssh-add -l
```

---

## 5. Common SSH Use Cases
- **Passwordless login:** Key-based server access.  
- **Git over SSH:** Seamless `git clone/push/pull`.  
- **Agent forwarding:** Secure multi-hop SSH.  
- **Hardware tokens:** GNOME Keyring integration.

---

## 6. Verification Checklist
```bash
go version
rustc --version
bash --login -ic 'echo interactive'
ssh-add -l
```
