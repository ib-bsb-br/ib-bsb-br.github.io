---
tags: aid>software>windows
info: aberto.
date: 2025-04-16
type: post
layout: post
published: true
slug: sysprep
title: Requirements for sysprep.bat on Windows (Server 2003 + Win11)
comment: https://www.vernalex.com/guides/sysprep/index.shtml
---

# Server 2003

## sysprep.bat

{% codeblock bat %}
@ECHO OFF
CLS
ECHO System Preparation Tool
ECHO.
ECHO Before continuing please:
ECHO 1. Be sure that the pre-sysprep steps were followed.
ECHO 2. Image the computer previous to this, as the sysprep
ECHO process may fail and this would corrupt the installation
ECHO you have prepared.
ECHO 3. Restart the computer before attempting this so that
ECHO system buffers are cleared.
ECHO 4. Close all open windows before continuing.
ECHO.
pause

ECHO.
ECHO Flushing data to disks (preliminary):
sync -r -e /accepteula

ECHO.
ECHO Cleaning up old driver caches:
del /s /q c:\sysprep\drivers\infcache.1

ECHO.
ECHO Creating driver path (SysPrep Driver Scanner):
spdrvscn /p c:\sysprep\drivers /e inf /d C:\windows\inf /m "Image: ~month/~day/~year" /o "Image created at ~hour:~minute:~second on ~month/~day/~year (~weekday)." /a /s /q

ECHO.
ECHO Closing open SMB connections:
net use * /delete /yes

ECHO.
ECHO Terminating unneeded processes:
kill /f vptray
kill /f ccapp
kill /f explorer
kill /f alg
kill /f ati2evxx
kill /f ccevtmgr
kill /f ccsetmgr
kill /f defwatch
kill /f lucoms~1
kill /f mdm

ECHO.
ECHO Stopping unnessary services:
net stop alerter /yes
net stop wuauserv /yes
net stop browser /yes
net stop cryptsvc /yes
net stop dhcp /yes
net stop mdm /yes
net stop trkwks /yes
net stop protectedstorage /yes
net stop remoteregistry /yes
net stop seclogon /yes
net stop samss /yes
net stop wscsvc /yes
net stop lanmanagerserver /yes
net stop "symantec antivirus" /yes
net stop defwatch /yes
net stop ccevtmgr /yes
net stop sndsrvc /yes
net stop ccpwdsvc /yes
net stop ccsetmgr /yes
net stop sens /yes
net stop srservice /yes
net stop schedule /yes
net stop lmhosts /yes
net stop ups /yes
net stop uphclean /yes
net stop webclient /yes
net stop audiosrv /yes
net stop sharedaccess /yes
net stop msiserver /yes
net stop w32time /yes
net stop wzcsvc /yes
net stop lanmanworkstation /yes
net stop spooler /yes

ECHO.
ECHO Flushing data to disks (finalization):
sync -r -e

ECHO.
ECHO Executing system preparation tool (reseal / minisetup)...
start sysprep -reseal -mini -quiet
{% endcodeblock %}

To successfully execute the provided sysprep.bat script during a System Preparation (Sysprep) process on Windows Server 2003 Standard R2 x64, specific external software, utilities, and directory structures must be correctly configured and accessible. This document provides a detailed outline of these essential requirements. Sysprep itself is used to generalize a Windows installation, removing unique identifiers like the Security Identifier (SID) and configuring the OS to run an initial setup wizard (Mini-Setup) on the next boot, making the image suitable for deployment onto multiple machines. The process often involves external tools, like those in this script, to ensure data integrity by flushing disk caches, manage device drivers effectively for hardware independence across different target machines, and terminate potentially problematic background processes before sealing the final image. Failing to meet these prerequisites by having missing components or incorrect configurations will likely cause script execution errors, prevent the Sysprep process from completing successfully, or lead to deployment failures and unstable systems on target computers.

**Important Note on Privileges:** Executing this script requires Administrator privileges. Many actions performed, such as stopping system services, deleting files in protected locations (implicitly, via infcache.1), potentially placing tools in C:\\Windows\\System32, and running sysprep.exe itself, necessitate elevated rights. Ensure you are running the script from an administrative command prompt.

Standard Windows commands (ECHO, CLS, pause, del, net, start), which are integral parts of the Windows command-line environment, are assumed to be present in their default system locations (typically C:\\Windows\\System32) and are therefore not detailed as separate requirements below.

### **1\. Sysinternals Sync (sync.exe)**

* **Purpose in Script:** The script utilizes sync.exe (sync \-r \-e /accepteula and sync \-r \-e) to force the operating system to flush all modified file system data held in memory (cached data) to the physical disk drives. This is a critical step before finalizing system changes or shutting down, especially before the Sysprep reseal operation, as it ensures data consistency and minimizes the risk of data loss or corruption if the system were to shut down unexpectedly. The /accepteula flag is used once to automatically accept the Sysinternals End User License Agreement, preventing the script from pausing for user input. The \-r flag ensures it flushes files in subdirectories, and \-e attempts to flush and eject removable media.  
* **Required Software:** The specific executable sync.exe from the widely recognized Microsoft Sysinternals Suite. Using other utilities named 'sync' may not provide the same functionality or accept the same command-line arguments.  
  * *Acquisition:* This tool is typically downloaded directly from the official Microsoft Sysinternals documentation pages or website. For older operating systems like Windows Server 2003, ensure you obtain a version of the tool known to be compatible; archives of older Sysinternals suites may be necessary.  
* **Required Location:** For the script to run sync.exe, the executable must be located where the command processor can find it. This means placing sync.exe either in a directory listed in the system's PATH environment variable (like C:\\Windows\\System32) or directly in the same directory where the sysprep.bat script is being executed.  
* **Common Placement:** Placing sync.exe in C:\\Windows\\System32 is a frequent practice as it makes the tool available system-wide for various administrative scripts and tasks.

### **2\. Driver Scanner (spdrvscn.exe)**

* **Purpose in Script:** The command spdrvscn /p c:\\sysprep\\drivers ... strongly suggests this executable performs a specialized role related to device driver management during the Sysprep process. Its function is likely crucial for ensuring the prepared image can boot and correctly install devices when deployed onto potentially diverse hardware configurations. This might involve tasks such as scanning the system for installed drivers, comparing them against a repository, injecting necessary Plug-and-Play (PnP) drivers into the image from the specified path (c:\\sysprep\\drivers), or perhaps pre-indexing drivers to accelerate PnP detection during Mini-Setup. Effective driver management is fundamental to Sysprep's goal of hardware independence.  
* **Required Software:** An executable file specifically named spdrvscn.exe (or whatever tool this command actually invokes).  
  * *Note:* It is vital to understand that this is **not** a standard component of Windows Server 2003, nor is it part of common toolsets like Sysinternals or the Resource Kit Tools. It most likely represents a third-party utility or, quite possibly, a custom in-house tool developed specifically for the organization's unique imaging workflow. Crucially, you must identify this *exact* spdrvscn.exe tool from your organization's original imaging process and obtain it. Its specific function is unknown based solely on the script; attempting to substitute it with any other tool is impossible without knowing precisely what it does and will likely result in incorrect driver handling, deployment failures, or system instability (e.g., BSODs) on target machines.  
* **Required Location:** Similar to other external tools, spdrvscn.exe must be placed where the script can execute it: either in a directory included within the system's PATH environment variable or in the same directory from which the sysprep.bat script is being run.  
* **Common Placement:** Given its specialized nature and connection to Sysprep, it might logically reside within the C:\\Sysprep folder structure itself (e.g., in a subfolder like C:\\Sysprep\\Tools). Alternatively, it could be placed in C:\\Windows\\System32 or a centrally managed custom tools directory that's part of the system PATH. The script's reference to c:\\sysprep\\drivers might hint that related tools are also kept under C:\\Sysprep.

### **3\. Kill Process Utility (kill.exe)**

* **Purpose in Script:** The script uses kill.exe (with the /f flag for forceful termination) to stop specific background processes (vptray, ccapp, explorer, etc.) before proceeding with Sysprep. This is important to ensure a clean system state, prevent applications from interfering with the Sysprep operations (which modify many system files and registry settings), remove user-specific application states or running agents, and avoid potential conflicts during the resealing phase. The processes listed appear to include components of Symantec Antivirus (vptray, ccapp, ccevtmgr, ccsetmgr), the Windows shell (explorer), and various system or utility services.  
* **Required Software:** An executable named kill.exe. While Windows Server 2003 includes the native taskkill.exe command for terminating processes, this script explicitly relies on kill.exe. This specific utility often provided a simpler syntax or slightly different behavior compared to taskkill.  
  * *Acquisition:* kill.exe was a standard utility included in the freely downloadable Microsoft Windows Server 2003 Resource Kit Tools package. This package contained numerous helpful administrative utilities not included with the base OS.  
* **Required Location:** The kill.exe executable must be found by the command interpreter. Place the file either in a directory that is part of the system's PATH environment variable or directly in the same directory where the sysprep.bat script resides and is executed.  
* **Common Placement:** If the full Windows Server 2003 Resource Kit Tools package is installed, its installation directory is typically added to the system PATH automatically, making kill.exe accessible. A common alternative for deploying specific tools is to copy kill.exe directly into the C:\\Windows\\System32 folder.

### **4\. System Preparation Tool (sysprep.exe)**

* **Purpose in Script:** This is the core Microsoft utility essential for the entire image preparation process. The command start sysprep \-reseal \-mini \-quiet initiates the final phase. Specifically, \-reseal configures the system to run the Mini-Setup wizard (also known as Windows Welcome or OOBE \- Out-Of-Box Experience) upon the next boot, clearing system-specific information like the SID. The \-mini option specifies that the Mini-Setup wizard should run, allowing for customization during deployment (like setting computer name, joining a domain, etc.). The \-quiet flag suppresses any graphical user interface or prompts from Sysprep itself, making it suitable for automated scripting.  
* **Required Software:** The main sysprep.exe executable and all its necessary supporting files (such as setupcl.exe, factory.exe, and various .inf or .dll files). These components work together; simply having sysprep.exe alone is insufficient. These files are specific to the operating system version, architecture (x64 in this case), and potentially the service pack level. Using mismatched versions can lead to unpredictable failures.  
  * *Acquisition:* The correct Sysprep files for Windows Server 2003 are typically located within the Deploy.cab compressed archive file found in the \\Support\\Tools\\ directory on the official Windows Server 2003 installation media (CD or ISO). You must extract the *entire contents* of Deploy.cab to the designated Sysprep location using a tool capable of handling CAB archives (like expand.exe or built-in Windows functionality).  
* **Required Location:** Sysprep files must be placed precisely where the operating system and the start sysprep command expect to find them. While Sysprep *might* be found if placed in the system PATH, this is not the standard or recommended practice for Windows Server 2003\.  
* **Standard Location:** For Windows Server 2003, the universally accepted and expected location is the C:\\Sysprep folder at the root of the system drive. You should manually create this folder if it doesn't exist and then extract all files from the Deploy.cab archive directly into C:\\Sysprep.

### **5\. Directory Structure (C:\\Sysprep\\drivers)**

* **Purpose in Script:** The script explicitly interacts with this directory in two ways: first, by deleting c:\\sysprep\\drivers\\infcache.1, and second, by passing the path c:\\sysprep\\drivers as a parameter to spdrvscn.exe. The deletion of infcache.1 (a file Windows uses to cache information about discovered INF files) is likely intended to force a complete rebuild of the driver cache during Mini-Setup, ensuring that only explicitly provided or newly detected drivers are considered, rather than relying on potentially outdated cached information. The spdrvscn.exe tool, as discussed, likely uses this directory either as a source repository from which to inject necessary drivers into the image or as a target location to store information about the drivers it has processed for use during deployment.  
* **Required:** The directory path C:\\Sysprep\\drivers must physically exist on the file system *before* the sysprep.bat script is executed. If the directory is missing, the del command might simply report an error, but the spdrvscn.exe tool would likely fail catastrophically if it expects to read from or write to this specific location. The contents required within this directory depend entirely on the function of the custom spdrvscn.exe tool.

Note on Services:  
The script includes a lengthy section dedicated to stopping numerous Windows services using net stop. Examples include security software (symantec antivirus, defwatch), Windows Update (wuauserv), networking services (dhcp, lanmanserver, lanmanworkstation), and various others. While the script attempts to stop these, their actual presence on the system isn't strictly required for the net stop command itself to run (it will simply report an error like "The service name is invalid" or "The service has not been started" if the service doesn't exist or isn't running). However, the explicit inclusion of these commands strongly implies that the script was carefully crafted for a specific baseline system configuration where these services were typically installed and running. Stopping them is considered best practice before Sysprep to prevent interference with the generalization process (e.g., AV scanning/blocking file changes, Windows Update trying to install updates, DHCP client renewing leases during cloning, remote registry service allowing unwanted access). Failure to stop necessary services, especially those performing background file modifications or network communications, could compromise the integrity and stability of the sealed image.  
**Verification Note:** The information provided regarding sync.exe and kill.exe assumes the use of standard, compatible distributions from Microsoft Sysinternals and the Windows Server 2003 Resource Kit Tools, respectively. Given the significant age of the Windows Server 2003 operating system, it is absolutely crucial to verify that you are using tool versions explicitly stated as compatible with this OS and architecture (R2 x64). Using incompatible or newer versions not designed for WS2003 could lead to subtle errors or outright failures. Furthermore, the identity, specific function, and correct method for obtaining and implementing the non-standard spdrvscn.exe utility must be determined entirely from the documentation or institutional knowledge surrounding your organization's specific, established imaging process. This document can only highlight its likely role based on the script's commands.

Ensuring these prerequisites are met is essential for the successful execution of the sysprep.bat script and the creation of a reliable Windows Server 2003 image.

# Windows 11

## Preparing a Windows 11 Image using Sysprep: A Modern Guide

System Preparation (Sysprep) is Microsoft's essential tool for preparing a customized Windows 11 installation for imaging and deployment. Its primary function is to **generalize** the operating system by removing unique identifiers (like the Security Identifier - SID) and configuring it to run the Out-of-Box Experience (OOBE) on the next boot. This allows the captured image to be deployed across multiple, potentially diverse hardware devices, each receiving a unique identity during setup.

Unlike older operating systems (e.g., Windows Server 2003) where Sysprep preparation often involved complex batch scripts using external utilities for tasks like driver injection, cache flushing, and aggressive process termination, Windows 11 utilizes a more integrated and robust approach. Modern Sysprep heavily relies on the built-in tool itself, combined with an **answer file (`unattend.xml`)** for automation and configuration.

This revised guide details the modern requirements and considerations for Sysprepping Windows 11, contrasting them with older methods and incorporating current best practices.

**Key Differences from Older Sysprep Workflows:**

* **Built-in Tool:** `sysprep.exe` is included in Windows 11 at `C:\Windows\System32\Sysprep`. No extraction from installation media is needed.
* **Answer File (`unattend.xml`):** This XML file is the cornerstone of modern Sysprep automation. It dictates OOBE settings, driver handling, commands to run, and much more, replacing many manual script steps.
* **Integrated Driver Management:** Driver injection and persistence are managed via settings in `unattend.xml` or through offline image servicing with DISM (Deployment Image Servicing and Management). Custom tools like the `spdrvscn.exe` mentioned in the original context are obsolete.
* **Refined Process/Service Handling:** Windows 11's Sysprep `/generalize` process is more comprehensive in cleaning up system state. Aggressive termination of built-in services is strongly discouraged due to potential system instability. Built-in tools like `taskkill.exe` replace legacy utilities (`kill.exe`).
* **Filesystem Robustness:** Modern NTFS and improved OS cache management reduce the critical need for manual cache flushing tools (`sync.exe`), though they can still be used as a precaution.

**Important Note on Privileges:** Executing Sysprep requires **Administrator privileges**. Always run `sysprep.exe` and any preparatory commands from an elevated Command Prompt or PowerShell session.

### Modern Requirements and Considerations for Windows 11 Sysprep

The modern workflow involves configuring the reference system, creating a comprehensive `unattend.xml` answer file, performing minimal necessary pre-Sysprep tasks, and then executing `sysprep.exe` with the correct parameters.

**1. System Preparation Tool (`sysprep.exe`)**

* **Purpose:** The core utility for generalizing the Windows 11 installation.
* **Location:** `C:\Windows\System32\Sysprep\`
* **Key Parameters:**
    * `/generalize`: **Essential.** Removes unique system information (SID, computer name, event logs, etc.). The system cannot be imaged for deployment without this.
    * `/oobe`: Configures Windows to boot into the Out-of-Box Experience (user setup phase) on the next start. Used for images intended for end-users.
    * `/audit`: Restarts the computer into audit mode, allowing further customization before OOBE.
    * `/shutdown`: Shuts down the machine after Sysprep completes. Use this when you intend to capture the image immediately.
    * `/reboot`: Reboots the machine after Sysprep completes.
    * `/quiet`: Suppresses on-screen confirmation messages. Useful for automation.
    * `/unattend:<answerfile>`: Applies settings specified in the `unattend.xml` file during the Sysprep process and subsequent setup phases. **Highly recommended for automation and customization.**
* **Example Command (for Image Capture):**
    `C:\Windows\System32\Sysprep\sysprep.exe /generalize /oobe /shutdown /unattend:C:\path\to\your\unattend.xml`
* **Reference:** Search "Sysprep Command-Line Options" on Microsoft Learn for full details.

**2. Answer File (`unattend.xml`)**

* **Purpose:** Provides automated instructions for Windows Setup and Sysprep, controlling numerous settings across different configuration passes.
* **Key Functions:**
    * Automating OOBE (language, locale, license key, user accounts, computer name, network config).
    * Specifying driver search paths (`DriverPaths`).
    * Persisting installed Plug-and-Play drivers (`PersistAllDeviceInstalls`).
    * Running custom scripts or commands (`RunSynchronousCommand`, `RunAsynchronousCommand`).
    * Configuring disk partitions, Windows features, security settings, and much more.
* **Configuration Passes:** Settings in `unattend.xml` are applied during specific phases (passes) of setup:
    * `generalize`: Settings applied when `sysprep /generalize` runs. Used for system-wide settings that shouldn't depend on specific hardware.
    * `specialize`: Settings applied during the first boot after generalization, when Windows configures hardware-specific settings. Computer name, network settings, domain join often go here.
    * `oobeSystem`: Settings applied just before OOBE starts. Controls UI language, user accounts, etc.
    * (Other passes like `windowsPE`, `auditSystem`, `auditUser`, `offlineServicing` exist for different scenarios).
* **Creation:** Use the **Windows System Image Manager (WSIM)**, available in the **Windows Assessment and Deployment Kit (ADK)**. The ADK is a free download from Microsoft (search the Microsoft website for "Download Windows ADK"). WSIM provides a GUI to create and validate `unattend.xml` files against a Windows image (`install.wim`).
* **Location:** Can be placed in various locations (e.g., `C:\Windows\Panther`, removable media) but explicitly providing the path via `/unattend:` is the clearest method.
* **Reference:** Search "Windows Setup Automation Overview" and "Answer files overview" on Microsoft Learn.

**3. Driver Management (Replaces `spdrvscn.exe` / `C:\Sysprep\drivers`)**

* **Purpose:** Ensure Windows can find and install necessary drivers during deployment, especially on different hardware.
* **Modern Methods:**
    * **DISM (Offline Injection):** Use `DISM /Image:C:\mount /Add-Driver /Driver:C:\drivers /Recurse` on a *mounted offline* Windows image (`.wim`) before deployment. This pre-installs drivers into the image's driver store. Often the most robust method for large driver sets or ensuring drivers are present before PnP detection.
    * **`unattend.xml` - `DriverPaths`:** Specify one or more paths (local or UNC) in the `Microsoft-Windows-PnpCustomizationsWinPE` or `Microsoft-Windows-PnpCustomizationsNonWinPE` components. During setup, Windows PnP will search these locations for matching drivers if needed. Useful for providing drivers "just-in-time".
    * **`unattend.xml` - `PersistAllDeviceInstalls`:** Setting in the `Microsoft-Windows-PnpSysprep` component (applied during the `generalize` pass). If `true`, Sysprep attempts to keep drivers for *all* currently installed PnP devices. **Use with extreme caution.** This can significantly increase image size and cause conflicts if deploying to hardware significantly different from the reference machine. Generally recommended to set to `false` (default) and use DISM or `DriverPaths` for necessary drivers.
* **Obsolete:** Custom scanning tools and manual cache deletion are unnecessary and unreliable. Rely on DISM and `unattend.xml`.
* **Reference:** Search "Device Drivers and Deployment Overview" and "Add and Remove Drivers Offline using DISM" on Microsoft Learn.

**4. Process Termination (Replaces `kill.exe`)**

* **Purpose:** Optionally stop non-essential third-party applications that might interfere with Sysprep.
* **Modern Tool:** `taskkill.exe` (built-in).
    * **Syntax:** `taskkill /F /IM <process_image_name.exe>` (e.g., `taskkill /F /IM thirdpartyapp.exe`)
    * `/F` forces termination; `/IM` specifies the image name.
* **Caution:** **Do not terminate core Windows processes or services.** Focus *only* on specific, known problematic third-party applications (e.g., some security agents might require specific stop procedures before Sysprep). Sysprep's `/generalize` handles necessary system process cleanup.

**5. Service Management (Replaces `net stop ...`)**

* **Purpose:** Optionally stop services that might interfere.
* **Modern Approach:** **Strongly discouraged for built-in Windows services.** Windows 11 service dependencies are complex, and stopping them can lead to instability or Sysprep failure. The `/generalize` pass correctly resets service states for deployment. The aggressive stopping seen in older scripts is generally unnecessary and risky.
* **If Necessary (Third-Party Only):** If a specific *third-party* service *must* be stopped:
    * Use `net stop <service_name>` or `sc stop <service_name>`. Find the correct name via `services.msc` or `sc query`.
* **Recommendation:** Build your reference image cleanly. Avoid installing software or agents that interfere with Sysprep if possible. If third-party software requires specific handling before Sysprep, consult its vendor documentation.

**6. Disk Cache Flushing (Optional - Replaces `sync.exe`)**

* **Purpose:** Force in-memory file changes to be written to disk before shutdown.
* **Modern Tool:** `sync.exe` or `sync64.exe` from Microsoft Sysinternals Suite (downloadable from Microsoft).
    * **Syntax:** `sync64.exe -r` (use `sync64.exe` on 64-bit Windows 11). `/accepteula` may be needed on first run.
* **Necessity:** Optional precaution. Modern NTFS journaling makes data loss from cache less likely than on older systems, but flushing cache before the Sysprep shutdown is harmless and provides peace of mind for some administrators.

**7. Network Drive Disconnection (Optional - `net use`)**

* **Purpose:** Ensure no network drives are mapped in the captured image.
* **Command:** `net use * /delete /y` (remains valid in Windows 11).

**8. Sysprep Limitations and Considerations**

* **Upgrade Scenarios:** Sysprep is **not supported** on Windows installations that were upgraded from a previous version. Always start with a clean installation for your reference image.
* **Sysprep Count:** You can typically run `sysprep /generalize` up to 8 times on a single Windows image. The count can be checked via registry keys (search Microsoft documentation for "slmgr /dlv" or Sysprep generalize limits). Use Audit Mode for customizations instead of repeatedly generalizing.
* **Windows Store Apps (UWP):** Sysprep can sometimes have issues with provisioned Store apps, especially if they've been updated or if new users have logged in. Microsoft provides guidance on handling UWP apps during Sysprep (often involving removing certain apps before generalizing). Consult current Microsoft documentation on "Sysprep fails UWP apps".
* **Domain Membership:** A machine must be removed from a domain *before* running `sysprep /generalize`. Domain join is configured via `unattend.xml` during the `specialize` pass after deployment.
* **Encryption:** Disable BitLocker or other full-disk encryption before running Sysprep.

### Example Modern Preparation Workflow (Conceptual)

1.  **Build Reference Machine:** Perform a clean install of Windows 11. Install necessary drivers, applications, and updates. Configure settings as desired. **Do not** join a domain.
2.  **Create `unattend.xml`:** Use WSIM (from Windows ADK) to create an answer file. Configure OOBE, drivers (`DriverPaths` or plan for DISM), product key, local admin account, etc. Save as `C:\unattend.xml` (or similar).
3.  **(Optional) Inject Drivers Offline:** If using DISM, shut down the reference machine, capture a preliminary WIM, mount it, inject drivers using `DISM /Add-Driver`, unmount and commit changes. Then redeploy this updated WIM to the reference machine or proceed with Sysprep on the original machine if only using `DriverPaths`.
4.  **Final Customizations (Audit Mode Recommended):** Boot into Audit Mode (`Ctrl+Shift+F3` at OOBE, or use `sysprep /audit`) for final software installs or configuration that should run as Local System/Admin before sealing.
5.  **Pre-Sysprep Cleanup (Run as Admin):**
    * Run disk cleanup.
    * (Optional) Disconnect network drives: `net use * /delete /y`
    * (Optional) Stop *specific* problematic third-party apps/services: `taskkill /F /IM myapp.exe`, `net stop mythirdpartyservice`
    * (Optional) Flush disk cache: `C:\path\to\sync64.exe -r`
6.  **Execute Sysprep (Run as Admin):**
    * Navigate to Sysprep dir: `cd C:\Windows\System32\Sysprep`
    * Run Sysprep for capture: `.\sysprep.exe /generalize /oobe /shutdown /unattend:C:\unattend.xml`
7.  **Capture Image:** Once the machine shuts down, boot it using Windows PE or another imaging environment and capture the generalized image (e.g., using `DISM /Capture-Image`).
