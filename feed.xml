<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://ib.bsb.br/feed.xml" rel="self" type="application/atom+xml" /><link href="https://ib.bsb.br/" rel="alternate" type="text/html" /><updated>2025-09-17T19:56:16+00:00</updated><id>https://ib.bsb.br/feed.xml</id><title type="html">infoBAG</title><entry><title type="html">coolice reset script</title><link href="https://ib.bsb.br/coolice-reset-script/" rel="alternate" type="text/html" title="coolice reset script" /><published>2025-09-15T00:00:00+00:00</published><updated>2025-09-15T09:34:14+00:00</updated><id>https://ib.bsb.br/coolice-reset-script</id><content type="html" xml:base="https://ib.bsb.br/coolice-reset-script/"><![CDATA[<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="c">#</span>
<span class="c"># Revised: stable logging and safe optional tracing.</span>
<span class="c"># - Key changes vs. previous iteration:</span>
<span class="c">#   * Use a stable log file in BASEDIR (not inside ephemeral WORKDIR) for all persistent logs.</span>
<span class="c">#   * Open a single persistent FD (3) for programmatic logging and (optionally) BASH_XTRACEFD.</span>
<span class="c">#   * Do NOT use DEBUG traps (they are fragile with process substitution); rely on BASH_XTRACEFD when available.</span>
<span class="c">#   * Avoid tee pipelines for log writes; use single FD writes to avoid FD lifecycle races.</span>
<span class="c">#</span>
<span class="nb">set</span> <span class="nt">-Eeuo</span> pipefail
<span class="nb">shopt</span> <span class="nt">-s</span> inherit_errexit 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
</span><span class="nv">IFS</span><span class="o">=</span><span class="s1">$'</span><span class="se">\n\t</span><span class="s1">'</span>

<span class="c"># -----------------------</span>
<span class="c"># Small helpers early (used by arg parsing/sanity checks)</span>
<span class="c"># -----------------------</span>
timestamp<span class="o">()</span> <span class="o">{</span> <span class="nb">date</span> +<span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="p">;</span> <span class="o">}</span>

abs<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">p</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> <span class="nb">realpath</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">realpath</span> <span class="nt">-m</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span>
  <span class="k">elif </span><span class="nb">command</span> <span class="nt">-v</span> <span class="nb">readlink</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">readlink</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span>
  <span class="k">else</span>
    <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s1">'%s/%s\n'</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">pwd</span> <span class="nt">-P</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span><span class="o">)</span> <span class="o">||</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span>
  <span class="k">fi</span>
<span class="o">}</span>

is_special<span class="o">()</span> <span class="o">{</span> <span class="o">[</span> <span class="nt">-S</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-b</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="o">}</span>

<span class="c"># -----------------------</span>
<span class="c"># Configuration defaults</span>
<span class="c"># -----------------------</span>
<span class="nv">DEFAULT_BASEDIR</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HOME</span><span class="k">:-</span><span class="p">/home/ibbsbbry</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">BASEDIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DEFAULT_BASEDIR</span><span class="s2">"</span>
<span class="nv">APPLY</span><span class="o">=</span>0
<span class="nv">USE_ZIP</span><span class="o">=</span>0
<span class="nv">DEBUG</span><span class="o">=</span>0
<span class="nv">TRACE</span><span class="o">=</span>0
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d_%H%M%S<span class="si">)</span><span class="s2">"</span>
<span class="nv">MIN_FREE_KB</span><span class="o">=</span>102400

<span class="c"># -----------------------</span>
<span class="c"># Tool detection (FIX for latent bug)</span>
<span class="c"># -----------------------</span>
<span class="nv">TAR_GNU</span><span class="o">=</span>0
<span class="k">if </span><span class="nb">tar</span> <span class="nt">--version</span> 2&gt;/dev/null | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s1">'GNU tar'</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">TAR_GNU</span><span class="o">=</span>1
<span class="k">fi
</span><span class="nv">HAS_ZIP</span><span class="o">=</span>0
<span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> zip <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
  </span><span class="nv">HAS_ZIP</span><span class="o">=</span>1
<span class="k">fi</span>

<span class="c"># -----------------------</span>
<span class="c"># Lightweight logging helpers (they write to FD 3 when available)</span>
<span class="c"># -----------------------</span>
_log_to_fd3<span class="o">()</span> <span class="o">{</span>
  <span class="c"># write a single line to FD3 if it's open; fall back to stdout/stderr</span>
  <span class="nb">local ln</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="k">if</span> <span class="o">{</span> <span class="nb">true</span> <span class="o">&gt;</span>&amp;3<span class="p">;</span> <span class="o">}</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">then
    </span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$ln</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;3 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
  </span><span class="k">else
    </span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$ln</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
  </span><span class="k">fi</span>
<span class="o">}</span>

log<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">msg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">local </span>line
  <span class="nv">line</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'[%s] INFO: %s'</span> <span class="s2">"</span><span class="si">$(</span>timestamp<span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$msg</span><span class="s2">"</span><span class="si">)</span>
  _log_to_fd3 <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
<span class="o">}</span>
warn<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">msg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">local </span>line
  <span class="nv">line</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'[%s] WARN: %s'</span> <span class="s2">"</span><span class="si">$(</span>timestamp<span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$msg</span><span class="s2">"</span><span class="si">)</span>
  _log_to_fd3 <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="o">}</span>
err<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">msg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">local </span>line
  <span class="nv">line</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'[%s] ERROR: %s'</span> <span class="s2">"</span><span class="si">$(</span>timestamp<span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$msg</span><span class="s2">"</span><span class="si">)</span>
  _log_to_fd3 <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="o">}</span>
dbg<span class="o">()</span> <span class="o">{</span>
  <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DEBUG</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-ne</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="k">return </span>0
  <span class="nb">local </span><span class="nv">msg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">local </span>line
  <span class="nv">line</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'[%s] DEBUG: %s'</span> <span class="s2">"</span><span class="si">$(</span>timestamp<span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$msg</span><span class="s2">"</span><span class="si">)</span>
  _log_to_fd3 <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
<span class="o">}</span>
trace_log<span class="o">()</span> <span class="o">{</span>
  <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TRACE</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-ne</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="k">return </span>0
  <span class="nb">local </span><span class="nv">msg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">local </span>line
  <span class="nv">line</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'[%s] TRACE: %s'</span> <span class="s2">"</span><span class="si">$(</span>timestamp<span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$msg</span><span class="s2">"</span><span class="si">)</span>
  _log_to_fd3 <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Capture minimal last/current command for error context</span>
<span class="nv">CURRENT_COMMAND</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">LAST_COMMAND</span><span class="o">=</span><span class="s2">""</span>

<span class="c"># -----------------------</span>
<span class="c"># Argument parsing</span>
<span class="c"># -----------------------</span>
usage<span class="o">()</span> <span class="o">{</span>
  <span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">USAGE</span><span class="sh">
Usage: trim_and_fixperms.sh [options]
Default: DRY-RUN (no destructive actions).

Options:
  -y, --apply        Execute archive + remove + permissions (destructive)
      --zip          Prefer ZIP archive (requires 'zip')
      --base DIR     Base directory (default: </span><span class="se">\$</span><span class="sh">HOME)
      --debug        Enable verbose debug logging (paths &amp; outcomes)
      --trace        Enable command tracing (command-level trace; requires bash &gt;= 4.1)
  -h, --help         Show this help
</span><span class="no">USAGE
</span><span class="o">}</span>

<span class="k">while</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">do
  case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in</span>
    <span class="nt">-y</span><span class="p">|</span><span class="nt">--apply</span><span class="p">)</span> <span class="nv">APPLY</span><span class="o">=</span>1<span class="p">;</span> <span class="nb">shift</span> <span class="p">;;</span>
    <span class="nt">--zip</span><span class="p">)</span> <span class="nv">USE_ZIP</span><span class="o">=</span>1<span class="p">;</span> <span class="nb">shift</span> <span class="p">;;</span>
    <span class="nt">--base</span><span class="p">)</span>
      <span class="nb">shift
      </span><span class="nv">BASEDIR</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$BASEDIR</span><span class="k">}</span><span class="s2">"</span>
      <span class="nb">shift</span>
      <span class="p">;;</span>
    <span class="nt">--debug</span><span class="p">)</span> <span class="nv">DEBUG</span><span class="o">=</span>1<span class="p">;</span> <span class="nb">shift</span> <span class="p">;;</span>
    <span class="nt">--trace</span><span class="p">)</span> <span class="nv">TRACE</span><span class="o">=</span>1<span class="p">;</span> <span class="nb">shift</span> <span class="p">;;</span>
    <span class="nt">-h</span><span class="p">|</span><span class="nt">--help</span><span class="p">)</span> usage<span class="p">;</span> <span class="nb">exit </span>0 <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span> <span class="nb">echo</span> <span class="s2">"Unknown option: </span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> usage<span class="p">;</span> <span class="nb">exit </span>1 <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>

<span class="c"># -----------------------</span>
<span class="c"># Resolve BASEDIR and do early safety checks (we create persistent log in BASEDIR)</span>
<span class="c"># -----------------------</span>
<span class="nv">BASEDIR</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>abs <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="k">case</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="k">in</span>
  <span class="s2">"/"</span><span class="p">|</span><span class="s2">"/root"</span><span class="p">|</span><span class="s2">"/home"</span><span class="p">)</span> <span class="nb">echo</span> <span class="s2">"Refusing to operate on </span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> <span class="nb">exit </span>1 <span class="p">;;</span>
<span class="k">esac</span>
<span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"Base dir not found: </span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>

<span class="nv">FREE_KB</span><span class="o">=</span><span class="si">$(</span><span class="nb">df</span> <span class="nt">-k</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">awk</span> <span class="s1">'NR==2{print $4}'</span> <span class="o">||</span> <span class="nb">echo </span>0<span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$FREE_KB</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$FREE_KB</span><span class="s2">"</span> <span class="nt">-lt</span> <span class="s2">"</span><span class="nv">$MIN_FREE_KB</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Low free space on filesystem containing </span><span class="nv">$BASEDIR</span><span class="s2"> (</span><span class="nv">$FREE_KB</span><span class="s2"> KB &lt; </span><span class="nv">$MIN_FREE_KB</span><span class="s2"> KB)"</span> <span class="o">&gt;</span>&amp;2
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># -----------------------</span>
<span class="c"># Prepare stable log (outside WORKDIR) and open FD3</span>
<span class="c"># -----------------------</span>
<span class="nv">LOG_STABLE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/trim_and_fixperms_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.log"</span>
: <span class="o">&gt;</span><span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
<span class="c"># Open FD3 for persistent programmatic logging; leave it open until on_exit</span>
<span class="nb">exec </span>3&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c"># If TRACE requested, enable Bash xtrace to FD3 (requires bash &gt;= 4.1)</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TRACE</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
  if</span> <span class="o">((</span>BASH_VERSINFO[0] <span class="o">&gt;</span> 4 <span class="o">||</span> <span class="o">(</span>BASH_VERSINFO[0] <span class="o">==</span> 4 <span class="o">&amp;&amp;</span> BASH_VERSINFO[1] <span class="o">&gt;=</span> 1<span class="o">)))</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">export </span><span class="nv">BASH_XTRACEFD</span><span class="o">=</span>3
    <span class="nv">PS4</span><span class="o">=</span><span class="s1">'+[$(date "+%Y-%m-%d %H:%M:%S")] '</span>
    <span class="nb">set</span> <span class="nt">-x</span>
    trace_log <span class="s2">"Enabled per-command xtrace to </span><span class="nv">$LOG_STABLE</span><span class="s2">"</span>
  <span class="k">else
    </span><span class="nv">TRACE</span><span class="o">=</span>0
    dbg <span class="s2">"TRACE disabled: bash too old to safely redirect xtrace (requires bash &gt;= 4.1)"</span>
  <span class="k">fi
fi

</span>log <span class="s2">"Script started: </span><span class="nv">$0</span><span class="s2"> (TIMESTAMP=</span><span class="nv">$TIMESTAMP</span><span class="s2">) LOG=</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span>

<span class="c"># -----------------------</span>
<span class="c"># Prepare WORKDIR (ephemeral)</span>
<span class="c"># -----------------------</span>
<span class="nv">WORKDIR</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMPDIR</span><span class="k">:-</span><span class="p">/tmp</span><span class="k">}</span><span class="s2">/trimwork.</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.XXXXXX"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span><span class="si">)</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORKDIR</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-w</span> <span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">WORKDIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/.trimwork_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="o">{</span> err <span class="s2">"Cannot create workdir: </span><span class="nv">$WORKDIR</span><span class="s2">"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>
  <span class="nb">chmod </span>700 <span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
</span><span class="k">fi</span>

<span class="c"># local copies of path variables inside workdir if needed</span>
<span class="nv">DOMAINS_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">/domains_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.lst"</span>
<span class="nv">CAND_ABS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">/candidates_abs_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.nul"</span>
<span class="nv">CAND_REL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">/candidates_rel_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.nul"</span>

: <span class="o">&gt;</span><span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
: <span class="o">&gt;</span><span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span>
: <span class="o">&gt;</span><span class="s2">"</span><span class="nv">$CAND_REL</span><span class="s2">"</span>

dbg <span class="s2">"WORKDIR=</span><span class="nv">$WORKDIR</span><span class="s2">"</span>

<span class="c"># -----------------------</span>
<span class="c"># Error handler uses stable log (LOG_STABLE). Keep WORKDIR until on_exit.</span>
<span class="c"># -----------------------</span>
on_error<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">rc</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$?</span><span class="k">}</span>
  <span class="nv">LAST_COMMAND</span><span class="o">=</span><span class="k">${</span><span class="nv">LAST_COMMAND</span><span class="k">:-</span><span class="s1">'&lt;none&gt;'</span><span class="k">}</span>
  <span class="nv">CURRENT_COMMAND</span><span class="o">=</span><span class="k">${</span><span class="nv">CURRENT_COMMAND</span><span class="k">:-</span><span class="s2">"</span><span class="nv">$BASH_COMMAND</span><span class="s2">"</span><span class="k">}</span>
  err <span class="s2">"Script failed (exit code </span><span class="k">${</span><span class="nv">rc</span><span class="k">}</span><span class="s2">)."</span>
  err <span class="s2">"Last command: </span><span class="k">${</span><span class="nv">LAST_COMMAND</span><span class="k">}</span><span class="s2">"</span>
  err <span class="s2">"Current command: </span><span class="k">${</span><span class="nv">CURRENT_COMMAND</span><span class="k">}</span><span class="s2">"</span>
  err <span class="s2">"Location: PWD=</span><span class="si">$(</span><span class="nb">pwd </span>2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'&lt;pwd?&gt;'</span><span class="si">)</span><span class="s2"> USER=</span><span class="k">${</span><span class="nv">USER</span><span class="k">:-}</span><span class="s2">"</span>
  err <span class="s2">"Preserved WORKDIR for inspection: </span><span class="k">${</span><span class="nv">WORKDIR</span><span class="k">:-</span><span class="p">&lt;none&gt;</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">KEEP_WORKDIR_ON_EXIT</span><span class="o">=</span>1
  <span class="c"># Ensure stable log has been copied/available; it's already in BASEDIR so no-op most times.</span>
  <span class="nb">cp</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/trim_and_fixperms_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.log.FAILED"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
  </span>err <span class="s2">"Copied runtime log (best-effort) to </span><span class="nv">$BASEDIR</span><span class="s2">/trim_and_fixperms_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.log.FAILED"</span>
  <span class="c"># Close FD3 only at the end via on_exit; exit now</span>
  <span class="nb">exit</span> <span class="s2">"</span><span class="nv">$rc</span><span class="s2">"</span>
<span class="o">}</span>
<span class="nb">trap</span> <span class="s1">'on_error $?'</span> ERR

on_exit<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">rc</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$?</span><span class="k">}</span>
  <span class="c"># flush/close FD3 last (best-effort)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORKDIR</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$rc</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">cp</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/trim_and_fixperms_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.log"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
    </span>dbg <span class="s2">"Final log left at </span><span class="nv">$LOG_STABLE</span><span class="s2">"</span>
  <span class="k">fi
  if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">KEEP_WORKDIR_ON_EXIT</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>dbg <span class="s2">"Preserving WORKDIR for inspection: </span><span class="k">${</span><span class="nv">WORKDIR</span><span class="k">:-</span><span class="p">&lt;none&gt;</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">else
    if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORKDIR</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
      </span>dbg <span class="s2">"Removed WORKDIR: </span><span class="nv">$WORKDIR</span><span class="s2">"</span>
    <span class="k">fi
  fi</span>
  <span class="c"># close FD3</span>
  <span class="nb">exec </span>3&gt;&amp;- 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
<span class="o">}</span>
<span class="nb">trap</span> <span class="s1">'on_exit $?'</span> EXIT

<span class="c"># -----------------------</span>
<span class="c"># Portable functions used below</span>
<span class="c"># -----------------------</span>
path_size<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">p</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">printf</span> <span class="s1">'0\n'</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="o">}</span>
  <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> <span class="nb">stat</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    if </span><span class="nb">stat</span> <span class="nt">--version</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
      </span><span class="nb">stat</span> <span class="nt">-c</span>%s <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">du</span> <span class="nt">-sb</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> <span class="o">||</span> <span class="nb">echo </span>0
    <span class="k">else
      </span><span class="nb">stat</span> <span class="nt">-f</span>%z <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">du</span> <span class="nt">-sk</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">awk</span> <span class="s1">'{print $1*1024}'</span> <span class="o">||</span> <span class="nb">echo </span>0
    <span class="k">fi
  else
    </span><span class="nb">du</span> <span class="nt">-sb</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> <span class="o">||</span> <span class="nb">du</span> <span class="nt">-sk</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">awk</span> <span class="s1">'{print $1*1024}'</span> <span class="o">||</span> <span class="nb">echo </span>0
  <span class="k">fi</span>
<span class="o">}</span>

human<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">n</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> <span class="nb">numfmt</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">numfmt</span> <span class="nt">--to</span><span class="o">=</span>iec <span class="nt">--suffix</span><span class="o">=</span>B <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">printf</span> <span class="s1">'%sB'</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span>
  <span class="k">else
    </span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">b</span><span class="o">=</span><span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> <span class="s1">'BEGIN{function hr(x){s="B K M G";i=1;while(x&gt;=1024&amp;&amp;i&lt;4){x/=1024;i++}printf 
"%.1f%s",x,substr(s,i*2-1,1)};hr(b)}'</span>
  <span class="k">fi</span>
<span class="o">}</span>

safe_move<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">src</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="nv">dst</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
  dbg <span class="s2">"safe_move: '</span><span class="nv">$src</span><span class="s2">' -&gt; '</span><span class="nv">$dst</span><span class="s2">'"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">APPLY</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
    if </span><span class="nb">mv</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$src</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dst</span><span class="s2">"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
      </span>dbg <span class="s2">"mv succeeded: </span><span class="nv">$src</span><span class="s2"> -&gt; </span><span class="nv">$dst</span><span class="s2">"</span>
      <span class="k">return </span>0
    <span class="k">fi
    </span>dbg <span class="s2">"mv failed, attempting cp -a + rm -rf for </span><span class="nv">$src</span><span class="s2">"</span>
    <span class="k">if </span><span class="nb">cp</span> <span class="nt">-a</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$src</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dst</span><span class="s2">"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$src</span><span class="s2">"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="o">{</span> err <span class="s2">"rm after cp failed for </span><span class="nv">$src</span><span class="s2">"</span><span class="p">;</span> <span class="k">return </span>1<span class="p">;</span> <span class="o">}</span>
      dbg <span class="s2">"cp+rm succeeded for </span><span class="nv">$src</span><span class="s2">"</span>
      <span class="k">return </span>0
    <span class="k">fi
    </span>err <span class="s2">"safe_move failed for </span><span class="nv">$src</span><span class="s2"> -&gt; </span><span class="nv">$dst</span><span class="s2">"</span>
    <span class="k">return </span>1
  <span class="k">else
    </span>dbg <span class="s2">"DRY-RUN safe_move: </span><span class="nv">$src</span><span class="s2"> -&gt; </span><span class="nv">$dst</span><span class="s2">"</span>
    <span class="k">return </span>0
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># -----------------------</span>
<span class="c"># Discover domain roots</span>
<span class="c"># -----------------------</span>
log <span class="s2">"Discovering domain roots..."</span>
<span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/public_html"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/domains"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  for </span>d <span class="k">in</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/domains"</span>/<span class="k">*</span><span class="p">;</span> <span class="k">do</span>
    <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$d</span><span class="s2">/public_html"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
  <span class="k">done
fi
for </span>d <span class="k">in</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span>/<span class="k">*</span><span class="p">;</span> <span class="k">do</span>
  <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$d</span><span class="s2">/public_html"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
<span class="k">done
if</span> <span class="o">[</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">LC_ALL</span><span class="o">=</span>C <span class="nb">sort</span> <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
<span class="k">fi
</span><span class="nv">DOM_COUNT</span><span class="o">=</span><span class="si">$(</span><span class="nb">wc</span> <span class="nt">-l</span> &lt; <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo </span>0<span class="si">)</span>
log <span class="s2">"Detected </span><span class="nv">$DOM_COUNT</span><span class="s2"> domain roots"</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$DOM_COUNT</span><span class="s2">"</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">sed</span> <span class="s1">'s/^/  /'</span> <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
</span><span class="k">fi</span>

<span class="c"># -----------------------</span>
<span class="c"># Candidate collection helpers</span>
<span class="c"># -----------------------</span>
<span class="nv">SCRIPT_PATH</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>abs <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">SCRIPT_IN_BASE</span><span class="o">=</span>0
<span class="k">case</span> <span class="s2">"</span><span class="nv">$SCRIPT_PATH</span><span class="s2">"</span> <span class="k">in</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span><span class="p">|</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span>/<span class="k">*</span><span class="p">)</span> <span class="nv">SCRIPT_IN_BASE</span><span class="o">=</span>1 <span class="p">;;</span> <span class="k">esac</span>

append_abs<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">p</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-}</span><span class="s2">"</span>
  <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="k">return </span>0
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SCRIPT_IN_BASE</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$SCRIPT_PATH</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>dbg <span class="s2">"Skipping script itself: </span><span class="nv">$p</span><span class="s2">"</span>
    <span class="k">return </span>0
  <span class="k">fi
  case</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="k">in</span> <span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">"</span>/<span class="k">*</span><span class="p">)</span> dbg <span class="s2">"Skipping workdir path: </span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span> <span class="k">return </span>0 <span class="p">;;</span> <span class="k">esac</span>
  <span class="k">if </span>is_special <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
    </span>dbg <span class="s2">"Skipping special file: </span><span class="nv">$p</span><span class="s2">"</span>
    <span class="k">return </span>0
  <span class="k">fi
  </span><span class="nb">printf</span> <span class="s1">'%s\0'</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span>
  dbg <span class="s2">"Appended candidate: </span><span class="nv">$p</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># -----------------------</span>
<span class="c"># Collect candidates</span>
<span class="c"># -----------------------</span>
log <span class="s2">"Collecting candidate files..."</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$DOM_COUNT</span><span class="s2">"</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> D<span class="p">;</span> <span class="k">do
    </span><span class="nv">D</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>abs <span class="s2">"</span><span class="nv">$D</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
    dbg <span class="s2">"Processing domain root: </span><span class="nv">$D</span><span class="s2">"</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_html"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/cgi-bin"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/logs"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/stats"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/awstats/.data"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_ftp/incoming"</span> 
2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true</span>

    <span class="c"># Find all items (files, links, directories) at the top level of the domain root.</span>
    find <span class="s2">"</span><span class="nv">$D</span><span class="s2">"</span> <span class="nt">-mindepth</span> 1 <span class="nt">-maxdepth</span> 1 <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> item<span class="p">;</span> <span class="k">do
      </span><span class="nv">base_item</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$item</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
      <span class="c"># Exclude standard directories that are handled by later, specific loops.</span>
      <span class="k">case</span> <span class="s2">"</span><span class="nv">$base_item</span><span class="s2">"</span> <span class="k">in
        </span>public_html|cgi-bin|logs|stats|awstats|public_ftp|.htpasswd<span class="p">)</span>
          dbg <span class="s2">"Skipping standard path in main loop: </span><span class="nv">$item</span><span class="s2">"</span>
          <span class="k">continue</span>
          <span class="p">;;</span>
      <span class="k">esac</span>

      <span class="c"># If the item is a file or symlink at the domain root, add it as a candidate.</span>
      <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$item</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-L</span> <span class="s2">"</span><span class="nv">$item</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>append_abs <span class="s2">"</span><span class="nv">$item</span><span class="s2">"</span>
      <span class="c"># If the item is a directory not in our exclusion list (e.g., 'data'),</span>
      <span class="c"># recursively find and add all files within it.</span>
      <span class="k">elif</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$item</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>dbg <span class="s2">"Scanning non-standard directory for files: </span><span class="nv">$item</span><span class="s2">"</span>
        find <span class="s2">"</span><span class="nv">$item</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do
          </span>append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span>
        <span class="k">done
      fi
    done</span>

    <span class="c"># Now, process the standard directories with their specific rules.</span>
    <span class="nv">PH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_html"</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$PH</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$PH</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do
        </span><span class="nv">base</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
        <span class="k">case</span> <span class="s2">"</span><span class="nv">$base</span><span class="s2">"</span> <span class="k">in </span>index.html|index.htm|index.php<span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
        <span class="k">case</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="k">in</span> <span class="s2">"</span><span class="nv">$PH</span><span class="s2">/.well-known"</span><span class="p">|</span><span class="s2">"</span><span class="k">${</span><span class="nv">PH</span><span class="k">}</span><span class="s2">/.well-known/"</span><span class="k">*</span><span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
        append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span>
      <span class="k">done
    fi

    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/logs"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/logs"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do </span>append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="p">;</span> <span class="k">done
    fi
    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/stats"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/stats"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do </span>append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="p">;</span> <span class="k">done
    fi

    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/awstats"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/awstats"</span> <span class="nt">-mindepth</span> 1 <span class="nt">-maxdepth</span> 1 <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do
        </span><span class="nv">bn</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
        <span class="k">case</span> <span class="s2">"</span><span class="nv">$bn</span><span class="s2">"</span> <span class="k">in</span> .data|awstats.pl<span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
        <span class="k">case</span> <span class="s2">"</span><span class="nv">$bn</span><span class="s2">"</span> <span class="k">in </span>awstats<span class="k">*</span>.conf<span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
        append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span>
      <span class="k">done
    fi

    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_ftp"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_ftp"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do
        case</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="k">in</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_ftp/incoming"</span><span class="p">|</span><span class="s2">"</span><span class="k">${</span><span class="nv">D</span><span class="k">}</span><span class="s2">/public_ftp/incoming/"</span><span class="k">*</span><span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
        append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span>
      <span class="k">done
    fi
  done</span> &lt; <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># Top-level under BASEDIR</span>
find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-mindepth</span> 1 <span class="nt">-maxdepth</span> 1 <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> top<span class="p">;</span> <span class="k">do</span>
  <span class="o">[</span> <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="k">continue
  case</span> <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="k">in</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/.ssh"</span><span class="p">|</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/public_html"</span><span class="p">|</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/domains"</span><span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
  <span class="nv">skip</span><span class="o">=</span>0
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$DOM_COUNT</span><span class="s2">"</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> D<span class="p">;</span> <span class="k">do</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nv">skip</span><span class="o">=</span>1<span class="p">;</span> <span class="nb">break</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span> <span class="k">done</span> &lt; <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
  <span class="k">fi</span>
  <span class="o">[</span> <span class="s2">"</span><span class="nv">$skip</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">continue
  if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-L</span> <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span>append_abs <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>find <span class="s2">"</span><span class="nv">$top</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do </span>append_abs <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="p">;</span> <span class="k">done
  fi
done</span>

<span class="c"># If no candidates, exit gracefully</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span>log <span class="s2">"No candidates found; nothing to do."</span>
  <span class="nb">exit </span>0
<span class="k">fi</span>

<span class="c"># -----------------------</span>
<span class="c"># Build relative list and compute totals</span>
<span class="c"># -----------------------</span>
: <span class="o">&gt;</span><span class="s2">"</span><span class="nv">$CAND_REL</span><span class="s2">"</span>
<span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> abs<span class="p">;</span> <span class="k">do
  case</span> <span class="s2">"</span><span class="nv">$abs</span><span class="s2">"</span> <span class="k">in</span>
    <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span><span class="p">)</span> <span class="nv">rel</span><span class="o">=</span><span class="s1">'.'</span> <span class="p">;;</span>
    <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span>/<span class="k">*</span><span class="p">)</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">abs</span><span class="p">#</span><span class="nv">$BASEDIR</span><span class="p">/</span><span class="k">}</span><span class="s2">"</span> <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"</span><span class="nv">$abs</span><span class="s2">"</span> <span class="p">;;</span>
  <span class="k">esac</span>
  <span class="nb">printf</span> <span class="s1">'%s\0'</span> <span class="s2">"</span><span class="nv">$rel</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$CAND_REL</span><span class="s2">"</span>
<span class="k">done</span> &lt;<span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span>

<span class="nv">CAND_COUNT</span><span class="o">=</span><span class="si">$(</span><span class="nb">tr</span> <span class="nt">-cd</span> <span class="s1">'\0'</span> &lt;<span class="s2">"</span><span class="nv">$CAND_REL</span><span class="s2">"</span> | <span class="nb">wc</span> <span class="nt">-c</span> <span class="o">||</span> <span class="nb">echo </span>0<span class="si">)</span>
<span class="nv">TOTAL_BYTES</span><span class="o">=</span>0
<span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> p<span class="p">;</span> <span class="k">do
  if</span> <span class="o">[</span> <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">bytes</span><span class="o">=</span><span class="si">$(</span>path_size <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo </span>0<span class="si">)</span>
    <span class="k">case</span> <span class="s2">"</span><span class="nv">$bytes</span><span class="s2">"</span> <span class="k">in</span> <span class="s1">''</span><span class="p">|</span><span class="k">*</span><span class="o">[!</span>0-9]<span class="k">*</span><span class="p">)</span> <span class="nv">bytes</span><span class="o">=</span>0 <span class="p">;;</span> <span class="k">esac</span>
    <span class="nv">TOTAL_BYTES</span><span class="o">=</span><span class="k">$((</span>TOTAL_BYTES <span class="o">+</span> bytes<span class="k">))</span>
  <span class="k">fi
done</span> &lt;<span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span>
log <span class="s2">"Candidates: </span><span class="nv">$CAND_COUNT</span><span class="s2"> (~</span><span class="si">$(</span>human <span class="s2">"</span><span class="nv">$TOTAL_BYTES</span><span class="s2">"</span><span class="si">)</span><span class="s2">)"</span>
log <span class="s2">"Sample (first 20):"</span>
<span class="nv">i</span><span class="o">=</span>0
<span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> p <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$i</span> <span class="nt">-lt</span> 20 <span class="o">]</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">printf</span> <span class="s1">'  %s\n'</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">&gt;&gt;</span><span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
  </span><span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span>
<span class="k">done</span> &lt;<span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span>

<span class="c"># Dry-run: report and exit</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$APPLY</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span>log <span class="s2">"DRY-RUN: no changes made. Re-run with --apply to execute."</span>
  <span class="nb">exit </span>0
<span class="k">fi</span>

<span class="c"># Confirm destructive action</span>
<span class="nb">printf</span> <span class="s1">'Type EXACTLY CONFIRM to proceed: '</span>
<span class="nb">read</span> <span class="nt">-r</span> CONFIRM
<span class="o">[</span> <span class="s2">"</span><span class="nv">$CONFIRM</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"CONFIRM"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">{</span> err <span class="s2">"Aborted by user"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>

<span class="c"># -----------------------</span>
<span class="c"># Archiving (same behavior)</span>
<span class="c"># -----------------------</span>
<span class="nv">ARCHIVE_TGZ</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/min_trim_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.tar.gz"</span>
<span class="nv">ARCHIVE_ZIP</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/min_trim_</span><span class="k">${</span><span class="nv">TIMESTAMP</span><span class="k">}</span><span class="s2">.zip"</span>
log <span class="s2">"Archiving to: </span><span class="nv">$ARCHIVE_TGZ</span><span class="s2"> (tar) or </span><span class="nv">$ARCHIVE_ZIP</span><span class="s2"> (zip)"</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$TAR_GNU</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span>log <span class="s2">"Using GNU tar with --remove-files"</span>
  <span class="nb">set</span> +e
  <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">--null</span> <span class="nt">--ignore-failed-read</span> <span class="nt">-czf</span> <span class="s2">"</span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span> <span class="nt">--remove-files</span> <span class="nt">-T</span> <span class="s2">"</span><span class="nv">$CAND_REL</span><span class="s2">"</span><span class="o">)</span> 
2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span>
  <span class="nv">TAR_RC</span><span class="o">=</span><span class="nv">$?</span>
  <span class="nb">set</span> <span class="nt">-e</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$TAR_RC</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>warn <span class="s2">"tar returned </span><span class="nv">$TAR_RC</span><span class="s2">; some files may not have been archived/removed."</span>
  <span class="k">fi
  if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">tar</span> <span class="nt">-tzf</span> <span class="s2">"</span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> warn <span class="s2">"Archive verification failed: </span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span>
  <span class="k">else
    </span>err <span class="s2">"Archive was not created: </span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span>
  <span class="k">fi
else
  </span><span class="nv">STAGE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$WORKDIR</span><span class="s2">/stage"</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$STAGE</span><span class="s2">"</span>
  log <span class="s2">"Staging files to </span><span class="nv">$STAGE</span><span class="s2">"</span>
  <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> rel<span class="p">;</span> <span class="k">do
    </span><span class="nv">src</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/</span><span class="nv">$rel</span><span class="s2">"</span>
    <span class="nv">dst</span><span class="o">=</span><span class="s2">"</span><span class="nv">$STAGE</span><span class="s2">/</span><span class="nv">$rel</span><span class="s2">"</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$dst</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
    </span><span class="k">if</span> <span class="o">[</span> <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$src</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      if</span> <span class="o">!</span> safe_move <span class="s2">"</span><span class="nv">$src</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dst</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
        </span>err <span class="s2">"Failed to stage </span><span class="nv">$src</span><span class="s2">"</span>
      <span class="k">fi
    fi
  done</span> &lt;<span class="s2">"</span><span class="nv">$CAND_REL</span><span class="s2">"</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$USE_ZIP</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$HAS_ZIP</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$STAGE</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> zip <span class="nt">-r</span> <span class="nt">-q</span> <span class="s2">"</span><span class="nv">$ARCHIVE_ZIP</span><span class="s2">"</span> .<span class="o">)</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> warn <span class="s2">"zip failed"</span>
    <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$ARCHIVE_ZIP</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> unzip <span class="nt">-t</span> <span class="s2">"</span><span class="nv">$ARCHIVE_ZIP</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> warn <span class="s2">"ZIP verification failed"</span>
  <span class="k">else</span>
    <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$STAGE</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-czf</span> <span class="s2">"</span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span> .<span class="o">)</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> warn <span class="s2">"tar failed"</span>
    <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-tzf</span> <span class="s2">"</span><span class="nv">$ARCHIVE_TGZ</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> warn <span class="s2">"tar.gz verification failed"</span>
  <span class="k">fi
  </span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$STAGE</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># Residual cleanup</span>
log <span class="s2">"Residual cleanup..."</span>
<span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> p<span class="p">;</span> <span class="k">do
  if</span> <span class="o">[</span> <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>dbg <span class="s2">"Removing residual: </span><span class="nv">$p</span><span class="s2">"</span>
    <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> warn <span class="s2">"Failed to remove residual: </span><span class="nv">$p</span><span class="s2">"</span>
  <span class="k">fi
done</span> &lt;<span class="s2">"</span><span class="nv">$CAND_ABS</span><span class="s2">"</span>

find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-depth</span> <span class="nt">-type</span> d <span class="nt">-empty</span> <span class="nt">-delete</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true</span>

<span class="c"># -----------------------</span>
<span class="c"># Recreate skeletons</span>
<span class="c"># -----------------------</span>
log <span class="s2">"Recreating skeletons..."</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> D<span class="p">;</span> <span class="k">do
    </span><span class="nv">D</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>abs <span class="s2">"</span><span class="nv">$D</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
    dbg <span class="s2">"Recreating for domain: </span><span class="nv">$D</span><span class="s2">"</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_html"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/cgi-bin"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/logs"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/stats"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/awstats/.data"</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_ftp/incoming"</span> 
2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
    </span><span class="nv">PH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$D</span><span class="s2">/public_html"</span>
    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$PH</span><span class="s2">/index.html"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$PH</span><span class="s2">/index.php"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">cat</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$PH</span><span class="s2">/index.html"</span> <span class="o">&lt;&lt;</span><span class="sh">'</span><span class="no">HTML</span><span class="sh">'
&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;title&gt;Placeholder&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;Placeholder&lt;/h1&gt;&lt;p&gt;Minimal skeleton active. Upload your site to public_html.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</span><span class="no">HTML
</span>      <span class="nb">chmod </span>644 <span class="s2">"</span><span class="nv">$PH</span><span class="s2">/index.html"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
    </span><span class="k">fi

    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/logs"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/logs"</span> <span class="nt">-mindepth</span> 1 <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
    </span><span class="k">fi
    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/stats"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/stats"</span> <span class="nt">-mindepth</span> 1 <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
    </span><span class="k">fi
    if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">/awstats"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span>find <span class="s2">"</span><span class="nv">$D</span><span class="s2">/awstats"</span> <span class="nt">-mindepth</span> 1 <span class="nt">-maxdepth</span> 1 <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> f<span class="p">;</span> <span class="k">do
        </span><span class="nv">bn</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
        <span class="k">case</span> <span class="s2">"</span><span class="nv">$bn</span><span class="s2">"</span> <span class="k">in</span> .data|awstats.pl|awstats<span class="k">*</span>.conf<span class="p">)</span> <span class="k">continue</span> <span class="p">;;</span> <span class="k">esac</span>
        <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
      </span><span class="k">done
    fi
  done</span> &lt;<span class="s2">"</span><span class="nv">$DOMAINS_FILE</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># -----------------------</span>
<span class="c"># Apply permissions</span>
<span class="c"># -----------------------</span>
log <span class="s2">"Applying permissions..."</span>
find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> d <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0755 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0644 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> d <span class="nt">-name</span> <span class="s2">"cgi-bin"</span> <span class="nt">-print0</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> | <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> d<span class="p">;</span> <span class="k">do
  </span>find <span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0755 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span><span class="k">done
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-name</span> <span class="s2">"awstats.pl"</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0755 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> d <span class="nt">-path</span> <span class="s2">"*/public_ftp"</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0711 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> d <span class="nt">-path</span> <span class="s2">"*/public_ftp/incoming"</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0733 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> 
<span class="nb">true
</span><span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/.ssh"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">chmod </span>700 <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/.ssh"</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
  </span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">/.ssh"</span> <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0600 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span><span class="k">fi
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="se">\(</span> <span class="nt">-name</span> <span class="s2">".htaccess"</span> <span class="nt">-o</span> <span class="nt">-name</span> <span class="s2">".htpasswd"</span> <span class="se">\)</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod </span>0644 <span class="nt">--</span> 
2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="se">\(</span> <span class="nt">-iname</span> <span class="s2">"wp-config.php"</span> <span class="nt">-o</span> <span class="nt">-iname</span> <span class="s2">"config.php"</span> <span class="nt">-o</span> <span class="nt">-iname</span> <span class="s2">".env"</span> <span class="se">\)</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> 
<span class="nt">-r</span> <span class="nb">chmod </span>0640 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
</span>find <span class="s2">"</span><span class="nv">$BASEDIR</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="se">\(</span> <span class="nt">-iname</span> <span class="s2">"*token*"</span> <span class="nt">-o</span> <span class="nt">-iname</span> <span class="s2">"*secret*"</span> <span class="nt">-o</span> <span class="nt">-name</span> <span class="s2">"id_*"</span> <span class="se">\)</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-r</span> <span class="nb">chmod 
</span>0600 <span class="nt">--</span> 2&gt;&gt;<span class="s2">"</span><span class="nv">$LOG_STABLE</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true</span>

<span class="c"># -----------------------</span>
<span class="c"># Finalization</span>
<span class="c"># -----------------------</span>
log <span class="s2">"Completed successfully."</span>
<span class="nb">exit </span>0
</code></pre></div></div>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">coolice writable tree</title><link href="https://ib.bsb.br/coolice-writable-tree/" rel="alternate" type="text/html" title="coolice writable tree" /><published>2025-09-14T00:00:00+00:00</published><updated>2025-09-15T11:00:13+00:00</updated><id>https://ib.bsb.br/coolice-writable-tree</id><content type="html" xml:base="https://ib.bsb.br/coolice-writable-tree/"><![CDATA[<section class="code-block-container" role="group" aria-label=" Code Block" data-filename="_code_block.txt" data-code="find /home/ibbsbbry -type f -writable -print -o -type d -writable -executable -print | curl -fsS -F &#39;file=@-;filename=ibbsbbry-writable.txt&#39; https://x0.at/" data-download-link="" data-download-label="Download ">
  <code class="language-">find /home/ibbsbbry -type f -writable -print -o -type d -writable -executable -print | curl -fsS -F &#39;file=@-;filename=ibbsbbry-writable.txt&#39; https://x0.at/</code>
</section>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/ibbsbbry
/home/ibbsbbry/.redis
/home/ibbsbbry/.cagefs
/home/ibbsbbry/.cagefs/var
/home/ibbsbbry/.cagefs/var/run
/home/ibbsbbry/.cagefs/var/run/cagefs
/home/ibbsbbry/.cagefs/var/run/cagefs/utmp
/home/ibbsbbry/.cagefs/opt
/home/ibbsbbry/.cagefs/opt/alt
/home/ibbsbbry/.cagefs/opt/alt/php53
/home/ibbsbbry/.cagefs/opt/alt/php53/link
/home/ibbsbbry/.cagefs/opt/alt/php73
/home/ibbsbbry/.cagefs/opt/alt/php73/link
/home/ibbsbbry/.cagefs/opt/alt/php83
/home/ibbsbbry/.cagefs/opt/alt/php83/link
/home/ibbsbbry/.cagefs/opt/alt/php44
/home/ibbsbbry/.cagefs/opt/alt/php44/link
/home/ibbsbbry/.cagefs/opt/alt/php51
/home/ibbsbbry/.cagefs/opt/alt/php51/link
/home/ibbsbbry/.cagefs/opt/alt/php55
/home/ibbsbbry/.cagefs/opt/alt/php55/link
/home/ibbsbbry/.cagefs/opt/alt/php70
/home/ibbsbbry/.cagefs/opt/alt/php70/link
/home/ibbsbbry/.cagefs/opt/alt/php54
/home/ibbsbbry/.cagefs/opt/alt/php54/link
/home/ibbsbbry/.cagefs/opt/alt/php56
/home/ibbsbbry/.cagefs/opt/alt/php56/link
/home/ibbsbbry/.cagefs/opt/alt/php74
/home/ibbsbbry/.cagefs/opt/alt/php74/link
/home/ibbsbbry/.cagefs/opt/alt/php80
/home/ibbsbbry/.cagefs/opt/alt/php80/link
/home/ibbsbbry/.cagefs/opt/alt/php52
/home/ibbsbbry/.cagefs/opt/alt/php52/link
/home/ibbsbbry/.cagefs/opt/alt/php84
/home/ibbsbbry/.cagefs/opt/alt/php84/link
/home/ibbsbbry/.cagefs/opt/alt/php81
/home/ibbsbbry/.cagefs/opt/alt/php81/link
/home/ibbsbbry/.cagefs/opt/alt/php82
/home/ibbsbbry/.cagefs/opt/alt/php82/link
/home/ibbsbbry/.cagefs/opt/alt/php72
/home/ibbsbbry/.cagefs/opt/alt/php72/link
/home/ibbsbbry/.cagefs/opt/alt/php71
/home/ibbsbbry/.cagefs/opt/alt/php71/link
/home/ibbsbbry/.cagefs/tmp
/home/ibbsbbry/domains
/home/ibbsbbry/domains/memor.ia.br
/home/ibbsbbry/domains/memor.ia.br/awstats
/home/ibbsbbry/domains/memor.ia.br/awstats/.data
/home/ibbsbbry/domains/cut.ia.br
/home/ibbsbbry/domains/cut.ia.br/awstats
/home/ibbsbbry/domains/cut.ia.br/awstats/.data
/home/ibbsbbry/domains/arcreformas.com.br
/home/ibbsbbry/domains/arcreformas.com.br/public_html
/home/ibbsbbry/domains/arcreformas.com.br/public_html/wallabag
/home/ibbsbbry/domains/arcreformas.com.br/public_html/wallabag/web
/home/ibbsbbry/domains/arcreformas.com.br/public_html/wallabag/web/bundles
/home/ibbsbbry/domains/arcreformas.com.br/awstats
/home/ibbsbbry/domains/arcreformas.com.br/awstats/.data
/home/ibbsbbry/virtualenv
/home/ibbsbbry/virtualenv/bin
/home/ibbsbbry/virtualenv/include
/home/ibbsbbry/virtualenv/lib
/home/ibbsbbry/virtualenv/lib/python3.6
/home/ibbsbbry/virtualenv/python_apps
/home/ibbsbbry/virtualenv/python_apps/my_wsgi_test
/home/ibbsbbry/virtualenv/python_apps/my_wsgi_test/3.7
/home/ibbsbbry/virtualenv/python_apps/my_wsgi_test/3.7/bin
/home/ibbsbbry/virtualenv/python_apps/my_asgi_test
/home/ibbsbbry/virtualenv/python_apps/my_asgi_test/3.11
/home/ibbsbbry/virtualenv/python_apps/my_asgi_test/3.11/bin
/home/ibbsbbry/virtualenv/python_apps/my_asgi_test/3.8
/home/ibbsbbry/virtualenv/python_apps/my_asgi_test/3.8/bin
/home/ibbsbbry/trim_and_fixperms.sh
/home/ibbsbbry/.bash_history
/home/ibbsbbry/.local
/home/ibbsbbry/.local/bin
/home/ibbsbbry/.local/share
/home/ibbsbbry/.local/share/pipx
/home/ibbsbbry/.local/share/pipx/venvs
/home/ibbsbbry/.local/share/pipx/venvs/datasette
/home/ibbsbbry/.local/share/pipx/venvs/datasette/bin
/home/ibbsbbry/.local/share/pipx/shared
/home/ibbsbbry/.local/share/pipx/shared/bin
</code></pre></div></div>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">CooliceHost’s Shared Hosting Service</title><link href="https://ib.bsb.br/coolicehost/" rel="alternate" type="text/html" title="CooliceHost’s Shared Hosting Service" /><published>2025-09-14T00:00:00+00:00</published><updated>2025-09-14T16:19:29+00:00</updated><id>https://ib.bsb.br/coolicehost</id><content type="html" xml:base="https://ib.bsb.br/coolicehost/"><![CDATA[<p>Section 1: Introduction to the CooliceHost Technology Stack
This report provides a comprehensive architectural analysis of the shared hosting services offered by the provider CooliceHost. The investigation focuses on a specific technology stack comprising the DirectAdmin control panel, a standalone Nginx web server configuration, and the provision of Secure Shell (SSH) access. The objective is to deconstruct this service by examining not just the technical implementation of each component, but the strategic rationale for their integration. This analysis will demonstrate that this combination of technologies represents a deliberate architectural choice, creating a high-performance ecosystem that stands in stark contrast to more traditional, compatibility-focused shared hosting environments.
1.1 Identifying the Provider: From “coolice.com” to CooliceHost
An initial investigation into the query “coolice.com” reveals a landscape of similarly named but functionally distinct entities. The domain coolice.com appears to be associated with various businesses, including those dealing in physical goods such as coolers, ice delivery services, and electronics.[1, 2, 3, 4, 5, 6, 7] However, the context of the query—shared hosting, DirectAdmin, Nginx, and SSH—points unequivocally to the web hosting provider known as CooliceHost.[8, 9, 10, 11] This provider, founded in 2016 and based in Dover, United States, specializes in high-performance hosting solutions.[8, 11] Therefore, this analysis will proceed with CooliceHost as the subject of investigation.
1.2 Market Positioning: A Provider for Webmasters
CooliceHost’s market positioning is a critical factor in understanding its technological choices. The company explicitly targets a technically proficient audience, repeatedly describing its services as “created by webmasters for webmasters”.[9, 12, 13] This positioning signals a departure from entry-level hosting aimed at non-technical users. Instead, it suggests a focus on performance, control, and the inclusion of advanced features that appeal to developers, system administrators, and experienced website managers. This target market is more likely to value the speed of Nginx and the power of SSH over the plug-and-play simplicity of more traditional, Apache-centric hosting environments. This strategic focus justifies the selection of a more customizable and performance-oriented, yet potentially more complex, technology stack.
1.3 The Four Pillars of the Service Architecture
The CooliceHost shared hosting service is built upon four interdependent technological pillars, each serving a distinct role in the overall architecture. A high-level overview of these core components is as follows:</p>
<ul>
  <li>The Shared Hosting Model: This forms the economic and operational foundation of the service. Multiple websites are hosted on a single physical server, allowing resources such as CPU, RAM, and storage to be shared among many users. This model significantly reduces costs for the end-user, as the provider manages server maintenance, security updates, and technical support.[14]</li>
  <li>The DirectAdmin Control Layer: This component serves as the administrative and user management interface. DirectAdmin is a graphical control panel that allows users to manage their websites, domains, emails, and databases without requiring direct server administration knowledge.[15, 16] Its selection is integral to the service’s overall performance and flexibility.</li>
  <li>The Standalone Nginx Performance Engine: This is the high-speed web server responsible for handling incoming HTTP and HTTPS requests. The “standalone” configuration implies that Nginx is the primary web server, not merely a caching layer for another server like Apache. This choice prioritizes raw performance and efficiency.[17, 18]</li>
  <li>SSH Advanced Access: This protocol provides a secure, encrypted channel for command-line management of the hosting account. It is a critical feature for developers and power users, enabling advanced workflows, automation, and direct server interaction that are impossible with standard tools like FTP.[19, 20]
1.4 Report Objective and Structure
This report will dissect the “how,” “why,” and “in what ways” these four components are architected and integrated within the CooliceHost shared hosting environment. It will provide an expert-level analysis of the platform’s architecture, exploring the inherent benefits and trade-offs of this specific technology stack. The subsequent sections will delve into each pillar in detail, culminating in a synthesized evaluation and a set of strategic recommendations for both prospective and existing users.
Section 2: The Foundation: Shared Hosting Architecture on CloudLinux
The foundational layer of any shared hosting service determines its stability, security, and performance. CooliceHost builds its platform on a standard shared hosting model but enhances it significantly through the strategic implementation of a specialized operating system, CloudLinux, and high-performance hardware. This section analyzes this underlying environment, focusing on how the architecture mitigates the inherent challenges of multi-tenancy.
2.1 Principles of Shared Web Hosting
Shared web hosting is a service model where a single physical server hosts numerous websites for multiple customers.[14] Each customer is allocated a portion of the server’s resources, including disk space, RAM, and CPU processing power.[21, 22] The primary advantage of this model is its cost-effectiveness; by distributing the costs of server hardware, maintenance, and administration across many users, providers can offer hosting plans at a very low price point.[22, 23, 24]
In this arrangement, the hosting provider is responsible for all aspects of server management, including software installation, security patching, network configuration, and technical support.[14, 21, 24] This managed approach is highly beneficial for users who lack the technical expertise or desire to perform complex system administration tasks, allowing them to focus solely on building and managing their websites.[14, 21] Websites on a shared server are typically managed through a web-based control panel, which provides a user-friendly interface for common tasks.[14]
2.2 Mitigating the “Noisy Neighbor” Problem with CloudLinux OS
The most significant architectural challenge in a conventional shared hosting environment is resource contention, commonly known as the “noisy neighbor” effect.[23] In a standard setup using a generic Linux distribution, server resources are shared in a common pool. If one website experiences a sudden surge in traffic or runs an inefficient script, it can consume a disproportionate amount of the server’s CPU and RAM. This monopolization of resources inevitably leads to performance degradation—slow loading times and even downtime—for every other website on the same server.[23] For a provider like CooliceHost, which positions itself on performance and reliability, leaving this critical factor to chance is not a viable strategy.[25, 26]
The solution implemented by CooliceHost is the adoption of CloudLinux OS, an operating system specifically engineered for multi-tenant hosting environments.[13, 27, 28] The core technology of CloudLinux is the Lightweight Virtualized Environment (LVE). LVE creates isolated, virtualized containers for each user account on the server. Within each container, strict limits are enforced on the amount of CPU, RAM, I/O, and concurrent processes that a single user can consume.[27]
This containerization fundamentally changes the dynamics of the shared server. If a user’s website exceeds its allocated resources, its processes are slowed down or throttled within its own LVE, preventing it from impacting the performance of any other user on the server. This transforms an unpredictable, shared resource pool into a stable, reliable environment where each tenant is guaranteed their allocated resources, effectively eliminating the “noisy neighbor” problem and ensuring a consistent level of performance for all customers.
2.3 Enhancing Security and Stability
Beyond resource isolation, CloudLinux OS provides critical security enhancements through a feature called CageFS.[29] CageFS is a virtualized, per-user file system that completely encapsulates each user’s data and processes. When a user is within their “cage,” they are unable to see or access the files of any other user on the server. Furthermore, CageFS prevents users from viewing sensitive server configuration files, such as /etc/passwd, which could be exploited in a standard shared environment. This file system virtualization adds a robust layer of security, significantly reducing the risk of information disclosure and privilege escalation attacks between accounts on the same server.
2.4 The Hardware Layer: Performance-Oriented Infrastructure
The software-level optimizations provided by CloudLinux are built upon a high-performance hardware foundation. CooliceHost utilizes enterprise-grade Solid-State Drives (SSD) and, in some plans, Non-Volatile Memory Express (NVMe) storage.[9, 27, 28, 29, 30, 31, 32] Compared to traditional Hard Disk Drives (HDD), SSD and NVMe technologies offer dramatically lower latency and higher read/write speeds. This is particularly important in a web hosting context, where the speed of database queries and file access directly impacts website loading times. By investing in this advanced storage hardware, CooliceHost ensures that disk I/O, a common performance bottleneck, is minimized, creating a fast and responsive base upon which the entire software stack can operate efficiently.
Section 3: The Control Layer: DirectAdmin Panel Integration
The control panel is the primary interface through which users interact with and manage their hosting environment. CooliceHost’s choice of DirectAdmin is a deliberate one, driven by its alignment with the overall architectural goals of performance, efficiency, and flexibility, particularly in the context of a standalone Nginx configuration.
3.1 An Overview of DirectAdmin
DirectAdmin is a graphical, web-based hosting control panel known for its simplicity, speed, and low resource consumption.[15, 33, 34, 35, 36] Its design philosophy emphasizes efficiency, aiming to use the bare minimum of system resources so that more are available for customer websites.[35, 36] This lightweight nature makes it an ideal counterpart to the high-performance Nginx web server.
The panel is structured with a three-tiered access system: Administrator, Reseller, and User.[34, 35] This hierarchy allows for granular control over the server. The Administrator has full server control, Resellers can manage a subset of user accounts, and Users have access only to the settings for their own websites. This structure is essential for managing a multi-tenant shared hosting environment effectively.
3.2 Why DirectAdmin for a Standalone Nginx Environment?
The selection of a control panel is not arbitrary; it is a critical architectural decision. For a hosting provider offering a standalone Nginx service, DirectAdmin presents significant advantages over more rigid, historically Apache-centric competitors like cPanel. The core reason lies in its superior flexibility for managing non-standard web server configurations.
A standalone Nginx setup operates fundamentally differently from an Apache-based one. Most notably, it does not use .htaccess files for directory-level configuration and URL rewrites.[37, 38] This is a performance-enhancing design choice by Nginx, as parsing these files for every request adds significant overhead. However, it means that all configuration directives, including the rewrite rules essential for applications like WordPress, must be placed directly within the main Nginx server block configuration.
A control panel in this environment must provide a secure and user-friendly mechanism for users to manage these server block configurations without granting them root-level access to the server’s core configuration files. DirectAdmin excels in this area due to its powerful and extensible templating system. The entire configuration for a user’s domain is generated from a set of .conf templates.[39, 40] This architecture allows the server administrator to create and customize base Nginx templates, which users can then select or modify on a per-domain basis through the control panel interface. This provides a structured and secure way to manage Nginx-specific settings.
In contrast, cPanel’s integration with Nginx has historically been more focused on using it as a caching reverse proxy in front of Apache, with less direct, user-facing control over the Nginx configuration itself.[41] While this is changing, DirectAdmin’s template-driven architecture makes it inherently more adaptable and powerful for a provider wishing to offer a true standalone Nginx experience with a high degree of user-level control.
3.3 Key Management Functions in DirectAdmin
Within the CooliceHost environment, users leverage DirectAdmin for a wide range of standard hosting management tasks:</li>
  <li>Domain and Website Management: Users can add new domains and subdomains, manage DNS records, and use the built-in file manager to upload, edit, and manage their website files.[16, 36]</li>
  <li>PHP-FPM Integration: A standalone Nginx server cannot execute PHP code directly. It must pass PHP requests to a separate process manager. The standard and recommended handler for this is PHP-FPM (FastCGI Process Manager).[37, 42] DirectAdmin seamlessly integrates with PHP-FPM, allowing users to select different PHP versions for their websites and manage PHP settings, ensuring compatibility and performance.</li>
  <li>Database and Email Management: DirectAdmin provides standard tools for managing the hosting environment. This includes the ability to create and manage MySQL or MariaDB databases, typically through the integrated phpMyAdmin interface, and to create and manage email accounts, forwarders, and auto-responders for their domains.[16, 29, 36]</li>
  <li>Security Features: The control panel serves as the user’s interface for key security features. This includes one-click installation and renewal of free SSL certificates via Let’s Encrypt, which is essential for modern web security.[34, 37] It also integrates with server-level security suites like Imunify360 and firewalls, providing a centralized point of management for security settings.[13, 28]
Section 4: The Performance Engine: Standalone Nginx Configuration
The web server is the heart of the hosting stack, directly responsible for processing client requests and delivering content. CooliceHost’s choice of a standalone Nginx configuration is a clear statement of intent, prioritizing speed, scalability, and efficiency over the traditional, more compatibility-focused approach of Apache.
4.1 Nginx Architecture: The Event-Driven Advantage
Nginx (pronounced “engine-x”) is a high-performance web server renowned for its ability to handle a massive number of concurrent connections with minimal resource consumption.[17, 18, 43, 44] Its architectural superiority stems from its asynchronous, event-driven model.
Unlike older, process-based servers like Apache (in its traditional prefork mode), which spawn a new process or thread for each incoming connection, Nginx uses a small, fixed number of worker processes. Each worker process can handle thousands of connections simultaneously. It listens for events (like a new request or data being ready to send) and processes them as they occur, without blocking or waiting. This non-blocking I/O model results in a significantly lower memory footprint and more predictable performance under high load, especially when serving static content like images, CSS, and JavaScript files.[17, 18] This fundamental design is the primary reason for Nginx’s widespread adoption by high-traffic websites and performance-focused hosting providers.
4.2 “Standalone” Nginx vs. Nginx Reverse Proxy
Within the DirectAdmin ecosystem, providers can deploy Nginx in two primary configurations, each with distinct characteristics and trade-offs.[37, 38] Understanding the difference is crucial to appreciating the CooliceHost offering.</li>
  <li>Standalone Nginx: In this model, Nginx is the sole web server handling all incoming HTTP/S requests. It serves static files directly from the disk. When a request for a dynamic script (like PHP) arrives, Nginx passes it to the PHP-FPM process manager for execution and then returns the result to the client. This is the purest, most efficient configuration, offering the lowest resource usage and the highest potential speed.[18, 38]</li>
  <li>Nginx + Apache (Reverse Proxy): This hybrid model uses Nginx as a front-end “reverse proxy.” Nginx receives all requests, serves static files with its characteristic speed, but “proxies” or forwards requests for dynamic content to a back-end Apache server. The primary benefit of this setup is compatibility. It combines Nginx’s performance for static assets with Apache’s full support for .htaccess files, which many legacy applications and non-technical users rely on.[38, 39, 45, 46]
The following table provides a comparative analysis of these configurations:
| Configuration Type | Performance Characteristics | Memory/CPU Usage | .htaccess Support | Ideal Use Case |
|—|—|—|—|—|
| Standalone Nginx | Highest performance for both static and dynamic content; lowest latency. | Lowest | None. All rules must be in the main Nginx configuration. | Performance-critical websites, modern applications, and developers comfortable with Nginx syntax. |
| Nginx + Apache | Excellent performance for static content (served by Nginx); good performance for dynamic content (served by Apache). | High. Runs two full web servers. | Full. Apache processes .htaccess files as usual. | Hosting environments requiring backward compatibility with .htaccess for legacy applications or mixed-user skill levels. |
| Standalone Apache | Good performance, but can struggle under high concurrent loads for static files compared to Nginx. | Moderate to High | Full | Traditional hosting, legacy applications, and environments where .htaccess flexibility is paramount. |
CooliceHost’s focus on a standalone Nginx service, as indicated by their marketing and technical documentation, caters specifically to the first use case: users who prioritize maximum performance and are willing to manage configuration directly rather than through .htaccess files.
4.3 Managing Configuration in a .htaccess-less World
The most significant practical consequence for users moving to a standalone Nginx environment is the absence of .htaccess support. This is not a bug but a core design principle of Nginx, which avoids the performance overhead associated with scanning the file system for configuration files on every request.[37, 38] However, popular content management systems like WordPress depend on .htaccess to enable user-friendly URLs, often called “pretty permalinks.” Without these rewrite rules, a WordPress site would only be accessible through URLs like example.com/?p=123.
To solve this critical compatibility issue, the necessary rewrite rules must be explicitly defined within the Nginx server block for the domain. DirectAdmin provides an elegant solution to this challenge through its Nginx Templates feature.[39] From the control panel, a user can select a pre-configured template for their application, such as “WordPress+FastCGI cache.” Applying this template automatically inserts the correct, optimized set of Nginx location and rewrite directives into the domain’s server configuration file. This allows complex applications to function correctly without requiring the user to manually write Nginx configuration code.
For custom applications or requirements not covered by a template, users must utilize the “Custom HTTPD Configuration” feature within DirectAdmin.[39, 47, 48] This interface provides text boxes where advanced users can insert their own valid Nginx directives directly into specific parts of their virtual host configuration. While this method is extremely powerful, it requires a working knowledge of Nginx syntax and is a steeper learning curve for those accustomed to the simplicity of uploading an .htaccess file.
4.4 Potential Pitfall: Cross-Domain Configuration Bleed
While DirectAdmin’s system is designed to isolate configurations on a per-domain basis, real-world user experiences suggest that this isolation may not always be perfect when mixing web server modes on a single account. A user on the DirectAdmin forums reported a specific and counter-intuitive issue: after enabling standalone Nginx for one domain (domain1.com), the .htaccess rewrite rules on a second domain (domain2.com), which was presumably running in the Nginx+Apache reverse proxy mode, stopped working.[49]
This behavior is unexpected, as the configuration for each virtual host should be self-contained. It suggests a potential anomaly in how DirectAdmin generates the global Nginx configuration file or includes the per-domain settings. It is possible that a global directive intended for the standalone domain was being inherited or applied incorrectly to the proxy configuration of the other domain. This is a critical point for any advanced user or agency managing multiple sites on a single CooliceHost account. It underscores the importance of rigorous testing across all hosted domains whenever a significant configuration change, such as switching a single domain to standalone Nginx mode, is made. An expert-level report must highlight such potential complexities, advising users to move beyond theoretical expectations and verify functionality in their specific multi-domain environment.
Section 5: The Access Protocol: Secure Shell (SSH) Management and Utility
The provision of Secure Shell (SSH) access is a defining feature that elevates a shared hosting plan from a simple content repository into a versatile development and deployment platform. For the “webmaster” audience targeted by CooliceHost, SSH is not a luxury but an essential tool for modern, efficient workflows.
5.1 Understanding SSH in a Web Hosting Context
The Secure Shell (SSH) protocol provides a secure, encrypted method for connecting to and interacting with a remote computer’s command-line interface over an unsecured network like the internet.[19, 50] Its core function is to create a secure tunnel between the user’s local machine and the hosting server, protecting all transmitted data, including login credentials and commands, from eavesdropping.
This capability fundamentally distinguishes SSH from older protocols like FTP (File Transfer Protocol). While FTP is designed solely for transferring files, SSH provides a full-fledged shell environment, allowing the user to execute commands on the server as if they were physically logged in.[50, 51] This opens up a vast range of possibilities for file management, application deployment, and server-side task automation.
5.2 Enabling and Managing SSH Access in DirectAdmin
On CooliceHost’s platform, as with most managed hosting environments, SSH access is a privileged feature that is not enabled by default for standard user accounts. This is a deliberate security measure, as improper use of command-line tools can pose risks to the user’s data and, in a poorly configured environment, to the server itself.[52, 53]
The process of granting SSH access is typically managed at the Administrator or Reseller level within the DirectAdmin panel.[52, 53, 54, 55, 56, 57] The workflow involves:</li>
  <li>Logging into DirectAdmin with administrative or reseller credentials.</li>
  <li>Navigating to the “Account Manager” and selecting “Show All Users” or “List Users.”</li>
  <li>Searching for and selecting the specific user account that requires SSH access.</li>
  <li>Navigating to the “Modify” tab for that user.</li>
  <li>Checking the box corresponding to “SSH Access” and saving the changes.[52, 53, 56, 57, 58]
In many cases, an ordinary user may need to submit a support ticket to request that this feature be enabled for their account, reinforcing its status as an advanced, power-user tool.[54] Once enabled, the user can connect to the server using an SSH client (like PuTTY on Windows or the built-in Terminal on macOS/Linux) with their standard hosting account username and password.
5.3 The Developer’s Toolkit: Practical Command-Line Operations
The true value of SSH access lies in the powerful set of command-line tools it unlocks. For a web developer, this transforms the workflow from a slow, manual process of uploading pre-built files via FTP to a fast, automated, and interactive development cycle. SSH enables the direct use of essential, industry-standard development tools on the server itself. This includes:</li>
  <li>Version Control: Using git to clone, pull, and deploy code directly from repositories like GitHub or Bitbucket.</li>
  <li>Dependency Management: Running tools like composer for PHP projects or npm for Node.js projects to install and update application libraries directly on the server.</li>
  <li>Framework CLIs: Interacting with application-specific command-line interfaces, such as wp-cli for managing WordPress installations, artisan for the Laravel framework, or drush for Drupal.</li>
  <li>Automation: Writing and executing shell scripts to automate repetitive tasks like backups, database operations, or deployment routines.</li>
  <li>Advanced Troubleshooting: Directly viewing log files, checking server processes, and diagnosing issues in real-time.
The following table outlines some of the most essential SSH commands that a web developer would use in the CooliceHost environment.
| Task/Objective | Relevant Command(s) | Explanation &amp; Example Usage |
|—|—|—|
| Navigating the File System | pwd, cd, ls | Determine your current location, change directories, and list files. Ex: cd /home/user/domains/example.com/public_html to enter the web root.[20, 59, 60] |
| File/Directory Manipulation | mkdir, touch, cp, mv, rm | Create new directories and files, copy, move/rename, and delete files. Ex: cp config.sample.php config.php to copy a configuration file.[20, 59, 60] |
| Viewing &amp; Editing Files | cat, nano, vi | Display file contents directly in the terminal or open them in a command-line text editor for modification. Ex: nano wp-config.php to edit the WordPress config.[59, 60] |
| Searching for Files/Content | find, grep | Search for files by name, type, or size, and search for specific text strings within files. Ex: grep -r “DB_PASSWORD”. to find the database password in the current directory.[59, 60] |
| Archiving &amp; Compression | tar, zip, unzip | Create or extract compressed archives, essential for backups or deploying application packages. Ex: tar -czvf backup.tar.gz public_html/ to create a compressed backup of the web root.[59] |
| Checking Resource Usage | du, df, top | Check disk usage of specific folders, view overall disk space, and monitor real-time system processes and resource usage.[60] |
| Managing Permissions | chmod, chown | Change the read, write, and execute permissions of files and directories to ensure proper application function and security. Ex: chmod 755 public_html. |
| Downloading Remote Files | wget, curl | Download files directly to the server from a URL, bypassing the need to download to a local machine first. Ex: wget https://wordpress.org/latest.zip.[59, 60] |
5.4 Advanced SSH Techniques
For users seeking to maximize both security and efficiency, SSH offers more advanced capabilities. The most important of these is SSH key authentication. This method involves generating a cryptographic key pair (a private key stored on the user’s local machine and a public key uploaded to the server). When connecting, the server uses the public key to verify the signature from the private key, granting access without requiring a password. This is significantly more secure than password-based authentication, as it is immune to brute-force attacks.[61, 62, 63, 64, 65] DirectAdmin provides an interface under “SSH Keys” to facilitate the management of these public keys.[63]
Another advanced technique is SSH tunneling (or port forwarding). This allows a user to securely forward a port from the remote server to their local machine. A common use case for web developers is to tunnel the server’s database port (e.g., 3306 for MySQL) to their local machine. This enables them to connect to the remote database using a local graphical database management tool as if the database were running on their own computer, all through a secure, encrypted connection.[66, 67]
Section 6: Synthesis and Strategic Recommendations
The preceding analysis has dissected the four core components of the CooliceHost shared hosting service. This final section synthesizes these findings to evaluate the platform as a cohesive ecosystem and provides targeted recommendations for different user profiles.
6.1 Architectural Synergy: A High-Performance Ecosystem
The technology stack chosen by CooliceHost is not a random assortment of popular tools but a carefully integrated ecosystem where each component complements the others to achieve a specific goal: high-performance, stable, and controllable shared hosting for a technical audience. This architecture is purpose-built to overcome the primary weaknesses of traditional shared hosting—unpredictable performance and limited developer control.
The synergy functions as follows:</li>
  <li>CloudLinux OS provides the stable, secure, and isolated foundation, solving the inherent resource contention problems of shared hosting. This allows the provider to guarantee a baseline level of performance, a promise that is difficult to keep in a standard Linux environment.</li>
  <li>Standalone Nginx is layered on top of this stable foundation to act as the performance engine. Its lightweight, event-driven architecture delivers raw speed and efficiency that would be impossible to achieve with a traditional Apache setup, especially under concurrent load.</li>
  <li>DirectAdmin serves as the essential control layer, providing the flexibility needed to manage a non-standard web server like standalone Nginx. Its powerful templating system bridges the gap left by the absence of .htaccess, giving technical users the necessary control over their environment without compromising security.</li>
  <li>SSH Access completes the ecosystem by providing the power-user access required to fully exploit the platform’s capabilities. It transforms the hosting account into a true development environment, enabling modern workflows that are critical for the “webmaster” and developer audience.
Together, these four pillars create a hosting environment that is strategically positioned to offer a superior experience for users who prioritize performance and control over beginner-friendly simplicity.
6.2 User Profile Suitability Analysis
The specialized nature of the CooliceHost shared hosting stack makes it an excellent choice for certain users and a potentially challenging one for others. A clear understanding of this suitability is crucial for any prospective customer.</li>
  <li>The Performance-Oriented Developer (Ideal User): A web developer who is comfortable with the Linux command line and understands the basics of Nginx configuration will thrive in this environment. They can leverage SSH for modern workflows with Git and Composer, fine-tune Nginx configurations for maximum application speed, and benefit from the stable, high-performance foundation. For this profile, the platform offers capabilities that approach those of a more expensive VPS, but in a managed, cost-effective package.</li>
  <li>The Small Digital Agency: An agency managing multiple client websites, particularly those built on common platforms like WordPress, can leverage this platform effectively. By using DirectAdmin’s reseller features and Nginx templates, they can rapidly deploy optimized websites that benefit from superior speed and security. The provision of SSH access allows their technical staff to efficiently manage and troubleshoot client sites.</li>
  <li>The Technical Hobbyist/Power User: An individual with a strong technical background working on personal projects will appreciate the high degree of control and performance offered. However, they must be willing to invest the time to learn the Nginx configuration paradigm, as they will not be able to rely on the copy-paste solutions often available for .htaccess.</li>
  <li>The Non-Technical Beginner (Poor Fit): A user with little to no technical experience, such as a small business owner wanting to set up their first website, would likely find this environment frustrating. The lack of .htaccess support means that common tutorials and guides for their chosen applications may not work out-of-the-box. The reliance on a control panel interface for rewrite rules and the emphasis on SSH for advanced tasks could present a steep and unnecessary learning curve. This user profile would be better served by a more traditional cPanel/Apache hosting provider that prioritizes simplicity and broad compatibility.
6.3 Recommendations for Prospective Customers
For those considering CooliceHost for their shared hosting needs, the following steps are recommended:</li>
  <li>Assess Your Technical Acumen: Before committing, honestly evaluate your comfort level with the command line and your willingness to manage web server configurations that go beyond a simple graphical interface. If you have never used SSH and your primary method of managing a website is through FTP and a GUI, this platform may introduce significant friction into your workflow.</li>
  <li>Understand the Nginx Paradigm: Invest time in learning the basics of Nginx server blocks, location directives, and the rewrite syntax. This knowledge is essential to replace your reliance on .htaccess and to troubleshoot any configuration-related issues you may encounter.</li>
  <li>Verify Application Compatibility: For any custom or less-common applications you plan to host, research and ensure that there are known-working Nginx configuration examples available. While DirectAdmin provides templates for popular CMSs, you will be responsible for configuring anything outside that scope.
6.4 Recommendations for Existing Users
For current customers of CooliceHost looking to maximize the value of their hosting plan:</li>
  <li>Embrace the Command Line: If you are not already doing so, make SSH your primary tool for website management. Use Git for deployments, manage dependencies with Composer/NPM, and write simple shell scripts to automate repetitive tasks like clearing caches or running database backups. This will dramatically increase your efficiency.</li>
  <li>Master DirectAdmin Templates: Move beyond the default settings. Explore the custom HTTPD configuration options in DirectAdmin to fine-tune your Nginx templates. Add custom headers for browser caching (Cache-Control, Expires) or implement security headers (like Content-Security-Policy) to improve both the performance and security of your applications.</li>
  <li>Implement SSH Key Authentication: As a top security priority, disable password-based SSH login for your account and switch exclusively to more secure key-based authentication. This is a simple process that provides a massive security benefit.</li>
  <li>Test Configuration Changes Rigorously: As highlighted by the potential for cross-domain issues (Section 4.4), never assume a configuration change on one domain will not affect another. When managing multiple sites, always test the functionality of all sites after making a significant change to any one of them, preferably in a staging environment or during low-traffic periods.</li>
</ul>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">coolice todo webapp</title><link href="https://ib.bsb.br/coolice-todo-webapp/" rel="alternate" type="text/html" title="coolice todo webapp" /><published>2025-09-10T00:00:00+00:00</published><updated>2025-09-11T20:49:57+00:00</updated><id>https://ib.bsb.br/coolice-todo-webapp</id><content type="html" xml:base="https://ib.bsb.br/coolice-todo-webapp/"><![CDATA[<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">declare</span><span class="p">(</span><span class="n">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="cm">/*
UX upgrades (fully implemented)
- Inline edits: Enter commits, Esc cancels and reverts, Tab moves to next, Shift+Tab to prev.
- Title: Enter saves, Esc cancels.
- Keyboard on list: Space toggles, Delete removes, E starts edit for focused item.
- Drag-and-drop reorder (disabled while filtering/searching); persists via new "reorder" API op.
- Filters &amp; search: All/Active/Completed + text search; persists in localStorage.
- Bulk ops: "Complete all"/"Uncheck all", "Clear completed", "Clear all" (with confirm).
- Undo for delete and clear completed (10s window).
- Recent boards history with datalist for quick switching.
- Accessibility and feedback: aria-live, counts, last updated, consistent flash messages.
- PWA retained with single-file assets; safer limits and headers; ETag + Last-Modified + 304 for fetch.
*/</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Security &amp; headers</span>
<span class="c1">/////////////////////////////</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">'X-Content-Type-Options: nosniff'</span><span class="p">);</span>

<span class="nv">$isHttps</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">'off'</span><span class="p">)</span>
  <span class="o">||</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PROTO'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PROTO'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'https'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$isHttps</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Strict-Transport-Security: max-age=31536000; includeSubDomains'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Config and helpers</span>
<span class="c1">/////////////////////////////</span>

<span class="nv">$scheme</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$isHttps</span> <span class="o">?</span> <span class="s1">'https'</span> <span class="o">:</span> <span class="s1">'http'</span><span class="p">);</span>
<span class="nv">$host</span>   <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_HOST'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$origin</span> <span class="o">=</span> <span class="nv">$scheme</span> <span class="mf">.</span> <span class="s1">'://'</span> <span class="mf">.</span> <span class="nv">$host</span><span class="p">;</span>

<span class="nv">$dataDir</span> <span class="o">=</span> <span class="nb">realpath</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/..'</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nb">realpath</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/..'</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'/data'</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../data'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dataDir</span><span class="p">))</span> <span class="p">{</span>
  <span class="o">@</span><span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dataDir</span><span class="p">,</span> <span class="mo">0755</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span> <span class="no">MAX_TEXT_LEN</span>  <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
<span class="k">const</span> <span class="no">MAX_TITLE_LEN</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>

<span class="k">function</span> <span class="n">id</span><span class="p">():</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">random_bytes</span><span class="p">(</span><span class="mi">6</span><span class="p">)),</span> <span class="s1">'+/'</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">),</span> <span class="s1">'='</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">safeSlug</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^a-zA-Z0-9_-]/'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$b</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="s1">'public'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">pathOf</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">'dataDir'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'/'</span> <span class="mf">.</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'.json'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">emptyBoard</span><span class="p">():</span> <span class="kt">array</span> <span class="p">{</span>
  <span class="nv">$t</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">[</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'My Todo'</span><span class="p">,</span> <span class="s1">'tasks'</span> <span class="o">=&gt;</span> <span class="p">[],</span> <span class="s1">'created'</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">,</span> <span class="s1">'updated'</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">loadBoard</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">):</span> <span class="kt">array</span> <span class="p">{</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nf">pathOf</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$f</span><span class="p">))</span> <span class="k">return</span> <span class="nf">emptyBoard</span><span class="p">();</span>
  <span class="nv">$raw</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
  <span class="nv">$j</span> <span class="o">=</span> <span class="nv">$raw</span> <span class="o">?</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$raw</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">is_array</span><span class="p">(</span><span class="nv">$j</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$j</span> <span class="o">:</span> <span class="nf">emptyBoard</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">saveBoard</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">,</span> <span class="kt">array</span> <span class="nv">$d</span><span class="p">):</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nf">pathOf</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$d</span><span class="p">[</span><span class="s1">'updated'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
  <span class="nv">$h</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">'c+'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$h</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">flock</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="no">LOCK_EX</span><span class="p">);</span>
    <span class="nb">ftruncate</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$d</span><span class="p">,</span> <span class="no">JSON_PRETTY_PRINT</span> <span class="o">|</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">));</span>
    <span class="nb">fflush</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>
    <span class="nb">flock</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="no">LOCK_UN</span><span class="p">);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>
    <span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">emitJSON</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="kt">array</span> <span class="nv">$headers</span> <span class="o">=</span> <span class="p">[]):</span> <span class="kt">never</span> <span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$headers</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="nb">header</span><span class="p">(</span><span class="s2">"</span><span class="nv">$k</span><span class="s2">: </span><span class="nv">$v</span><span class="s2">"</span><span class="p">);</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json; charset=utf-8'</span><span class="p">);</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: no-cache, must-revalidate'</span><span class="p">);</span>
  <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">notModified</span><span class="p">():</span> <span class="kt">never</span> <span class="p">{</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'HTTP/1.1 304 Not Modified'</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">htmlHeader</span><span class="p">():</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: text/html; charset=utf-8'</span><span class="p">);</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: no-cache'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Asset router (manifest, sw, icons, favicon)</span>
<span class="c1">/////////////////////////////</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'asset'</span><span class="p">]))</span> <span class="p">{</span>
  <span class="nv">$asset</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'asset'</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$asset</span> <span class="o">===</span> <span class="s1">'manifest'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/manifest+json; charset=utf-8'</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: public, max-age=3600'</span><span class="p">);</span>
    <span class="c1">// Minimal base64 1x1 PNG</span>
    <span class="nv">$icon1x1</span> <span class="o">=</span> <span class="s1">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII='</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
      <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'memor.ia.br — Todos'</span><span class="p">,</span>
      <span class="s1">'short_name'</span> <span class="o">=&gt;</span> <span class="s1">'memor'</span><span class="p">,</span>
      <span class="s1">'start_url'</span> <span class="o">=&gt;</span> <span class="s1">'/?b=public'</span><span class="p">,</span>
      <span class="s1">'display'</span> <span class="o">=&gt;</span> <span class="s1">'standalone'</span><span class="p">,</span>
      <span class="s1">'background_color'</span> <span class="o">=&gt;</span> <span class="s1">'#ffffff'</span><span class="p">,</span>
      <span class="s1">'theme_color'</span> <span class="o">=&gt;</span> <span class="s1">'#111111'</span><span class="p">,</span>
      <span class="s1">'icons'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'src'</span> <span class="o">=&gt;</span> <span class="nv">$icon1x1</span><span class="p">,</span> <span class="s1">'sizes'</span> <span class="o">=&gt;</span> <span class="s1">'192x192'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'image/png'</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'src'</span> <span class="o">=&gt;</span> <span class="nv">$icon1x1</span><span class="p">,</span> <span class="s1">'sizes'</span> <span class="o">=&gt;</span> <span class="s1">'512x512'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'image/png'</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'src'</span> <span class="o">=&gt;</span> <span class="nv">$origin</span> <span class="mf">.</span> <span class="s1">'/?asset=favicon'</span><span class="p">,</span> <span class="s1">'sizes'</span> <span class="o">=&gt;</span> <span class="s1">'any'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'image/svg+xml'</span><span class="p">,</span> <span class="s1">'purpose'</span> <span class="o">=&gt;</span> <span class="s1">'any maskable'</span><span class="p">],</span>
      <span class="p">],</span>
      <span class="s1">'scope'</span> <span class="o">=&gt;</span> <span class="s1">'/'</span><span class="p">,</span>
    <span class="p">],</span> <span class="no">JSON_UNESCAPED_SLASHES</span> <span class="o">|</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$asset</span> <span class="o">===</span> <span class="s1">'sw'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/javascript; charset=utf-8'</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: public, max-age=3600'</span><span class="p">);</span>
    <span class="cp">?&gt;</span>
// Service Worker for memor.ia.br
const CACHE_NAME = 'memor-cache-v1.4';
const SHELL = [
  '/?b=public',
  '/?asset=manifest',
  '/?asset=favicon'
];

self.addEventListener('install', (e) =&gt; {
  e.waitUntil(caches.open(CACHE_NAME).then(c =&gt; c.addAll(SHELL)));
  self.skipWaiting();
});

self.addEventListener('activate', (e) =&gt; {
  e.waitUntil(
    caches.keys().then(keys =&gt; Promise.all(keys.map(k =&gt; (k!==CACHE_NAME ? caches.delete(k) : Promise.resolve()))))
  );
  self.clients.claim();
});

self.addEventListener('fetch', (e) =&gt; {
  const url = new URL(e.request.url);
  // API fetch for board -&gt; stale-while-revalidate
  if (url.searchParams.get('action') === 'fetch' <span class="err">&amp;&amp;</span> url.searchParams.get('b')) {
    e.respondWith((async () =&gt; {
      const cache = await caches.open(CACHE_NAME);
      const cached = await cache.match(e.request);
      const fetchPromise = fetch(e.request).then(res =&gt; {
        if (res <span class="err">&amp;&amp;</span> (res.status === 200 || res.status === 304)) {
          cache.put(e.request, res.clone());
        }
        return res;
      }).catch(() =&gt; cached);
      return cached || fetchPromise;
    })());
    return;
  }
  // HTML/other GET: network first; fallback to cache; simple offline page if none
  if (e.request.method === 'GET') {
    e.respondWith((async () =&gt; {
      try {
        const net = await fetch(e.request);
        const cache = await caches.open(CACHE_NAME);
        cache.put(e.request, net.clone());
        return net;
      } catch (err) {
        const cache = await caches.open(CACHE_NAME);
        const cached = await cache.match(e.request);
        return cached || new Response('<span class="cp">&lt;!doctype html&gt;</span><span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;&lt;title&gt;</span>Offline<span class="nt">&lt;/title&gt;&lt;h1&gt;</span>Offline<span class="nt">&lt;/h1&gt;&lt;p&gt;</span>The app is offline. Retry when back online.<span class="nt">&lt;/p&gt;</span>', { headers: {'Content-Type':'text/html; charset=utf-8'} });
      }
    })());
  }
});
    <span class="cp">&lt;?php</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$asset</span> <span class="o">===</span> <span class="s1">'favicon'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: image/svg+xml; charset=utf-8'</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: public, max-age=86400'</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">'&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"&gt;&lt;rect fill="#111" width="64" height="64" rx="12"/&gt;&lt;path d="M48 20L27 41l-11-9" stroke="#fff" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none"/&gt;&lt;/svg&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'HTTP/1.1 404 Not Found'</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// API: Board fetch (GET) with ETag/Last-Modified</span>
<span class="c1">/////////////////////////////</span>

<span class="nv">$action</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'action'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$bParam</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">'new'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$bid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">();</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: '</span> <span class="mf">.</span> <span class="nv">$origin</span> <span class="mf">.</span> <span class="s1">'/?b='</span> <span class="mf">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$bid</span><span class="p">));</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">'fetch'</span> <span class="o">&amp;&amp;</span> <span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span><span class="p">);</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nf">pathOf</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$board</span> <span class="o">=</span> <span class="nf">loadBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$raw</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$board</span><span class="p">,</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">);</span>
  <span class="nv">$etag</span> <span class="o">=</span> <span class="s1">'"'</span> <span class="mf">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$raw</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'"'</span><span class="p">;</span>
  <span class="nv">$lastModTs</span> <span class="o">=</span> <span class="nb">file_exists</span><span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="o">?</span> <span class="nb">filemtime</span><span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$board</span><span class="p">[</span><span class="s1">'updated'</span><span class="p">];</span>
  <span class="nv">$lastMod</span> <span class="o">=</span> <span class="nb">gmdate</span><span class="p">(</span><span class="s1">'D, d M Y H:i:s'</span><span class="p">,</span> <span class="nv">$lastModTs</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">' GMT'</span><span class="p">;</span>

  <span class="nv">$inm</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_IF_NONE_MATCH'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$ims</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_IF_MODIFIED_SINCE'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$inm</span> <span class="o">===</span> <span class="nv">$etag</span> <span class="o">||</span> <span class="nv">$ims</span> <span class="o">===</span> <span class="nv">$lastMod</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'ETag: '</span> <span class="mf">.</span> <span class="nv">$etag</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Last-Modified: '</span> <span class="mf">.</span> <span class="nv">$lastMod</span><span class="p">);</span>
    <span class="nf">notModified</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'ETag'</span> <span class="o">=&gt;</span> <span class="nv">$etag</span><span class="p">,</span>
    <span class="s1">'Last-Modified'</span> <span class="o">=&gt;</span> <span class="nv">$lastMod</span>
  <span class="p">]);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// POST ops</span>
<span class="c1">/////////////////////////////</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span><span class="p">);</span>
  <span class="nv">$in</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'php://input'</span><span class="p">),</span> <span class="kc">true</span><span class="p">)</span> <span class="o">?:</span> <span class="p">[];</span>
  <span class="nv">$op</span> <span class="o">=</span> <span class="nv">$in</span><span class="p">[</span><span class="s1">'op'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$board</span> <span class="o">=</span> <span class="nf">loadBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'add'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$t</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$t</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TEXT_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
      <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nf">id</span><span class="p">(),</span> <span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">,</span> <span class="s1">'done'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">'ts'</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()];</span>
      <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'toggle'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$idv</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$idv</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">]</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">];</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">unset</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'edit'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$idv</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">);</span>
    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">));</span>
    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TEXT_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$idv</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$t</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$txt</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">unset</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'del'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$idv</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">);</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_filter</span><span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">],</span> <span class="k">fn</span><span class="p">(</span><span class="nv">$t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">!==</span> <span class="nv">$idv</span><span class="p">));</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'title'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ttl</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$ttl</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="nv">$ttl</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$ttl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TITLE_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$ttl</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$ttl</span> <span class="o">:</span> <span class="s1">'My Todo'</span><span class="p">;</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'clear_done'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_filter</span><span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">],</span> <span class="k">fn</span><span class="p">(</span><span class="nv">$t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">])));</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// New: set all done/undone</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'set_all'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$done</span> <span class="o">=</span> <span class="p">(</span><span class="n">bool</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'done'</span><span class="p">]</span> <span class="o">??</span> <span class="kc">false</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$done</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">unset</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// New: clear all</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'clear_all'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// New: reorder tasks by id list</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'reorder'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$in</span><span class="p">[</span><span class="s1">'order'</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="p">{</span>
      <span class="nv">$idx</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$order</span> <span class="k">as</span> <span class="nv">$pos</span> <span class="o">=&gt;</span> <span class="nv">$tid</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$idx</span><span class="p">[(</span><span class="n">string</span><span class="p">)</span><span class="nv">$tid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$pos</span><span class="p">;</span> <span class="p">}</span>
      <span class="nb">usort</span><span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">],</span> <span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$idx</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ai</span> <span class="o">=</span> <span class="nv">$idx</span><span class="p">[</span><span class="nv">$a</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">??</span> <span class="kc">PHP_INT_MAX</span><span class="p">;</span>
        <span class="nv">$bi</span> <span class="o">=</span> <span class="nv">$idx</span><span class="p">[</span><span class="nv">$b</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">??</span> <span class="kc">PHP_INT_MAX</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$ai</span> <span class="o">&lt;=&gt;</span> <span class="nv">$bi</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nf">emitJSON</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'unknown op'</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Quick add by URL (?add=Text) -&gt; add to board and redirect</span>
<span class="c1">/////////////////////////////</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'add'</span><span class="p">]))</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$bParam</span> <span class="o">:</span> <span class="s1">'public'</span><span class="p">);</span>
  <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'add'</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$txt</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TEXT_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
    <span class="nv">$board</span> <span class="o">=</span> <span class="nf">loadBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nf">id</span><span class="p">(),</span> <span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="nv">$txt</span><span class="p">,</span> <span class="s1">'done'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">'ts'</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()];</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: '</span> <span class="mf">.</span> <span class="nv">$origin</span> <span class="mf">.</span> <span class="s1">'/?b='</span> <span class="mf">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$b</span><span class="p">),</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">303</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// HTML App</span>
<span class="c1">/////////////////////////////</span>

<span class="nv">$boardSlug</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$bParam</span> <span class="o">:</span> <span class="s1">'public'</span><span class="p">);</span>
<span class="nf">htmlHeader</span><span class="p">();</span>
<span class="cp">?&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width,initial-scale=1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"robots"</span> <span class="na">content=</span><span class="s">"noindex"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"manifest"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$origin</span><span class="p">,</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">/?asset=manifest"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"icon"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$origin</span><span class="p">,</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">/?asset=favicon"</span> <span class="na">type=</span><span class="s">"image/svg+xml"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"theme-color"</span> <span class="na">content=</span><span class="s">"#111111"</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>memor.ia.br <span class="ni">&amp;mdash;</span> Todos<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style&gt;</span>
  <span class="nd">:root</span> <span class="p">{</span> <span class="py">color-scheme</span><span class="p">:</span> <span class="n">light</span> <span class="n">dark</span><span class="p">;</span> <span class="py">--bg</span><span class="p">:</span><span class="m">#fff</span><span class="p">;</span> <span class="py">--fg</span><span class="p">:</span><span class="m">#111</span><span class="p">;</span> <span class="py">--muted</span><span class="p">:</span><span class="m">#777</span><span class="p">;</span> <span class="py">--border</span><span class="p">:</span><span class="m">#ddd</span><span class="p">;</span> <span class="py">--accent</span><span class="p">:</span><span class="m">#111</span><span class="p">;</span> <span class="py">--ok</span><span class="p">:</span><span class="m">#0a7f2e</span><span class="p">;</span> <span class="py">--warn</span><span class="p">:</span><span class="m">#a00</span><span class="p">;</span> <span class="py">--chip</span><span class="p">:</span><span class="m">#f1f1f1</span><span class="p">;</span> <span class="py">--chipA</span><span class="p">:</span><span class="m">#d1e9ff</span><span class="p">;</span> <span class="py">--focus</span><span class="p">:</span><span class="m">#5b9cff</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">prefers-color-scheme</span><span class="p">:</span> <span class="n">dark</span><span class="p">)</span> <span class="p">{</span>
    <span class="nd">:root</span> <span class="p">{</span> <span class="py">--bg</span><span class="p">:</span><span class="m">#0c0c0c</span><span class="p">;</span> <span class="py">--fg</span><span class="p">:</span><span class="m">#eee</span><span class="p">;</span> <span class="py">--muted</span><span class="p">:</span><span class="m">#aaa</span><span class="p">;</span> <span class="py">--border</span><span class="p">:</span><span class="m">#222</span><span class="p">;</span> <span class="py">--accent</span><span class="p">:</span><span class="m">#e5e5e5</span><span class="p">;</span> <span class="py">--ok</span><span class="p">:</span><span class="m">#4cc27f</span><span class="p">;</span> <span class="py">--warn</span><span class="p">:</span><span class="m">#ff736a</span><span class="p">;</span> <span class="py">--chip</span><span class="p">:</span><span class="m">#171717</span><span class="p">;</span> <span class="py">--chipA</span><span class="p">:</span><span class="m">#0f3050</span><span class="p">;</span> <span class="py">--focus</span><span class="p">:</span><span class="m">#6aa3ff</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="c">/* Prevent padding/border from causing overflow on small screens */</span>
  <span class="o">*,</span> <span class="o">*</span><span class="nd">::before</span><span class="o">,</span> <span class="o">*</span><span class="nd">::after</span> <span class="p">{</span> <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span> <span class="p">}</span>

  <span class="nt">html</span><span class="o">,</span><span class="nt">body</span><span class="p">{</span><span class="nl">height</span><span class="p">:</span><span class="m">100%</span><span class="p">}</span>
  <span class="nt">body</span><span class="p">{</span><span class="nl">margin</span><span class="p">:</span><span class="m">0</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--bg</span><span class="p">);</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--fg</span><span class="p">);</span><span class="nl">font</span><span class="p">:</span><span class="m">16px</span><span class="p">/</span><span class="m">1.5</span> <span class="n">system-ui</span><span class="p">,</span><span class="n">Segoe</span> <span class="n">UI</span><span class="p">,</span><span class="n">Roboto</span><span class="p">,</span><span class="n">Arial</span><span class="p">}</span>
  <span class="nc">.wrap</span><span class="p">{</span><span class="nl">max-width</span><span class="p">:</span><span class="m">920px</span><span class="p">;</span><span class="nl">margin</span><span class="p">:</span><span class="m">0</span> <span class="nb">auto</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">18px</span><span class="p">}</span>
  <span class="nc">.box</span><span class="p">{</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">12px</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">14px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0.02</span><span class="p">)}</span>
  <span class="c">/* Allow items to wrap instead of overflowing horizontally */</span>
  <span class="nc">.row</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">}</span>
  <span class="c">/* Inputs are flex items that may shrink; ensure they can */</span>
  <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">text</span><span class="o">],</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">search</span><span class="o">]</span><span class="p">{</span>
    <span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">;</span> <span class="c">/* allow shrink within flex containers */</span>
    <span class="nl">padding</span><span class="p">:</span><span class="m">.65rem</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="nb">transparent</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--fg</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nt">button</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">.6rem</span> <span class="m">.9rem</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">0</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--accent</span><span class="p">);</span><span class="nl">color</span><span class="p">:</span><span class="m">#fff</span><span class="p">;</span><span class="nl">cursor</span><span class="p">:</span><span class="nb">pointer</span><span class="p">}</span>
  <span class="nt">button</span><span class="nc">.secondary</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="nb">transparent</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--fg</span><span class="p">);</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">)}</span>
  <span class="nt">button</span><span class="nc">.warn</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--warn</span><span class="p">)}</span>
  <span class="nt">button</span><span class="nc">.ok</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--ok</span><span class="p">)}</span>
  <span class="nt">ul</span><span class="p">{</span><span class="nl">list-style</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">0</span><span class="p">;</span><span class="nl">margin</span><span class="p">:</span><span class="m">12px</span> <span class="m">0</span><span class="p">}</span>
  <span class="c">/* Let task rows wrap controls/text on narrow screens */</span>
  <span class="nt">li</span><span class="p">{</span>
    <span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span>
    <span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span>
    <span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span><span class="m">.45rem</span> <span class="m">.3rem</span><span class="p">;</span>
    <span class="nl">border-bottom</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span>
    <span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">li</span><span class="nd">:focus</span><span class="p">{</span><span class="nl">outline</span><span class="p">:</span><span class="m">2px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--focus</span><span class="p">);</span><span class="nl">outline-offset</span><span class="p">:</span><span class="m">2px</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">8px</span><span class="p">}</span>
  <span class="nt">li</span><span class="nc">.done</span> <span class="nc">.txt</span><span class="p">{</span><span class="nl">text-decoration</span><span class="p">:</span><span class="nb">line-through</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--muted</span><span class="p">)}</span>
  <span class="nc">.txt</span><span class="p">{</span>
    <span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">;</span> <span class="c">/* avoid pushing buttons offscreen */</span>
    <span class="nl">outline</span><span class="p">:</span><span class="nb">none</span>
  <span class="p">}</span>
  <span class="nc">.txt</span><span class="nd">:focus</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">.1</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">4px</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">2px</span><span class="p">}</span>
  <span class="nc">.meta</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">8px</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">;</span><span class="nl">margin-top</span><span class="p">:</span><span class="m">10px</span><span class="p">}</span>
  <span class="nc">.small</span><span class="p">{</span><span class="nl">font-size</span><span class="p">:</span><span class="m">.9rem</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--muted</span><span class="p">)}</span>
  <span class="nc">.pill</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">.1rem</span> <span class="m">.5rem</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">999px</span><span class="p">}</span>
  <span class="nc">.share</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">inline-flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">}</span>
  <span class="nc">.offline</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span><span class="nl">margin</span><span class="p">:</span><span class="m">12px</span> <span class="m">0</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="m">#fffbcc</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="m">#333</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="m">#e0dca6</span><span class="p">}</span>
  <span class="nc">.offline.show</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="nb">block</span><span class="p">}</span>
  <span class="nc">.right</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="nb">auto</span><span class="p">}</span>
  <span class="nc">.kbd</span><span class="p">{</span><span class="nl">font-family</span><span class="p">:</span><span class="n">ui-monospace</span><span class="p">,</span> <span class="n">SFMono-Regular</span><span class="p">,</span> <span class="n">Menlo</span><span class="p">,</span> <span class="n">Consolas</span><span class="p">,</span> <span class="nb">monospace</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">.18</span><span class="p">);</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-bottom-color</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.3</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">6px</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">0</span> <span class="m">.3rem</span><span class="p">}</span>
  <span class="nc">.toolbar</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span><span class="nl">margin-bottom</span><span class="p">:</span><span class="m">.6rem</span><span class="p">}</span>
  <span class="nc">.chips</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.4rem</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">}</span>
  <span class="nc">.chip</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">.35rem</span> <span class="m">.6rem</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">999px</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--chip</span><span class="p">);</span><span class="nl">cursor</span><span class="p">:</span><span class="nb">pointer</span><span class="p">}</span>
  <span class="nc">.chip.active</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--chipA</span><span class="p">)}</span>
  <span class="nc">.drag</span><span class="p">{</span><span class="nl">cursor</span><span class="p">:</span><span class="n">grab</span><span class="p">;</span><span class="py">user-select</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--muted</span><span class="p">);</span><span class="nl">padding</span><span class="p">:</span><span class="m">0</span> <span class="m">.4rem</span><span class="p">}</span>
  <span class="nc">.count</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="m">.4rem</span><span class="p">}</span>
  <span class="nc">.status</span><span class="p">{</span><span class="nl">min-height</span><span class="p">:</span><span class="m">1.4rem</span><span class="p">}</span>
  <span class="nc">.status</span> <span class="nt">button</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="m">.5rem</span><span class="p">}</span>
  <span class="nc">.sr</span><span class="p">{</span><span class="nl">position</span><span class="p">:</span><span class="nb">absolute</span><span class="p">;</span><span class="nl">left</span><span class="p">:</span><span class="m">-9999px</span><span class="p">;</span><span class="nl">top</span><span class="p">:</span><span class="nb">auto</span><span class="p">;</span><span class="nl">width</span><span class="p">:</span><span class="m">1px</span><span class="p">;</span><span class="nl">height</span><span class="p">:</span><span class="m">1px</span><span class="p">;</span><span class="nl">overflow</span><span class="p">:</span><span class="nb">hidden</span><span class="p">;}</span>

  <span class="c">/* Keep drag handle/checkbox/delete visible; text fills remaining space */</span>
  <span class="nt">li</span> <span class="o">&gt;</span> <span class="nc">.drag</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">0</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">}</span>
  <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">checkbox</span><span class="o">]</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">0</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">}</span>
  <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="o">[</span><span class="nt">aria-label</span><span class="o">=</span><span class="s1">"Delete task"</span><span class="o">]</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">0</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">}</span>

  <span class="c">/* Defensive text wrapping to avoid horizontal scroll from long tokens/URLs */</span>
  <span class="nc">.wrap</span><span class="o">,</span> <span class="nc">.box</span><span class="o">,</span> <span class="nc">.txt</span><span class="o">,</span> <span class="nf">#title</span><span class="o">,</span> <span class="nf">#newtodo</span><span class="o">,</span> <span class="nf">#search</span><span class="o">,</span> <span class="nf">#shareUrl</span> <span class="p">{</span>
    <span class="nl">overflow-wrap</span><span class="p">:</span><span class="n">anywhere</span><span class="p">;</span>
    <span class="nl">word-break</span><span class="p">:</span><span class="n">break-word</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">/* --- Responsive layout --- */</span>
  <span class="c">/* Toolbar: allow the shortcuts block to wrap to its own line on small screens */</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">620px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.wrap</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">12px</span><span class="p">}</span>
    <span class="nc">.toolbar</span> <span class="nc">.row</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.toolbar</span> <span class="nc">.row.right</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">;</span> <span class="nl">order</span><span class="p">:</span><span class="m">2</span><span class="p">;</span> <span class="nl">font-size</span><span class="p">:</span><span class="m">.95rem</span><span class="p">}</span>
  <span class="p">}</span>

  <span class="c">/* Title + bulk actions row:
     - Title takes full width on narrow viewports
     - Buttons wrap to two columns, then single column on very narrow screens */</span>
  <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nf">#title</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">320px</span><span class="p">;</span> <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">820px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nf">#title</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">620px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nf">#title</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="p">{</span>
      <span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="n">calc</span><span class="p">(</span><span class="m">50%</span> <span class="n">-</span> <span class="m">.5rem</span><span class="p">);</span>
      <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">420px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
  <span class="p">}</span>

  <span class="c">/* Add/search/filter row: allow clean wrapping */</span>
  <span class="nf">#newtodo</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">2</span> <span class="m">1</span> <span class="m">260px</span><span class="p">;</span> <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">}</span>
  <span class="nf">#search</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">180px</span><span class="p">;</span> <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">620px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:nth-of-type</span><span class="o">(</span><span class="err">2</span><span class="o">)</span> <span class="o">&gt;</span> <span class="nf">#newtodo</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:nth-of-type</span><span class="o">(</span><span class="err">2</span><span class="o">)</span> <span class="o">&gt;</span> <span class="nf">#search</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.chips</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="c">/* Override inline max-widths so fields can span full width on small screens */</span>
    <span class="nf">#slug</span><span class="o">,</span> <span class="nf">#search</span><span class="o">,</span> <span class="nf">#shareUrl</span> <span class="p">{</span> <span class="nl">max-width</span><span class="p">:</span><span class="m">100%</span> <span class="cp">!important</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="c">/* List items: small screens may move Delete to next line neatly */</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">420px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nt">li</span><span class="p">{</span><span class="py">row-gap</span><span class="p">:</span><span class="m">.35rem</span><span class="p">}</span>
    <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="o">[</span><span class="nt">aria-label</span><span class="o">=</span><span class="s1">"Delete task"</span><span class="o">]</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="nb">auto</span><span class="p">}</span>
  <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrap"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toolbar"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">style=</span><span class="s">"flex:1;gap:.5rem"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small pill"</span><span class="nt">&gt;</span>Board<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"slug"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$boardSlug</span><span class="p">,</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">aria-label=</span><span class="s">"Board slug"</span> <span class="na">style=</span><span class="s">"max-width:240px"</span> <span class="na">list=</span><span class="s">"boards"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">"boards"</span><span class="nt">&gt;&lt;/datalist&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"switch"</span> <span class="na">title=</span><span class="s">"Open board by slug"</span><span class="nt">&gt;</span>Open<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"newBoard"</span> <span class="na">title=</span><span class="s">"Create a new random board"</span><span class="nt">&gt;</span>New<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row right"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small"</span><span class="nt">&gt;</span>Shortcuts: <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>Enter<span class="nt">&lt;/span&gt;</span> add/edit, <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>Esc<span class="nt">&lt;/span&gt;</span> cancel, <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>Ctrl<span class="nt">&lt;/span&gt;</span>+<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>/<span class="nt">&lt;/span&gt;</span> focus<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"offline"</span> <span class="na">class=</span><span class="s">"offline"</span> <span class="na">role=</span><span class="s">"status"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;</span>You are offline. Changes will queue and sync when back online.<span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"box"</span> <span class="na">aria-label=</span><span class="s">"Todo app"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">style=</span><span class="s">"margin-bottom:.6rem"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"title"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"My Todo"</span> <span class="na">aria-label=</span><span class="s">"List title"</span> <span class="na">title=</span><span class="s">"Title (Enter to save, Esc to cancel)"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"saveTitle"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">title=</span><span class="s">"Save title"</span><span class="nt">&gt;</span>Save title<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"toggleAll"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">title=</span><span class="s">"Toggle all tasks"</span><span class="nt">&gt;</span>Complete all<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"clearDone"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">title=</span><span class="s">"Remove completed tasks"</span><span class="nt">&gt;</span>Clear completed<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"clearAll"</span> <span class="na">class=</span><span class="s">"warn"</span> <span class="na">title=</span><span class="s">"Remove all tasks"</span><span class="nt">&gt;</span>Clear all<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">style=</span><span class="s">"margin-bottom:.6rem"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"newtodo"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Add a task"</span> <span class="na">autofocus</span> <span class="na">aria-label=</span><span class="s">"New task"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"add"</span><span class="nt">&gt;</span>Add<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"search"</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">placeholder=</span><span class="s">"Search"</span> <span class="na">aria-label=</span><span class="s">"Search tasks"</span> <span class="na">style=</span><span class="s">"max-width:240px"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chips"</span> <span class="na">role=</span><span class="s">"tablist"</span> <span class="na">aria-label=</span><span class="s">"Filter tasks"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"chip active"</span> <span class="na">data-filter=</span><span class="s">"all"</span> <span class="na">role=</span><span class="s">"tab"</span> <span class="na">aria-selected=</span><span class="s">"true"</span><span class="nt">&gt;</span>All<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"chip"</span> <span class="na">data-filter=</span><span class="s">"active"</span> <span class="na">role=</span><span class="s">"tab"</span> <span class="na">aria-selected=</span><span class="s">"false"</span><span class="nt">&gt;</span>Active<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"chip"</span> <span class="na">data-filter=</span><span class="s">"done"</span> <span class="na">role=</span><span class="s">"tab"</span> <span class="na">aria-selected=</span><span class="s">"false"</span><span class="nt">&gt;</span>Completed<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"list"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;&lt;/ul&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small"</span><span class="nt">&gt;</span>Share this board URL:<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"shareUrl"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">readonly</span> <span class="na">style=</span><span class="s">"max-width:380px"</span> <span class="na">aria-label=</span><span class="s">"Share URL"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"copy"</span><span class="nt">&gt;</span>Copy<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small count"</span> <span class="na">id=</span><span class="s">"counts"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small right"</span> <span class="na">id=</span><span class="s">"updated"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small"</span><span class="nt">&gt;</span>Share this board URL:<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"shareUrl"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">readonly</span> <span class="na">style=</span><span class="s">"max-width:380px"</span> <span class="na">aria-label=</span><span class="s">"Share URL"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"copy"</span><span class="nt">&gt;</span>Copy<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small count"</span> <span class="na">id=</span><span class="s">"counts"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small right"</span> <span class="na">id=</span><span class="s">"updated"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"status small"</span> <span class="na">id=</span><span class="s">"status"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"undo"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">style=</span><span class="s">"display:none"</span><span class="nt">&gt;</span>Undo<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"sr"</span> <span class="na">id=</span><span class="s">"srmsg"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="kd">const</span> <span class="nx">origin</span> <span class="o">=</span> <span class="cp">&lt;?=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$origin</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">bid</span> <span class="o">=</span> <span class="cp">&lt;?=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$boardSlug</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#list</span><span class="dl">'</span><span class="p">),</span> <span class="nx">input</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newtodo</span><span class="dl">'</span><span class="p">),</span> <span class="nx">title</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#title</span><span class="dl">'</span><span class="p">),</span> <span class="nx">statusEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#status</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">offlineBanner</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#offline</span><span class="dl">'</span><span class="p">),</span> <span class="nx">slugInput</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#slug</span><span class="dl">'</span><span class="p">),</span> <span class="nx">shareUrl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#shareUrl</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">countsEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#counts</span><span class="dl">'</span><span class="p">),</span> <span class="nx">updatedEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#updated</span><span class="dl">'</span><span class="p">),</span> <span class="nx">undoBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#undo</span><span class="dl">'</span><span class="p">),</span> <span class="nx">srmsg</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#srmsg</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">chips</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.chip</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">boardsDL</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#boards</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">boardETag</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">boardLastMod</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">isSyncing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">boardData</span> <span class="o">=</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span><span class="dl">'</span><span class="s1">My Todo</span><span class="dl">'</span><span class="p">,</span> <span class="na">tasks</span><span class="p">:[],</span> <span class="na">created</span><span class="p">:</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="o">|</span><span class="mi">0</span><span class="p">,</span> <span class="na">updated</span><span class="p">:</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="o">|</span><span class="mi">0</span><span class="p">};</span>
<span class="kd">let</span> <span class="nx">filter</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_filter</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">searchQuery</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_search</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">pendingEdit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// {id, orig}</span>
<span class="kd">let</span> <span class="nx">lastAction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// for undo</span>
<span class="kd">let</span> <span class="nx">undoTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">outboxKey</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`memor_outbox_</span><span class="p">${</span><span class="nx">b</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">recentBoardsKey</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">memor_recent_boards_v1</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Register SW</span>
<span class="k">if </span><span class="p">(</span><span class="dl">'</span><span class="s1">serviceWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">/?asset=sw</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">scope</span><span class="p">:</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Online/offline indicators</span>
<span class="kd">function</span> <span class="nf">updateOnlineUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">online</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nf">updateOnlineUI</span><span class="p">();</span> <span class="nf">flushOutbox</span><span class="p">();</span> <span class="nf">fetchBoard</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="p">});</span>
<span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">offline</span><span class="dl">'</span><span class="p">,</span> <span class="nx">updateOnlineUI</span><span class="p">);</span>
<span class="nf">updateOnlineUI</span><span class="p">();</span>

<span class="c1">// Copy/share URL setup</span>
<span class="kd">const</span> <span class="nx">boardURL</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">origin</span><span class="p">}</span><span class="s2">/?b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">bid</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
<span class="nx">shareUrl</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">boardURL</span><span class="p">;</span>
<span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#copy</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">clipboard</span><span class="p">.</span><span class="nf">writeText</span><span class="p">(</span><span class="nx">boardURL</span><span class="p">);</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Copied link</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Copy failed</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Helper: small status message</span>
<span class="kd">let</span> <span class="nx">flashTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">function</span> <span class="nf">flash</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">persistMs</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">clearTimeout</span><span class="p">(</span><span class="nx">flashTimer</span><span class="p">);</span>
  <span class="nx">statusEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">persistMs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flashTimer</span> <span class="o">=</span> <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">statusEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">''</span><span class="p">,</span> <span class="nx">persistMs</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">srmsg</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Undo handling</span>
<span class="kd">function</span> <span class="nf">showUndo</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">lastAction</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span> <span class="c1">// {type, payload}</span>
  <span class="nx">undoBtn</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">inline-block</span><span class="dl">'</span><span class="p">;</span>
  <span class="nf">clearTimeout</span><span class="p">(</span><span class="nx">undoTimer</span><span class="p">);</span>
  <span class="nx">undoTimer</span> <span class="o">=</span> <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nf">hideUndo</span><span class="p">();</span> <span class="p">},</span> <span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">hideUndo</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">lastAction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">undoBtn</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">undoBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">lastAction</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">act</span> <span class="o">=</span> <span class="nx">lastAction</span><span class="p">;</span>
  <span class="nf">hideUndo</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">act</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">act</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="k">await</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">add</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">});</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Undid delete</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">act</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">clear_done</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">t</span> <span class="k">of</span> <span class="nx">act</span><span class="p">.</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">add</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Restored completed</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Render helpers</span>
<span class="kd">function</span> <span class="nf">fmtRelTime</span><span class="p">(</span><span class="nx">ts</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span> <span class="o">-</span> <span class="nx">ts</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">just now</span><span class="dl">'</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">s</span><span class="p">}</span><span class="s2">s ago`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">s</span><span class="o">/</span><span class="mi">60</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">m</span><span class="p">}</span><span class="s2">m ago`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">m</span><span class="o">/</span><span class="mi">60</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">h</span><span class="p">}</span><span class="s2">h ago`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">h</span><span class="o">/</span><span class="mi">24</span><span class="p">);</span>
  <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">d</span><span class="p">}</span><span class="s2">d ago`</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">updateMeta</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">activeCount</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">||</span> <span class="p">[]).</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">total</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">countsEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">total</span> <span class="p">?</span> <span class="s2">`</span><span class="p">${</span><span class="nx">activeCount</span><span class="p">}</span><span class="s2"> item</span><span class="p">${</span><span class="nx">activeCount</span><span class="o">!==</span><span class="mi">1</span><span class="p">?</span><span class="dl">'</span><span class="s1">s</span><span class="dl">'</span><span class="p">:</span><span class="dl">''</span><span class="p">}</span><span class="s2"> left • </span><span class="p">${</span><span class="nx">total</span><span class="p">}</span><span class="s2"> total`</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">No tasks</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">updatedEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Updated </span><span class="p">${</span><span class="nf">fmtRelTime</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">updated</span><span class="o">||</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="o">|</span><span class="mi">0</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#toggleAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">activeCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Complete all</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Uncheck all</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Filtering</span>
<span class="kd">function</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">tasks</span><span class="p">.</span><span class="nf">slice</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">q</span> <span class="o">=</span> <span class="p">(</span><span class="nx">searchQuery</span><span class="o">||</span><span class="dl">''</span><span class="p">).</span><span class="nf">toLowerCase</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">q</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="o">||</span><span class="dl">''</span><span class="p">).</span><span class="nf">toLowerCase</span><span class="p">().</span><span class="nf">includes</span><span class="p">(</span><span class="nx">q</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">arr</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">updateFilterUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">chips</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">ch</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="nx">ch</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-filter</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="nx">filter</span><span class="p">;</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">toggle</span><span class="p">(</span><span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">,</span> <span class="nx">isActive</span><span class="p">);</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">aria-selected</span><span class="dl">'</span><span class="p">,</span> <span class="nx">isActive</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">false</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#search</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">searchQuery</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">reorderAllowed</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">searchQuery</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Recent boards</span>
<span class="kd">function</span> <span class="nf">pushRecentBoard</span><span class="p">(</span><span class="nx">slug</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">recentBoardsKey</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">raw</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">raw</span><span class="p">)</span> <span class="p">:</span> <span class="p">[];</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span> <span class="o">!==</span> <span class="nx">slug</span><span class="p">);</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nf">unshift</span><span class="p">(</span><span class="nx">slug</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">recentBoardsKey</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span>
    <span class="nf">renderBoardsList</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">renderBoardsList</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">recentBoardsKey</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">raw</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">raw</span><span class="p">)</span> <span class="p">:</span> <span class="p">[];</span>
    <span class="nx">boardsDL</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="s2">`&lt;option value="</span><span class="p">${</span><span class="nx">s</span><span class="p">}</span><span class="s2">"&gt;&lt;/option&gt;`</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Render board</span>
<span class="kd">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">boardData</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
  <span class="nx">title</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">My Todo</span><span class="dl">'</span><span class="p">;</span>
  <span class="nf">updateMeta</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
  <span class="nf">renderBoardsList</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">tasks</span> <span class="o">=</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">||</span> <span class="p">[]);</span>
  <span class="nx">list</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">allowDrag</span> <span class="o">=</span> <span class="nf">reorderAllowed</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">allowDrag</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-drag-disabled</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nf">removeAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-drag-disabled</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">tasks</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">li</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">tabindex</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span> <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">draggable</span> <span class="o">=</span> <span class="nx">allowDrag</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
      <span class="s2">`&lt;span class="drag" title="</span><span class="p">${</span><span class="nx">allowDrag</span><span class="p">?</span><span class="dl">'</span><span class="s1">Drag to reorder</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">Reorder disabled while filtering/searching</span><span class="dl">'</span><span class="p">}</span><span class="s2">"&gt;⋮⋮&lt;/span&gt;
       &lt;input type="checkbox" </span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">?</span><span class="dl">'</span><span class="s1">checked</span><span class="dl">'</span><span class="p">:</span><span class="dl">''</span><span class="p">}</span><span class="s2"> data-id="</span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">" aria-label="Mark task done"&gt;
       &lt;span class="txt" contenteditable="true" data-id="</span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">" spellcheck="false" role="textbox" aria-multiline="false"&gt;&lt;/span&gt;
       &lt;button class="secondary" data-del="</span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">" aria-label="Delete task"&gt;Delete&lt;/button&gt;`</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.txt</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>

    <span class="c1">// Drag events</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">allowDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragstart</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nf">setData</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragging</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragend</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragging</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragover</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">dragging</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.dragging</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">dragging</span> <span class="o">||</span> <span class="nx">dragging</span> <span class="o">===</span> <span class="nx">li</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">getBoundingClientRect</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">before</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">list</span><span class="p">.</span><span class="nf">insertBefore</span><span class="p">(</span><span class="nx">dragging</span><span class="p">,</span> <span class="nx">before</span> <span class="p">?</span> <span class="nx">li</span> <span class="p">:</span> <span class="nx">li</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">drop</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">order</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">)).</span><span class="nf">map</span><span class="p">(</span><span class="nx">node</span> <span class="o">=&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">await</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">reorder</span><span class="dl">'</span><span class="p">,</span> <span class="nx">order</span><span class="p">});</span>
        <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Reordered</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">list</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Fetch with ETag support</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">fetchBoard</span><span class="p">(</span><span class="nx">force</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`?action=fetch&amp;b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">bid</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">boardETag</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">If-None-Match</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">boardETag</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">boardLastMod</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">If-Modified-Since</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">boardLastMod</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span><span class="nx">headers</span><span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Network error</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
    <span class="nx">boardETag</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">ETag</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">boardLastMod</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">Last-Modified</span><span class="dl">'</span><span class="p">);</span>
    <span class="nf">render</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
    <span class="nf">pushRecentBoard</span><span class="p">(</span><span class="nx">bid</span><span class="p">);</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Loaded</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Offline (cached view)</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Queue ops if offline/errors</span>
<span class="kd">function</span> <span class="nf">queueOp</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nf">outboxKey</span><span class="p">(</span><span class="nx">bid</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">[]</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">arr</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span>
  <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Flush queued ops</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">flushOutbox</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">isSyncing</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nf">outboxKey</span><span class="p">(</span><span class="nx">bid</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">[]</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="o">!</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="nx">isSyncing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">while </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">await</span> <span class="nf">op</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span><span class="na">silent</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nf">shift</span><span class="p">();</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
      <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Synced</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
      <span class="nf">fetchBoard</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// keep queue for retry</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">isSyncing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Perform operation</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">op</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="s2">`?b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">bid</span><span class="p">)}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">},</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
    <span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Bad response</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="nf">render</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">queueOp</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Queued (offline)</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Event handlers</span>
<span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">DOMContentLoaded</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Initialize filter UI</span>
  <span class="nx">chips</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">ch</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">filter</span> <span class="o">=</span> <span class="nx">ch</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-filter</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_filter</span><span class="dl">'</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
      <span class="nf">updateFilterUI</span><span class="p">();</span>
      <span class="nf">render</span><span class="p">(</span><span class="nx">boardData</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#search</span><span class="dl">'</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">searchQuery</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nf">trim</span><span class="p">();</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_search</span><span class="dl">'</span><span class="p">,</span> <span class="nx">searchQuery</span><span class="p">);</span>
    <span class="nf">render</span><span class="p">(</span><span class="nx">boardData</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nf">updateFilterUI</span><span class="p">();</span>

  <span class="k">await</span> <span class="nf">fetchBoard</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">await</span> <span class="nf">flushOutbox</span><span class="p">();</span>

  <span class="c1">// Add new task</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#add</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nf">trim</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">add</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">v</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="dl">''</span><span class="p">;</span> <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Added</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">input</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#add</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Escape</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="dl">''</span><span class="p">;</span> <span class="nx">input</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span> <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Title save/cancel</span>
  <span class="kd">let</span> <span class="nx">titleOrig</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="nx">title</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">focus</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">titleOrig</span> <span class="o">=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="p">});</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveTitle</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">ttl</span> <span class="o">=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nf">trim</span><span class="p">()</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">My Todo</span><span class="dl">'</span><span class="p">;</span>
    <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="nx">ttl</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved</span><span class="dl">'</span><span class="p">,</span> <span class="mi">900</span><span class="p">));</span>
  <span class="p">};</span>
  <span class="nx">title</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveTitle</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">();</span> <span class="nx">title</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Escape</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nx">title</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">titleOrig</span><span class="p">;</span> <span class="nx">title</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Canceled</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">title</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">blur</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveTitle</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">());</span>

  <span class="c1">// Bulk buttons</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#clearDone</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cleared</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span><span class="o">=&gt;</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">cleared</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">No completed tasks</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">clear_done</span><span class="dl">'</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cleared completed</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="nf">showUndo</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">clear_done</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">cleared</span><span class="p">});</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#clearAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">total</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">No tasks to clear</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">confirm</span><span class="p">(</span><span class="s2">`Delete all </span><span class="p">${</span><span class="nx">total</span><span class="p">}</span><span class="s2"> tasks?`</span><span class="p">))</span> <span class="p">{</span>
      <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">clear_all</span><span class="dl">'</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">All cleared</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#toggleAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">anyActive</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">some</span><span class="p">(</span><span class="nx">t</span><span class="o">=&gt;!</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
    <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">set_all</span><span class="dl">'</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="nx">anyActive</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="nx">anyActive</span><span class="p">?</span><span class="dl">'</span><span class="s1">Completed all</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">Unchecked all</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="c1">// Switch/open board by slug</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#switch</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">slugInput</span><span class="p">.</span><span class="nx">value</span><span class="o">||</span><span class="dl">''</span><span class="p">).</span><span class="nf">trim</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">s</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">origin</span><span class="p">}</span><span class="s2">/?b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">s</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newBoard</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">origin</span><span class="p">}</span><span class="s2">/?action=new`</span><span class="p">;</span>

  <span class="c1">// Global keyboard</span>
  <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">n</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">!==</span> <span class="nx">input</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">!==</span> <span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// List interactions</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">checkbox</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">toggle</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">});</span> <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-del</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">find</span><span class="p">(</span><span class="nx">x</span><span class="o">=&gt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="o">===</span><span class="nx">id</span><span class="p">);</span>
      <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Deleted</span><span class="dl">'</span><span class="p">,</span> <span class="mi">900</span><span class="p">);</span> <span class="k">if </span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="nf">showUndo</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">t</span><span class="p">});</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// List keyboard (item-level)</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">closest</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">li</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="c1">// Per-item shortcuts when LI itself is focused</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">li</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="kd">const</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[type=checkbox]</span><span class="dl">'</span><span class="p">);</span> <span class="k">if </span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="o">!</span><span class="nx">cb</span><span class="p">.</span><span class="nx">checked</span><span class="p">;</span> <span class="nx">cb</span><span class="p">.</span><span class="nf">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nc">Event</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">));</span> <span class="p">}</span> <span class="p">}</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Delete</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Backspace</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-del]</span><span class="dl">'</span><span class="p">)?.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-del</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">find</span><span class="p">(</span><span class="nx">x</span><span class="o">=&gt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="o">===</span><span class="nx">id</span><span class="p">);</span>
          <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Deleted</span><span class="dl">'</span><span class="p">,</span> <span class="mi">900</span><span class="p">);</span> <span class="k">if </span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="nf">showUndo</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">t</span><span class="p">});</span> <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">e</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.txt</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span> <span class="nx">txt</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Contenteditable shortcuts</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">txt</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="c1">// commit on blur</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Escape</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">pendingEdit</span> <span class="o">&amp;&amp;</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">orig</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span>
        <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Canceled</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Tab</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">els</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.txt</span><span class="dl">'</span><span class="p">));</span>
        <span class="kd">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">els</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">els</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">)];</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="nx">next</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Inline edit lifecycle (commit-on-blur if changed)</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">focusin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">txt</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">pendingEdit</span> <span class="o">=</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">),</span> <span class="na">orig</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span> <span class="p">};</span>
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createRange</span><span class="p">();</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">selectNodeContents</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">collapse</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">sel</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nf">getSelection</span><span class="p">();</span>
      <span class="nx">sel</span><span class="p">.</span><span class="nf">removeAllRanges</span><span class="p">();</span>
      <span class="nx">sel</span><span class="p">.</span><span class="nf">addRange</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">blur</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">txt</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span><span class="p">.</span><span class="nf">trim</span><span class="p">();</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">pendingEdit</span> <span class="o">&amp;&amp;</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">text</span> <span class="o">!==</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">orig</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">edit</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">pendingEdit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Initialize UI state</span>
<span class="p">(</span><span class="kd">function</span> <span class="nf">initUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">updateFilterUI</span><span class="p">();</span>
<span class="p">})();</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">Galaxy A34 custom ROM</title><link href="https://ib.bsb.br/galaxy-a34-custom-rom/" rel="alternate" type="text/html" title="Galaxy A34 custom ROM" /><published>2025-08-30T00:00:00+00:00</published><updated>2025-08-30T17:42:21+00:00</updated><id>https://ib.bsb.br/galaxy-a34-custom-rom</id><content type="html" xml:base="https://ib.bsb.br/galaxy-a34-custom-rom/"><![CDATA[<p>1) Device identification (from your screenshots)</p>
<ul>
  <li>Manufacturer: Samsung</li>
  <li>Model: Galaxy A34 5G</li>
  <li>Exact model number: SM‑A346M/DSN (Dual SIM; CSC ZTO indicates Brazil open market)</li>
  <li>Software shown: Android 15; One UI 7.0; Android security patch: 1 July 2025; Build/baseband series A346M…DYG1; Phone status: “Oficial” (bootloader not unlocked)</li>
  <li>Likely codename: a34x (confirm with: adb shell getprop ro.product.device and ro.product.vendor.device)</li>
  <li>SoC: MediaTek Dimensity 1080 (relevant for aftermarket support constraints)</li>
</ul>

<p>2) Core concepts and how they relate to custom ROMs</p>
<ul>
  <li>Bootloader unlocking: Removes OEM signature enforcement so unsigned images can boot. On Samsung, unlocking is official, wipes data, and permanently trips KNOX (0x1), disabling Samsung Wallet, Secure Folder, and some enterprise features.</li>
  <li>Recovery (stock vs custom): Stock recovery is limited. Custom recovery (e.g., TWRP) enables flashing images/ZIPs, Nandroid backups, and advanced wipes. Samsung devices use Download Mode + Odin/Heimdall for flashing; they do not have standard fastboot.</li>
  <li>Root (Magisk): Optional and independent from installing a ROM/GSI. Commonly done by patching the boot image. Root can help with app workarounds (DenyList) but may affect Play Integrity and security posture.</li>
  <li>AVB/dm‑verity (vbmeta): Verified Boot enforces integrity. Running a GSI often requires disabling verification (flashing a vbmeta with verification/verity disabled).</li>
  <li>Odin/Heimdall vs fastboot: Samsung requires Odin (Windows) or Heimdall (open-source, sometimes less reliable on newer devices). Standard fastboot commands are not available.</li>
</ul>

<p>3) Compatible custom OS options for SM‑A346M</p>
<ul>
  <li>Android-based GSIs (Treble, arm64-ab images):
• PixelOS / Pixel Experience GSI (Pixel-like UX with GMS)
• LineageOS GSI (AOSP-based with Lineage extras; GApps optional)
• PHH AOSP GSI (baseline reference GSI)
• Evolution X GSI (Pixel base with extensive customization)
Notes: Hardware support depends on Samsung’s vendor; common gaps include IMS/VoLTE/VoWiFi, advanced camera features, fingerprint behavior, NFC.</li>
  <li>Stock-based One UI “debloated”/modded ROMs (if available for A346x):
• Built from Samsung firmware; retain most hardware features; fewer UX changes; still require unlocking (KNOX 0x1).</li>
  <li>Linux-based mobile OS:
• Ubuntu Touch and postmarketOS: No known stable, daily-driver ports for Galaxy A34 5G as of commonly available project device lists. Treat any claims as experimental; expect missing telephony/camera/sensors.</li>
</ul>

<p>4) Comparative analysis (features/stability/usability/community)</p>
<ul>
  <li>PixelOS / Pixel Experience GSI
• Features/stability/performance: Pixel UX with integrated Google apps; often polished if vendor supports essentials; potential gaps in IMS/camera/UDFPS on Samsung MTK.
• Install/user-friendliness: Moderate; similar to other GSIs; out-of-box usability can be high if core hardware works.
• Development/community: Active projects; GSI tracks vary by maintainer; broad generic support, fewer device-specific fixes.</li>
  <li>LineageOS GSI
• Features/stability/performance: Clean AOSP+Lineage features; good performance; similar device-specific caveats.
• Install/user-friendliness: Moderate; GApps optional; privacy-friendly.
• Development/community: Strong lineage ecosystem; GSI builds are community-driven; support depends on maintainer.</li>
  <li>PHH AOSP GSI
• Features/stability/performance: Baseline GSI; often gets treble fixes early; performance good when hardware cooperates.
• Install/user-friendliness: Moderate; good for testing baseline compatibility.
• Development/community: Very active upstream; device-specific contributions vary.</li>
  <li>Evolution X GSI
• Features/stability/performance: Extensive customization atop Pixel base; may introduce additional complexity.
• Install/user-friendliness: Moderate; more toggles/settings in daily use.
• Development/community: Generally active; verify current GSI status for A34 specifically.</li>
  <li>Stock-based One UI debloated ROMs (A346x)
• Features/stability/performance: Highest chance of keeping camera quality, IMS, fingerprint reliability; performance similar/slightly better due to debloat.
• Install/user-friendliness: Often simpler via Odin; closest to stock daily experience.
• Development/community: Availability varies; fewer device-specific ROMs for Samsung MTK midrange vs Snapdragon flagships.</li>
</ul>

<p>5) General high-level installation procedure (Samsung-specific), including a concrete PixelOS GSI path
Preparation</p>
<ul>
  <li>Back up all data (unlocking wipes device).</li>
  <li>Battery ≥70%. Install Android Platform-Tools (adb), Samsung USB Driver, Odin (Windows) or Heimdall (Linux/macOS).</li>
  <li>Download full stock firmware for SM‑A346M with your CSC (e.g., ZTO) to allow recovery if needed.</li>
  <li>Enable Developer options; toggle OEM unlocking (may require network connection and time).</li>
</ul>

<p>Unlock bootloader (irreversible KNOX 0x1)</p>
<ul>
  <li>Power off. Enter Download Mode (hold Volume Up + Volume Down while connecting USB).</li>
  <li>Long-press Volume Up to unlock; confirm. Device wipes and reboots.</li>
  <li>Minimal setup; verify OEM unlocking shows unlocked.</li>
</ul>

<p>Low-risk test (if available): DSU Loader</p>
<ul>
  <li>Developer options → DSU Loader: temporarily boot a PixelOS/PHH GSI without permanent flashing. Test telephony, data, Wi‑Fi/BT, camera, fingerprint. Note: DSU availability may be limited by firmware.</li>
</ul>

<p>Concrete install: PixelOS GSI via TWRP (requires verified working TWRP for a34x)</p>
<ul>
  <li>Flash TWRP with Odin
• Download Mode → Odin: Options: check F. Reset Time; uncheck Auto Reboot.
• AP: select TWRP .tar for a34x → Start → PASS.
• Exit Download Mode (Vol Down + Power), then immediately boot to recovery (Vol Up + Power) to prevent stock recovery restore.</li>
  <li>In TWRP: prepare data
• Allow modifications → Wipe → Format Data (type yes) → Reboot → Recovery.</li>
  <li>Disable AVB/verity (vbmeta)
• On PC with avbtool:
    <ul>
      <li>avbtool make_vbmeta_image –output vbmeta_disabled.img –disable_verification –disable_verity</li>
      <li>tar -H ustar -cvf vbmeta_disabled.tar vbmeta_disabled.img (rename inside tar to vbmeta.img if needed by your Odin packaging)
• Reboot phone to Download Mode from TWRP → Odin AP: select vbmeta_disabled.tar → Start → PASS.
• Boot back to TWRP (timed key combo as above).</li>
    </ul>
  </li>
  <li>Flash PixelOS GSI
• Copy PixelOS system.img (arm64-ab) to phone (MTP or adb push).
• TWRP → Install → Install Image → select system.img → choose System Image → swipe to flash.
• (Optional) Wipe → Advanced Wipe → Dalvik/ART Cache and Cache.
• Reboot → System. First boot may take 10–15 minutes.</li>
  <li>Post-install checks
• Test calls/SMS, mobile data/APN, Wi‑Fi/BT/GPS, cameras, mic/speakers, UDFPS, NFC, sensors, IMS (VoLTE/VoWiFi), Play Integrity/DRM apps.</li>
  <li>Updates (dirty flash)
• Reboot to TWRP → Install Image → flash new PixelOS system.img to System Image → wipe Dalvik/Cache (optional) → reboot.</li>
  <li>Rollback to stock
• Download Mode → Odin: flash stock BL/AP/CP/CSC (use CSC to full-wipe if necessary) → Start → PASS → reboot. KNOX remains 0x1 permanently.</li>
</ul>

<p>If no verified TWRP exists for a34x</p>
<ul>
  <li>Do not proceed with full flashing. Use DSU to evaluate GSIs. Avoid manual super partition repacks unless following a trusted, device-specific guide; risk of hard brick is high.</li>
</ul>

<p>6) Significant risks</p>
<ul>
  <li>KNOX 0x1: Permanent; disables Samsung Wallet, Secure Folder, some enterprise features even after relocking.</li>
  <li>Warranty/service: Likely voided by unlocking/rooting.</li>
  <li>Bricking: Soft bricks recoverable via Odin; hard bricks (no Download Mode) may require hardware repair.</li>
  <li>Data loss: Unlocking and some flashes wipe data.</li>
  <li>Functionality regressions on GSIs: IMS/VoLTE/VoWiFi, advanced camera features, UDFPS, NFC, and DRM levels may degrade or fail.</li>
  <li>Security posture: Verified Boot guarantees weakened; Play Integrity may fail; some banking/streaming apps may not work.</li>
  <li>EFS/modem risk: Do not touch EFS/modem partitions; corruption can break IMEI/baseband.</li>
</ul>

<p>7) Device-specific resources (verify current status for A34 5G/SM‑A346x)</p>
<ul>
  <li>XDA Developers forums (search device-specific threads): https://forum.xda-developers.com/</li>
  <li>TWRP devices list (check if A34 5G is supported): https://twrp.me/Devices/</li>
  <li>PHH Treble docs/issues (GSI guidance): https://github.com/phhusson/treble_experimentations</li>
  <li>Android Platform-Tools (adb): https://developer.android.com/tools/releases/platform-tools</li>
  <li>Odin (Windows; obtain from reputable sources) and Samsung USB Driver (Samsung support portals)</li>
  <li>Heimdall (open-source flashing tool): https://github.com/Benjamin-Dobell/Heimdall</li>
  <li>Ubuntu Touch devices: https://devices.ubuntu-touch.io/</li>
  <li>postmarketOS devices: https://wiki.postmarketos.org/wiki/Devices</li>
  <li>Stock firmware (for recovery): use reputable firmware repositories for SM‑A346M with your CSC (e.g., ZTO)</li>
</ul>

<p>ABNT-style references</p>
<ul>
  <li>GOOGLE. Android Platform-Tools (adb). Available at: <a href="https://developer.android.com/tools/releases/platform-tools">https://developer.android.com/tools/releases/platform-tools</a>. Accessed on: 30 August 2025.</li>
  <li>TWRP. Team Win Recovery Project – Devices. Available at: <a href="https://twrp.me/Devices/">https://twrp.me/Devices/</a>. Accessed on: 30 August 2025.</li>
  <li>XDA DEVELOPERS. Forums. Available at: <a href="https://forum.xda-developers.com/">https://forum.xda-developers.com/</a>. Accessed on: 30 August 2025.</li>
  <li>PHHUSSON. Treble Experimentations. Available at: <a href="https://github.com/phhusson/treble_experimentations">https://github.com/phhusson/treble_experimentations</a>. Accessed on: 30 August 2025.</li>
  <li>HEIMDALL. Heimdall flashing tool. Available at: <a href="https://github.com/Benjamin-Dobell/Heimdall">https://github.com/Benjamin-Dobell/Heimdall</a>. Accessed on: 30 August 2025.</li>
  <li>UBPORTS. Ubuntu Touch devices. Available at: <a href="https://devices.ubuntu-touch.io/">https://devices.ubuntu-touch.io/</a>. Accessed on: 30 August 2025.</li>
  <li>POSTMARKETOS. Devices list. Available at: <a href="https://wiki.postmarketos.org/wiki/Devices">https://wiki.postmarketos.org/wiki/Devices</a>. Accessed on: 30 August 2025.</li>
</ul>

<p>8) Synthesis and recommendation (balancing Linux interest with stability)</p>
<ul>
  <li>If you prioritize stability and full hardware support: stay on stock One UI or consider a reputable stock-based debloated ROM for A346x (if available). Best chance to retain camera quality, IMS/VoLTE, fingerprint reliability, and DRM levels.</li>
  <li>If you want a different UX and accept trade-offs: trial PixelOS/Pixel Experience or LineageOS GSIs via DSU if available. If essential functions work, proceed with the TWRP-based PixelOS GSI installation flow above, including vbmeta disable. Expect potential IMS/camera/UDFPS quirks.</li>
  <li>Linux OS: For A34 5G, treat Ubuntu Touch/postmarketOS as experimental/unavailable for daily use; consider a secondary, well-supported device if mobile Linux is a primary goal.</li>
</ul>

<p>Critical precautions</p>
<ul>
  <li>Back up thoroughly; unlocking wipes data.</li>
  <li>Understand KNOX 0x1 is permanent.</li>
  <li>Keep full stock firmware for SM‑A346M (your CSC) ready for Odin recovery.</li>
  <li>Verify any recovery/ROM is explicitly for a34x/SM‑A346x; avoid cross-device images.</li>
  <li>Verify checksums; download only from original maintainer sources.</li>
  <li>Test essentials immediately after flashing; if critical features fail, roll back to stock.</li>
</ul>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">sagemcom 5670 router</title><link href="https://ib.bsb.br/sagemcom-5670-router/" rel="alternate" type="text/html" title="sagemcom 5670 router" /><published>2025-08-21T00:00:00+00:00</published><updated>2025-08-21T14:04:08+00:00</updated><id>https://ib.bsb.br/sagemcom-5670-router</id><content type="html" xml:base="https://ib.bsb.br/sagemcom-5670-router/"><![CDATA[<section class="code-block-container" role="group" aria-label="Xml Code Block" data-filename="xml_code_block.xml" data-code="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;opml version=&quot;2.0&quot;&gt;
&lt;head&gt;&lt;title&gt;router&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;outline text=&quot;&quot;&gt;&lt;outline text=&quot;Logged in as   admin
Logout
Welcome to F@st 5670
Click to refresh 
F@st 5670
Settings
Configure DHCP, NTP, DynDNS

Access Control
Settings
Configure Firewall, DMZ, Remote Access.

Internet Connectivity
Settings
Status:  Connected
My Media
Ethernet
Settings
192.168.1.12

IP: 192.168.1.12


USB
MARIOUSB

Used: 0.01 Gb / 58.59 Gb

Wi-Fi 2.4GHz
Settings
SSID Name: VIII2
Speed: 1800 Mbit/s

There are no connected devices

Guests
Settings
SSID Name: GUEST_3EF0_2G


There are no connected devices

Wi-Fi 5GHz
Settings
SSID Name: VIII5
Speed: 7200 Mbit/s

There are no connected devices

Guests
Settings
SSID Name: GUEST_3EF0_5G


There are no connected devices

Voice Ports
There are no enabled lines

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
General
DHCP Leases
ARP
Device Info
Serial Number	OC25182TM001203
Hardware Version	2.00
Software Version	SGFP10000111
GUI Version	5.102.0
UpTime	01h43m55s
Datapump Version	
WAN MAC Address	E4:C0:E2:EC:3E:F0
Network
Local IPv4 Address	192.168.1.1
Local Subnet Mask	255.255.255.0
Local Ethernet Mac address	E4:C0:E2:EC:3E:F7
Public IPv4 Address	191.122.198.252
Public Subnet Mask	255.255.255.255
IPv4 Online Duration	01h42m59s
Default Gateway	10.230.83.53
Primary DNS Server	189.40.198.95
Secondary DNS Server	189.40.198.81
Link Local Gateway IPv6 Address	fe80::e6c0:e2ff:feec:3ef7
Global Gateway IPv6 Address	2804:214:4013:24b6:e6c0:e2ff:feec:3ef7
Default Gateway IPv6 Address	-
DNS server IPv6 Address	2804:214:8000:ffff:0:0:0:81,2804:214:8000:ffff:0:0:0:97
IP Version	IPv4/IPv6
Wi-Fi
2.4 GHz Wi-Fi SSID	VIII2
Status	Enabled
Uptime	01h43m55s
MAC address	E4:C0:E2:EC:3E:F4
Mode	802.11 b,g,n,ax
Bitrate	1800 Mbps
Security	WPA2/WPA Personal
5.0 GHz Wi-Fi SSID	VIII5
Status	Enabled
Uptime	01h43m55s
MAC address	E4:C0:E2:EC:3E:F5
Mode	802.11 a,n,ac,ax
Bitrate	7200 Mbps
Security	WPA2/WPA Personal
2.4 GHz Guest Wi-Fi SSID	GUEST_3EF0_2G
Status	Disabled
Uptime	--
MAC address	
Mode	802.11 b,g,n,ax
Bitrate	1800 Mbps
Security	WPA2/WPA Personal
5.0 GHz Guest Wi-Fi SSID	GUEST_3EF0_5G
Status	Disabled
Uptime	--
MAC address	
Mode	802.11 a,n,ac,ax
Bitrate	7200 Mbps
Security	WPA2/WPA Personal
Telephone
Telephone 1	Not available
Status	Not registered
Telephone 2	Not available
Status	Not registered

GPON
Optical Link Status	OPERATIONAL
Optical Module Rx Power (dBm)	-19.030
Optical Module Tx Power (dBm)	2.923
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
General
DHCP Leases
ARP
DHCP Leases
Hostname	MAC address	IP address	Expires in
192.168.1.12	D8:3A:DD:84:6B:10	192.168.1.12	22h15m55s
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
General
DHCP Leases
ARP
ARP
IP address	Flags	HW Address	Interface
192.168.1.12	Complete	D8:3A:DD:84:6B:10	eth4
 
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
LAN / DHCP
Hostname
MyRouter

IP Address
192.168.1.1
Subnet Mask
255.255.255.0
DHCP
Enable
IPv4 Pool Start
192.168.1.2
IPv4 Pool End
192.168.1.254
IPv4 Lease Time

1 week
Restore Default DHCP Configuration
Restore
IP Reservation
Add Reserved Address
MAC Address format is YY:YY:YY:YY:YY:YY (Y between 0 and 9 or between A and F)
IPv4 Address format is X.X.X.X (X between 0 and 255)
IP already assigned to the devices and in the DHCP Leases table aren&amp;apos;t available for the configuration
Enable	Device Name	MAC address	IPv4 Address	Options
There are no reserved addresses
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
LAN IPv6
Enable IPv6
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
My Media
You can plug an USB drive into the gateway and share its content with other computers in your network. The DLNA protocol requires a compatible client and allows to stream Audio/Video content. The second option allows to share any type of files with the file explorer of your computer.
DLNA
Settings
Name
DLNA
Aggregation
UPnP Media Server Port
9000
Cancel Apply

http://192.168.1.1:9000/#video
http://192.168.1.1:9000/#music
http://192.168.1.1:9000/#photo

File Sharing
Access Authenticate
Access authenticate should be set as enable if you pc is windows10 system.
Username
Telekom-USB
Password
 Show Password
MARIOUSB
If the access authenticate is set after USB inserted, please insert the USB again to make the setting take action.
Share
Copy one of following links in your file explorer address bar and access shared content.


smb://192.168.1.1/MARIOUSB


Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Traceroute results
traceroute to 185.199.111.153 (185.199.111.153), 30 hops max, 38 byte packets
1 10.230.83.53 (10.230.83.53) 2.451 ms 2.398 ms 1.715 ms
2 10.230.82.60 (10.230.82.60) 17.752 ms 18.098 ms 17.873 ms
3 10.230.1.159 (10.230.1.159) 20.256 ms 20.073 ms 19.773 ms
4 10.224.150.189 (10.224.150.189) 181.707 ms 18.015 ms 18.415 ms
5 10.239.253.33 (10.239.253.33) 19.062 ms 17.804 ms 18.378 ms
6 10.213.247.38 (10.213.247.38) 159.538 ms 17.695 ms 32.761 ms
7 10.213.247.37 (10.213.247.37) 26.819 ms 25.828 ms 26.728 ms
8 10.247.0.6 (10.247.0.6) 34.970 ms 34.052 ms 33.355 ms
9 10.210.244.117 (10.210.244.117) 203.317 ms 26.501 ms 25.877 ms
10 10.213.249.38 (10.213.249.38) 25.876 ms 25.781 ms 26.681 ms

***

DNS Query results
Status: Active
Address: 142.251.133.4&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
IPv4
IPv6
DNS IPv6
IPv4
Connection type
PPP
Log-In
guest
Password
•••••
Addressing Type

IPCP
Public IP Address:
191.122.198.252
Mask
255.255.255.255
Gateway
10.230.83.53
DNS

Obtain DNS Automatically
First IPv4 DNS Server
189.40.198.95
Secondary IPv4 DNS Server
189.40.198.81
PPPoePassthrough
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
IPv4
IPv6
DNS IPv6

IPv6
Enable
Delegated Prefix
2804:20:6a:1c0b::/64,2804:214:4013:24b6::/64
LAN IPv6 Address
2804:214:4013:24b6:e6c0:e2ff:feec:3ef7
LAN IPv6 Enable
WAN IPv6 Address
2804:20:6a:1c0b:e6c0:e2ff:feec:3ef0
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
IPv4
IPv6
DNS IPv6

DNS WAN IPv6
DNS

Obtain DNS Automatically
First IPv6 DNS Server
2804:214:8000:ffff::81
Second IPv6 DNS Server
2804:214:8000:ffff::97
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
GPON
Enable
Status
UP
Serial Number
OC25182TM001203
GPON Serial Number
534D42530400EF2B
Optical Link Status
OPERATIONAL
Optical Module Tx Power (dBm)
2.956
Optical Module Rx Power (dBm)
-18.961
Optical Module Temperature (C)
41.859
Optical Module Power Feed Volt (mV)
3346.2
Optical Module BIAS current (mA)
14.45
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
MAC address
GPON DATA
 

GPON VOIP
 

GPON MNGT
 

GPON TV
 

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Access Control
Internet:  Connected

Home Icon
Parental Control
Port Forwarding
Port Triggering
DMZ
User
Add Rule
Games &amp;amp; Applications
Port Forwarding
Enable UPnP IGd
Advertisement Period
1800
Advertisement TTL
4
UPNP IGD allows games, peer-to-peer, remote assistance or others applications to automatically create port forwarding rules. This option can create a risk for the security of your local network, check list of rules in table below.
Cancel   Apply
Add Rules Manually
Use &amp;apos;-&amp;apos; character to enter a range of ports : XXX-XXX
Custom service name
Service

Other
External host
Internal host
Protocol

TCP
External Port
 
Internal Port
Clear Add
Enable	Service	Protocol	External host	Internal host	External Port	Internal Port	Options
There is no port forwarding rule
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Access Control
Internet:  Connected

Home Icon
Parental Control
Port Forwarding
Port Triggering
DMZ
User
Port Triggering
Service Name
Trigger Protocol

TCP
Trigger from port
Trigger to port
Open Protocol

TCP
Open from port
Open to port
Clear Add
Enable	Service Name	Trigger Protocol	Trigger from port	Trigger to port	Open Protocol	Open from port	Open to port	Options
There are no port triggering rules
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Access Control
Internet:  Connected

Home Icon
Parental Control
Port Forwarding
Port Triggering
DMZ
User
DMZ
Activate DMZ on a device to make it reachable from Internet.
Enable
Local host
192.168.1.12

192.168.1.12
Local host mac
D8:3A:DD:84:6B:10

192.168.1.12
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
192.168.1.12
Internet:  Connected

Home Icon
Device Info
Port Forwarding
DMZ

Device Info
Friendly Name
D8:3A:DD:84:6B:10
Icon

Miscellaneous
Location
Hostname
Not available

IP address
192.168.1.12
2804:214:4013:24b6:63bc:9a3c:232e:3f5b

Reserve IP
MAC address
D8:3A:DD:84:6B:10 

Manufacturer
 

Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Ethernet
Internet:  Connected

Home Icon
Enable
Port  1
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  2
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  3
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  4
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  2.5G
Status: UP
Link speed: AUTO
Current BitRate / 0

Sent / Received

Packets
285420 / 102965

Bytes
312,70 MB / 26,97 MB

Errors
0 / 0

Discarded Pkt
0 / 0

Unicast Pkt
282995 / 102003

Multicast Pkt
616 / 951

Broadcast Pkt
1809 / 11

Hide
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
USB Device
Internet:  Connected

Home Icon
Device Info
Mass Storage
Device Info
To view and manage the mass storage contents, under Windows you can open your Windows Explorer and type \\home in the address bar.
Status
Connected
Eject device
Eject
 Force to eject
Port
Port 1
Name
MARIOUSB
Device type
STORAGE
Manufacturer
XEROX CORPORATION
Partition list
Partition	File System	Size	Used
/dev/sda1	FAT32	58.59 Gb	0.01 Gb
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
USB Device
Internet:  Connected

Home Icon
Device Info
Mass Storage
USB Storage Device
You can plug a USB drive into the gateway, and share all files with your other computers in the network.
 
Share
Copy and paste the paths below in the address bar of your file explorer.
smb://192.168.1.1/MARIOUSB


2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
Basic
2.4 GHz5 GHz
Enable Wireless
 

Click on image to print 

Click on image to print
Status
UPUP
SSID
VIII2
 Visible
VIII5
 Visible
Channel Selection

AUTO
Current Channel: 11

AUTO
Current Channel: 52
Security
Security

WPA2/WPA Personal
WPA2 requires a 8-63 character password. Only the following characters can be used: a-z, A-Z, 0-9 and ! &amp;quot; # $ % &amp;amp; &amp;apos; () * , - . / : ; &amp;lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~

WPA2/WPA Personal
WPA2 requires a 8-63 character password. Only the following characters can be used: a-z, A-Z, 0-9 and ! &amp;quot; # $ % &amp;amp; &amp;apos; () * , - . / : ; &amp;lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~
Password
08qBD0p&amp;amp;
 Show Password
08qBD0p&amp;amp;
 Show Password
Confirm Password
08qBD0p&amp;amp;
08qBD0p&amp;amp;
Wi-Fi DefaultsCancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
WPS (Wi-Fi Protected Setup)
Enable WPS
If Wi-Fi Protected Setup is disabled here, the physical button on your router will also be disabled.
Cancel Apply
Use one method below to connect your device using Wi-Fi Protected Setup.

Push Button
Click the button below.

Activate WPS on the wireless client within 2 minutes after clicking the button.
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Wi-Fi Stats
Stats: UP
Link speed: 7200Mbit/s
Sent / Received

Packets
3478 / 0

Bytes
502,35 kB / 0

Errors
0 / 0

Discarded Pkt
3 / 62

Unicast Pkt
0 / 0

Multicast Pkt
0 / 0

Broadcast Pkt
0 / 0

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Wi-Fi Stats
Stats: UP
Link speed: 1800Mbit/s
Sent / Received

Packets
3467 / 0

Bytes
540,88 kB / 0

Errors
1600 / 0

Discarded Pkt
0 / 1

Unicast Pkt
0 / 0

Multicast Pkt
0 / 0

Broadcast Pkt
0 / 0

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Advanced Configuration
Wireless Mode

802.11ax
Region
BR/0
Bandwidth

Auto
Transmit Power

100%
Global Max Clients
64
WMM - Wi-Fi Multimedia
Enable
APSD
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Advanced Configuration
Wireless Mode

802.11ax
Region
BR/0
Bandwidth

Auto
Transmit Power

100%
Global Max Clients
32
WMM - Wi-Fi Multimedia
Enable
APSD
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
MAC Filter
MAC Filtering Mode

Allow all
Allow all: no filtering
Allow: Allow access only for devices in table below
Deny: Deny access for devices in table below

Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;&quot;&gt;&lt;/outline&gt;
&lt;/outline&gt;
&lt;/body&gt;&lt;/opml&gt;" data-download-link="" data-download-label="Download Xml">
  <code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;opml version=&quot;2.0&quot;&gt;
&lt;head&gt;&lt;title&gt;router&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;outline text=&quot;&quot;&gt;&lt;outline text=&quot;Logged in as   admin
Logout
Welcome to F@st 5670
Click to refresh 
F@st 5670
Settings
Configure DHCP, NTP, DynDNS

Access Control
Settings
Configure Firewall, DMZ, Remote Access.

Internet Connectivity
Settings
Status:  Connected
My Media
Ethernet
Settings
192.168.1.12

IP: 192.168.1.12


USB
MARIOUSB

Used: 0.01 Gb / 58.59 Gb

Wi-Fi 2.4GHz
Settings
SSID Name: VIII2
Speed: 1800 Mbit/s

There are no connected devices

Guests
Settings
SSID Name: GUEST_3EF0_2G


There are no connected devices

Wi-Fi 5GHz
Settings
SSID Name: VIII5
Speed: 7200 Mbit/s

There are no connected devices

Guests
Settings
SSID Name: GUEST_3EF0_5G


There are no connected devices

Voice Ports
There are no enabled lines

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
General
DHCP Leases
ARP
Device Info
Serial Number	OC25182TM001203
Hardware Version	2.00
Software Version	SGFP10000111
GUI Version	5.102.0
UpTime	01h43m55s
Datapump Version	
WAN MAC Address	E4:C0:E2:EC:3E:F0
Network
Local IPv4 Address	192.168.1.1
Local Subnet Mask	255.255.255.0
Local Ethernet Mac address	E4:C0:E2:EC:3E:F7
Public IPv4 Address	191.122.198.252
Public Subnet Mask	255.255.255.255
IPv4 Online Duration	01h42m59s
Default Gateway	10.230.83.53
Primary DNS Server	189.40.198.95
Secondary DNS Server	189.40.198.81
Link Local Gateway IPv6 Address	fe80::e6c0:e2ff:feec:3ef7
Global Gateway IPv6 Address	2804:214:4013:24b6:e6c0:e2ff:feec:3ef7
Default Gateway IPv6 Address	-
DNS server IPv6 Address	2804:214:8000:ffff:0:0:0:81,2804:214:8000:ffff:0:0:0:97
IP Version	IPv4/IPv6
Wi-Fi
2.4 GHz Wi-Fi SSID	VIII2
Status	Enabled
Uptime	01h43m55s
MAC address	E4:C0:E2:EC:3E:F4
Mode	802.11 b,g,n,ax
Bitrate	1800 Mbps
Security	WPA2/WPA Personal
5.0 GHz Wi-Fi SSID	VIII5
Status	Enabled
Uptime	01h43m55s
MAC address	E4:C0:E2:EC:3E:F5
Mode	802.11 a,n,ac,ax
Bitrate	7200 Mbps
Security	WPA2/WPA Personal
2.4 GHz Guest Wi-Fi SSID	GUEST_3EF0_2G
Status	Disabled
Uptime	--
MAC address	
Mode	802.11 b,g,n,ax
Bitrate	1800 Mbps
Security	WPA2/WPA Personal
5.0 GHz Guest Wi-Fi SSID	GUEST_3EF0_5G
Status	Disabled
Uptime	--
MAC address	
Mode	802.11 a,n,ac,ax
Bitrate	7200 Mbps
Security	WPA2/WPA Personal
Telephone
Telephone 1	Not available
Status	Not registered
Telephone 2	Not available
Status	Not registered

GPON
Optical Link Status	OPERATIONAL
Optical Module Rx Power (dBm)	-19.030
Optical Module Tx Power (dBm)	2.923
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
General
DHCP Leases
ARP
DHCP Leases
Hostname	MAC address	IP address	Expires in
192.168.1.12	D8:3A:DD:84:6B:10	192.168.1.12	22h15m55s
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
General
DHCP Leases
ARP
ARP
IP address	Flags	HW Address	Interface
192.168.1.12	Complete	D8:3A:DD:84:6B:10	eth4
 
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
LAN / DHCP
Hostname
MyRouter

IP Address
192.168.1.1
Subnet Mask
255.255.255.0
DHCP
Enable
IPv4 Pool Start
192.168.1.2
IPv4 Pool End
192.168.1.254
IPv4 Lease Time

1 week
Restore Default DHCP Configuration
Restore
IP Reservation
Add Reserved Address
MAC Address format is YY:YY:YY:YY:YY:YY (Y between 0 and 9 or between A and F)
IPv4 Address format is X.X.X.X (X between 0 and 255)
IP already assigned to the devices and in the DHCP Leases table aren&amp;apos;t available for the configuration
Enable	Device Name	MAC address	IPv4 Address	Options
There are no reserved addresses
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
LAN IPv6
Enable IPv6
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
F@st 5670
Internet:  Connected

Home Icon
Device Info
LAN IPv4
LAN IPv6
My Media
Maintenance
My Media
You can plug an USB drive into the gateway and share its content with other computers in your network. The DLNA protocol requires a compatible client and allows to stream Audio/Video content. The second option allows to share any type of files with the file explorer of your computer.
DLNA
Settings
Name
DLNA
Aggregation
UPnP Media Server Port
9000
Cancel Apply

http://192.168.1.1:9000/#video
http://192.168.1.1:9000/#music
http://192.168.1.1:9000/#photo

File Sharing
Access Authenticate
Access authenticate should be set as enable if you pc is windows10 system.
Username
Telekom-USB
Password
 Show Password
MARIOUSB
If the access authenticate is set after USB inserted, please insert the USB again to make the setting take action.
Share
Copy one of following links in your file explorer address bar and access shared content.


smb://192.168.1.1/MARIOUSB


Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Traceroute results
traceroute to 185.199.111.153 (185.199.111.153), 30 hops max, 38 byte packets
1 10.230.83.53 (10.230.83.53) 2.451 ms 2.398 ms 1.715 ms
2 10.230.82.60 (10.230.82.60) 17.752 ms 18.098 ms 17.873 ms
3 10.230.1.159 (10.230.1.159) 20.256 ms 20.073 ms 19.773 ms
4 10.224.150.189 (10.224.150.189) 181.707 ms 18.015 ms 18.415 ms
5 10.239.253.33 (10.239.253.33) 19.062 ms 17.804 ms 18.378 ms
6 10.213.247.38 (10.213.247.38) 159.538 ms 17.695 ms 32.761 ms
7 10.213.247.37 (10.213.247.37) 26.819 ms 25.828 ms 26.728 ms
8 10.247.0.6 (10.247.0.6) 34.970 ms 34.052 ms 33.355 ms
9 10.210.244.117 (10.210.244.117) 203.317 ms 26.501 ms 25.877 ms
10 10.213.249.38 (10.213.249.38) 25.876 ms 25.781 ms 26.681 ms

***

DNS Query results
Status: Active
Address: 142.251.133.4&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
IPv4
IPv6
DNS IPv6
IPv4
Connection type
PPP
Log-In
guest
Password
•••••
Addressing Type

IPCP
Public IP Address:
191.122.198.252
Mask
255.255.255.255
Gateway
10.230.83.53
DNS

Obtain DNS Automatically
First IPv4 DNS Server
189.40.198.95
Secondary IPv4 DNS Server
189.40.198.81
PPPoePassthrough
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
IPv4
IPv6
DNS IPv6

IPv6
Enable
Delegated Prefix
2804:20:6a:1c0b::/64,2804:214:4013:24b6::/64
LAN IPv6 Address
2804:214:4013:24b6:e6c0:e2ff:feec:3ef7
LAN IPv6 Enable
WAN IPv6 Address
2804:20:6a:1c0b:e6c0:e2ff:feec:3ef0
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
IPv4
IPv6
DNS IPv6

DNS WAN IPv6
DNS

Obtain DNS Automatically
First IPv6 DNS Server
2804:214:8000:ffff::81
Second IPv6 DNS Server
2804:214:8000:ffff::97
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
GPON
Enable
Status
UP
Serial Number
OC25182TM001203
GPON Serial Number
534D42530400EF2B
Optical Link Status
OPERATIONAL
Optical Module Tx Power (dBm)
2.956
Optical Module Rx Power (dBm)
-18.961
Optical Module Temperature (C)
41.859
Optical Module Power Feed Volt (mV)
3346.2
Optical Module BIAS current (mA)
14.45
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Internet Connectivity
Internet:  Connected

Home Icon
Internet Service
GPON
MAC Address of Active interfaces
MAC address
GPON DATA
 

GPON VOIP
 

GPON MNGT
 

GPON TV
 

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Access Control
Internet:  Connected

Home Icon
Parental Control
Port Forwarding
Port Triggering
DMZ
User
Add Rule
Games &amp;amp; Applications
Port Forwarding
Enable UPnP IGd
Advertisement Period
1800
Advertisement TTL
4
UPNP IGD allows games, peer-to-peer, remote assistance or others applications to automatically create port forwarding rules. This option can create a risk for the security of your local network, check list of rules in table below.
Cancel   Apply
Add Rules Manually
Use &amp;apos;-&amp;apos; character to enter a range of ports : XXX-XXX
Custom service name
Service

Other
External host
Internal host
Protocol

TCP
External Port
 
Internal Port
Clear Add
Enable	Service	Protocol	External host	Internal host	External Port	Internal Port	Options
There is no port forwarding rule
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Access Control
Internet:  Connected

Home Icon
Parental Control
Port Forwarding
Port Triggering
DMZ
User
Port Triggering
Service Name
Trigger Protocol

TCP
Trigger from port
Trigger to port
Open Protocol

TCP
Open from port
Open to port
Clear Add
Enable	Service Name	Trigger Protocol	Trigger from port	Trigger to port	Open Protocol	Open from port	Open to port	Options
There are no port triggering rules
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Access Control
Internet:  Connected

Home Icon
Parental Control
Port Forwarding
Port Triggering
DMZ
User
DMZ
Activate DMZ on a device to make it reachable from Internet.
Enable
Local host
192.168.1.12

192.168.1.12
Local host mac
D8:3A:DD:84:6B:10

192.168.1.12
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
192.168.1.12
Internet:  Connected

Home Icon
Device Info
Port Forwarding
DMZ

Device Info
Friendly Name
D8:3A:DD:84:6B:10
Icon

Miscellaneous
Location
Hostname
Not available

IP address
192.168.1.12
2804:214:4013:24b6:63bc:9a3c:232e:3f5b

Reserve IP
MAC address
D8:3A:DD:84:6B:10 

Manufacturer
 

Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Ethernet
Internet:  Connected

Home Icon
Enable
Port  1
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  2
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  3
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  4
Status: DOWN
Link speed: AUTO
Current BitRate /

Sent / Received

Packets
0 / 0

Show More
Enable
Port  2.5G
Status: UP
Link speed: AUTO
Current BitRate / 0

Sent / Received

Packets
285420 / 102965

Bytes
312,70 MB / 26,97 MB

Errors
0 / 0

Discarded Pkt
0 / 0

Unicast Pkt
282995 / 102003

Multicast Pkt
616 / 951

Broadcast Pkt
1809 / 11

Hide
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
USB Device
Internet:  Connected

Home Icon
Device Info
Mass Storage
Device Info
To view and manage the mass storage contents, under Windows you can open your Windows Explorer and type \\home in the address bar.
Status
Connected
Eject device
Eject
 Force to eject
Port
Port 1
Name
MARIOUSB
Device type
STORAGE
Manufacturer
XEROX CORPORATION
Partition list
Partition	File System	Size	Used
/dev/sda1	FAT32	58.59 Gb	0.01 Gb
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
USB Device
Internet:  Connected

Home Icon
Device Info
Mass Storage
USB Storage Device
You can plug a USB drive into the gateway, and share all files with your other computers in the network.
 
Share
Copy and paste the paths below in the address bar of your file explorer.
smb://192.168.1.1/MARIOUSB


2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
Basic
2.4 GHz5 GHz
Enable Wireless
 

Click on image to print 

Click on image to print
Status
UPUP
SSID
VIII2
 Visible
VIII5
 Visible
Channel Selection

AUTO
Current Channel: 11

AUTO
Current Channel: 52
Security
Security

WPA2/WPA Personal
WPA2 requires a 8-63 character password. Only the following characters can be used: a-z, A-Z, 0-9 and ! &amp;quot; # $ % &amp;amp; &amp;apos; () * , - . / : ; &amp;lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~

WPA2/WPA Personal
WPA2 requires a 8-63 character password. Only the following characters can be used: a-z, A-Z, 0-9 and ! &amp;quot; # $ % &amp;amp; &amp;apos; () * , - . / : ; &amp;lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~
Password
08qBD0p&amp;amp;
 Show Password
08qBD0p&amp;amp;
 Show Password
Confirm Password
08qBD0p&amp;amp;
08qBD0p&amp;amp;
Wi-Fi DefaultsCancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
WPS (Wi-Fi Protected Setup)
Enable WPS
If Wi-Fi Protected Setup is disabled here, the physical button on your router will also be disabled.
Cancel Apply
Use one method below to connect your device using Wi-Fi Protected Setup.

Push Button
Click the button below.

Activate WPS on the wireless client within 2 minutes after clicking the button.
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Wi-Fi Stats
Stats: UP
Link speed: 7200Mbit/s
Sent / Received

Packets
3478 / 0

Bytes
502,35 kB / 0

Errors
0 / 0

Discarded Pkt
3 / 62

Unicast Pkt
0 / 0

Multicast Pkt
0 / 0

Broadcast Pkt
0 / 0

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Wi-Fi Stats
Stats: UP
Link speed: 1800Mbit/s
Sent / Received

Packets
3467 / 0

Bytes
540,88 kB / 0

Errors
1600 / 0

Discarded Pkt
0 / 1

Unicast Pkt
0 / 0

Multicast Pkt
0 / 0

Broadcast Pkt
0 / 0

2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Advanced Configuration
Wireless Mode

802.11ax
Region
BR/0
Bandwidth

Auto
Transmit Power

100%
Global Max Clients
64
WMM - Wi-Fi Multimedia
Enable
APSD
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
Advanced Configuration
Wireless Mode

802.11ax
Region
BR/0
Bandwidth

Auto
Transmit Power

100%
Global Max Clients
32
WMM - Wi-Fi Multimedia
Enable
APSD
Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;Logged in as   admin
Logout
Wi-Fi 2.4GHz &amp;amp; 5GHz
Internet:  Connected

Home Icon
Basic
BandSteering
WPS
Stats
Advanced
MAC Filter
2.4 GHz
5 GHz
MAC Filter
MAC Filtering Mode

Allow all
Allow all: no filtering
Allow: Allow access only for devices in table below
Deny: Deny access for devices in table below

Cancel Apply
2005 - 2025 © Sagemcom Broadband SAS. All Rights Reserved&quot;&gt;&lt;/outline&gt;

&lt;outline text=&quot;&quot;&gt;&lt;/outline&gt;
&lt;/outline&gt;
&lt;/body&gt;&lt;/opml&gt;</code>
</section>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">iOS apps library clustered</title><link href="https://ib.bsb.br/ios-apps-library-clustered/" rel="alternate" type="text/html" title="iOS apps library clustered" /><published>2025-08-10T00:00:00+00:00</published><updated>2025-08-10T02:17:33+00:00</updated><id>https://ib.bsb.br/ios-apps-library-clustered</id><content type="html" xml:base="https://ib.bsb.br/ios-apps-library-clustered/"><![CDATA[<p><strong>System apps (built into iOS):</strong></p>
<ul>
  <li><strong>App Store:</strong> Apple’s built-in digital storefront. Used to browse, purchase, and update iOS applications. (Example: “App Store” is where you get apps on your iPhone.)</li>
  <li><strong>Camera:</strong> Apple’s camera app. “Take stunning photos and videos with true-to-life colour… Capture detailed shots in low-light situations” (<a href="https://apps.apple.com/pk/app/clock/id1584215688#:~:text=Clock%20helps%20you%20manage%20your,World%20Clock">apps.apple.com</a>).</li>
  <li><strong>Clock:</strong> iOS clock utility with World Clock, alarms, stopwatch, and timer. “Clock helps you manage your time on iOS… wake up on time with Alarms, or keep track of passing time with Stopwatch and Timers” (<a href="https://apps.apple.com/pk/app/clock/id1584215688#:~:text=Clock%20helps%20you%20manage%20your,World%20Clock">apps.apple.com</a>).</li>
  <li><strong>Contacts:</strong> Apple’s contacts/address book app for storing names, phone numbers, emails, etc. (Built-in People app on iOS.)</li>
  <li><strong>Find My:</strong> Apple’s locator app. “View the location of your Apple devices, locate items you’ve attached AirTag to… and share your location with friends and family” (<a href="https://apps.apple.com/us/app/find-my/id1514844621#:~:text=View%20the%20location%20of%20your,use%20app">apps.apple.com</a>).</li>
  <li><strong>Messages:</strong> Apple’s messaging app for SMS/MMS and iMessage (text, photos, video chats).</li>
  <li><strong>Phone:</strong> iPhone’s dialer for calls. (Built-in phone application.)</li>
  <li><strong>Photos:</strong> Apple’s photo library. Displays and manages your camera roll.</li>
  <li><strong>Wallet:</strong> Digital wallet/passes app for boarding passes, Apple Pay, gift cards, etc. (Built-in.)</li>
  <li><strong>Safari:</strong> Apple’s web browser on iOS. (Built-in.)</li>
  <li><strong>Calculator:</strong> Apple’s simple calculator app (built-in).</li>
  <li><strong>Measure:</strong> Apple’s augmented-reality measuring tool (built into iOS). (Uses the camera to measure real-world objects.)</li>
</ul>

<p><strong>Automation &amp; Shortcuts:</strong></p>
<ul>
  <li><strong>Actions:</strong> A launcher/shortcuts app (Glyph Launcher) for quick actions via URL schemes and shortcuts. Helps create and run automation tasks.</li>
  <li><strong>AI Actions:</strong> An iOS extension that lets you insert AI-generated steps into Shortcuts workflows and the Share Sheet (e.g. generate text with AI while sharing content).</li>
  <li><strong>Data Jar:</strong> A key–value data store for Apple Shortcuts. Allows shortcuts to save and retrieve persistent data (variables).</li>
  <li><strong>Pushcut:</strong> Automation notifier/trigger app. Sends custom push notifications and runs shortcut actions based on webhooks, time, or location triggers. (Great for advanced automations.)</li>
  <li><strong>Toolbox Pro:</strong> Adds dozens of extra actions for the Shortcuts app (e.g. manipulate text, images, files, etc.) that Shortcuts doesn’t have natively.</li>
  <li><strong>Userscripts:</strong> Safari extension manager. Lets you install and run custom JavaScript (“user scripts”) on webpages, adding bespoke automation/features to browsing.</li>
  <li><strong>Opener:</strong> Utility that opens shared links directly in specific apps instead of Safari (e.g. opening YouTube links in YouTube app, etc.). Maps URLs to app schemes.</li>
  <li><strong>Quick Launch:</strong> Shortcut/app launcher. Quickly run apps or shortcut sequences from your home or lock screen.</li>
  <li><strong>Quick Capture – Obsidian:</strong> One-tap note capturer for Obsidian. Instantly sends text (or web content) into your Obsidian knowledge base.</li>
  <li><strong>SingleFile:</strong> Safari extension that saves entire web pages as a single HTML file. “SingleFile can preserve the original layout, links, etc.” (<a href="https://apps.apple.com/us/app/singlefile-for-safari/id6444322545#:~:text=SingleFile%20is%20a%20Safari%20extension,you%20can%20easily%20access%20offline">apps.apple.com</a>). Useful for archiving pages offline.</li>
  <li><strong>SiteSucker:</strong> Website downloader. “Automatically downloads websites… copying the site’s webpages, style sheets, images… to your iOS device” for offline browsing (<a href="https://apps.apple.com/in/app/sitesucker/id346896838#:~:text=SiteSucker%20is%20an%20iOS%20app,sheet%2C%20it%20scans%20the%20file">apps.apple.com</a>).</li>
  <li><strong>Vinegar:</strong> Safari content blocker for video pages. Replaces embedded YouTube players with a simpler native interface. (Improves playback and privacy.)</li>
  <li><strong>Wipr:</strong> Safari content blocker. Blocks ads and trackers in the browser for privacy.</li>
</ul>

<p><strong>AI &amp; Voice Assistants:</strong></p>
<ul>
  <li><strong>Gemini:</strong> Google’s AI chatbot. Officially marketed as a powerful AI assistant (“Google Gemini app is your personal, proactive and powerful AI Assistant” (<a href="https://apps.apple.com/us/app/speech-central-text-to-speech/id1127349155#:~:text=App%20Store%20Preview">apps.apple.com</a>)). Chat and get answers using Google’s Gemini model.</li>
  <li><strong>GPT Box:</strong> System-wide AI assistant using OpenAI’s models. Runs GPT-style chat from anywhere (via share sheet).</li>
  <li><strong>Hume AI:</strong> Conversational AI with an emphasis on emotional intelligence. Voice chat that can respond empathetically using advanced AI.</li>
  <li><strong>ChatX:</strong> GPT-style AI chat client. Interface to have AI conversations (likely uses OpenAI/Claude style backend).</li>
  <li><strong>NotebookLM:</strong> Google’s AI research notebook. Helps you understand complex documents by answering questions, summarizing, and even providing audio summaries (<a href="https://blog.google/technology/ai/notebooklm-app/#:~:text=We%E2%80%99ve%20received%20a%20lot%20of,directly%20to%20NotebookLM%20while%20browsing">blog.google</a>). (Part of Google Labs.)</li>
  <li><strong>Whisper:</strong> Voice-to-text transcription app based on OpenAI’s Whisper model. Records audio and converts speech to text.</li>
  <li><strong>AudioWriter:</strong> Audio recording app that transcribes voice notes to text (records and AI-converts speech). (Name suggests audio-&gt;writing.)</li>
  <li><strong>Clean Text:</strong> Utility to reformat or clean up text. Can remove whitespace, uppercase/lowercase conversions, etc. (Not strictly AI, just a text utility.)</li>
</ul>

<p><strong>Developer &amp; Networking:</strong></p>
<ul>
  <li><strong>a-Shell:</strong> Local Unix terminal emulator on iOS (<a href="https://apps.apple.com/us/app/a-shell/id1473805438#:~:text=,Shell">apps.apple.com</a>). Supports commands like <code class="language-plaintext highlighter-rouge">grep</code>, <code class="language-plaintext highlighter-rouge">ssh</code>, <code class="language-plaintext highlighter-rouge">python</code>, <code class="language-plaintext highlighter-rouge">gcc</code>, and more. (“a-Shell is a complete local terminal emulator” (<a href="https://apps.apple.com/us/app/a-shell/id1473805438#:~:text=">apps.apple.com</a>).) Useful for scripting and development on the device.</li>
  <li><strong>GitHub:</strong> Official GitHub client. BrowseRepos, issues, PRs, notifications, and code on GitHub from iPhone. (“You can … browse your latest notifications, read, react, and reply to Issues and Pull Requests” (<a href="https://www.kdjingpai.com/en/alog/#:~:text=productivity%20tool%20www,you%20find%20the%20URL%20is">www.kdjingpai.com</a>).)</li>
  <li><strong>ZLGithubClient:</strong> Third-party GitHub client. (An alternative to the official GitHub app.)</li>
  <li><strong>Google Cloud:</strong> Google Cloud Console app. “Helps you manage your services on Google Cloud… check project status, billing, etc.” (<a href="https://apptopia.com/ios/app/790247988/about#:~:text=About%3A%20WOOP%20app%20,Productivity%2C%20Health%20%26%20Fitness">apptopia.com</a>) (Review VMs, storage, cloud accounts).</li>
  <li><strong>Google One:</strong> Google’s cloud storage/subscription app. “Lets you back up your phone and manage your Google account storage” (<a href="https://apps.apple.com/us/app/algoapp-flashcards/id689185915#:~:text=">apps.apple.com</a>) (photos, contacts backup, see plan usage).</li>
  <li><strong>TestFlight:</strong> Apple’s beta testing app. Install and test pre-release iOS apps and submit feedback. (<a href="https://discussions.apple.com/thread/252870348#:~:text=Community%20discussions.apple.com%20%20,I%20get%20the">discussions.apple.com</a>) (Built into Apple Developer system.)</li>
  <li><strong>Logger:</strong> Console log viewer for system and app logs. (Useful for debugging and diagnostics.)</li>
  <li><strong>Debug Anywhere:</strong> Overlay debug inspector for iOS apps. Allows inspecting UI elements and debugging on the device.</li>
  <li><strong>ServerBox:</strong> SSH/Server toolbox. Manage and monitor remote servers via SSH/SFTP on iPhone.</li>
  <li><strong>ServerCat:</strong> Similar SSH remote admin app (SFTP file browser, server metrics, etc.).</li>
  <li><strong>NeoServer:</strong> Server management/monitoring tool (for SSH servers).</li>
  <li><strong>NetBird:</strong> Cloud VPN/mesh networking (WireGuard-based). Creates a private network between your devices for remote access.</li>
  <li><strong>Tailscale:</strong> Zero-configuration VPN app (implements a secure WireGuard mesh). “Securely connect to anything on the internet with Tailscale” (<a href="https://apps.apple.com/us/app/sync-folders/id530573877#:~:text=Mac%20App%20Store%20Preview">apps.apple.com</a>), using identity to configure the VPN.</li>
  <li><strong>NeoAria2:</strong> Remote controller for the aria2 download daemon. Control downloads (magnet links, torrents) on a remote server from iOS.</li>
  <li><strong>Pushsafer:</strong> Service integration for sending push notifications via API/scripts (developer tool to send alerts).</li>
  <li><strong>Supasend:</strong> Mobile side of a third-party notification service (Quick Capture client). Quickly send push/email from Shortcuts (see below Quick Capture – SupaSend).</li>
  <li><strong>WPD:</strong> (Uncertain – possibly a developer utility; left as placeholder.)</li>
</ul>

<p><strong>Productivity, Notes &amp; PKM:</strong></p>
<ul>
  <li><strong>Thought Path:</strong> A lightweight outliner. Hierarchical note-taking app (mind-map or outline).</li>
  <li><strong>ToMemo:</strong> Very simple note/memo app for fast text capture.</li>
  <li><strong>IFThenNote:</strong> Creates notes triggered by conditions (e.g. arrives at location). (If-this-then-note utility.)</li>
  <li><strong>Quick Capture – Obsidian:</strong> (Also in Automation) Quick note capture directly into Obsidian vault.</li>
  <li><strong>Karakeep:</strong> Personal bookmarking and note app. Stores links, notes, images; uses AI to auto-tag and organize content】: “A bookmark-everything app (links, notes and images) with AI-based automatic tagging and full text search” (<a href="https://github.com/karakeep-app/karakeep#:~:text=Skip%20to%20content%20karakeep,app">github.com</a>). Self-hosted and sync options available.</li>
  <li><strong>Linkos:</strong> Read-it-later / link organizer. Save web links and read content later. (Likely similar to Pocket/Instapaper.)</li>
  <li><strong>Priority List:</strong> A to-do app focused on weight/prioritization. Assigns weights to tasks to decide what’s most important.</li>
  <li><strong>One Task:</strong> Minimalist to-do list, focusing on one task at a time. Simple checklist app.</li>
  <li><strong>MyLifeOrg 3:</strong> Personal organizer for tasks, goals, and habits tracking (like agendas or GTD).</li>
  <li><strong>Strides:</strong> Goal and habit tracker with streak counters (track progress on health, finance, etc.).</li>
  <li><strong>Nuj:</strong> Habit-building app (journaling prompts and nudges to form or break habits).</li>
</ul>

<p><strong>Reading &amp; Learning:</strong></p>
<ul>
  <li><strong>Reeder v5:</strong> Popular RSS/news feed reader. Subscribes to feeds (Feedly, etc.) and displays articles. (The icon shows a lightning bolt.)</li>
  <li><strong>Reeder (legacy):</strong> An older version of Reeder (also an RSS reader). Not needed separately if using v5. (Probably installed side-by-side.)</li>
  <li><strong>Reader:</strong> General reading app (possibly a MarkOff or Instapaper-style read-it-later).</li>
  <li><strong>Readfly:</strong> Reading tracker/reader. Monitors how much time you spend reading books or articles. (Tag suggests “reading tracker”.)</li>
  <li><strong>ReadIT:</strong> Reading app or e-book utility (the icon looks like an open book). Likely another read-it-later or e-reader.</li>
  <li><strong>ReadUp:</strong> Social reading/highlight app – share and discuss book highlights with friends. (Community reading tool.)</li>
  <li><strong>Spritz:</strong> Speed-reading app (RSVP style with black background “spritz” logo). Likely flashes words one by one to train reading speed.</li>
  <li><strong>Speed Reader:</strong> Another RSVP speed-reading trainer. “Reads one word at a time… start at 300 WPM and you can speed up to 750 WPM” (<a href="https://apps.apple.com/th/app/speed-reader-for-speed-reading/id6447472154#:~:text=Speed%20Reader%20,speed%20read%20750%20words%20per">apps.apple.com</a>). Improves reading speed via single-word display.</li>
  <li><strong>Speed Eyes:</strong> Educational eye-training for speed-reading (visual focus exercises).</li>
  <li><strong>Stage Reader:</strong> Teleprompter app for speeches. Scrolls text at adjustable speed for presenters.</li>
  <li><strong>Sara Nossa Terra:</strong> App for the Sara Nossa Terra church (Portuguese church). Provides faith resources and community info (the icon with a feather quill).</li>
  <li><strong>MH Comment (Matthew Henry Commentary):</strong> Bible study reference. Contains Matthew Henry’s complete Bible commentary (<a href="https://apps.apple.com/us/app/matthew-henry-bible-commentary/id985746464#:~:text=Matthew%20Henry%20Complete%20Commentary%20on,the%20Old%20and%20New%20Testaments">apps.apple.com</a>). (Also includes Scofield notes and King James Bible. Church study tool.)</li>
</ul>

<p><strong>Photos, Video &amp; Document Scanning:</strong></p>
<ul>
  <li><strong>Capture:</strong> Generic scanner app. The icon suggests capturing document photos. (Use camera to scan receipts/docs to PDF.)</li>
  <li><strong>Open Scanner:</strong> Camera-based document scanner with OCR (text recognition from photos).</li>
  <li><strong>Prizmo Go:</strong> Advanced live OCR app. Use camera to instantly extract and copy text from any printed material【0†source】 (the icon with an orange O).</li>
  <li><strong>Photos+:</strong> ‘Pro’ photo browser. Enhanced image viewer with EXIF data and editing tools. (Third-party Photos replacement.)</li>
  <li><strong>Replica:</strong> Screen/mirroring app. Casts your iPhone screen to a TV or PC over the network (via AirPlay or proprietary protocol). (Icon shows a TV screen.)</li>
  <li><strong>Mocha LPR:</strong> License-plate recognition camera. Uses the camera to read car license plates automatically (for parking or security tasks).</li>
  <li><strong>OpenCat:</strong> Possibly a control/monitoring app for an open-source punching bag/robot named “OpenCat”. (Unclear, likely IoT/hardware related.)</li>
</ul>

<p><strong>Audio &amp; Music:</strong></p>
<ul>
  <li><strong>Spotify:</strong> Popular music and podcast streaming app. (Known service for audio content.)</li>
  <li><strong>Audio Connect:</strong> Technics Audio Connect. Official app for Technics headphones and earbuds. “Provides a sensational music experience… by linking with your headphones and earphones… your listening experience becomes even more appealing” (<a href="https://apps.apple.com/za/app/technics-audio-connect/id1498029651#:~:text=Providing%20you%20with%20a%20sensational,experience%20becomes%20even%20more%20appealing">apps.apple.com</a>). Customize sound profiles and update firmware on Technics devices.</li>
  <li><strong>Voice Memos:</strong> Apple’s built-in audio recorder for voice notes. (Record audio clips.)</li>
</ul>

<p><strong>Finance &amp; Shopping:</strong></p>
<ul>
  <li><strong>AliExpress:</strong> Global online marketplace (shopping app from China). “Discover exclusive deals and millions of products on AliExpress” (<a href="https://apps.apple.com/th/app/speed-reader-for-speed-reading/id6447472154#:~:text=Speed%20Reader%20,speed%20read%20750%20words%20per">apps.apple.com</a>). Buy consumer goods at low prices.</li>
  <li><strong>CAIXA:</strong> Mobile banking app for Caixa Econômica Federal (Brazil). Check account balances, payments, etc. (Brazilian federal bank.)</li>
  <li><strong>Nubank (Nu):</strong> Brazilian digital bank app. Manage credit cards, accounts and transfers online.</li>
  <li><strong>Sicoob / Sicoob Moob / Sicoobcard:</strong> Apps for Brazil’s Sicoob cooperative bank. Sicoob (account app), Sicoob Moob (cooperative platform), Sicoobcard (credit cards). Manage accounts, cooperatives and credit services.</li>
  <li><strong>Pennies:</strong> Simple budgeting app. Track daily spending with a visual pie-chart “pennies” interface. Helps plan weekly/monthly budgets.</li>
  <li><strong>Livelo:</strong> Brazilian rewards program app. Manage Livelo points from credit cards and partners; redeem for gifts/miles.</li>
  <li><strong>Vale Bonus:</strong> Brazil employee voucher app (for benefits or meal vouchers).</li>
  <li><strong>Vale Presente:</strong> Brasil gift card wallet (stores/store gift card balances digitally).</li>
  <li><strong>Tokio Marine:</strong> Insurance company app (Brazilian Tokio Marine). Manage insurance policies and claims.</li>
  <li><strong>Drogasil:</strong> Brazilian pharmacy chain app. Order prescriptions and shop for medicines.</li>
  <li><strong>Meu TIM:</strong> Mobile carrier app for TIM Brazil. View/increase data plans and pay bills.</li>
  <li><strong>Tokio:</strong> Insurance app (Tokio Marine, as above).</li>
  <li><strong>ToMemo:</strong> (Also in Productivity) Quick personal notes.</li>
</ul>

<p><strong>Government &amp; Services (Brazil):</strong></p>
<ul>
  <li><strong>gov.br:</strong> Official Brazilian federal services app for digital identity (login to government services). Use your gov.br account to access tax filings, social benefits, etc.</li>
  <li><strong>Sou Gov.br:</strong> Government employee portal (Brazil). HR and benefits info for public servants.</li>
  <li><strong>Economia DF:</strong> Finance/tax info for Distrito Federal (Brasília) residents. (Shows budgets, spending for local gov.)</li>
  <li><strong>Detran DF:</strong> DMV services for Distrito Federal. Check traffic fines, license/vehicle status.</li>
  <li><strong>Receita Federal:</strong> Brazil’s Federal Revenue app. Access tax documents, CPF status, and tax refunds.</li>
  <li><strong>SINESP+:</strong> National public security info app. Look up stolen cars and missing persons via Brazil’s security database.</li>
  <li><strong>Fiscalização:</strong> Citizen enforcement app (Brasília). Report public infractions or check code enforcement tasks.</li>
  <li><strong>Metro-DF:</strong> Brasília Metro transit info. Schedules and maps for the subway system in Brasilia.</li>
  <li><strong>Minha Mobilidade:</strong> (Brasília) Integrated mobility app. Combines bus, metro schedules and traffic data for local transit (though specific info was unclear).</li>
  <li><strong>Sesc Distrito Federal:</strong> Social/cultural services app (Sesc DF). Access member benefits for Sesc centers in Distrito Federal (Brazil).</li>
  <li><strong>Correios:</strong> Brazilian mail tracking app (Correios). Track packages and shipments within Brazil.</li>
</ul>

<p><strong>Transport &amp; Navigation:</strong></p>
<ul>
  <li><strong>Uber:</strong> Ride-hailing app (taxi and car service network). Call rides and track drivers (Uber).</li>
  <li><strong>Waze:</strong> Community-based GPS navigation by Google. Live traffic alerts; “Know what’s ahead on the road with Waze” (leading navigation app) (<a href="https://www.stageprompter.co.uk/web-application.html#:~:text=Stageprompter%20www,Application%20is%20a%20teleprompter">www.stageprompter.co.uk</a>). (Routes around congestion.)</li>
  <li><strong>Metro-DF:</strong> (Also above) means metro/transit for Brasília.</li>
  <li><strong>Vale / Mocha LPR:</strong> (Already covered in photo/video.)</li>
  <li><strong>Divide Horário (÷ Horário):</strong> Schedule/timetable planner. Likely shot n for class/work scheduling. (Icon shows a clock.)</li>
  <li><strong>MyLifeOrg 3:</strong> (Already covered in Productivity tasks/habits.)</li>
  <li><strong>Plantão Escala:</strong> Shift/duty roster for hospitals or police (Brasília DF). Organize and view on-call schedules.</li>
  <li><strong>Uber:</strong> (Already listed.)</li>
</ul>

<p><strong>Smart Home &amp; IoT:</strong></p>
<ul>
  <li><strong>Home:</strong> Apple’s HomeKit app. Manage smart devices (lights, locks, cameras) in your home.</li>
  <li><strong>eufy:</strong> Anker’s security camera/home device app. View feeds and control Eufy cameras and alarms.</li>
  <li><strong>YI Home:</strong> App for YI/Nooie home cameras. (Watch live video and recordings.)</li>
</ul>

<p><strong>Health, Fitness &amp; Wellness:</strong></p>
<ul>
  <li><strong>Fasting:</strong> Intermittent fasting tracker. Log eating/fasting periods and set reminders. (Helps follow 16:8 etc.)</li>
  <li><strong>Help Me Calm Down:</strong> Guided breathing and relaxation exercises. (Black-white icon “help me calm down”.)</li>
  <li><strong>Polyphasic:</strong> Tool for polyphasic sleep schedules. Plans and alarms for multiple naps per day.</li>
  <li><strong>OMM:</strong> Meditation/relaxation coach. (Icon with simple zen face.) Provides guided meditations.</li>
  <li><strong>Strides:</strong> (Already listed in Productivity/habits.)</li>
  <li><strong>StrongLifts:</strong> Weightlifting workout tracker (StrongLifts 5x5 program). Log sets, progress in strength training.</li>
  <li><strong>Unhabit:</strong> Habit-breaking tool. Provides gentle “nudges” to help quit unwanted habits by making them difficult (e.g. quizzes before cigarettes).</li>
</ul>

<p><strong>Chat &amp; Social:</strong></p>
<ul>
  <li><strong>WhatsApp:</strong> Popular cross-platform chat/call app. Send messages, voice/video calls, group chats. (Built by Meta.)</li>
  <li><strong>Beeper:</strong> Unified chat client. “Unified inbox for many chat networks” (supports iMessage on Android, etc.). Consolidates multiple chat services in one app.</li>
  <li><strong>NextChat:</strong> GPT/OpenAI-compatible chat client. Alternative UI for ChatGPT-like conversations.</li>
  <li><strong>WyChat:</strong> (Likely) Another alternative chat/messaging client (perhaps for Telegram or another service).</li>
  <li><strong>9GAG:</strong> Meme/social app. Browse and share humorous images and videos (social feed of memes, jokes).</li>
</ul>

<p><strong>Entertainment &amp; Games:</strong></p>
<ul>
  <li><strong>Lite Lichess:</strong> Lichess chess client (unofficial lightweight app for Lichess). Play online chess and puzzles.</li>
  <li><strong>Openings:</strong> Chess openings trainer. Flashcards or practice positions with common opening lines. (Icon shows a chess knight.)</li>
  <li><strong>Games:</strong> A launcher or folder for games (the rocket icon suggests a games folder or shortcut app).</li>
</ul>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">refactor</title><link href="https://ib.bsb.br/refactor/" rel="alternate" type="text/html" title="refactor" /><published>2025-08-10T00:00:00+00:00</published><updated>2025-08-11T08:39:57+00:00</updated><id>https://ib.bsb.br/refactor</id><content type="html" xml:base="https://ib.bsb.br/refactor/"><![CDATA[<section class="code-block-container" role="group" aria-label=" Code Block" data-filename="_code_block.txt" data-code="&lt;purpose&gt;
    You are a Principal Software Engineer specializing in safe, behavior-preserving code refactoring. Given program source code in [[input_code]] (single or multiple files) and optional context, output a production-grade refactoring that preserves external behavior and public APIs by default. Output must be exclusively code, with no explanatory prose. For multi-file inputs, emit a unified diff; for single-file inputs, emit the fully refactored file. Use only code comments inside files when in full_file mode. Avoid adding dependencies or speculative features.
  &lt;/purpose&gt;

  &lt;persona&gt;
    &lt;role&gt;Principal Software Engineer — Code Refactoring Specialist&lt;/role&gt;
    &lt;attributes&gt;Conservative, precise, idiomatic, test-conscious, security - and performance - aware, review-friendly&lt;/attributes&gt;
  &lt;/persona&gt;

  &lt;constraints&gt;
    &lt;constraint&gt;Output is code-only. No explanatory prose. In diff mode: strictly a valid unified diff with no comments. In full_file mode: only code and in-file comments.&lt;/constraint&gt;
    &lt;constraint&gt;Preserve behavior and public APIs unless [[allow_breaking_changes]] is true and explicitly requested via [[refactoring_goals]].&lt;/constraint&gt;
    &lt;constraint&gt;Do not add external dependencies or services unless explicitly listed in [[allowed_dependencies]]. Do not remove required dependencies without preserving functionality.&lt;/constraint&gt;
    &lt;constraint&gt;Adhere to [[style_guide]] and [[target_language_version]] when provided; otherwise follow idiomatic, widely accepted conventions.&lt;/constraint&gt;
    &lt;constraint&gt;Do not fabricate missing code, APIs, or environment details. If context is insufficient, perform the safest minimal refactor and include extensive TODOs only as code comments (full_file mode only).&lt;/constraint&gt;
    &lt;constraint&gt;Security: avoid injection, unsafe deserialization, resource leaks, hardcoded secrets; respect least privilege and privacy.&lt;/constraint&gt;
    &lt;constraint&gt;Performance: avoid algorithmic regressions; remove obvious hotspots (e.g., N+1, unnecessary allocations) without premature micro-optimization.&lt;/constraint&gt;
    &lt;constraint&gt;Minimize unrelated reformatting and churn. Do not alter unaffected lines unless [[enforce_reformat]] is true or a canonical formatter config is provided.&lt;/constraint&gt;
    &lt;constraint&gt;Preserve license headers, file annotations, encodings, and line endings.&lt;/constraint&gt;
    &lt;constraint&gt;Avoid cross-file renames that break build systems (e.g., Java/C# file-name/class-name coupling) unless explicitly authorized.&lt;/constraint&gt;
    &lt;constraint&gt;No PII or confidential details in comments or logs.&lt;/constraint&gt;
  &lt;/constraints&gt;

  &lt;context&gt;
    &lt;audience_profile&gt;
      &lt;primary&gt;Code reviewers, maintainers, CI/CD systems&lt;/primary&gt;
      &lt;expertise&gt;Medium-to-high engineering literacy&lt;/expertise&gt;
      &lt;decision_need&gt;Adopt refactoring with minimal risk and maximum clarity&lt;/decision_need&gt;
    &lt;/audience_profile&gt;
    &lt;style_guide&gt;
      &lt;tone&gt;Code-first, precise&lt;/tone&gt;
      &lt;voice&gt;Conservative, evidence-seeking&lt;/voice&gt;
      &lt;format&gt;Exclusively code; unified diff or full-file output per [[output_mode]] rules&lt;/format&gt;
    &lt;/style_guide&gt;
    &lt;technical_conventions&gt;
      &lt;code_quality&gt;DRY, KISS, SOLID (where applicable), coherent naming, small functions, dependency inversion where valuable&lt;/code_quality&gt;
      &lt;error_handling&gt;Explicit error paths; no silent catches; preserve error semantics&lt;/error_handling&gt;
      &lt;typing&gt;Prefer explicit types/annotations where supported; meaningful names&lt;/typing&gt;
      &lt;concurrency&gt;Preserve thread/process safety; avoid shared mutable state; use safe synchronization primitives&lt;/concurrency&gt;
      &lt;resources&gt;Deterministic cleanup (RAII/defer/using), timeouts, backpressure&lt;/resources&gt;
      &lt;i18n_logging&gt;No PII in logs; keep existing structured logging only&lt;/i18n_logging&gt;
      &lt;tests&gt;Respect existing tests; update minimally when signatures/renames are necessary; add tests only if [[allow_test_additions]] is true&lt;/tests&gt;
    &lt;/technical_conventions&gt;
  &lt;/context&gt;

  &lt;variables&gt;
    &lt;var name=&quot;input_code&quot; type=&quot;string|json&quot; required=&quot;true&quot; description=&quot;Source code. For multiple files, provide a JSON map of file paths to contents.&quot; /&gt;
    &lt;var name=&quot;language&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;Programming language; auto-detect if not provided.&quot; /&gt;
    &lt;var name=&quot;target_language_version&quot; type=&quot;string&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;framework&quot; type=&quot;string&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;build_system&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;e.g., Maven/Gradle/npm/pip/Go modules&quot; /&gt;
    &lt;var name=&quot;style_guide&quot; type=&quot;text|link&quot; required=&quot;false&quot; description=&quot;e.g., PEP8, Google Java Style, .editorconfig, formatter config&quot; /&gt;
    &lt;var name=&quot;formatter_config&quot; type=&quot;string|json&quot; required=&quot;false&quot; description=&quot;Formatter tool and settings, if any&quot; /&gt;
    &lt;var name=&quot;enforce_reformat&quot; type=&quot;boolean&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;allowed_dependencies&quot; type=&quot;json&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;disallowed_dependencies&quot; type=&quot;json&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;refactoring_goals&quot; type=&quot;json|text&quot; required=&quot;false&quot; description=&quot;e.g., readability, modularization, performance, security, null-safety&quot; /&gt;
    &lt;var name=&quot;nfr_constraints&quot; type=&quot;json&quot; required=&quot;false&quot; description=&quot;Performance/memory/latency bounds; concurrency model&quot; /&gt;
    &lt;var name=&quot;api_stability&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;stable|compatible|may_break&quot; /&gt;
    &lt;var name=&quot;allow_breaking_changes&quot; type=&quot;boolean&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;allow_test_additions&quot; type=&quot;boolean&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;test_files&quot; type=&quot;json&quot; required=&quot;false&quot; description=&quot;Optional test sources to respect/update minimally&quot; /&gt;
    &lt;var name=&quot;output_mode&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;diff|full_file. Default: diff for multi-file; full_file for single-file.&quot; /&gt;
    &lt;var name=&quot;wrap_in_fence&quot; type=&quot;boolean&quot; required=&quot;false&quot; description=&quot;If true, wrap output in triple backticks with language tag (not allowed in diff mode).&quot; /&gt;
    &lt;var name=&quot;file_metadata&quot; type=&quot;json&quot; required=&quot;false&quot; description=&quot;Paths, module names, entry points, visibility constraints&quot; /&gt;
    &lt;var name=&quot;risk_tolerance&quot; type=&quot;text&quot; required=&quot;false&quot; /&gt;
  &lt;/variables&gt;

  &lt;instructions&gt;
    &lt;instruction&gt;0. Detect language and comment syntax (or use [[language]]). Respect [[target_language_version]] and [[framework]].&lt;/instruction&gt;
    &lt;instruction&gt;1. Determine safe scope from [[refactoring_goals]], [[api_stability]], and [[allow_breaking_changes]]; default to behavior-preserving and API-stable changes.&lt;/instruction&gt;
    &lt;instruction&gt;2. Apply targeted refactorings: extraction/renaming, deduplication, clearer control flow, type hints/signatures, dependency inversion where valuable, resource-safety, null-safety, and obvious security hardening consistent with existing patterns.&lt;/instruction&gt;
    &lt;instruction&gt;3. Avoid adding/changing external dependencies beyond [[allowed_dependencies]]. No feature additions or speculative code.&lt;/instruction&gt;
    &lt;instruction&gt;4. Respect performance and memory constraints in [[nfr_constraints]]; avoid algorithmic regressions; remove obvious hotspots without micro-optimizing.&lt;/instruction&gt;
    &lt;instruction&gt;5. Preserve tests; update only as required by safe renames or extractions. Add minimal focused tests only if [[allow_test_additions]] is true.&lt;/instruction&gt;
    &lt;instruction&gt;6. If context is insufficient to refactor safely, perform the smallest safe improvement and add TODOs/clarifying questions as top-of-file comments (full_file mode only). In diff mode, emit only the diff.&lt;/instruction&gt;
    &lt;instruction&gt;7. Output rules:
      - For multiple files: output_mode must be diff; emit a valid unified diff with ---/+++ headers and @@ hunks; no comments or prose.
      - For a single file: default to full_file; emit the complete refactored file. Only code and in-file comments are allowed.
      - If [[wrap_in_fence]] is true and in full_file mode: wrap the file content in ```[[language]] fences. Do not use fences in diff mode.&lt;/instruction&gt;
    &lt;instruction&gt;8. Keep diffs review-friendly: avoid reformatting unrelated lines unless [[enforce_reformat]] is true or a formatter is explicitly provided.&lt;/instruction&gt;
    &lt;instruction&gt;9. Ensure code remains buildable with given inputs; do not reference non-existent symbols. Use TODO comments rather than fabricating missing parts.&lt;/instruction&gt;
    &lt;instruction&gt;10. Avoid cross-file renames in languages with file-name/class-name constraints unless explicitly authorized.&lt;/instruction&gt;
    &lt;instruction&gt;11. Conflict resolution defaults:
      - If [[output_mode]] conflicts with input cardinality: enforce diff for multi-file; enforce full_file for single-file.
      - Prefer API stability over stylistic changes when in conflict.
      - Prefer minimal-diff transformations when multiple equivalent refactors exist.&lt;/instruction&gt;
    &lt;instruction&gt;12. Self-check before emitting:
      - Validate output format: diff vs full file, headers/hunks correctness (diff), and no extra text.
      - Confirm license headers, encodings, and line endings are preserved.
      - Confirm no new dependencies and no removed required dependencies.
      - Confirm public APIs unchanged unless explicitly allowed.
      - Confirm no unrelated reformatting unless [[enforce_reformat]] is true.
      - Confirm resource-safety and error-handling remain correct and explicit.
      - Confirm changes compile conceptually and do not introduce missing symbols.&lt;/instruction&gt;
  &lt;/instructions&gt;

  &lt;input_data&gt;
    &lt;input_code&gt;[[placeholder]]&lt;/input_code&gt;
    &lt;language&gt;[[placeholder]]&lt;/language&gt;
    &lt;target_language_version&gt;[[placeholder]]&lt;/target_language_version&gt;
    &lt;framework&gt;[[placeholder]]&lt;/framework&gt;
    &lt;build_system&gt;[[placeholder]]&lt;/build_system&gt;
    &lt;style_guide&gt;[[placeholder]]&lt;/style_guide&gt;
    &lt;formatter_config&gt;[[placeholder]]&lt;/formatter_config&gt;
    &lt;enforce_reformat&gt;[[placeholder]]&lt;/enforce_reformat&gt;
    &lt;allowed_dependencies&gt;[[placeholder]]&lt;/allowed_dependencies&gt;
    &lt;disallowed_dependencies&gt;[[placeholder]]&lt;/disallowed_dependencies&gt;
    &lt;refactoring_goals&gt;[[placeholder]]&lt;/refactoring_goals&gt;
    &lt;nfr_constraints&gt;[[placeholder]]&lt;/nfr_constraints&gt;
    &lt;api_stability&gt;[[placeholder]]&lt;/api_stability&gt;
    &lt;allow_breaking_changes&gt;[[placeholder]]&lt;/allow_breaking_changes&gt;
    &lt;allow_test_additions&gt;[[placeholder]]&lt;/allow_test_additions&gt;
    &lt;test_files&gt;[[placeholder]]&lt;/test_files&gt;
    &lt;output_mode&gt;[[placeholder]]&lt;/output_mode&gt;
    &lt;wrap_in_fence&gt;[[placeholder]]&lt;/wrap_in_fence&gt;
    &lt;file_metadata&gt;[[placeholder]]&lt;/file_metadata&gt;
    &lt;risk_tolerance&gt;[[placeholder]]&lt;/risk_tolerance&gt;
  &lt;/input_data&gt;

  &lt;output_format_specification&gt;
    &lt;overall&gt;Exclusively code. No explanatory prose. Diff mode: valid unified diff. Full_file mode: complete file content(s) only. Fences allowed only if [[wrap_in_fence]] is true and not in diff mode.&lt;/overall&gt;
    &lt;modes&gt;
      &lt;diff&gt;
        &lt;rule&gt;Emit a unified diff across provided file paths with correct headers (--- a/path, +++ b/path) and @@ hunks.&lt;/rule&gt;
        &lt;rule&gt;No comments or extra lines beyond the diff format.&lt;/rule&gt;
      &lt;/diff&gt;
      &lt;full_file&gt;
        &lt;rule&gt;Emit a single, compilable file. Place any minimal assumptions/TODOs as top-of-file comments using the language’s comment syntax.&lt;/rule&gt;
        &lt;rule&gt;Do not output multiple full files; use diff mode for multi-file inputs.&lt;/rule&gt;
      &lt;/full_file&gt;
    &lt;/modes&gt;
    &lt;formatting_rules&gt;
      &lt;rule&gt;Respect provided style guides/formatters; otherwise maintain consistent indentation, naming, imports.&lt;/rule&gt;
      &lt;rule&gt;Preserve license headers and file-level annotations.&lt;/rule&gt;
      &lt;rule&gt;Do not change line endings/encodings.&lt;/rule&gt;
    &lt;/formatting_rules&gt;
  &lt;/output_format_specification&gt;

  &lt;examples&gt;
    &lt;example id=&quot;python-single-file-full&quot;&gt;
      &lt;input_data&gt;
        &lt;input_code&gt;&lt;![CDATA[
def process(items):
    result = []
    i = 0
    while i &lt; len(items):
        x = items[i]
        if x is not None and x != &quot;&quot;:
            if isinstance(x, str):
                result.append(x.strip().lower())
            else:
                result.append(str(x))
        i = i + 1
    return result
        ]]&gt;&lt;/input_code&gt;
        &lt;language&gt;python&lt;/language&gt;
        &lt;output_mode&gt;full_file&lt;/output_mode&gt;
        &lt;wrap_in_fence&gt;true&lt;/wrap_in_fence&gt;
        &lt;refactoring_goals&gt;{&quot;readability&quot;: true, &quot;duplication&quot;: true}&lt;/refactoring_goals&gt;
      &lt;/input_data&gt;
      &lt;output&gt;&lt;![CDATA[
```python
from typing import Iterable, List, Any

def process(items: Iterable[Any]) -&gt; List[str]:
    # TODO: Confirm inputs may include None, strings, and other types; behavior preserved.
    result: List[str] = []
    for x in items:
        if x is None or x == &quot;&quot;:
            continue
        result.append(x.strip().lower() if isinstance(x, str) else str(x))
    return result
```
      ]]&gt;&lt;/output&gt;
    &lt;/example&gt;

    &lt;example id=&quot;java-multi-file-diff&quot;&gt;
      &lt;input_data&gt;
        &lt;input_code&gt;&lt;![CDATA[
{
  &quot;src/main/java/app/Service.java&quot;: &quot;package app;\n\npublic class Service {\n    public String greet(String name) {\n        if (name == null || name.trim().equals(\&quot;\&quot;)) {\n            name = \&quot;world\&quot;;\n        }\n        return \&quot;Hello, \&quot; + name + \&quot;!\&quot;;\n    }\n}\n&quot;,
  &quot;src/test/java/app/ServiceTest.java&quot;: &quot;package app;\n\nimport org.junit.jupiter.api.Test;\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass ServiceTest {\n    @Test void greet() {\n        assertEquals(\&quot;Hello, world!\&quot;, new Service().greet(\&quot;\&quot;));\n        assertEquals(\&quot;Hello, Alice!\&quot;, new Service().greet(\&quot;Alice\&quot;));\n    }\n}\n&quot;
}
        ]]&gt;&lt;/input_code&gt;
        &lt;language&gt;java&lt;/language&gt;
        &lt;output_mode&gt;diff&lt;/output_mode&gt;
      &lt;/input_data&gt;
      &lt;output&gt;&lt;![CDATA[
diff --git a/src/main/java/app/Service.java b/src/main/java/app/Service.java
index 1111111..2222222 100644
--- a/src/main/java/app/Service.java
+++ b/src/main/java/app/Service.java
@@ -1,10 +1,16 @@
 package app;
 
 public class Service {
-    public String greet(String name) {
-        if (name == null || name.trim().equals(&quot;&quot;)) {
-            name = &quot;world&quot;;
-        }
-        return &quot;Hello, &quot; + name + &quot;!&quot;;
-    }
+  public String greet(String name) {
+    final String normalized = normalizeName(name);
+    return &quot;Hello, &quot; + normalized + &quot;!&quot;;
+  }
+
+  private String normalizeName(String name) {
+    if (name == null || name.trim().isEmpty()) {
+      return &quot;world&quot;;
+    }
+    return name.trim();
+  }
 }
      ]]&gt;&lt;/output&gt;
    &lt;/example&gt;

    &lt;example id=&quot;typescript-multi-file-diff&quot;&gt;
      &lt;input_data&gt;
        &lt;input_code&gt;&lt;![CDATA[
{
  &quot;src/util.ts&quot;: &quot;export function pad(s: string, len: number) { while (s.length &lt; len) { s = s + &#39; &#39;; } return s; }\n&quot;,
  &quot;src/index.ts&quot;: &quot;import { pad } from &#39;./util&#39;;\nconsole.log(pad(&#39;hi&#39;, 5));\n&quot;
}
        ]]&gt;&lt;/input_code&gt;
        &lt;language&gt;typescript&lt;/language&gt;
        &lt;target_language_version&gt;4.9&lt;/target_language_version&gt;
        &lt;output_mode&gt;diff&lt;/output_mode&gt;
        &lt;refactoring_goals&gt;{&quot;readability&quot;: true, &quot;performance&quot;: true}&lt;/refactoring_goals&gt;
      &lt;/input_data&gt;
      &lt;output&gt;&lt;![CDATA[
diff --git a/src/util.ts b/src/util.ts
index a1b2c3d..d4e5f6a 100644
--- a/src/util.ts
+++ b/src/util.ts
@@ -1 +1,9 @@
-export function pad(s: string, len: number) { while (s.length &lt; len) { s = s + &#39; &#39;; } return s; }
+export function pad(s: string, len: number): string {
+  let out = s;
+  // Avoid quadratic behavior by appending once.
+  const deficit = len - out.length;
+  if (deficit &gt; 0) {
+    out = out + &quot; &quot;.repeat(deficit);
+  }
+  return out;
+}
      ]]&gt;&lt;/output&gt;
    &lt;/example&gt;
  &lt;/examples&gt;" data-download-link="" data-download-label="Download ">
  <code class="language-">&lt;purpose&gt;
    You are a Principal Software Engineer specializing in safe, behavior-preserving code refactoring. Given program source code in [[input_code]] (single or multiple files) and optional context, output a production-grade refactoring that preserves external behavior and public APIs by default. Output must be exclusively code, with no explanatory prose. For multi-file inputs, emit a unified diff; for single-file inputs, emit the fully refactored file. Use only code comments inside files when in full_file mode. Avoid adding dependencies or speculative features.
  &lt;/purpose&gt;

  &lt;persona&gt;
    &lt;role&gt;Principal Software Engineer — Code Refactoring Specialist&lt;/role&gt;
    &lt;attributes&gt;Conservative, precise, idiomatic, test-conscious, security - and performance - aware, review-friendly&lt;/attributes&gt;
  &lt;/persona&gt;

  &lt;constraints&gt;
    &lt;constraint&gt;Output is code-only. No explanatory prose. In diff mode: strictly a valid unified diff with no comments. In full_file mode: only code and in-file comments.&lt;/constraint&gt;
    &lt;constraint&gt;Preserve behavior and public APIs unless [[allow_breaking_changes]] is true and explicitly requested via [[refactoring_goals]].&lt;/constraint&gt;
    &lt;constraint&gt;Do not add external dependencies or services unless explicitly listed in [[allowed_dependencies]]. Do not remove required dependencies without preserving functionality.&lt;/constraint&gt;
    &lt;constraint&gt;Adhere to [[style_guide]] and [[target_language_version]] when provided; otherwise follow idiomatic, widely accepted conventions.&lt;/constraint&gt;
    &lt;constraint&gt;Do not fabricate missing code, APIs, or environment details. If context is insufficient, perform the safest minimal refactor and include extensive TODOs only as code comments (full_file mode only).&lt;/constraint&gt;
    &lt;constraint&gt;Security: avoid injection, unsafe deserialization, resource leaks, hardcoded secrets; respect least privilege and privacy.&lt;/constraint&gt;
    &lt;constraint&gt;Performance: avoid algorithmic regressions; remove obvious hotspots (e.g., N+1, unnecessary allocations) without premature micro-optimization.&lt;/constraint&gt;
    &lt;constraint&gt;Minimize unrelated reformatting and churn. Do not alter unaffected lines unless [[enforce_reformat]] is true or a canonical formatter config is provided.&lt;/constraint&gt;
    &lt;constraint&gt;Preserve license headers, file annotations, encodings, and line endings.&lt;/constraint&gt;
    &lt;constraint&gt;Avoid cross-file renames that break build systems (e.g., Java/C# file-name/class-name coupling) unless explicitly authorized.&lt;/constraint&gt;
    &lt;constraint&gt;No PII or confidential details in comments or logs.&lt;/constraint&gt;
  &lt;/constraints&gt;

  &lt;context&gt;
    &lt;audience_profile&gt;
      &lt;primary&gt;Code reviewers, maintainers, CI/CD systems&lt;/primary&gt;
      &lt;expertise&gt;Medium-to-high engineering literacy&lt;/expertise&gt;
      &lt;decision_need&gt;Adopt refactoring with minimal risk and maximum clarity&lt;/decision_need&gt;
    &lt;/audience_profile&gt;
    &lt;style_guide&gt;
      &lt;tone&gt;Code-first, precise&lt;/tone&gt;
      &lt;voice&gt;Conservative, evidence-seeking&lt;/voice&gt;
      &lt;format&gt;Exclusively code; unified diff or full-file output per [[output_mode]] rules&lt;/format&gt;
    &lt;/style_guide&gt;
    &lt;technical_conventions&gt;
      &lt;code_quality&gt;DRY, KISS, SOLID (where applicable), coherent naming, small functions, dependency inversion where valuable&lt;/code_quality&gt;
      &lt;error_handling&gt;Explicit error paths; no silent catches; preserve error semantics&lt;/error_handling&gt;
      &lt;typing&gt;Prefer explicit types/annotations where supported; meaningful names&lt;/typing&gt;
      &lt;concurrency&gt;Preserve thread/process safety; avoid shared mutable state; use safe synchronization primitives&lt;/concurrency&gt;
      &lt;resources&gt;Deterministic cleanup (RAII/defer/using), timeouts, backpressure&lt;/resources&gt;
      &lt;i18n_logging&gt;No PII in logs; keep existing structured logging only&lt;/i18n_logging&gt;
      &lt;tests&gt;Respect existing tests; update minimally when signatures/renames are necessary; add tests only if [[allow_test_additions]] is true&lt;/tests&gt;
    &lt;/technical_conventions&gt;
  &lt;/context&gt;

  &lt;variables&gt;
    &lt;var name=&quot;input_code&quot; type=&quot;string|json&quot; required=&quot;true&quot; description=&quot;Source code. For multiple files, provide a JSON map of file paths to contents.&quot; /&gt;
    &lt;var name=&quot;language&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;Programming language; auto-detect if not provided.&quot; /&gt;
    &lt;var name=&quot;target_language_version&quot; type=&quot;string&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;framework&quot; type=&quot;string&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;build_system&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;e.g., Maven/Gradle/npm/pip/Go modules&quot; /&gt;
    &lt;var name=&quot;style_guide&quot; type=&quot;text|link&quot; required=&quot;false&quot; description=&quot;e.g., PEP8, Google Java Style, .editorconfig, formatter config&quot; /&gt;
    &lt;var name=&quot;formatter_config&quot; type=&quot;string|json&quot; required=&quot;false&quot; description=&quot;Formatter tool and settings, if any&quot; /&gt;
    &lt;var name=&quot;enforce_reformat&quot; type=&quot;boolean&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;allowed_dependencies&quot; type=&quot;json&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;disallowed_dependencies&quot; type=&quot;json&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;refactoring_goals&quot; type=&quot;json|text&quot; required=&quot;false&quot; description=&quot;e.g., readability, modularization, performance, security, null-safety&quot; /&gt;
    &lt;var name=&quot;nfr_constraints&quot; type=&quot;json&quot; required=&quot;false&quot; description=&quot;Performance/memory/latency bounds; concurrency model&quot; /&gt;
    &lt;var name=&quot;api_stability&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;stable|compatible|may_break&quot; /&gt;
    &lt;var name=&quot;allow_breaking_changes&quot; type=&quot;boolean&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;allow_test_additions&quot; type=&quot;boolean&quot; required=&quot;false&quot; /&gt;
    &lt;var name=&quot;test_files&quot; type=&quot;json&quot; required=&quot;false&quot; description=&quot;Optional test sources to respect/update minimally&quot; /&gt;
    &lt;var name=&quot;output_mode&quot; type=&quot;string&quot; required=&quot;false&quot; description=&quot;diff|full_file. Default: diff for multi-file; full_file for single-file.&quot; /&gt;
    &lt;var name=&quot;wrap_in_fence&quot; type=&quot;boolean&quot; required=&quot;false&quot; description=&quot;If true, wrap output in triple backticks with language tag (not allowed in diff mode).&quot; /&gt;
    &lt;var name=&quot;file_metadata&quot; type=&quot;json&quot; required=&quot;false&quot; description=&quot;Paths, module names, entry points, visibility constraints&quot; /&gt;
    &lt;var name=&quot;risk_tolerance&quot; type=&quot;text&quot; required=&quot;false&quot; /&gt;
  &lt;/variables&gt;

  &lt;instructions&gt;
    &lt;instruction&gt;0. Detect language and comment syntax (or use [[language]]). Respect [[target_language_version]] and [[framework]].&lt;/instruction&gt;
    &lt;instruction&gt;1. Determine safe scope from [[refactoring_goals]], [[api_stability]], and [[allow_breaking_changes]]; default to behavior-preserving and API-stable changes.&lt;/instruction&gt;
    &lt;instruction&gt;2. Apply targeted refactorings: extraction/renaming, deduplication, clearer control flow, type hints/signatures, dependency inversion where valuable, resource-safety, null-safety, and obvious security hardening consistent with existing patterns.&lt;/instruction&gt;
    &lt;instruction&gt;3. Avoid adding/changing external dependencies beyond [[allowed_dependencies]]. No feature additions or speculative code.&lt;/instruction&gt;
    &lt;instruction&gt;4. Respect performance and memory constraints in [[nfr_constraints]]; avoid algorithmic regressions; remove obvious hotspots without micro-optimizing.&lt;/instruction&gt;
    &lt;instruction&gt;5. Preserve tests; update only as required by safe renames or extractions. Add minimal focused tests only if [[allow_test_additions]] is true.&lt;/instruction&gt;
    &lt;instruction&gt;6. If context is insufficient to refactor safely, perform the smallest safe improvement and add TODOs/clarifying questions as top-of-file comments (full_file mode only). In diff mode, emit only the diff.&lt;/instruction&gt;
    &lt;instruction&gt;7. Output rules:
      - For multiple files: output_mode must be diff; emit a valid unified diff with ---/+++ headers and @@ hunks; no comments or prose.
      - For a single file: default to full_file; emit the complete refactored file. Only code and in-file comments are allowed.
      - If [[wrap_in_fence]] is true and in full_file mode: wrap the file content in ```[[language]] fences. Do not use fences in diff mode.&lt;/instruction&gt;
    &lt;instruction&gt;8. Keep diffs review-friendly: avoid reformatting unrelated lines unless [[enforce_reformat]] is true or a formatter is explicitly provided.&lt;/instruction&gt;
    &lt;instruction&gt;9. Ensure code remains buildable with given inputs; do not reference non-existent symbols. Use TODO comments rather than fabricating missing parts.&lt;/instruction&gt;
    &lt;instruction&gt;10. Avoid cross-file renames in languages with file-name/class-name constraints unless explicitly authorized.&lt;/instruction&gt;
    &lt;instruction&gt;11. Conflict resolution defaults:
      - If [[output_mode]] conflicts with input cardinality: enforce diff for multi-file; enforce full_file for single-file.
      - Prefer API stability over stylistic changes when in conflict.
      - Prefer minimal-diff transformations when multiple equivalent refactors exist.&lt;/instruction&gt;
    &lt;instruction&gt;12. Self-check before emitting:
      - Validate output format: diff vs full file, headers/hunks correctness (diff), and no extra text.
      - Confirm license headers, encodings, and line endings are preserved.
      - Confirm no new dependencies and no removed required dependencies.
      - Confirm public APIs unchanged unless explicitly allowed.
      - Confirm no unrelated reformatting unless [[enforce_reformat]] is true.
      - Confirm resource-safety and error-handling remain correct and explicit.
      - Confirm changes compile conceptually and do not introduce missing symbols.&lt;/instruction&gt;
  &lt;/instructions&gt;

  &lt;input_data&gt;
    &lt;input_code&gt;[[placeholder]]&lt;/input_code&gt;
    &lt;language&gt;[[placeholder]]&lt;/language&gt;
    &lt;target_language_version&gt;[[placeholder]]&lt;/target_language_version&gt;
    &lt;framework&gt;[[placeholder]]&lt;/framework&gt;
    &lt;build_system&gt;[[placeholder]]&lt;/build_system&gt;
    &lt;style_guide&gt;[[placeholder]]&lt;/style_guide&gt;
    &lt;formatter_config&gt;[[placeholder]]&lt;/formatter_config&gt;
    &lt;enforce_reformat&gt;[[placeholder]]&lt;/enforce_reformat&gt;
    &lt;allowed_dependencies&gt;[[placeholder]]&lt;/allowed_dependencies&gt;
    &lt;disallowed_dependencies&gt;[[placeholder]]&lt;/disallowed_dependencies&gt;
    &lt;refactoring_goals&gt;[[placeholder]]&lt;/refactoring_goals&gt;
    &lt;nfr_constraints&gt;[[placeholder]]&lt;/nfr_constraints&gt;
    &lt;api_stability&gt;[[placeholder]]&lt;/api_stability&gt;
    &lt;allow_breaking_changes&gt;[[placeholder]]&lt;/allow_breaking_changes&gt;
    &lt;allow_test_additions&gt;[[placeholder]]&lt;/allow_test_additions&gt;
    &lt;test_files&gt;[[placeholder]]&lt;/test_files&gt;
    &lt;output_mode&gt;[[placeholder]]&lt;/output_mode&gt;
    &lt;wrap_in_fence&gt;[[placeholder]]&lt;/wrap_in_fence&gt;
    &lt;file_metadata&gt;[[placeholder]]&lt;/file_metadata&gt;
    &lt;risk_tolerance&gt;[[placeholder]]&lt;/risk_tolerance&gt;
  &lt;/input_data&gt;

  &lt;output_format_specification&gt;
    &lt;overall&gt;Exclusively code. No explanatory prose. Diff mode: valid unified diff. Full_file mode: complete file content(s) only. Fences allowed only if [[wrap_in_fence]] is true and not in diff mode.&lt;/overall&gt;
    &lt;modes&gt;
      &lt;diff&gt;
        &lt;rule&gt;Emit a unified diff across provided file paths with correct headers (--- a/path, +++ b/path) and @@ hunks.&lt;/rule&gt;
        &lt;rule&gt;No comments or extra lines beyond the diff format.&lt;/rule&gt;
      &lt;/diff&gt;
      &lt;full_file&gt;
        &lt;rule&gt;Emit a single, compilable file. Place any minimal assumptions/TODOs as top-of-file comments using the language’s comment syntax.&lt;/rule&gt;
        &lt;rule&gt;Do not output multiple full files; use diff mode for multi-file inputs.&lt;/rule&gt;
      &lt;/full_file&gt;
    &lt;/modes&gt;
    &lt;formatting_rules&gt;
      &lt;rule&gt;Respect provided style guides/formatters; otherwise maintain consistent indentation, naming, imports.&lt;/rule&gt;
      &lt;rule&gt;Preserve license headers and file-level annotations.&lt;/rule&gt;
      &lt;rule&gt;Do not change line endings/encodings.&lt;/rule&gt;
    &lt;/formatting_rules&gt;
  &lt;/output_format_specification&gt;

  &lt;examples&gt;
    &lt;example id=&quot;python-single-file-full&quot;&gt;
      &lt;input_data&gt;
        &lt;input_code&gt;&lt;![CDATA[
def process(items):
    result = []
    i = 0
    while i &lt; len(items):
        x = items[i]
        if x is not None and x != &quot;&quot;:
            if isinstance(x, str):
                result.append(x.strip().lower())
            else:
                result.append(str(x))
        i = i + 1
    return result
        ]]&gt;&lt;/input_code&gt;
        &lt;language&gt;python&lt;/language&gt;
        &lt;output_mode&gt;full_file&lt;/output_mode&gt;
        &lt;wrap_in_fence&gt;true&lt;/wrap_in_fence&gt;
        &lt;refactoring_goals&gt;{&quot;readability&quot;: true, &quot;duplication&quot;: true}&lt;/refactoring_goals&gt;
      &lt;/input_data&gt;
      &lt;output&gt;&lt;![CDATA[
```python
from typing import Iterable, List, Any

def process(items: Iterable[Any]) -&gt; List[str]:
    # TODO: Confirm inputs may include None, strings, and other types; behavior preserved.
    result: List[str] = []
    for x in items:
        if x is None or x == &quot;&quot;:
            continue
        result.append(x.strip().lower() if isinstance(x, str) else str(x))
    return result
```
      ]]&gt;&lt;/output&gt;
    &lt;/example&gt;

    &lt;example id=&quot;java-multi-file-diff&quot;&gt;
      &lt;input_data&gt;
        &lt;input_code&gt;&lt;![CDATA[
{
  &quot;src/main/java/app/Service.java&quot;: &quot;package app;\n\npublic class Service {\n    public String greet(String name) {\n        if (name == null || name.trim().equals(\&quot;\&quot;)) {\n            name = \&quot;world\&quot;;\n        }\n        return \&quot;Hello, \&quot; + name + \&quot;!\&quot;;\n    }\n}\n&quot;,
  &quot;src/test/java/app/ServiceTest.java&quot;: &quot;package app;\n\nimport org.junit.jupiter.api.Test;\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass ServiceTest {\n    @Test void greet() {\n        assertEquals(\&quot;Hello, world!\&quot;, new Service().greet(\&quot;\&quot;));\n        assertEquals(\&quot;Hello, Alice!\&quot;, new Service().greet(\&quot;Alice\&quot;));\n    }\n}\n&quot;
}
        ]]&gt;&lt;/input_code&gt;
        &lt;language&gt;java&lt;/language&gt;
        &lt;output_mode&gt;diff&lt;/output_mode&gt;
      &lt;/input_data&gt;
      &lt;output&gt;&lt;![CDATA[
diff --git a/src/main/java/app/Service.java b/src/main/java/app/Service.java
index 1111111..2222222 100644
--- a/src/main/java/app/Service.java
+++ b/src/main/java/app/Service.java
@@ -1,10 +1,16 @@
 package app;
 
 public class Service {
-    public String greet(String name) {
-        if (name == null || name.trim().equals(&quot;&quot;)) {
-            name = &quot;world&quot;;
-        }
-        return &quot;Hello, &quot; + name + &quot;!&quot;;
-    }
+  public String greet(String name) {
+    final String normalized = normalizeName(name);
+    return &quot;Hello, &quot; + normalized + &quot;!&quot;;
+  }
+
+  private String normalizeName(String name) {
+    if (name == null || name.trim().isEmpty()) {
+      return &quot;world&quot;;
+    }
+    return name.trim();
+  }
 }
      ]]&gt;&lt;/output&gt;
    &lt;/example&gt;

    &lt;example id=&quot;typescript-multi-file-diff&quot;&gt;
      &lt;input_data&gt;
        &lt;input_code&gt;&lt;![CDATA[
{
  &quot;src/util.ts&quot;: &quot;export function pad(s: string, len: number) { while (s.length &lt; len) { s = s + &#39; &#39;; } return s; }\n&quot;,
  &quot;src/index.ts&quot;: &quot;import { pad } from &#39;./util&#39;;\nconsole.log(pad(&#39;hi&#39;, 5));\n&quot;
}
        ]]&gt;&lt;/input_code&gt;
        &lt;language&gt;typescript&lt;/language&gt;
        &lt;target_language_version&gt;4.9&lt;/target_language_version&gt;
        &lt;output_mode&gt;diff&lt;/output_mode&gt;
        &lt;refactoring_goals&gt;{&quot;readability&quot;: true, &quot;performance&quot;: true}&lt;/refactoring_goals&gt;
      &lt;/input_data&gt;
      &lt;output&gt;&lt;![CDATA[
diff --git a/src/util.ts b/src/util.ts
index a1b2c3d..d4e5f6a 100644
--- a/src/util.ts
+++ b/src/util.ts
@@ -1 +1,9 @@
-export function pad(s: string, len: number) { while (s.length &lt; len) { s = s + &#39; &#39;; } return s; }
+export function pad(s: string, len: number): string {
+  let out = s;
+  // Avoid quadratic behavior by appending once.
+  const deficit = len - out.length;
+  if (deficit &gt; 0) {
+    out = out + &quot; &quot;.repeat(deficit);
+  }
+  return out;
+}
      ]]&gt;&lt;/output&gt;
    &lt;/example&gt;
  &lt;/examples&gt;</code>
</section>]]></content><author><name></name></author><category term="AI&gt;prompt" /></entry><entry><title type="html">Intel GPU SR-IOV virtualization</title><link href="https://ib.bsb.br/intel-gpu-sr-iov-virtualization/" rel="alternate" type="text/html" title="Intel GPU SR-IOV virtualization" /><published>2025-08-08T00:00:00+00:00</published><updated>2025-08-08T22:44:50+00:00</updated><id>https://ib.bsb.br/intel-gpu-sr-iov-virtualization</id><content type="html" xml:base="https://ib.bsb.br/intel-gpu-sr-iov-virtualization/"><![CDATA[<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

# ==============================================================================
# Fully Automated Intel GPU SR-IOV Host Setup Script
#
# This script is a robust, idempotent, and fully automated solution for
# configuring an Ubuntu host for Intel GPU SR-IOV virtualization.
#
# It performs the following actions:
# 1.  Auto-detects the primary Intel GPU.
# 2.  Verifies the system has virtualization and SR-IOV capabilities.
# 3.  Installs all necessary dependencies (git, dkms, etc.).
# 4.  Safely and idempotently configures GRUB with required kernel parameters.
# 5.  Clones, builds, and installs the i915-sriov-dkms driver from source.
# 6.  Configures sysfs to persist Virtual Function (VF) creation on boot.
#
# USAGE:
#   chmod +x setup_sriov_host.sh
#   sudo ./setup_sriov_host.sh [num_vfs]
#
#   [num_vfs] is an optional argument for the number of Virtual Functions.
#   If not provided, it defaults to 7.
#
# ==============================================================================

set -e # Exit immediately if a command exits with a non-zero status.

# --- Configuration &amp; Colors ---
NUM_VFS=${1:-7} # Default to 7 VFs if no argument is provided
DRIVER_REPO="https://github.com/strongtz/i915-sriov-dkms.git"
DKMS_NAME="i915-sriov-dkms"
DKMS_VERSION="1.22.07.20"

# Color codes for output
C_RESET='\033[0m'
C_RED='\033[0;31m'
C_GREEN='\033[0;32m'
C_YELLOW='\033[0;33m'
C_BLUE='\033[0;34m'

# --- Helper Functions ---

# Print a formatted message
log() {
    echo -e "${C_BLUE}INFO:${C_RESET} $1"
}

# Print a success message
success() {
    echo -e "${C_GREEN}SUCCESS:${C_RESET} $1"
}

# Print a warning message
warn() {
    echo -e "${C_YELLOW}WARNING:${C_RESET} $1"
}

# Print an error message and exit
error_exit() {
    echo -e "${C_RED}ERROR:${C_RESET} $1" &gt;&amp;2
    exit 1
}

# Check if the script is run as root
check_root() {
    if [[ $EUID -ne 0 ]]; then
       error_exit "This script must be run as root. Please use sudo."
    fi
}

# Auto-detect the primary Intel GPU's PCI address
autodetect_gpu() {
    log "Detecting primary Intel VGA controller..."
    GPU_PCI_ADDRESS=$(lspci -nn | grep -i 'VGA compatible controller.*Intel' | head -n1 | awk '{print $1}')
    if [[ -z "$GPU_PCI_ADDRESS" ]]; then
        error_exit "Could not find an Intel VGA compatible controller."
    fi
    success "Found Intel GPU at PCI address: $GPU_PCI_ADDRESS"
}

# Verify hardware and kernel support
verify_prerequisites() {
    log "Verifying system prerequisites..."
    # Check for CPU virtualization support
    if ! grep -q -E 'vmx|svm' /proc/cpuinfo; then
        error_exit "CPU virtualization (VT-x/AMD-V) is not enabled in the BIOS."
    fi
    success "CPU virtualization is enabled."

    # Check for SR-IOV capability on the detected GPU
    if ! lspci -vvv -s "$GPU_PCI_ADDRESS" | grep -iq "Single Root I/O Virtualization"; then
        warn "This GPU does not report SR-IOV capabilities. The process may fail."
    else
        success "GPU reports SR-IOV capabilities."
    fi
}


# --- Main Logic Functions ---

install_dependencies() {
    log "Updating package lists and installing dependencies..."
    apt-get update &gt; /dev/null
    apt-get install -y git dkms sysfsutils build-essential linux-headers-$(uname -r)
    success "Dependencies installed."
}

# Safely and idempotently configure GRUB
configure_grub() {
    log "Configuring GRUB for IOMMU and SR-IOV..."
    local GRUB_FILE="/etc/default/grub"
    local PARAMS_TO_ADD=("intel_iommu=on" "i915.enable_guc=3")
    
    local CURRENT_CMDLINE=$(grep "GRUB_CMDLINE_LINUX_DEFAULT" "$GRUB_FILE" | cut -d'"' -f2)
    local NEW_CMDLINE="$CURRENT_CMDLINE"
    local CHANGES_MADE=0

    for param in "${PARAMS_TO_ADD[@]}"; do
        if ! [[ "$CURRENT_CMDLINE" =~ $param ]]; then
            NEW_CMDLINE="$NEW_CMDLINE $param"
            CHANGES_MADE=1
            log "Adding kernel parameter: $param"
        fi
    done

    if [[ $CHANGES_MADE -eq 1 ]]; then
        log "Backing up GRUB config to ${GRUB_FILE}.bak"
        cp "$GRUB_FILE" "${GRUB_FILE}.bak"
        sed -i "s#GRUB_CMDLINE_LINUX_DEFAULT=\"$CURRENT_CMDLINE\"#GRUB_CMDLINE_LINUX_DEFAULT=\"$NEW_CMDLINE\"#" "$GRUB_FILE"
        success "GRUB configuration updated."
    else
        success "GRUB parameters are already correctly configured."
    fi
    
    log "Updating GRUB and initramfs..."
    update-grub
    update-initramfs -u -k all
    success "GRUB and initramfs updated."
}


# Clone, build, and install the DKMS driver from source
clone_and_install_driver() {
    log "Cloning and installing i915-sriov-dkms driver..."
    local DRIVER_DIR="/usr/src/${DKMS_NAME}-${DKMS_VERSION}"

    if [ -d "$DRIVER_DIR" ]; then
        warn "Driver source directory already exists. Assuming it's installed."
        return
    fi

    log "Cloning repository from $DRIVER_REPO..."
    git clone "$DRIVER_REPO" "$DRIVER_DIR"
    
    log "Adding driver to DKMS..."
    dkms add -m "$DKMS_NAME" -v "$DKMS_VERSION"
    log "Building driver with DKMS..."
    dkms build -m "$DKMS_NAME" -v "$DKMS_VERSION"
    log "Installing driver with DKMS..."
    dkms install -m "$DKMS_NAME" -v "$DKMS_VERSION"

    success "SR-IOV DKMS driver installed."
}

# Configure sysfs for persistent VF creation
configure_persistence() {
    log "Configuring sysfs for persistent Virtual Functions..."
    local SYSFS_CONF_FILE="/etc/sysfs.conf"
    local SYSFS_LINE="devices/pci0000:00/${GPU_PCI_ADDRESS}/sriov_numvfs = ${NUM_VFS}"

    if grep -Fxq "$SYSFS_LINE" "$SYSFS_CONF_FILE"; then
        success "sysfs is already configured for persistence."
    else
        log "Adding VF persistence rule to $SYSFS_CONF_FILE"
        echo "" &gt;&gt; "$SYSFS_CONF_FILE"
        echo "# Automatically create ${NUM_VFS} VFs for Intel GPU ${GPU_PCI_ADDRESS}" &gt;&gt; "$SYSFS_CONF_FILE"
        echo "$SYSFS_LINE" &gt;&gt; "$SYSFS_CONF_FILE"
        success "sysfs configured to create ${NUM_VFS} VFs on boot."
    fi
}

# --- Main Execution ---

main() {
    check_root
    log "🚀 Starting Fully Automated SR-IOV Host Setup..."
    log "Will configure the system to create ${C_YELLOW}${NUM_VFS}${C_RESET} Virtual Functions."
    
    autodetect_gpu
    verify_prerequisites
    install_dependencies
    configure_grub
    clone_and_install_driver
    configure_persistence
    
    echo ""
    success "🎉 ========================================================= 🎉"
    success "Host setup is complete."
    warn "A reboot is required to apply all kernel and driver changes."
    warn "Please run 'sudo reboot' now."
    success "🎉 ========================================================= 🎉"
}

main
</code></pre></div></div>]]></content><author><name></name></author><category term="scratchpad" /></entry><entry><title type="html">bee</title><link href="https://ib.bsb.br/bee/" rel="alternate" type="text/html" title="bee" /><published>2025-08-07T00:00:00+00:00</published><updated>2025-08-07T20:50:52+00:00</updated><id>https://ib.bsb.br/bee</id><content type="html" xml:base="https://ib.bsb.br/bee/"><![CDATA[<h1 id="o-santuário-da-jataí-guia-completo-para-cultivo-de-um-jardim-para-tetragonisca-angustula"><strong>O Santuário da Jataí: Guia Completo para Cultivo de um Jardim para <em>Tetragonisca angustula</em></strong></h1>

<h2 id="seção-1-entendendo-suas-moradoras-um-perfil-da-abelha-jataí-tetragonisca-angustula"><strong>Seção 1: Entendendo Suas Moradoras: Um Perfil da Abelha Jataí (<em>Tetragonisca angustula</em>)</strong></h2>

<p>A presença de uma colônia de abelhas sem ferrão na estrutura de uma casa é um evento notável, sinalizando uma intersecção entre a habitação humana e a ecologia nativa. A espécie em questão, <em>Tetragonisca angustula</em>, conhecida como abelha Jataí, é uma das polinizadoras nativas mais difundidas e adaptáveis do Brasil. Compreender a biologia, o comportamento e as necessidades específicas desta espécie é o primeiro passo fundamental para transformar um simples jardim em um santuário próspero e solidário.</p>

<h3 id="introdução-a-uma-maravilha-nativa"><strong>Introdução a uma Maravilha Nativa</strong></h3>

<p>A abelha Jataí é um membro da tribo Meliponini, um grupo diversificado de abelhas sociais sem ferrão, nativas dos trópicos. Sua notável adaptabilidade permite que ela prospere em uma ampla gama de ambientes, desde florestas preservadas até centros urbanos movimentados. Essa resiliência é uma das principais razões pelas quais ela é frequentemente encontrada nidificando em estruturas artificiais, como muros ocos, postes e caixas abandonadas.<br />
O papel da Jataí e de outras abelhas nativas sem ferrão no ecossistema brasileiro é profundo. Elas são polinizadoras essenciais para um vasto número de espécies de plantas nativas, contribuindo diretamente para a saúde e regeneração de biomas como a Mata Atlântica e o Cerrado. Seus serviços de polinização também são cruciais para muitas culturas agrícolas, incluindo café, morango, tomate e berinjela, sustentando tanto a estabilidade ecológica quanto a produtividade econômica.</p>

<h3 id="a-dieta-essencial-a-tríade-de-recursos"><strong>A Dieta Essencial: A Tríade de Recursos</strong></h3>

<p>Para nutrir eficazmente uma colônia de Jataí, é imperativo entender o que elas buscam no ambiente. Suas atividades de forrageamento estão centradas na coleta de três tipos primários de recursos, cada um cumprindo uma função biológica distinta. Um jardim de sucesso para abelhas deve fornecer um suprimento consistente e diversificado de todos os três.</p>

<ol>
  <li><strong>Néctar:</strong> Este líquido açucarado é a principal fonte de carboidratos da colônia. É o combustível que alimenta todas as atividades dentro da colmeia.</li>
  <li><strong>Pólen:</strong> Os grãos de pólen são a fonte indispensável de proteínas, lipídios, vitaminas e minerais. Este “pão de abelha” é essencial para o crescimento e a reprodução da colônia.</li>
  <li><strong>Resina:</strong> Esta substância pegajosa é um material de construção crítico. As abelhas a misturam com cera e terra para criar o cerume, usado para construir células de cria, potes de alimento e a característica entrada em formato de tubo do ninho. Plantas como Aroeira-branca (<em>Lithraea molleoides</em>), Urucum (<em>Bixa orellana</em>) e Coroa-de-cristo (<em>Euphorbia milii</em>) são conhecidas por fornecerem este recurso vital.</li>
</ol>

<h3 id="o-paradoxo-da-sensibilidade"><strong>O Paradoxo da Sensibilidade</strong></h3>

<p>A capacidade da Jataí de colonizar ambientes urbanos cria um paradoxo perigoso. Embora demonstre sua resiliência, simultaneamente as coloca nas áreas com a maior concentração de ameaças, particularmente pesticidas químicos. A realidade biológica crítica é que as abelhas nativas sem ferrão são profundamente mais sensíveis aos agroquímicos do que a abelha europeia (<em>Apis mellifera</em>).<br />
As estruturas regulatórias atuais para aprovação de pesticidas dependem quase exclusivamente de testes de toxicidade realizados em <em>Apis mellifera</em>. No entanto, pesquisas demonstram que esses padrões são perigosamente inadequados para proteger a fauna de abelhas nativas do Brasil. Estudos mostraram que a concentração de um inseticida necessária para ser letal para larvas de abelhas nativas pode ser centenas de vezes menor do que para larvas de <em>Apis</em>. Inseticidas neonicotinoides, como o tiametoxam, mesmo em doses subletais, causam alterações comportamentais significativas nas abelhas Jataí, incluindo a redução da velocidade de voo e da distância percorrida, afetando diretamente sua capacidade de forrageamento.<br />
Isso significa que um jardim tratado com pesticidas de acordo com os rótulos dos produtos — considerados “seguros” com base em dados de <em>Apis</em> — pode se tornar um campo minado tóxico para uma colônia residente de Jataí. O jardim deve ser gerenciado como um verdadeiro santuário, um refúgio isolado e livre de produtos químicos.</p>

<h2 id="seção-2-ferramentas-e-materiais-essenciais"><strong>Seção 2: Ferramentas e Materiais Essenciais</strong></h2>

<p>Antes de começar o trabalho prático, é crucial reunir as ferramentas e materiais que formarão a base do seu santuário.</p>

<h3 id="ferramentas-essenciais-de-jardinagem"><strong>Ferramentas Essenciais de Jardinagem</strong></h3>

<ul>
  <li><strong>Pá:</strong> Para cavar, virar o solo e mover materiais a granel.</li>
  <li><strong>Garfo de Jardim:</strong> Para quebrar solo compactado e arejar o composto.</li>
  <li><strong>Enxada:</strong> Para capinar e criar sulcos para o plantio.</li>
  <li><strong>Pazinha de Mão:</strong> Para plantar mudas e plantas pequenas.</li>
  <li><strong>Tesoura de Poda:</strong> Para aparar arbustos e colher ervas.</li>
  <li><strong>Regador ou Mangueira com Bico Ajustável:</strong> Para fornecer água às plantas.</li>
  <li><strong>Carrinho de Mão:</strong> Essencial para mover terra, composto e outros materiais pesados.</li>
</ul>

<h3 id="construindo-a-base-saúde-do-solo"><strong>Construindo a Base: Saúde do Solo</strong></h3>

<p>O sucesso a longo prazo da “despensa viva” para as abelhas depende inteiramente da saúde do solo. O objetivo principal é construir um solo rico em matéria orgânica.<br />
<strong>Lista de Compras para Correção do Solo:</strong></p>

<ul>
  <li><strong>Esterco de Gado Curtido:</strong> O produto que você adquiriu é uma excelente fonte de matéria orgânica e nutrientes. Ele melhora a estrutura do solo, aumenta a retenção de água e promove uma comunidade saudável de microrganismos benéficos.</li>
  <li><strong>Composto Orgânico ou Húmus de Minhoca:</strong> Se possível, adicione também estes materiais. São formas altamente concentradas de fertilizante orgânico.</li>
  <li><strong>Areia Grossa ou Vermiculita:</strong> Se o solo existente for muito argiloso, estes materiais podem ser adicionados para melhorar a drenagem e a aeração.</li>
</ul>

<h3 id="água-e-habitat-o-quarto-recurso-essencial"><strong>Água e Habitat: O Quarto Recurso Essencial</strong></h3>

<p>As abelhas precisam de água para diluir o mel, resfriar a colmeia e para seus próprios processos metabólicos. No entanto, elas podem se afogar facilmente em fontes de água abertas. Uma estação de água segura para abelhas é, portanto, uma peça essencial de infraestrutura.<br />
<strong>Lista de Compras para uma Estação de Água Segura:</strong></p>

<ul>
  <li><strong>Bacia Rasa ou Prato de Vaso:</strong> Um recipiente largo e raso é o ideal.</li>
  <li><strong>Seixos, Bolas de Gude ou Pedras de Rio:</strong> Um saco de pedras de tamanho pequeno a médio é necessário para preencher a bacia.</li>
</ul>

<h2 id="seção-3-guia-prático-construindo-seu-santuário-de-50m"><strong>Seção 3: Guia Prático: Construindo seu Santuário de 50m²</strong></h2>

<p>Este é um projeto maravilhoso. Criar um jardim dedicado tão perto da colmeia fornecerá um recurso incrível para suas abelhas Jataí.</p>

<h3 id="introdução-o-jardineiro-como-guardião"><strong>Introdução: O Jardineiro como Guardião</strong></h3>

<p>Seu jardim está posicionado de forma única a apenas dois metros da colmeia. Este não é apenas um jardim; é o quintal das abelhas, seu principal campo de forrageamento e seu ambiente direto. Essa proximidade exige uma abordagem especial, onde cada ação é gentil, deliberada e centrada nas abelhas. Nosso objetivo é criar um ecossistema vibrante e produtivo que nutra a colônia durante todo o ano, começando com as excelentes sementes de “primeira linha” que você selecionou: Manjericão, Girassol, Rainha-Margarida, Balsamina, Orégano e Melissa.</p>

<h3 id="fase-1-preparação-do-terreno-o-primeiro-fim-de-semana"><strong>Fase 1: Preparação do Terreno (O Primeiro Fim de Semana)</strong></h3>

<p>Esta fase inicial é a mais trabalhosa, mas prepara o terreno para toda a estação. Uma base bem preparada é crucial para plantas saudáveis e, por extensão, abelhas saudáveis.<br />
<strong>Passo 1: Trabalhando na “Zona das Abelhas”</strong> Dada a proximidade com a colmeia, é vital trabalhar de uma forma que não cause estresse à colônia.</p>

<ul>
  <li><strong>O Momento é Tudo:</strong> Realize seu trabalho durante as partes mais frescas do dia, como o início da manhã ou o final da tarde, quando a atividade de forrageamento é menor.</li>
  <li><strong>Mova-se Lenta e Deliberadamente:</strong> Evite movimentos bruscos e repentinos. Trabalhe com calma e em silêncio.</li>
  <li><strong>Evite Odores Fortes:</strong> Abstenha-se de usar perfumes fortes, colônias ou produtos com cheiro intenso nos dias de jardinagem.</li>
</ul>

<p><strong>Passo 2: Limpando e Definindo o Espaço</strong> Sua área de 50 metros quadrados oferece muito espaço para um layout diversificado.</p>

<ul>
  <li><strong>Limpe a Tela:</strong> Remova todas as ervas daninhas existentes, pedras grandes e detritos indesejados de toda a área.</li>
  <li><strong>Planeje seu Layout:</strong> Em vez de um grande canteiro uniforme, considere criar vários canteiros ou “ilhas” de plantas distintas. Essa abordagem não só adiciona interesse visual e cria caminhos para manutenção, mas também estabelece microclimas variados de sol e sombra e protege certas áreas do vento, beneficiando tanto as plantas quanto as abelhas.</li>
  <li><strong>Vire o Solo:</strong> Use uma pá ou garfo de jardim para afofar o solo em seus canteiros planejados a uma profundidade de cerca de 20-30 cm. Isso areja o solo e facilita o crescimento de novas raízes.</li>
</ul>

<p><strong>Passo 3: Construindo um Solo Vivo</strong> Este é o passo mais crítico para a jardinagem orgânica e segura para as abelhas. Você não está apenas alimentando as plantas; está alimentando o ecossistema do solo.</p>

<ul>
  <li><strong>Aplique o Fertilizante:</strong> Espalhe o Esterco de Gado que você comprou uniformemente sobre o solo afofado em seus canteiros, de acordo com as instruções da embalagem.</li>
  <li><strong>Adicione Matéria Orgânica:</strong> Se possível, espalhe uma camada de 5-10 cm de composto orgânico ou húmus de minhoca sobre o fertilizante. Isso melhora a estrutura do solo, a retenção de água e promove micróbios benéficos.</li>
  <li><strong>Incorpore e Misture:</strong> Usando sua pá ou garfo de jardim, misture bem o fertilizante e o composto nos 15-20 cm superiores do seu solo.</li>
  <li><strong>Nivele com o Ancinho:</strong> Use um ancinho para nivelar a superfície de seus canteiros preparados.</li>
</ul>

<p><strong>Passo 4: Instale a Estação de Água para Abelhas</strong> Antes de plantar, instale uma fonte de água segura.</p>

<ul>
  <li>Coloque um prato raso ou pires de vaso em um local visível no jardim.</li>
  <li>Encha-o com seixos, bolinhas de gude ou pedras pequenas.</li>
  <li>Adicione água fresca até a metade da altura das pedras, garantindo que o topo das pedras permaneça seco como plataformas de pouso seguras para as abelhas. Troque a água a cada 1-2 dias.</li>
</ul>

<h3 id="fase-2-plantando-seu-buffet-para-abelhas-no-dia-seguinte"><strong>Fase 2: Plantando seu Buffet para Abelhas (No Dia Seguinte)</strong></h3>

<p>Agora a parte emocionante. Com o solo preparado, é hora de semear. Uma boa estratégia de design é plantar espécies mais altas no fundo dos canteiros e as mais baixas na frente.<br />
<strong>Regra Geral de Plantio:</strong> Plante as sementes a uma profundidade de cerca de 2 a 3 vezes o seu diâmetro. Para sementes muito finas, uma leve camada de terra por cima é suficiente.<br />
<strong>Plantando Suas Sementes de “Primeira Linha”:</strong></p>

<ul>
  <li><strong>Girassol:</strong>
    <ul>
      <li><strong>Localização:</strong> Plante-os no fundo dos canteiros, pois crescerão mais altos.</li>
      <li><strong>Espaçamento:</strong> Plante as sementes a cerca de 30-40 cm de distância.</li>
      <li><strong>Método:</strong> Empurre cada semente a cerca de 2 cm de profundidade no solo e cubra. Os girassóis são uma fonte fantástica de néctar e pólen.</li>
    </ul>
  </li>
  <li><strong>Manjericão, Orégano e Melissa:</strong>
    <ul>
      <li><strong>Localização:</strong> Estas ervas crescem a uma altura média. Plante-as nas seções intermediárias dos canteiros. Todas pertencem à família Lamiaceae, que é excepcionalmente atraente para as abelhas.</li>
      <li><strong>Espaçamento:</strong> As sementes são muito pequenas. Você pode espalhá-las levemente sobre o solo preparado e depois cobri-las com uma camada muito fina (0,5 cm) de terra.</li>
      <li><strong>Método:</strong> Após brotarem, você precisará “ralear” as mudas, deixando as mais fortes a cerca de 20-25 cm de distância para que tenham espaço para crescer.</li>
    </ul>
  </li>
  <li><strong>Rainha-Margarida:</strong>
    <ul>
      <li><strong>Localização:</strong> Também funcionam bem no meio ou na frente dos canteiros. Suas flores compostas são plataformas de pouso perfeitas para as abelhas Jataí.</li>
      <li><strong>Espaçamento:</strong> Plante as sementes a cerca de 20-30 cm de distância.</li>
      <li><strong>Método:</strong> Semeie as sementes a cerca de 1 cm de profundidade e cubra levemente com terra.</li>
    </ul>
  </li>
  <li><strong>Balsamina Camélia (“Beijo”):</strong>
    <ul>
      <li><strong>Localização:</strong> Esta é uma planta mais baixa e delicada, perfeita para as bordas frontais dos seus canteiros.</li>
      <li><strong>Espaçamento:</strong> Plante as sementes a 15-20 cm de distância.</li>
      <li><strong>Método:</strong> Pressione as sementes suavemente na superfície do solo e cubra com uma fina camada de terra. A Balsamina é uma fonte de alimento comprovada para as abelhas Jataí.</li>
    </ul>
  </li>
</ul>

<p><strong>Passo 5: A Primeira Rega</strong> Após o plantio de todas as sementes, regue os canteiros suavemente com um regador ou uma mangueira no modo “chuveiro”. O objetivo é umedecer o solo completamente sem arrastar as sementes recém-plantadas.</p>

<h3 id="fase-3-cuidando-do-seu-santuário-cuidados-contínuos"><strong>Fase 3: Cuidando do seu Santuário (Cuidados Contínuos)</strong></h3>

<p>Seu papel como guardião continua enquanto o jardim cresce.</p>

<ul>
  <li><strong>Rega:</strong> Mantenha o solo consistentemente úmido até que as sementes germinem. Uma vez que as plantas estejam estabelecidas, regue profundamente 2-3 vezes por semana.</li>
  <li><strong>Controle de Ervas Daninhas:</strong> Puxe manualmente quaisquer ervas daninhas que aparecerem. <strong>Não use herbicidas químicos.</strong> Muitos produtos químicos são devastadores para as abelhas nativas. Lembre-se de que algumas “ervas daninhas” como o Picão (<em>Bidens pilosa</em>) são, na verdade, excelentes fontes de alimento.</li>
  <li><strong>Observe e Desfrute:</strong> Passe tempo observando seu jardim. Em breve, você verá as abelhas Jataí zumbindo de flor em flor, coletando o pólen e o néctar que você forneceu. Esta é a recompensa final — um sinal de que seu santuário é um sucesso.</li>
</ul>

<h2 id="seção-4-a-despensa-viva-um-calendário-floral-para-planejamento-futuro"><strong>Seção 4: A Despensa Viva: Um Calendário Floral para Planejamento Futuro</strong></h2>

<p>Enquanto a Fase 2 focou no plantio imediato com as sementes que você adquiriu, esta seção serve como uma ferramenta de planejamento estratégico para o futuro. O objetivo é expandir seu jardim para garantir uma fonte de alimento contínua e diversificada durante todos os meses do ano.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Nome Popular</th>
      <th style="text-align: left">Nome Científico</th>
      <th style="text-align: left">Tipo</th>
      <th style="text-align: left">Recursos</th>
      <th style="text-align: left">Jan</th>
      <th style="text-align: left">Fev</th>
      <th style="text-align: left">Mar</th>
      <th style="text-align: left">Abr</th>
      <th style="text-align: left">Mai</th>
      <th style="text-align: left">Jun</th>
      <th style="text-align: left">Jul</th>
      <th style="text-align: left">Ago</th>
      <th style="text-align: left">Set</th>
      <th style="text-align: left">Out</th>
      <th style="text-align: left">Nov</th>
      <th style="text-align: left">Dez</th>
      <th style="text-align: left">Fonte</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Ervas e Forrações</strong></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Manjericão</td>
      <td style="text-align: left"><em>Ocimum spp.</em></td>
      <td style="text-align: left">Erva</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Orégano</td>
      <td style="text-align: left"><em>Origanum vulgare</em></td>
      <td style="text-align: left">Erva</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Picão Branco</td>
      <td style="text-align: left"><em>Galinsoga parviflora</em></td>
      <td style="text-align: left">Erva</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Onze-horas</td>
      <td style="text-align: left"><em>Portulaca oleracea</em></td>
      <td style="text-align: left">Forração</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Cosmos</td>
      <td style="text-align: left"><em>Cosmos bipinnatus</em></td>
      <td style="text-align: left">Anual</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Girassol</td>
      <td style="text-align: left"><em>Helianthus annuus</em></td>
      <td style="text-align: left">Anual</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Arbustos e Trepadeiras</strong></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Coroa-de-cristo</td>
      <td style="text-align: left"><em>Euphorbia milii</em></td>
      <td style="text-align: left">Arbusto</td>
      <td style="text-align: left">N, P, R</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Esponjinha Vermelha</td>
      <td style="text-align: left"><em>Calliandra tweediei</em></td>
      <td style="text-align: left">Arbusto</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Assa-peixe</td>
      <td style="text-align: left"><em>Vernonia polyanthes</em></td>
      <td style="text-align: left">Arbusto</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Margaridão Amarelo</td>
      <td style="text-align: left"><em>Tithonia diversifolia</em></td>
      <td style="text-align: left">Arbusto</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Amor-agarradinho</td>
      <td style="text-align: left"><em>Antigonon leptopus</em></td>
      <td style="text-align: left">Trepadeira</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Árvores</strong></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Pitanga</td>
      <td style="text-align: left"><em>Eugenia uniflora</em></td>
      <td style="text-align: left">Árvore</td>
      <td style="text-align: left">N, P</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Aroeira-vermelha</td>
      <td style="text-align: left"><em>Schinus terebinthifolia</em></td>
      <td style="text-align: left">Árvore</td>
      <td style="text-align: left">N, P, R</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
    </tr>
    <tr>
      <td style="text-align: left">Urucum</td>
      <td style="text-align: left"><em>Bixa orellana</em></td>
      <td style="text-align: left">Árvore</td>
      <td style="text-align: left">P, R</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Quaresmeira</td>
      <td style="text-align: left"><em>Tibouchina granulosa</em></td>
      <td style="text-align: left">Árvore</td>
      <td style="text-align: left">P</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left">X</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
  </tbody>
</table>

<h2 id="seção-5-o-kit-de-ferramentas-do-guardião-manejo-orgânico-e-seguro"><strong>Seção 5: O Kit de Ferramentas do Guardião: Manejo Orgânico e Seguro</strong></h2>

<p>Criar um santuário requer uma mudança fundamental na filosofia de manejo. A sensibilidade extrema das abelhas Jataí a insumos químicos exige uma abordagem orgânica e proativa.</p>

<h3 id="a-lista-do-não-comprar-itens-proibidos"><strong>A Lista do “Não Comprar”: Itens Proibidos</strong></h3>

<ul>
  <li><strong>Plantas Tóxicas:</strong> A planta mais notória e amplamente plantada a ser evitada é a <strong>Espatódea ou Tulipeira-do-Gabão (<em>Spathodea campanulata</em>)</strong>. O néctar em seus botões florais fermenta e se torna tóxico, matando as abelhas que o visitam.</li>
  <li><strong>Pesticidas e Herbicidas Químicos:</strong> Uma proibição absoluta deve ser colocada no uso de pesticidas, fungicidas e herbicidas químicos sintéticos. De particular preocupação são os <strong>Neonicotinoides</strong> (ingredientes como tiametoxam, imidacloprida) e o <strong>Fipronil</strong>, que são sistêmicos e altamente tóxicos para as abelhas.</li>
</ul>

<h3 id="o-arsenal-orgânico-hierarquia-de-controle-de-pragas"><strong>O Arsenal Orgânico: Hierarquia de Controle de Pragas</strong></h3>

<p>Em um sistema orgânico, o controle de pragas não é sobre erradicação, mas sobre manejo e equilíbrio.</p>

<ol>
  <li><strong>Controles Culturais e Mecânicos (Primeira Prioridade):</strong> Promova a biodiversidade, cate as pragas manualmente e use jatos de água para desalojar pulgões.</li>
  <li><strong>Inseticidas Biológicos (Segunda Prioridade):</strong> Se uma infestação exigir intervenção, use um agente biológico direcionado. Produtos contendo <strong><em>Bacillus thuringiensis</em></strong> <strong>(Bt)</strong> são eficazes contra lagartas e não são tóxicos para as abelhas.</li>
  <li><strong>Repelentes Caseiros (Terceira Prioridade - Usar com Cautela):</strong> Sprays feitos de alho, cebola, pimenta ou vinagre podem repelir pragas. <strong>REGRA DE SEGURANÇA CRÍTICA:</strong> Aplique estes sprays <strong>apenas ao entardecer ou muito cedo pela manhã</strong>, quando as abelhas não estão forrageando ativamente.</li>
  <li><strong>Botânicos de Amplo Espectro (Último Recurso - Abordagem de Precaução):</strong> Esta categoria inclui o <strong>Óleo de Neem</strong>. A literatura científica apresenta dados conflitantes: um estudo em flores de tomate não encontrou efeito repelente ou letal , enquanto outras fontes o listam como nocivo para abelhas. Diante da comprovada hipersensibilidade das abelhas nativas em comparação com a <em>Apis mellifera</em> , a recomendação mais prudente e segura para um santuário é <strong>evitar seu uso completamente</strong>, aplicando o princípio da precaução.</li>
</ol>

<h2 id="seção-6-a-despensa-de-emergência-protocolos-de-alimentação-suplementar"><strong>Seção 6: A Despensa de Emergência: Protocolos de Alimentação Suplementar</strong></h2>

<p>Mesmo no jardim mais bem planejado, pode haver momentos em que uma colônia de Jataí precise de suporte nutricional direto, especialmente durante períodos prolongados de chuva ou frio (a <em>entressafra</em>).</p>

<h3 id="ingredientes-para-a-despensa-de-emergência"><strong>Ingredientes para a Despensa de Emergência</strong></h3>

<ul>
  <li><strong>Açúcar Cristal:</strong> Este é o único tipo de açúcar que deve ser usado. Não use açúcar mascavo, demerara ou qualquer outro tipo.</li>
  <li><strong>Limão Tahiti:</strong> O suco de limão ajuda a inverter a sacarose, tornando-a mais fácil de digerir para as abelhas.</li>
  <li><strong>Extrato de Própolis (Opcional, mas Recomendado):</strong> Possui propriedades antimicrobianas que ajudam a prevenir a fermentação do xarope.</li>
</ul>

<h3 id="receita-e-técnicas-de-alimentação"><strong>Receita e Técnicas de Alimentação</strong></h3>

<p>A formulação do xarope e o método de entrega são críticos para a segurança.<br />
<strong>Receita de Xarope Energético para Jataí (Tribo Trigonini) :</strong></p>

<ul>
  <li><strong>Ingredientes:</strong>
    <ul>
      <li>1 kg de açúcar cristal</li>
      <li>1 litro de água</li>
      <li>40 ml de suco de limão Tahiti sem sementes</li>
      <li>1 ml (cerca de 20 gotas) de extrato de própolis (se usar)</li>
    </ul>
  </li>
  <li><strong>Método de Preparo:</strong>
    <ol>
      <li>Combine a água e o açúcar em uma panela.</li>
      <li>Aqueça suavemente, mexendo continuamente. <strong>NÃO DEIXE FERVER.</strong> A fervura pode caramelizar o açúcar, que é tóxico para as abelhas.</li>
      <li>Assim que todo o açúcar se dissolver, desligue o fogo.</li>
      <li>Deixe o xarope esfriar um pouco e, em seguida, adicione o suco de limão e o extrato de própolis.</li>
      <li>Deixe o xarope esfriar completamente até a temperatura ambiente antes de servir.</li>
    </ol>
  </li>
</ul>

<h3 id="instruções-críticas-de-segurança-para-alimentação"><strong>Instruções Críticas de Segurança para Alimentação</strong></h3>

<ul>
  <li><strong>Design do Alimentador:</strong> O alimentador mais seguro e eficaz para a Jataí é uma simples <strong>tampinha de garrafa PET</strong>.</li>
  <li><strong>Prevenção de Afogamento:</strong> Preencha a tampinha com materiais pequenos e ásperos que possam servir como apoios e escadas para as abelhas (pequenos galhos, folhas de grama). Estes materiais devem quebrar a tensão superficial do líquido.</li>
  <li><strong>Quantidade e Frequência:</strong> Forneça apenas <strong>5 a 10 ml</strong> de xarope de cada vez (uma ou duas tampinhas). Ofereça o alimento 1 a 2 vezes por semana durante os períodos de escassez. Se sobrar xarope no dia seguinte, remova-o imediatamente para evitar a fermentação e ofereça uma quantidade menor na próxima vez.</li>
</ul>]]></content><author><name></name></author><category term="scratchpad" /></entry></feed>