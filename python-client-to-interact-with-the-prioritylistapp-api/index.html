<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        Python client to interact with the `prioritylist.app` API - infoBAG
      
    </title>
    <meta name="title" content="Python client to interact with the `prioritylist.app` API - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/python-client-to-interact-with-the-prioritylistapp-api/">
    <meta property="og:title" content="Python client to interact with the `prioritylist.app` API - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/python-client-to-interact-with-the-prioritylistapp-api/">
    <meta name="twitter:title" content="Python client to interact with the `prioritylist.app` API - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/python-client-to-interact-with-the-prioritylistapp-api/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          Python client to interact with the `prioritylist.app` API
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-06-18T00:00:00+00:00" class="post-date">
          18 Jun 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-06-18T20:22:43+00:00">
              18 Jun 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/python-client-to-interact-with-the-prioritylistapp-api" class="tag">python-client-to-interact-with-the-prioritylistapp-api</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        48199 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        4892 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-06-18-python-client-to-interact-with-the-prioritylistapp-api.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-06-18-python-client-to-interact-with-the-prioritylistapp-api.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#api-analysis">API Analysis</a><ul><li><a href="#1-authentication-mechanism"><strong>1. Authentication Mechanism</strong></a></li><li><a href="#2-api-design-patterns"><strong>2. API Design Patterns</strong></a></li><li><a href="#3-endpoint-reference"><strong>3. Endpoint Reference</strong></a><ul><li><a href="#list--group-actions"><strong>List &amp; Group Actions</strong></a></li><li><a href="#sublist-actions"><strong>Sublist Actions</strong></a></li><li><a href="#item-task-actions"><strong>Item (Task) Actions</strong></a></li><li><a href="#notification--access-actions"><strong>Notification &amp; Access Actions</strong></a></li></ul></li></ul></li><li><a href="#python-api-client">Python API Client</a></li><li><a href="#quick-start-for-advanced-users">Quick Start for Advanced Users</a></li><li><a href="#11-system-dependencies">1.1. System Dependencies</a></li><li><a href="#12-creating-a-python-virtual-environment-best-practice">1.2. Creating a Python Virtual Environment (Best Practice)</a></li><li><a href="#13-installing-script-dependencies">1.3. Installing Script Dependencies</a></li><li><a href="#21-saving-the-script">2.1. Saving the Script</a></li><li><a href="#22-making-the-script-globally-executable">2.2. Making the Script Globally Executable</a></li><li><a href="#31-finding-your-phpsessid-and-rkey">3.1. Finding Your <code class="language-plaintext highlighter-rouge">PHPSESSID</code> and <code class="language-plaintext highlighter-rouge">rkey</code></a></li><li><a href="#32-storing-your-credentials-securely">3.2. Storing Your Credentials Securely</a></li><li><a href="#33-security-considerations">3.3. Security Considerations</a></li><li><a href="#41-global-options">4.1. Global Options</a></li><li><a href="#42-list-commands">4.2. List Commands</a></li><li><a href="#43-sublist-commands">4.3. Sublist Commands</a></li><li><a href="#44-task-commands">4.4. Task Commands</a></li><li><a href="#45-interactive-repl-mode">4.5. Interactive REPL Mode</a><ul><li><a href="#command-line-interface-cli-and-user-experience-ux"><strong>Command-Line Interface (CLI) and User Experience (UX)</strong></a></li><li><a href="#4-security-enhancements"><strong>4. Security Enhancements</strong></a></li></ul></li></ul>
          <h3 id="api-analysis">
    
    
     <a href="#api-analysis">#</a><a href="#" aria-label="Back to top">API Analysis</a>
        
    
  </h3>
      
  <h4 id="1-authentication-mechanism">
    
    
     <a href="#1-authentication-mechanism">#</a><a href="#" aria-label="Back to top"><strong>1. Authentication Mechanism</strong></a>
        
    
  </h4>
      

<p>The API does not use a visible token in an <code class="language-plaintext highlighter-rouge">Authorization</code> header. Authentication is managed via session cookies that must be included with every API request to the <code class="language-plaintext highlighter-rouge">/api/</code> endpoints.</p>

<ul>
  <li><strong>Mechanism</strong>: Cookie-based session.</li>
  <li><strong>Required Cookies</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">PHPSESSID</code>: The primary PHP session identifier.</li>
      <li><code class="language-plaintext highlighter-rouge">rkey</code>: A custom, long-lived key that appears to be essential for maintaining the authenticated session.</li>
    </ul>
  </li>
  <li><strong>Required Headers</strong>: All API calls observed in the HAR file include the <code class="language-plaintext highlighter-rouge">X-Requested-With: XMLHttpRequest</code> header, indicating they are intended to be called via AJAX.</li>
  <li><strong>Note on Login Flow</strong>: The provided HAR data <strong>does not</strong> include the initial login request. Therefore, to use the generated Python client, you must first log in through a web browser, extract the <code class="language-plaintext highlighter-rouge">PHPSESSID</code> and <code class="language-plaintext highlighter-rouge">rkey</code> cookie values, and provide them to the client.</li>
</ul>
  <h4 id="2-api-design-patterns">
    
    
     <a href="#2-api-design-patterns">#</a><a href="#" aria-label="Back to top"><strong>2. API Design Patterns</strong></a>
        
    
  </h4>
      

<ul>
  <li><strong>Request Chaining</strong>: The API is designed hierarchically. Creating a child object (like a task) requires the ID of its parent (a sublist), which in turn requires the ID of its parent (a list). A typical workflow is a chain of <code class="language-plaintext highlighter-rouge">add</code> requests, where the ID from one response is used in the payload of the next.</li>
  <li><strong>Response on Creation</strong>: When a new object is created (e.g., adding a task), the API’s response body contains the full, updated data of the <em>parent object</em>. For example, adding a task to a sublist returns the entire sublist object, now including the newly created task in its <code class="language-plaintext highlighter-rouge">items</code> array. The client code must parse this parent object to find the ID of the newly created child.</li>
</ul>
  <h4 id="3-endpoint-reference">
    
    
     <a href="#3-endpoint-reference">#</a><a href="#" aria-label="Back to top"><strong>3. Endpoint Reference</strong></a>
        
    
  </h4>
      

<p>The following endpoints were identified from the HAR data. All endpoints use the <code class="language-plaintext highlighter-rouge">POST</code> method and are relative to <code class="language-plaintext highlighter-rouge">https://prioritylist.app</code>.</p>
  <h5 id="list--group-actions">
    
    
     <a href="#list--group-actions">#</a><a href="#" aria-label="Back to top"><strong>List &amp; Group Actions</strong></a>
        
    
  </h5>
      

<table>
  <thead>
    <tr>
      <th style="text-align: left">Endpoint</th>
      <th style="text-align: left">Method</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/groups/pull</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Fetches all list groups and the lists they contain.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/add</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Creates a new list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/update</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Updates the name of an existing list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/star</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Toggles the “starred” status of a list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/pull</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Fetches the detailed contents of a specific list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/notes</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Saves or updates the notes for a list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/focus</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Sets a list to “focus” mode.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/list/unfocus</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Removes a list from “focus” mode.</td>
    </tr>
  </tbody>
</table>

<p><strong>Payload for <code class="language-plaintext highlighter-rouge">POST /api/list/add</code></strong>
| Parameter | Type | Required | Description |
| :— | :— | :— | :— |
| <code class="language-plaintext highlighter-rouge">name</code> | string | Yes | The name of the new list. |
| <code class="language-plaintext highlighter-rouge">group_id</code>| string | No | The ID of the group to add the list to. |</p>
  <h5 id="sublist-actions">
    
    
     <a href="#sublist-actions">#</a><a href="#" aria-label="Back to top"><strong>Sublist Actions</strong></a>
        
    
  </h5>
      

<table>
  <thead>
    <tr>
      <th style="text-align: left">Endpoint</th>
      <th style="text-align: left">Method</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/sublist/add</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Adds a new sublist to a parent list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/sublist/update</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Updates the name of an existing sublist.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/sublist/show</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Toggles the visibility of a sublist in the UI.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/sublist/reorder</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Changes the display order of sublists.</td>
    </tr>
  </tbody>
</table>

<p><strong>Payload for <code class="language-plaintext highlighter-rouge">POST /api/sublist/add</code></strong>
| Parameter | Type | Required | Description |
| :— | :— | :— | :— |
| <code class="language-plaintext highlighter-rouge">list_id</code> | integer | Yes | The ID of the parent list. |
| <code class="language-plaintext highlighter-rouge">name</code> | string | Yes | The name of the new sublist. |</p>
  <h5 id="item-task-actions">
    
    
     <a href="#item-task-actions">#</a><a href="#" aria-label="Back to top"><strong>Item (Task) Actions</strong></a>
        
    
  </h5>
      

<table>
  <thead>
    <tr>
      <th style="text-align: left">Endpoint</th>
      <th style="text-align: left">Method</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/item/add</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Creates a new task (item) within a sublist.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/item/update</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Updates an existing task.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/item/update-name</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Updates only the name of a task.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/subitems/pull</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Fetches the sub-items for a given parent item.</td>
    </tr>
  </tbody>
</table>

<p><strong>Payload for <code class="language-plaintext highlighter-rouge">POST /api/item/add</code></strong>
| Parameter | Type | Required | Description |
| :— | :— | :— | :— |
| <code class="language-plaintext highlighter-rouge">sublist_id</code> | integer | Yes | The ID of the parent sublist. |
| <code class="language-plaintext highlighter-rouge">name</code> | string | Yes | The name of the task. |
| <code class="language-plaintext highlighter-rouge">score_i</code> | integer | Yes | Importance score (e.g., 1-10). |
| <code class="language-plaintext highlighter-rouge">score_t</code> | integer | Yes | Urgency/Time score (e.g., 1-10). |
| <code class="language-plaintext highlighter-rouge">d_date</code> | string | No | Due date in <code class="language-plaintext highlighter-rouge">YYYY-MM-DD</code> format. |
| <code class="language-plaintext highlighter-rouge">d_time</code> | string | No | Due time in <code class="language-plaintext highlighter-rouge">HH:MM</code> format. |
| <code class="language-plaintext highlighter-rouge">d_zone</code> | string | No | Timezone offset (e.g., <code class="language-plaintext highlighter-rouge">-0300</code>). |
| <code class="language-plaintext highlighter-rouge">dependency_id</code>| integer | No | The ID of a prerequisite task. |</p>
  <h5 id="notification--access-actions">
    
    
     <a href="#notification--access-actions">#</a><a href="#" aria-label="Back to top"><strong>Notification &amp; Access Actions</strong></a>
        
    
  </h5>
      

<table>
  <thead>
    <tr>
      <th style="text-align: left">Endpoint</th>
      <th style="text-align: left">Method</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/notifications/all</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Fetches all notifications.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/notifications/count</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Gets the count of unread notifications.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/access/pull</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Retrieves sharing information for a list.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST /api/access/public</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">POST</code></td>
      <td style="text-align: left">Toggles the public visibility of a list.</td>
    </tr>
  </tbody>
</table>
  <h3 id="python-api-client">
    
    
     <a href="#python-api-client">#</a><a href="#" aria-label="Back to top">Python API Client</a>
        
    
  </h3>
      

<p>The following Python script provides a reusable <code class="language-plaintext highlighter-rouge">PriorityListApiClient</code> class to interact with the API. It is designed to be used with session cookies extracted from a browser.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">PriorityListApiClient</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    A client for interacting with the prioritylist.app API.

    This client handles session management via cookies and provides methods for
    automating the creation and management of lists, sublists, and tasks.
    </span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">phpsessid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rkey</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://prioritylist.app</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Initializes the API client with the necessary authentication cookies.

        Args:
            phpsessid (str): The PHPSESSID cookie value from a browser session.
            rkey (str): The rkey cookie value from a browser session.
            base_url (str, optional): The base URL of the API.
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>

        <span class="c1"># Set common headers observed in the HAR file for all requests
</span>        <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">User-Agent</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">Accept</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">text/plain, */*; q=0.01</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">X-Requested-With</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">XMLHttpRequest</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">Origin</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">base_url</span>
        <span class="p">})</span>

        <span class="c1"># Set the authentication cookies for the session.
</span>        <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">PHPSESSID</span><span class="sh">"</span><span class="p">,</span> <span class="n">phpsessid</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="sh">"</span><span class="s">prioritylist.app</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">rkey</span><span class="sh">"</span><span class="p">,</span> <span class="n">rkey</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="sh">"</span><span class="s">prioritylist.app</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_request</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">
        A helper method to make POST requests to the API and handle responses.

        Args:
            endpoint (str): The API endpoint path (e.g., </span><span class="sh">'</span><span class="s">/list/add</span><span class="sh">'</span><span class="s">).
            data (dict, optional): The form-encoded payload to send.

        Returns:
            dict: The </span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="s"> field from the JSON response, or None if an error occurs.
        </span><span class="sh">"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/api</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise HTTPError for bad responses (4xx or 5xx)
</span>            
            <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">json_response</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">result</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json_response</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">API Error at </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">json_response</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown error</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">HTTP Error for </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">reason</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Response body: </span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Request failed for </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to decode JSON from response. URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">, Response: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">create_list</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">Creates a new list and returns its data object.</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Creating list: </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_make_request</span><span class="p">(</span><span class="sh">"</span><span class="s">/list/add</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="sh">"</span><span class="s">group_id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">})</span>
        
        <span class="k">if</span> <span class="n">response_data</span><span class="p">:</span>
            <span class="c1"># WARNING: This assumes the new list is the last in the returned array.
</span>            <span class="c1"># A more robust solution would filter by name to find the correct list.
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="n">response_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">lists</span><span class="sh">'</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">-&gt; Success! Created list </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s"> with ID: </span><span class="si">{</span><span class="n">new_list</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_list</span>
            <span class="nf">except </span><span class="p">(</span><span class="nb">IndexError</span><span class="p">,</span> <span class="nb">KeyError</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Could not find the new list in the API response.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">create_sublist</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">list_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">Creates a new sublist and returns its data object.</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Creating sublist </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s"> in list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_make_request</span><span class="p">(</span><span class="sh">"</span><span class="s">/sublist/add</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">list_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">list_id</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">:</span>
            <span class="c1"># WARNING: Assumes the new sublist is the last in the array.
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_sublist</span> <span class="o">=</span> <span class="n">response_data</span><span class="p">[</span><span class="sh">'</span><span class="s">sublists</span><span class="sh">'</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">-&gt; Success! Created sublist </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s"> with ID: </span><span class="si">{</span><span class="n">new_sublist</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_sublist</span>
            <span class="nf">except </span><span class="p">(</span><span class="nb">IndexError</span><span class="p">,</span> <span class="nb">KeyError</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Could not find the new sublist in the API response.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">create_task</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sublist_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">importance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">time_effort</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">Creates a new task and returns its data object.</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Creating task </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s"> in sublist </span><span class="si">{</span><span class="n">sublist_id</span><span class="si">}</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">sublist_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sublist_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">score_i</span><span class="sh">"</span><span class="p">:</span> <span class="n">importance</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">score_t</span><span class="sh">"</span><span class="p">:</span> <span class="n">time_effort</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">d_date</span><span class="sh">"</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">d_date</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">d_time</span><span class="sh">"</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">d_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">d_zone</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">-0300</span><span class="sh">"</span> <span class="k">if</span> <span class="n">kwargs</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">d_date</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="sh">""</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">dependency_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">dependency_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_make_request</span><span class="p">(</span><span class="sh">"</span><span class="s">/item/add</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">:</span>
            <span class="c1"># WARNING: Assumes the new item is the last in the array.
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_item</span> <span class="o">=</span> <span class="n">response_data</span><span class="p">[</span><span class="sh">'</span><span class="s">items</span><span class="sh">'</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">-&gt; Success! Created task </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s"> with ID: </span><span class="si">{</span><span class="n">new_item</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_item</span>
            <span class="nf">except </span><span class="p">(</span><span class="nb">IndexError</span><span class="p">,</span> <span class="nb">KeyError</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Could not find the new task in the API response.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">
    Main function to demonstrate the use of the ptpython REPL framework.
    </span><span class="sh">"""</span>
    <span class="c1"># --- IMPORTANT: These values must be obtained from a valid, logged-in browser session. ---
</span>    <span class="c1"># The values below are the dummy data from the provided HAR file.
</span>    <span class="n">PHPSESSID_COOKIE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">77n5cmi8mucr04afiukmatp151</span><span class="sh">"</span>
    <span class="n">RKEY_COOKIE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">413511bec626a5eb964e337e4165fee629685ac7caa75b21257604bcf5ca4b93911a8f1f6c9d5b902e598db6cc028fe91988db2590daaca4bff55e82d14028ce%3Afvwzb%3Aec91c6f9a5ae2a25515b951b30bb23297d601f184b994eda24654d6edba86bd1</span><span class="sh">"</span>

    <span class="c1"># 1. Instantiate the client with authentication cookies
</span>    <span class="n">client</span> <span class="o">=</span> <span class="nc">PriorityListApiClient</span><span class="p">(</span><span class="n">phpsessid</span><span class="o">=</span><span class="n">PHPSESSID_COOKIE</span><span class="p">,</span> <span class="n">rkey</span><span class="o">=</span><span class="n">RKEY_COOKIE</span><span class="p">)</span>

    <span class="c1"># 2. --- Example Workflow Demonstrating Request Chaining ---
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="s">n--- Starting API Automation Workflow ---</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Step A: Create a new main list
</span>    <span class="n">list_obj</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">create_list</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">Project Phoenix</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_obj</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Workflow failed: Could not create the main list.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="c1"># Step B: Extract the new list's ID from the response
</span>    <span class="n">list_id</span> <span class="o">=</span> <span class="n">list_obj</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--&gt; Using new list ID: </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="se">\\</span><span class="s">n</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Step C: Create the first sublist using the list_id
</span>    <span class="n">sublist1_obj</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">create_sublist</span><span class="p">(</span><span class="n">list_id</span><span class="o">=</span><span class="n">list_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">Phase 1: Research</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sublist1_obj</span><span class="p">:</span>
        <span class="c1"># Step D: Extract the sublist's ID
</span>        <span class="n">sublist1_id</span> <span class="o">=</span> <span class="n">sublist1_obj</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--&gt; Using new sublist ID: </span><span class="si">{</span><span class="n">sublist1_id</span><span class="si">}</span><span class="se">\\</span><span class="s">n</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Step E: Create a task in the first sublist
</span>        <span class="n">task1_obj</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="n">sublist1_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">Analyze Market Data</span><span class="sh">"</span><span class="p">,</span> <span class="n">importance</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">time_effort</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task1_obj</span><span class="p">:</span>
            <span class="c1"># Step F: Extract the task's ID to use as a dependency
</span>            <span class="n">task1_id</span> <span class="o">=</span> <span class="n">task1_obj</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--&gt; Using new task ID for dependency: </span><span class="si">{</span><span class="n">task1_id</span><span class="si">}</span><span class="se">\\</span><span class="s">n</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Step G: Create a second task that depends on the first one
</span>            <span class="n">client</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span>
                <span class="n">sublist1_id</span><span class="p">,</span> 
                <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">Write Competitor Report</span><span class="sh">"</span><span class="p">,</span> 
                <span class="n">importance</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> 
                <span class="n">time_effort</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                <span class="n">dependency_id</span><span class="o">=</span><span class="n">task1_id</span>
            <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="s">n--- Workflow Complete ---</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="c1"># This block demonstrates how to use the ptpython REPL framework.
</span>    <span class="c1"># It sets up a REPL environment where the ApiClient can be used interactively.
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="n">ptpython.repl</span> <span class="kn">import</span> <span class="n">embed</span>
        
        <span class="c1"># --- IMPORTANT: These values must be obtained from a valid, logged-in browser session. ---
</span>        <span class="c1"># The values below are the dummy data from the provided HAR file.
</span>        <span class="n">PHPSESSID_COOKIE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">77n5cmi8mucr04afiukmatp151</span><span class="sh">"</span>
        <span class="n">RKEY_COOKIE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">413511bec626a5eb964e337e4165fee629685ac7caa75b21257604bcf5ca4b93911a8f1f6c9d5b902e598db6cc028fe91988db2590daaca4bff55e82d14028ce%3Afvwzb%3Aec91c6f9a5ae2a25515b951b30bb23297d601f184b994eda24654d6edba86bd1</span><span class="sh">"</span>

        <span class="c1"># Instantiate the client
</span>        <span class="n">client</span> <span class="o">=</span> <span class="nc">PriorityListApiClient</span><span class="p">(</span><span class="n">phpsessid</span><span class="o">=</span><span class="n">PHPSESSID_COOKIE</span><span class="p">,</span> <span class="n">rkey</span><span class="o">=</span><span class="n">RKEY_COOKIE</span><span class="p">)</span>
        
        <span class="c1"># Create a namespace for the REPL
</span>        <span class="n">namespace</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">client</span><span class="sh">'</span><span class="p">:</span> <span class="n">client</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">requests</span><span class="sh">'</span><span class="p">:</span> <span class="n">requests</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="p">:</span> <span class="n">json</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">main</span><span class="sh">'</span><span class="p">:</span> <span class="n">main</span>
        <span class="p">}</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">--- ptpython REPL ---</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">An </span><span class="sh">'</span><span class="s">ApiClient</span><span class="sh">'</span><span class="s"> instance named </span><span class="sh">'</span><span class="s">client</span><span class="sh">'</span><span class="s"> is available.</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">You can now interact with the API, e.g., client.create_list(</span><span class="sh">'</span><span class="s">My New List</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Type </span><span class="sh">'</span><span class="s">main()</span><span class="sh">'</span><span class="s"> to run the example workflow.</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Embed the ptpython REPL
</span>        <span class="nf">embed</span><span class="p">(</span><span class="nb">globals</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ptpython is not installed. Please run </span><span class="sh">'</span><span class="s">pip install ptpython</span><span class="sh">'</span><span class="s"> to use the REPL.</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># Fallback to standard Python REPL if ptpython is not available
</span>        <span class="kn">import</span> <span class="n">code</span>
        <span class="n">code</span><span class="p">.</span><span class="nf">interact</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="nf">locals</span><span class="p">())</span>

</code></section></div></div>
  <h3 id="quick-start-for-advanced-users">
    
    
     <a href="#quick-start-for-advanced-users">#</a><a href="#" aria-label="Back to top">Quick Start for Advanced Users</a>
        
    
  </h3>
      

<p>For experienced users familiar with Python and Linux environments:</p>

<ol>
  <li><strong>Save the script:</strong> Save the code as <code class="language-plaintext highlighter-rouge">prioritylist-cli.py</code>.</li>
  <li><strong>Create venv &amp; install:</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate
pip <span class="nb">install </span>requests ptpython
</code></section></div>    </div>
  </li>
  <li><strong>Configure credentials:</strong> Create <code class="language-plaintext highlighter-rouge">~/.config/prioritylist/config.ini</code> with your <code class="language-plaintext highlighter-rouge">phpsessid</code> and <code class="language-plaintext highlighter-rouge">rkey</code>.
    <div class="language-ini highlighter-rouge"><div class="highlight"><section><code><span class="nn">[auth]</span>
<span class="py">phpsessid</span> <span class="p">=</span> <span class="s">YOUR_PHPSESSID_VALUE</span>
<span class="py">rkey</span> <span class="p">=</span> <span class="s">YOUR_RKEY_VALUE</span>
</code></section></div>    </div>
  </li>
  <li><strong>Make executable &amp; move to PATH:</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">chmod</span> +x prioritylist-cli.py
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/.local/bin
<span class="nb">mv </span>prioritylist-cli.py ~/.local/bin/
<span class="c"># Ensure ~/.local/bin is in your PATH</span>
</code></section></div>    </div>
  </li>
  <li><strong>Run:</strong> <code class="language-plaintext highlighter-rouge">prioritylist-cli.py list pull-all</code></li>
</ol><hr />
  <h2 id="table-of-contents">
    
    
     <a href="#table-of-contents">#</a><a href="#" aria-label="Back to top">Table of Contents</a>
        
    
  </h2>
      

<ol>
  <li><strong>Part 1: Environment Setup (The Right Way)</strong>
    <ul>
      <li>1.1. System Dependencies</li>
      <li>1.2. Creating a Python Virtual Environment (Best Practice)</li>
      <li>1.3. Installing Script Dependencies</li>
    </ul>
  </li>
  <li><strong>Part 2: Script Installation &amp; Configuration</strong>
    <ul>
      <li>2.1. Saving the Script</li>
      <li>2.2. Making the Script Globally Executable</li>
    </ul>
  </li>
  <li><strong>Part 3: Authentication - The Critical Step</strong>
    <ul>
      <li>3.1. Finding Your <code class="language-plaintext highlighter-rouge">PHPSESSID</code> and <code class="language-plaintext highlighter-rouge">rkey</code></li>
      <li>3.2. Storing Your Credentials Securely</li>
      <li>3.3. Security Considerations</li>
    </ul>
  </li>
  <li><strong>Part 4: Command Cheatsheet &amp; Usage</strong>
    <ul>
      <li>4.1. Global Options</li>
      <li>4.2. List Commands</li>
      <li>4.3. Sublist Commands</li>
      <li>4.4. Task Commands</li>
      <li>4.5. Interactive REPL Mode</li>
    </ul>
  </li>
  <li><strong>Part 5: Troubleshooting</strong></li>
</ol><hr />
  <h2 id="part-1-environment-setup-the-right-way">
    
    
     <a href="#part-1-environment-setup-the-right-way">#</a><a href="#" aria-label="Back to top">Part 1: Environment Setup (The Right Way)</a>
        
    
  </h2>
      

<p>We will use a Python virtual environment to keep your system clean and avoid dependency conflicts.</p>
  <h3 id="11-system-dependencies">
    
    
     <a href="#11-system-dependencies">#</a><a href="#" aria-label="Back to top">1.1. System Dependencies</a>
        
    
  </h3>
      

<p>Ensure Python 3, pip, and the <code class="language-plaintext highlighter-rouge">venv</code> module are installed on your openSUSE Tumbleweed system.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>zypper <span class="nb">install </span>python3 python3-pip python3-venv
</code></section></div></div>
  <h3 id="12-creating-a-python-virtual-environment-best-practice">
    
    
     <a href="#12-creating-a-python-virtual-environment-best-practice">#</a><a href="#" aria-label="Back to top">1.2. Creating a Python Virtual Environment (Best Practice)</a>
        
    
  </h3>
      

<p>A virtual environment is an isolated space for your Python project’s dependencies.</p>

<ol>
  <li><strong>Create a Project Directory:</strong> First, make a directory for your script and its environment.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">mkdir</span> ~/prioritylist-project
<span class="nb">cd</span> ~/prioritylist-project
</code></section></div>    </div>
  </li>
  <li><strong>Create the Virtual Environment:</strong> Use Python’s built-in <code class="language-plaintext highlighter-rouge">venv</code> module to create an environment named <code class="language-plaintext highlighter-rouge">.venv</code>.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>python3 <span class="nt">-m</span> venv .venv
</code></section></div>    </div>
  </li>
  <li><strong>Activate the Environment:</strong> You must “activate” the environment to use it. Your shell prompt will change to indicate it’s active.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">source</span> .venv/bin/activate
</code></section></div>    </div>
    <blockquote>
      <p><strong>Note:</strong> To leave the environment, simply type <code class="language-plaintext highlighter-rouge">deactivate</code>. You must activate the environment in any new terminal session where you want to run the script or install packages for it.</p>
    </blockquote>
  </li>
</ol>
  <h3 id="13-installing-script-dependencies">
    
    
     <a href="#13-installing-script-dependencies">#</a><a href="#" aria-label="Back to top">1.3. Installing Script Dependencies</a>
        
    
  </h3>
      

<p>With your environment active, install the required Python libraries. They will be installed inside the <code class="language-plaintext highlighter-rouge">.venv</code> directory, not system-wide.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>pip <span class="nb">install </span>requests ptpython
</code></section></div></div>
  <h2 id="part-2-script-installation--configuration">
    
    
     <a href="#part-2-script-installation--configuration">#</a><a href="#" aria-label="Back to top">Part 2: Script Installation &amp; Configuration</a>
        
    
  </h2>
      

<p>Now we’ll save the script and make it easy to run from anywhere.</p>
  <h3 id="21-saving-the-script">
    
    
     <a href="#21-saving-the-script">#</a><a href="#" aria-label="Back to top">2.1. Saving the Script</a>
        
    
  </h3>
      

<p>Save the Python code you were given into a file named <code class="language-plaintext highlighter-rouge">prioritylist-cli.py</code> inside your <code class="language-plaintext highlighter-rouge">~/prioritylist-project</code> directory.</p>
  <h3 id="22-making-the-script-globally-executable">
    
    
     <a href="#22-making-the-script-globally-executable">#</a><a href="#" aria-label="Back to top">2.2. Making the Script Globally Executable</a>
        
    
  </h3>
      

<p>To run <code class="language-plaintext highlighter-rouge">prioritylist-cli.py</code> from any directory without typing the full path, we’ll make it executable and move it to a location in your system’s <code class="language-plaintext highlighter-rouge">PATH</code>.</p>

<ol>
  <li><strong>Grant Execute Permissions:</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">chmod</span> +x prioritylist-cli.py
</code></section></div>    </div>
  </li>
  <li><strong>Move to Local Bin Directory:</strong> The standard location for user-specific executables is <code class="language-plaintext highlighter-rouge">~/.local/bin</code>.
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.local/bin
<span class="nb">mv </span>prioritylist-cli.py ~/.local/bin/
</code></section></div>    </div>
  </li>
  <li><strong>Verify your PATH:</strong> On most modern Linux systems, <code class="language-plaintext highlighter-rouge">~/.local/bin</code> is automatically added to your <code class="language-plaintext highlighter-rouge">PATH</code> when you log in. You can verify this:
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">echo</span> <span class="nv">$PATH</span>
</code></section></div>    </div>
    <p>If you see <code class="language-plaintext highlighter-rouge">/home/your_username/.local/bin</code> in the output, you are all set. If not, add the following line to your <code class="language-plaintext highlighter-rouge">~/.profile</code> or <code class="language-plaintext highlighter-rouge">~/.bashrc</code> file and restart your shell session:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Add this line to ~/.profile</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.local/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></section></div>    </div>
  </li>
</ol>
  <h2 id="part-3-authentication---the-critical-step">
    
    
     <a href="#part-3-authentication---the-critical-step">#</a><a href="#" aria-label="Back to top">Part 3: Authentication - The Critical Step</a>
        
    
  </h2>
      

<p>The script requires your account’s session cookies to work.</p>
  <h3 id="31-finding-your-phpsessid-and-rkey">
    
    
     <a href="#31-finding-your-phpsessid-and-rkey">#</a><a href="#" aria-label="Back to top">3.1. Finding Your <code class="language-plaintext highlighter-rouge">PHPSESSID</code> and <code class="language-plaintext highlighter-rouge">rkey</code></a>
        
    
  </h3>
      

<ol>
  <li><strong>Log In:</strong> In Firefox or a Chromium-based browser, log in to <a href="https://prioritylist.app">https://prioritylist.app</a>.</li>
  <li><strong>Open Developer Tools:</strong> Press <code class="language-plaintext highlighter-rouge">F12</code> or right-click the page and select “Inspect”.</li>
  <li><strong>Go to Storage/Application:</strong>
    <ul>
      <li>In <strong>Firefox</strong>, go to the <strong>Storage</strong> tab.</li>
      <li>In <strong>Chrome/Edge</strong>, go to the <strong>Application</strong> tab.</li>
    </ul>
  </li>
  <li><strong>Find Cookies:</strong> In the sidebar, expand “Cookies” and select <code class="language-plaintext highlighter-rouge">https://prioritylist.app</code>.</li>
  <li><strong>Copy Values:</strong> Find the rows for <code class="language-plaintext highlighter-rouge">PHPSESSID</code> and <code class="language-plaintext highlighter-rouge">rkey</code>. Carefully copy the long string from the <strong>“Value”</strong> column for each.</li>
</ol>

<blockquote>
  <p><strong>Important Note on Credentials</strong>
These cookies can and will expire (e.g., after a few days, or when you log out). If the script suddenly stops working with an “API Error” or “HTTP 401/403” error, the most likely cause is an expired cookie. You will need to repeat this step to get new, valid cookie values.</p>
</blockquote>
  <h3 id="32-storing-your-credentials-securely">
    
    
     <a href="#32-storing-your-credentials-securely">#</a><a href="#" aria-label="Back to top">3.2. Storing Your Credentials Securely</a>
        
    
  </h3>
      

<p>The script checks for credentials in three places. The configuration file is the most convenient and recommended method.</p>

<ol>
  <li><strong>Create the Directory:</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.config/prioritylist
</code></section></div>    </div>
  </li>
  <li><strong>Create the Config File:</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>nano ~/.config/prioritylist/config.ini
</code></section></div>    </div>
  </li>
  <li><strong>Add Your Credentials:</strong> Paste the following into the file, replacing the placeholders with your actual values.
    <div class="language-ini highlighter-rouge"><div class="highlight"><section><code><span class="nn">[auth]</span>
<span class="py">phpsessid</span> <span class="p">=</span> <span class="s">YOUR_PHPSESSID_VALUE_HERE</span>
<span class="py">rkey</span> <span class="p">=</span> <span class="s">YOUR_RKEY_VALUE_HERE</span>
</code></section></div>    </div>
    <p>Save and exit (<code class="language-plaintext highlighter-rouge">Ctrl+O</code>, then <code class="language-plaintext highlighter-rouge">Ctrl+X</code> in <code class="language-plaintext highlighter-rouge">nano</code>).</p>
  </li>
</ol>
  <h3 id="33-security-considerations">
    
    
     <a href="#33-security-considerations">#</a><a href="#" aria-label="Back to top">3.3. Security Considerations</a>
        
    
  </h3>
      

<ul>
  <li><strong>Treat these credentials like passwords.</strong> Anyone with them can access your PriorityList account.</li>
  <li>The <code class="language-plaintext highlighter-rouge">config.ini</code> file is stored as plain text. On a multi-user system, ensure its permissions are secure (<code class="language-plaintext highlighter-rouge">chmod 600 ~/.config/prioritylist/config.ini</code>).</li>
  <li>Avoid passing credentials as command-line arguments (<code class="language-plaintext highlighter-rouge">--phpsessid ...</code>), as they will be stored in your shell’s history file (<code class="language-plaintext highlighter-rouge">.bash_history</code>).</li>
</ul>
  <h2 id="part-4-command-cheatsheet--usage">
    
    
     <a href="#part-4-command-cheatsheet--usage">#</a><a href="#" aria-label="Back to top">Part 4: Command Cheatsheet &amp; Usage</a>
        
    
  </h2>
      

<p>Remember to have your virtual environment active (<code class="language-plaintext highlighter-rouge">source ~/prioritylist-project/.venv/bin/activate</code>) before running commands.</p>
  <h3 id="41-global-options">
    
    
     <a href="#41-global-options">#</a><a href="#" aria-label="Back to top">4.1. Global Options</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--json</code></td>
      <td>Output machine-readable JSON instead of human-friendly text.</td>
    </tr>
  </tbody>
</table>
  <h3 id="42-list-commands">
    
    
     <a href="#42-list-commands">#</a><a href="#" aria-label="Back to top">4.2. List Commands</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th>Action</th>
      <th>Description</th>
      <th>Example Command</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pull-all</code></td>
      <td>Fetch and display all your lists and groups.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py list pull-all</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">show</code></td>
      <td>Show full JSON details for a single list.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py list show 12345</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">add</code></td>
      <td>Add a new list.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py list add --name "New Project"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">update</code></td>
      <td>Rename a list.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py list update 12345 --name "Renamed Project"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">delete</code></td>
      <td><strong>Permanently delete</strong> a list.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py list delete 12345</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">star</code></td>
      <td>Toggle the star status on a list.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py list star 12345</code></td>
    </tr>
  </tbody>
</table>
  <h3 id="43-sublist-commands">
    
    
     <a href="#43-sublist-commands">#</a><a href="#" aria-label="Back to top">4.3. Sublist Commands</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th>Action</th>
      <th>Description</th>
      <th>Example Command</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">add</code></td>
      <td>Add a new sublist to a list.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py sublist add --list-id 12345 --name "Design Phase"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">update</code></td>
      <td>Rename a sublist.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py sublist update 56789 --name "Final Designs"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">delete</code></td>
      <td><strong>Permanently delete</strong> a sublist.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py sublist delete 56789</code></td>
    </tr>
  </tbody>
</table>
  <h3 id="44-task-commands">
    
    
     <a href="#44-task-commands">#</a><a href="#" aria-label="Back to top">4.4. Task Commands</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th>Action</th>
      <th>Description</th>
      <th>Example Command</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">add</code></td>
      <td>Add a new task to a sublist.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py task add --sublist-id 56789 --name "Create logo" -i 8 -t 3</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">update</code></td>
      <td>Update an existing task.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py task update 98765 --name "Finalize logo" --due-date "2024-12-20"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">delete</code></td>
      <td><strong>Permanently delete</strong> a task.</td>
      <td><code class="language-plaintext highlighter-rouge">prioritylist-cli.py task delete 98765</code></td>
    </tr>
  </tbody>
</table>
  <h3 id="45-interactive-repl-mode">
    
    
     <a href="#45-interactive-repl-mode">#</a><a href="#" aria-label="Back to top">4.5. Interactive REPL Mode</a>
        
    
  </h3>
      

<p>Run the script with no arguments to enter a powerful interactive shell.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>prioritylist-cli.py
</code></section></div></div>

<p>Inside the REPL, a pre-configured <code class="language-plaintext highlighter-rouge">client</code> object is available. You can explore the API directly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="c1"># Example REPL session
</span><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Get details for a list and print it nicely
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">details</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">get_list_details</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nf">print_json</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
</code></section></div></div>
  <h2 id="part-5-troubleshooting">
    
    
     <a href="#part-5-troubleshooting">#</a><a href="#" aria-label="Back to top">Part 5: Troubleshooting</a>
        
    
  </h2>
      

<table>
  <thead>
    <tr>
      <th>Error Message / Symptom</th>
      <th>Likely Cause &amp; Solution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bash: prioritylist-cli.py: command not found</code></td>
      <td>1. Your <code class="language-plaintext highlighter-rouge">~/.local/bin</code> is not in your <code class="language-plaintext highlighter-rouge">PATH</code>. See step 2.2. <br /> 2. You have not restarted your shell since modifying your <code class="language-plaintext highlighter-rouge">~/.profile</code> or <code class="language-plaintext highlighter-rouge">~/.bashrc</code>. <br /> 3. You are trying to run it from a non-active venv.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ImportError: No module named 'requests'</code></td>
      <td>The required Python libraries are not installed in your <strong>active</strong> virtual environment. Ensure you have run <code class="language-plaintext highlighter-rouge">source .venv/bin/activate</code> and then <code class="language-plaintext highlighter-rouge">pip install requests ptpython</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">❌ Error: Authentication credentials not found.</code></td>
      <td>The script could not find your <code class="language-plaintext highlighter-rouge">config.ini</code> file. Ensure it is located at <code class="language-plaintext highlighter-rouge">~/.config/prioritylist/config.ini</code> and the keys (<code class="language-plaintext highlighter-rouge">phpsessid</code>, <code class="language-plaintext highlighter-rouge">rkey</code>) are spelled correctly.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">❌ API Error...</code> or <code class="language-plaintext highlighter-rouge">❌ HTTP Error... 401/403</code></td>
      <td>Your credentials have expired or are incorrect. This is the most common operational error. Repeat <strong>Part 3.1</strong> to get new cookie values and update your <code class="language-plaintext highlighter-rouge">config.ini</code> file.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">❌ Request failed... ConnectionError</code></td>
      <td>You have a network problem. Check your internet connection and ensure you can access <code class="language-plaintext highlighter-rouge">prioritylist.app</code> in your browser.</td>
    </tr>
  </tbody>
</table>

<section class="code-block-container" role="group" aria-label="Python Code Block" data-filename="python_code_block.py" data-code="#!/usr/bin/env python3
&quot;&quot;&quot;
PriorityList CLI - The Optimized &amp; Integrated Solution

This script is the result of integrating the best features from multiple development
approaches into a single, cohesive, and robust command-line interface.

It combines:
• Full CRUD (Create, Read, Update, Delete) operations for all resources.
• A robust API client with detailed error handling and reliable response parsing.
• A clean, nested command structure (e.g., `list add`, `task delete`).
• An interactive REPL mode (via `ptpython`) for exploratory API calls.
• Strict separation of human-readable and machine-readable (`--json`) output.
• Secure credential management from args, environment, or config file.
&quot;&quot;&quot;

from __future__ import annotations

import argparse
import configparser
import json
import os
import sys
from pathlib import Path
from typing import Any, Dict, List, Optional, Tuple

import requests

# ─────────────────────────────────────────────────────────────
# Helper Functions
# ─────────────────────────────────────────────────────────────

def print_json(obj: Any) -&gt; None:
    &quot;&quot;&quot;Prints an object as a formatted JSON string to stdout.&quot;&quot;&quot;
    print(json.dumps(obj, indent=2, ensure_ascii=False))


def print_human(msg: str, *, is_json_mode: bool) -&gt; None:
    &quot;&quot;&quot;Prints a message to stdout only if not in JSON mode.&quot;&quot;&quot;
    if not is_json_mode:
        print(msg)

# ─────────────────────────────────────────────────────────────
# API Client
# ─────────────────────────────────────────────────────────────

class PriorityListApiClient:
    &quot;&quot;&quot;A robust client for interacting with the prioritylist.app API.&quot;&quot;&quot;

    def __init__(self, phpsessid: str, rkey: str, base_url: str = &quot;https://prioritylist.app&quot;) -&gt; None:
        self.base_url = base_url.rstrip(&quot;/&quot;)
        self.session = requests.Session()
        self.session.headers.update({
            &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0&quot;,
            &quot;Accept&quot;: &quot;text/plain, */*; q=0.01&quot;,
            &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;,
            &quot;Origin&quot;: self.base_url,
        })
        self.session.cookies.set(&quot;PHPSESSID&quot;, phpsessid, domain=&quot;prioritylist.app&quot;)
        self.session.cookies.set(&quot;rkey&quot;, rkey, domain=&quot;prioritylist.app&quot;)

    def _post(self, endpoint: str, data: Optional[Dict[str, Any]] = None) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Makes a POST request, handles errors, and returns the &#39;data&#39; field on success.&quot;&quot;&quot;
        url = f&quot;{self.base_url}/api{endpoint}&quot;
        try:
            response = self.session.post(url, data=data)
            response.raise_for_status()
            json_response = response.json()
            if json_response.get(&quot;result&quot;) == &quot;success&quot;:
                return json_response.get(&quot;data&quot;)
            else:
                print(f&quot;❌ API Error at {endpoint}: {json_response.get(&#39;result&#39;, &#39;Unknown error&#39;)}&quot;, file=sys.stderr)
        except requests.exceptions.HTTPError as e:
            print(f&quot;❌ HTTP Error for {endpoint}: {e.response.status_code} {e.response.reason}&quot;, file=sys.stderr)
            print(f&quot;   Response body: {e.response.text}&quot;, file=sys.stderr)
        except requests.exceptions.RequestException as e:
            print(f&quot;❌ Request failed for {endpoint}: {e}&quot;, file=sys.stderr)
        except json.JSONDecodeError:
            print(f&quot;❌ Failed to decode JSON from response. URL: {url}&quot;, file=sys.stderr)
        return None

    # --- List Operations ---
    def get_all_lists(self) -&gt; Optional[List[Dict[str, Any]]]:
        return self._post(&quot;/groups/pull&quot;)

    def get_list_details(self, list_id: int) -&gt; Optional[Dict[str, Any]]:
        return self._post(&quot;/list/pull&quot;, {&quot;id&quot;: list_id})

    def create_list(self, name: str, group_id: str = &quot;&quot;) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Creates a new list and robustly finds and returns it from the response.&quot;&quot;&quot;
        response_data = self._post(&quot;/list/add&quot;, {&quot;name&quot;: name, &quot;group_id&quot;: group_id})
        if response_data:
            try:
                for group in response_data:
                    # Find the list by name to avoid relying on array order.
                    # Note: This might not be perfect if duplicate names are allowed.
                    for lst in group.get(&#39;lists&#39;, []):
                        if lst[&#39;name&#39;] == name:
                            return lst
            except (IndexError, KeyError, TypeError) as e:
                print(f&quot;❌ Could not parse created list from API response: {e}&quot;, file=sys.stderr)
        return None

    def update_list(self, list_id: int, name: str) -&gt; bool:
        return self._post(&quot;/list/update&quot;, {&quot;id&quot;: list_id, &quot;name&quot;: name}) is not None

    def delete_list(self, list_id: int) -&gt; bool:
        # Note: The delete endpoint was not in the HAR file, this is an educated guess.
        # If it fails, the actual endpoint might be different (e.g., /list/remove).
        return self._post(&quot;/list/delete&quot;, {&quot;id&quot;: list_id}) is not None

    def star_list(self, list_id: int) -&gt; bool:
        return self._post(&quot;/list/star&quot;, {&quot;id&quot;: list_id}) is not None

    # --- Sublist Operations ---
    def create_sublist(self, list_id: int, name: str) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Creates a new sublist and robustly finds and returns it.&quot;&quot;&quot;
        response_data = self._post(&quot;/sublist/add&quot;, {&quot;list_id&quot;: list_id, &quot;name&quot;: name})
        if response_data:
            try:
                for sublist in response_data.get(&#39;sublists&#39;, []):
                    if sublist[&#39;name&#39;] == name:
                        return sublist
            except (KeyError, TypeError) as e:
                print(f&quot;❌ Could not parse created sublist from API response: {e}&quot;, file=sys.stderr)
        return None

    def update_sublist(self, sublist_id: int, name: str) -&gt; bool:
        return self._post(&quot;/sublist/update&quot;, {&quot;id&quot;: sublist_id, &quot;name&quot;: name}) is not None

    def delete_sublist(self, sublist_id: int) -&gt; bool:
        # Note: The delete endpoint was not in the HAR file, this is an educated guess.
        return self._post(&quot;/sublist/delete&quot;, {&quot;id&quot;: sublist_id}) is not None

    # --- Task Operations ---
    def create_task(self, sublist_id: int, name: str, **kwargs) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Creates a new task and robustly finds and returns it.&quot;&quot;&quot;
        payload = {&quot;sublist_id&quot;: sublist_id, &quot;name&quot;: name}
        # Map CLI-friendly names to API parameter names
        if &#39;importance&#39; in kwargs: payload[&#39;score_i&#39;] = kwargs.pop(&#39;importance&#39;)
        if &#39;time&#39; in kwargs: payload[&#39;score_t&#39;] = kwargs.pop(&#39;time&#39;)
        if &#39;due_date&#39; in kwargs: payload[&#39;d_date&#39;] = kwargs.pop(&#39;due_date&#39;)
        if &#39;dependency_id&#39; in kwargs: payload[&#39;dependency_id&#39;] = kwargs.pop(&#39;dependency_id&#39;)
        
        payload.update(kwargs)
        if payload.get(&#39;d_date&#39;):
            payload.setdefault(&#39;d_zone&#39;, &#39;-0300&#39;)
            
        response_data = self._post(&quot;/item/add&quot;, payload)
        if response_data:
            try:
                for item in response_data.get(&#39;items&#39;, []):
                    if item[&#39;name&#39;] == name:
                        return item
            except (KeyError, TypeError) as e:
                print(f&quot;❌ Could not parse created task from API response: {e}&quot;, file=sys.stderr)
        return None

    def update_task(self, task_id: int, updates: Dict[str, Any]) -&gt; bool:
        &quot;&quot;&quot;Updates an existing task with only the provided fields.&quot;&quot;&quot;
        payload = updates.copy()
        payload[&#39;id&#39;] = task_id
        if &#39;d_date&#39; in payload and payload[&#39;d_date&#39;]:
            payload.setdefault(&#39;d_zone&#39;, &#39;-0300&#39;)
        return self._post(&quot;/item/update&quot;, data=payload) is not None

    def delete_task(self, task_id: int) -&gt; bool:
        # Note: The delete endpoint was not in the HAR file, this is an educated guess.
        return self._post(&quot;/item/delete&quot;, {&quot;id&quot;: task_id}) is not None

# ─────────────────────────────────────────────────────────────
# Credentials Helper
# ─────────────────────────────────────────────────────────────

def get_credentials(ns: argparse.Namespace) -&gt; Tuple[str, str]:
    &quot;&quot;&quot;Retrieves credentials from args, environment variables, or config file.&quot;&quot;&quot;
    if ns.phpsessid and ns.rkey:
        return ns.phpsessid, ns.rkey
    
    env_sess, env_rkey = os.getenv(&quot;PL_PHPSESSID&quot;), os.getenv(&quot;PL_RKEY&quot;)
    if env_sess and env_rkey:
        return env_sess, env_rkey
        
    cfg_file = Path.home() / &quot;.config&quot; / &quot;prioritylist&quot; / &quot;config.ini&quot;
    if cfg_file.exists():
        # FIX: Disable interpolation to handle &#39;%&#39; characters in cookie values
        cp = configparser.ConfigParser(interpolation=None)
        cp.read(cfg_file)
        if &quot;auth&quot; in cp and &quot;phpsessid&quot; in cp[&quot;auth&quot;] and &quot;rkey&quot; in cp[&quot;auth&quot;]:
            return cp[&quot;auth&quot;][&quot;phpsessid&quot;], cp[&quot;auth&quot;][&quot;rkey&quot;]
            
    print(&quot;❌ Error: Authentication credentials not found.&quot;, file=sys.stderr)
    print(&quot;  Please provide them via flags, environment variables, or a config file.&quot;, file=sys.stderr)
    sys.exit(1)

# ─────────────────────────────────────────────────────────────
# Command Handlers
# ─────────────────────────────────────────────────────────────

def handle_list_pull_all(client: PriorityListApiClient, ns: argparse.Namespace):
    data = client.get_all_lists()
    if data is None:
        print_human(&quot;❌ Could not fetch lists.&quot;, is_json_mode=ns.json)
        return
    if ns.json:
        print_json(data)
    else:
        for group in data:
            print_human(f&quot;\n📁 {group.get(&#39;name&#39;) or &#39;Uncategorized&#39;}&quot;, is_json_mode=ns.json)
            for lst in group.get(&quot;lists&quot;, []):
                star = &quot;⭐&quot; if lst.get(&quot;starred&quot;) else &quot; &quot;
                print_human(f&quot;  {star} ID: {lst[&#39;id&#39;]:&lt;6} {lst[&#39;name&#39;]}&quot;, is_json_mode=ns.json)

def handle_list_show(client: PriorityListApiClient, ns: argparse.Namespace):
    data = client.get_list_details(ns.list_id)
    if data is None:
        print_human(f&quot;❌ List {ns.list_id} not found.&quot;, is_json_mode=ns.json)
        return
    print_json(data)

def handle_list_add(client: PriorityListApiClient, ns: argparse.Namespace):
    new_list = client.create_list(ns.name)
    if new_list:
        print_human(f&quot;✅ Created list &#39;{new_list[&#39;name&#39;]}&#39; (ID: {new_list[&#39;id&#39;]})&quot;, is_json_mode=ns.json)
        if ns.json:
            print_json(new_list)
    else:
        print_human(f&quot;❌ Failed to create list &#39;{ns.name}&#39;.&quot;, is_json_mode=ns.json)

def handle_list_update(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.update_list(ns.list_id, ns.name)
    msg = f&quot;✅ Renamed list {ns.list_id} to &#39;{ns.name}&#39;.&quot; if ok else f&quot;❌ Failed to rename list {ns.list_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_list_delete(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.delete_list(ns.list_id)
    msg = f&quot;✅ Deleted list {ns.list_id}.&quot; if ok else f&quot;❌ Failed to delete list {ns.list_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_list_star(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.star_list(ns.list_id)
    msg = f&quot;✅ Toggled star on list {ns.list_id}.&quot; if ok else f&quot;❌ Failed to toggle star on list {ns.list_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_sublist_add(client: PriorityListApiClient, ns: argparse.Namespace):
    new_sublist = client.create_sublist(ns.list_id, ns.name)
    if new_sublist:
        msg = f&quot;✅ Created sublist &#39;{new_sublist[&#39;name&#39;]}&#39; (ID: {new_sublist[&#39;id&#39;]}) in list {ns.list_id}.&quot;
        print_human(msg, is_json_mode=ns.json)
        if ns.json:
            print_json(new_sublist)
    else:
        print_human(f&quot;❌ Failed to create sublist &#39;{ns.name}&#39;.&quot;, is_json_mode=ns.json)

def handle_sublist_update(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.update_sublist(ns.sublist_id, ns.name)
    msg = f&quot;✅ Renamed sublist {ns.sublist_id} to &#39;{ns.name}&#39;.&quot; if ok else f&quot;❌ Failed to rename sublist {ns.sublist_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_sublist_delete(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.delete_sublist(ns.sublist_id)
    msg = f&quot;✅ Deleted sublist {ns.sublist_id}.&quot; if ok else f&quot;❌ Failed to delete sublist {ns.sublist_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_task_add(client: PriorityListApiClient, ns: argparse.Namespace):
    params = {
        &quot;importance&quot;: ns.importance,
        &quot;time&quot;: ns.time,
        &quot;d_date&quot;: ns.due_date or &quot;&quot;,
        &quot;dependency_id&quot;: ns.dependency_id or &quot;&quot;,
    }
    new_task = client.create_task(ns.sublist_id, ns.name, **params)
    if new_task:
        msg = f&quot;✅ Created task &#39;{new_task[&#39;name&#39;]}&#39; (ID: {new_task[&#39;id&#39;]}) in sublist {ns.sublist_id}.&quot;
        print_human(msg, is_json_mode=ns.json)
        if ns.json:
            print_json(new_task)
    else:
        print_human(f&quot;❌ Failed to create task &#39;{ns.name}&#39;.&quot;, is_json_mode=ns.json)

def handle_task_update(client: PriorityListApiClient, ns: argparse.Namespace):
    updates = {k: v for k, v in vars(ns).items() if k in [
        &#39;name&#39;, &#39;sublist_id&#39;, &#39;importance&#39;, &#39;time&#39;, &#39;due_date&#39;, &#39;dependency_id&#39;
    ] and v is not None}
    
    if not updates:
        print_human(&quot;❌ Error: At least one field to update must be provided.&quot;, is_json_mode=ns.json)
        sys.exit(1)
        
    # Remap arg names to API field names
    if &#39;importance&#39; in updates: updates[&#39;score_i&#39;] = updates.pop(&#39;importance&#39;)
    if &#39;time&#39; in updates: updates[&#39;score_t&#39;] = updates.pop(&#39;time&#39;)
    if &#39;due_date&#39; in updates: updates[&#39;d_date&#39;] = updates.pop(&#39;due_date&#39;)

    ok = client.update_task(ns.task_id, updates)
    msg = f&quot;✅ Updated task {ns.task_id}.&quot; if ok else f&quot;❌ Failed to update task {ns.task_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_task_delete(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.delete_task(ns.task_id)
    msg = f&quot;✅ Deleted task {ns.task_id}.&quot; if ok else f&quot;❌ Failed to delete task {ns.task_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

# ─────────────────────────────────────────────────────────────
# Argument Parser
# ─────────────────────────────────────────────────────────────

def build_parser() -&gt; argparse.ArgumentParser:
    p = argparse.ArgumentParser(description=&quot;A robust CLI for prioritylist.app.&quot;, formatter_class=argparse.RawTextHelpFormatter)
    p.add_argument(&quot;--phpsessid&quot;, help=&quot;Your PHPSESSID cookie.&quot;)
    p.add_argument(&quot;--rkey&quot;, help=&quot;Your rkey cookie.&quot;)
    p.add_argument(&quot;--json&quot;, action=&quot;store_true&quot;, help=&quot;Output machine-readable JSON only.&quot;)

    sp = p.add_subparsers(dest=&quot;resource&quot;, required=True, help=&quot;The resource to manage.&quot;)

    # --- List Parser ---
    ls = sp.add_parser(&quot;list&quot;, help=&quot;Manage lists&quot;).add_subparsers(dest=&quot;action&quot;, required=True)
    ls.add_parser(&quot;pull-all&quot;, help=&quot;Fetch all lists and groups&quot;).set_defaults(func=handle_list_pull_all)
    ls_sh = ls.add_parser(&quot;show&quot;, help=&quot;Show full JSON details for one list&quot;)
    ls_sh.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to show&quot;)
    ls_sh.set_defaults(func=handle_list_show)
    ls_add = ls.add_parser(&quot;add&quot;, help=&quot;Add a new list&quot;)
    ls_add.add_argument(&quot;--name&quot;, required=True, help=&quot;Name for the new list&quot;)
    ls_add.set_defaults(func=handle_list_add)
    ls_upd = ls.add_parser(&quot;update&quot;, help=&quot;Rename a list&quot;)
    ls_upd.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to update&quot;)
    ls_upd.add_argument(&quot;--name&quot;, required=True, help=&quot;New name for the list&quot;)
    ls_upd.set_defaults(func=handle_list_update)
    ls_del = ls.add_parser(&quot;delete&quot;, help=&quot;Delete a list&quot;)
    ls_del.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to delete&quot;)
    ls_del.set_defaults(func=handle_list_delete)
    ls_star = ls.add_parser(&quot;star&quot;, help=&quot;Toggle star status on a list&quot;)
    ls_star.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to star/unstar&quot;)
    ls_star.set_defaults(func=handle_list_star)

    # --- Sublist Parser ---
    sb = sp.add_parser(&quot;sublist&quot;, help=&quot;Manage sublists&quot;).add_subparsers(dest=&quot;action&quot;, required=True)
    sb_add = sb.add_parser(&quot;add&quot;, help=&quot;Add a new sublist&quot;)
    sb_add.add_argument(&quot;--list-id&quot;, type=int, required=True, help=&quot;ID of the parent list&quot;)
    sb_add.add_argument(&quot;--name&quot;, required=True, help=&quot;Name for the new sublist&quot;)
    sb_add.set_defaults(func=handle_sublist_add)
    sb_upd = sb.add_parser(&quot;update&quot;, help=&quot;Rename a sublist&quot;)
    sb_upd.add_argument(&quot;sublist_id&quot;, type=int, help=&quot;ID of the sublist to update&quot;)
    sb_upd.add_argument(&quot;--name&quot;, required=True, help=&quot;New name for the sublist&quot;)
    sb_upd.set_defaults(func=handle_sublist_update)
    sb_del = sb.add_parser(&quot;delete&quot;, help=&quot;Delete a sublist&quot;)
    sb_del.add_argument(&quot;sublist_id&quot;, type=int, help=&quot;ID of the sublist to delete&quot;)
    sb_del.set_defaults(func=handle_sublist_delete)

    # --- Task Parser ---
    tk = sp.add_parser(&quot;task&quot;, help=&quot;Manage tasks&quot;).add_subparsers(dest=&quot;action&quot;, required=True)
    tk_add = tk.add_parser(&quot;add&quot;, help=&quot;Add a new task&quot;)
    tk_add.add_argument(&quot;--sublist-id&quot;, type=int, required=True, help=&quot;ID of the parent sublist&quot;)
    tk_add.add_argument(&quot;--name&quot;, required=True, help=&quot;Name for the new task&quot;)
    tk_add.add_argument(&quot;-i&quot;, &quot;--importance&quot;, type=int, default=5, help=&quot;Importance score (1-10)&quot;)
    tk_add.add_argument(&quot;-t&quot;, &quot;--time&quot;, type=int, default=5, help=&quot;Time/Effort score (1-10)&quot;)
    tk_add.add_argument(&quot;--due-date&quot;, help=&quot;Due date in YYYY-MM-DD format&quot;)
    tk_add.add_argument(&quot;--dependency-id&quot;, type=int, help=&quot;ID of a prerequisite task&quot;)
    tk_add.set_defaults(func=handle_task_add)
    tk_upd = tk.add_parser(&quot;update&quot;, help=&quot;Update an existing task&quot;)
    tk_upd.add_argument(&quot;task_id&quot;, type=int, help=&quot;ID of the task to update&quot;)
    tk_upd.add_argument(&quot;--sublist-id&quot;, type=int, help=&quot;Move task to a new parent sublist&quot;)
    tk_upd.add_argument(&quot;--name&quot;, help=&quot;New name for the task&quot;)
    tk_upd.add_argument(&quot;-i&quot;, &quot;--importance&quot;, type=int, help=&quot;New importance score (1-10)&quot;)
    tk_upd.add_argument(&quot;-t&quot;, &quot;--time&quot;, type=int, help=&quot;New time/Effort score (1-10)&quot;)
    tk_upd.add_argument(&quot;--due-date&quot;, help=&quot;New due date in YYYY-MM-DD format&quot;)
    tk_upd.add_argument(&quot;--dependency-id&quot;, type=int, help=&quot;New ID of a prerequisite task&quot;)
    tk_upd.set_defaults(func=handle_task_update)
    tk_del = tk.add_parser(&quot;delete&quot;, help=&quot;Delete a task&quot;)
    tk_del.add_argument(&quot;task_id&quot;, type=int, help=&quot;ID of the task to delete&quot;)
    tk_del.set_defaults(func=handle_task_delete)

    return p

# ─────────────────────────────────────────────────────────────
# Main Execution
# ─────────────────────────────────────────────────────────────

def main():
    &quot;&quot;&quot;Main entry point for the script.&quot;&quot;&quot;
    if len(sys.argv) == 1:
        try:
            from ptpython.repl import embed
            print(&quot;▶️  No command provided. Starting interactive REPL...&quot;)
            creds_ns = argparse.Namespace(phpsessid=None, rkey=None)
            phpsessid, rkey = get_credentials(creds_ns)
            client = PriorityListApiClient(phpsessid, rkey)
            namespace = {&#39;client&#39;: client, &#39;print_json&#39;: print_json}
            print(&quot;✅ An API client is available as `client`.&quot;)
            embed(globals=namespace, locals=namespace)
        except ImportError:
            print(&quot;ℹ️ Optional dependency &#39;ptpython&#39; not found.&quot;, file=sys.stderr)
            print(&quot;  Run &#39;pip install ptpython&#39; for an enhanced interactive experience.&quot;, file=sys.stderr)
            print(&quot;\nDisplaying help instead:\n&quot;)
            build_parser().print_help()
        sys.exit(0)

    parser = build_parser()
    args = parser.parse_args()
    
    phpsessid, rkey = get_credentials(args)
    client = PriorityListApiClient(phpsessid, rkey)

    if hasattr(args, &#39;func&#39;):
        args.func(client, args)
    else:
        parser.print_help()

if __name__ == &quot;__main__&quot;:
    main()" data-download-link="" data-download-label="Download Python">
  <code class="language-python">#!/usr/bin/env python3
&quot;&quot;&quot;
PriorityList CLI - The Optimized &amp; Integrated Solution

This script is the result of integrating the best features from multiple development
approaches into a single, cohesive, and robust command-line interface.

It combines:
• Full CRUD (Create, Read, Update, Delete) operations for all resources.
• A robust API client with detailed error handling and reliable response parsing.
• A clean, nested command structure (e.g., `list add`, `task delete`).
• An interactive REPL mode (via `ptpython`) for exploratory API calls.
• Strict separation of human-readable and machine-readable (`--json`) output.
• Secure credential management from args, environment, or config file.
&quot;&quot;&quot;

from __future__ import annotations

import argparse
import configparser
import json
import os
import sys
from pathlib import Path
from typing import Any, Dict, List, Optional, Tuple

import requests

# ─────────────────────────────────────────────────────────────
# Helper Functions
# ─────────────────────────────────────────────────────────────

def print_json(obj: Any) -&gt; None:
    &quot;&quot;&quot;Prints an object as a formatted JSON string to stdout.&quot;&quot;&quot;
    print(json.dumps(obj, indent=2, ensure_ascii=False))


def print_human(msg: str, *, is_json_mode: bool) -&gt; None:
    &quot;&quot;&quot;Prints a message to stdout only if not in JSON mode.&quot;&quot;&quot;
    if not is_json_mode:
        print(msg)

# ─────────────────────────────────────────────────────────────
# API Client
# ─────────────────────────────────────────────────────────────

class PriorityListApiClient:
    &quot;&quot;&quot;A robust client for interacting with the prioritylist.app API.&quot;&quot;&quot;

    def __init__(self, phpsessid: str, rkey: str, base_url: str = &quot;https://prioritylist.app&quot;) -&gt; None:
        self.base_url = base_url.rstrip(&quot;/&quot;)
        self.session = requests.Session()
        self.session.headers.update({
            &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0&quot;,
            &quot;Accept&quot;: &quot;text/plain, */*; q=0.01&quot;,
            &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;,
            &quot;Origin&quot;: self.base_url,
        })
        self.session.cookies.set(&quot;PHPSESSID&quot;, phpsessid, domain=&quot;prioritylist.app&quot;)
        self.session.cookies.set(&quot;rkey&quot;, rkey, domain=&quot;prioritylist.app&quot;)

    def _post(self, endpoint: str, data: Optional[Dict[str, Any]] = None) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Makes a POST request, handles errors, and returns the &#39;data&#39; field on success.&quot;&quot;&quot;
        url = f&quot;{self.base_url}/api{endpoint}&quot;
        try:
            response = self.session.post(url, data=data)
            response.raise_for_status()
            json_response = response.json()
            if json_response.get(&quot;result&quot;) == &quot;success&quot;:
                return json_response.get(&quot;data&quot;)
            else:
                print(f&quot;❌ API Error at {endpoint}: {json_response.get(&#39;result&#39;, &#39;Unknown error&#39;)}&quot;, file=sys.stderr)
        except requests.exceptions.HTTPError as e:
            print(f&quot;❌ HTTP Error for {endpoint}: {e.response.status_code} {e.response.reason}&quot;, file=sys.stderr)
            print(f&quot;   Response body: {e.response.text}&quot;, file=sys.stderr)
        except requests.exceptions.RequestException as e:
            print(f&quot;❌ Request failed for {endpoint}: {e}&quot;, file=sys.stderr)
        except json.JSONDecodeError:
            print(f&quot;❌ Failed to decode JSON from response. URL: {url}&quot;, file=sys.stderr)
        return None

    # --- List Operations ---
    def get_all_lists(self) -&gt; Optional[List[Dict[str, Any]]]:
        return self._post(&quot;/groups/pull&quot;)

    def get_list_details(self, list_id: int) -&gt; Optional[Dict[str, Any]]:
        return self._post(&quot;/list/pull&quot;, {&quot;id&quot;: list_id})

    def create_list(self, name: str, group_id: str = &quot;&quot;) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Creates a new list and robustly finds and returns it from the response.&quot;&quot;&quot;
        response_data = self._post(&quot;/list/add&quot;, {&quot;name&quot;: name, &quot;group_id&quot;: group_id})
        if response_data:
            try:
                for group in response_data:
                    # Find the list by name to avoid relying on array order.
                    # Note: This might not be perfect if duplicate names are allowed.
                    for lst in group.get(&#39;lists&#39;, []):
                        if lst[&#39;name&#39;] == name:
                            return lst
            except (IndexError, KeyError, TypeError) as e:
                print(f&quot;❌ Could not parse created list from API response: {e}&quot;, file=sys.stderr)
        return None

    def update_list(self, list_id: int, name: str) -&gt; bool:
        return self._post(&quot;/list/update&quot;, {&quot;id&quot;: list_id, &quot;name&quot;: name}) is not None

    def delete_list(self, list_id: int) -&gt; bool:
        # Note: The delete endpoint was not in the HAR file, this is an educated guess.
        # If it fails, the actual endpoint might be different (e.g., /list/remove).
        return self._post(&quot;/list/delete&quot;, {&quot;id&quot;: list_id}) is not None

    def star_list(self, list_id: int) -&gt; bool:
        return self._post(&quot;/list/star&quot;, {&quot;id&quot;: list_id}) is not None

    # --- Sublist Operations ---
    def create_sublist(self, list_id: int, name: str) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Creates a new sublist and robustly finds and returns it.&quot;&quot;&quot;
        response_data = self._post(&quot;/sublist/add&quot;, {&quot;list_id&quot;: list_id, &quot;name&quot;: name})
        if response_data:
            try:
                for sublist in response_data.get(&#39;sublists&#39;, []):
                    if sublist[&#39;name&#39;] == name:
                        return sublist
            except (KeyError, TypeError) as e:
                print(f&quot;❌ Could not parse created sublist from API response: {e}&quot;, file=sys.stderr)
        return None

    def update_sublist(self, sublist_id: int, name: str) -&gt; bool:
        return self._post(&quot;/sublist/update&quot;, {&quot;id&quot;: sublist_id, &quot;name&quot;: name}) is not None

    def delete_sublist(self, sublist_id: int) -&gt; bool:
        # Note: The delete endpoint was not in the HAR file, this is an educated guess.
        return self._post(&quot;/sublist/delete&quot;, {&quot;id&quot;: sublist_id}) is not None

    # --- Task Operations ---
    def create_task(self, sublist_id: int, name: str, **kwargs) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Creates a new task and robustly finds and returns it.&quot;&quot;&quot;
        payload = {&quot;sublist_id&quot;: sublist_id, &quot;name&quot;: name}
        # Map CLI-friendly names to API parameter names
        if &#39;importance&#39; in kwargs: payload[&#39;score_i&#39;] = kwargs.pop(&#39;importance&#39;)
        if &#39;time&#39; in kwargs: payload[&#39;score_t&#39;] = kwargs.pop(&#39;time&#39;)
        if &#39;due_date&#39; in kwargs: payload[&#39;d_date&#39;] = kwargs.pop(&#39;due_date&#39;)
        if &#39;dependency_id&#39; in kwargs: payload[&#39;dependency_id&#39;] = kwargs.pop(&#39;dependency_id&#39;)
        
        payload.update(kwargs)
        if payload.get(&#39;d_date&#39;):
            payload.setdefault(&#39;d_zone&#39;, &#39;-0300&#39;)
            
        response_data = self._post(&quot;/item/add&quot;, payload)
        if response_data:
            try:
                for item in response_data.get(&#39;items&#39;, []):
                    if item[&#39;name&#39;] == name:
                        return item
            except (KeyError, TypeError) as e:
                print(f&quot;❌ Could not parse created task from API response: {e}&quot;, file=sys.stderr)
        return None

    def update_task(self, task_id: int, updates: Dict[str, Any]) -&gt; bool:
        &quot;&quot;&quot;Updates an existing task with only the provided fields.&quot;&quot;&quot;
        payload = updates.copy()
        payload[&#39;id&#39;] = task_id
        if &#39;d_date&#39; in payload and payload[&#39;d_date&#39;]:
            payload.setdefault(&#39;d_zone&#39;, &#39;-0300&#39;)
        return self._post(&quot;/item/update&quot;, data=payload) is not None

    def delete_task(self, task_id: int) -&gt; bool:
        # Note: The delete endpoint was not in the HAR file, this is an educated guess.
        return self._post(&quot;/item/delete&quot;, {&quot;id&quot;: task_id}) is not None

# ─────────────────────────────────────────────────────────────
# Credentials Helper
# ─────────────────────────────────────────────────────────────

def get_credentials(ns: argparse.Namespace) -&gt; Tuple[str, str]:
    &quot;&quot;&quot;Retrieves credentials from args, environment variables, or config file.&quot;&quot;&quot;
    if ns.phpsessid and ns.rkey:
        return ns.phpsessid, ns.rkey
    
    env_sess, env_rkey = os.getenv(&quot;PL_PHPSESSID&quot;), os.getenv(&quot;PL_RKEY&quot;)
    if env_sess and env_rkey:
        return env_sess, env_rkey
        
    cfg_file = Path.home() / &quot;.config&quot; / &quot;prioritylist&quot; / &quot;config.ini&quot;
    if cfg_file.exists():
        # FIX: Disable interpolation to handle &#39;%&#39; characters in cookie values
        cp = configparser.ConfigParser(interpolation=None)
        cp.read(cfg_file)
        if &quot;auth&quot; in cp and &quot;phpsessid&quot; in cp[&quot;auth&quot;] and &quot;rkey&quot; in cp[&quot;auth&quot;]:
            return cp[&quot;auth&quot;][&quot;phpsessid&quot;], cp[&quot;auth&quot;][&quot;rkey&quot;]
            
    print(&quot;❌ Error: Authentication credentials not found.&quot;, file=sys.stderr)
    print(&quot;  Please provide them via flags, environment variables, or a config file.&quot;, file=sys.stderr)
    sys.exit(1)

# ─────────────────────────────────────────────────────────────
# Command Handlers
# ─────────────────────────────────────────────────────────────

def handle_list_pull_all(client: PriorityListApiClient, ns: argparse.Namespace):
    data = client.get_all_lists()
    if data is None:
        print_human(&quot;❌ Could not fetch lists.&quot;, is_json_mode=ns.json)
        return
    if ns.json:
        print_json(data)
    else:
        for group in data:
            print_human(f&quot;\n📁 {group.get(&#39;name&#39;) or &#39;Uncategorized&#39;}&quot;, is_json_mode=ns.json)
            for lst in group.get(&quot;lists&quot;, []):
                star = &quot;⭐&quot; if lst.get(&quot;starred&quot;) else &quot; &quot;
                print_human(f&quot;  {star} ID: {lst[&#39;id&#39;]:&lt;6} {lst[&#39;name&#39;]}&quot;, is_json_mode=ns.json)

def handle_list_show(client: PriorityListApiClient, ns: argparse.Namespace):
    data = client.get_list_details(ns.list_id)
    if data is None:
        print_human(f&quot;❌ List {ns.list_id} not found.&quot;, is_json_mode=ns.json)
        return
    print_json(data)

def handle_list_add(client: PriorityListApiClient, ns: argparse.Namespace):
    new_list = client.create_list(ns.name)
    if new_list:
        print_human(f&quot;✅ Created list &#39;{new_list[&#39;name&#39;]}&#39; (ID: {new_list[&#39;id&#39;]})&quot;, is_json_mode=ns.json)
        if ns.json:
            print_json(new_list)
    else:
        print_human(f&quot;❌ Failed to create list &#39;{ns.name}&#39;.&quot;, is_json_mode=ns.json)

def handle_list_update(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.update_list(ns.list_id, ns.name)
    msg = f&quot;✅ Renamed list {ns.list_id} to &#39;{ns.name}&#39;.&quot; if ok else f&quot;❌ Failed to rename list {ns.list_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_list_delete(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.delete_list(ns.list_id)
    msg = f&quot;✅ Deleted list {ns.list_id}.&quot; if ok else f&quot;❌ Failed to delete list {ns.list_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_list_star(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.star_list(ns.list_id)
    msg = f&quot;✅ Toggled star on list {ns.list_id}.&quot; if ok else f&quot;❌ Failed to toggle star on list {ns.list_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_sublist_add(client: PriorityListApiClient, ns: argparse.Namespace):
    new_sublist = client.create_sublist(ns.list_id, ns.name)
    if new_sublist:
        msg = f&quot;✅ Created sublist &#39;{new_sublist[&#39;name&#39;]}&#39; (ID: {new_sublist[&#39;id&#39;]}) in list {ns.list_id}.&quot;
        print_human(msg, is_json_mode=ns.json)
        if ns.json:
            print_json(new_sublist)
    else:
        print_human(f&quot;❌ Failed to create sublist &#39;{ns.name}&#39;.&quot;, is_json_mode=ns.json)

def handle_sublist_update(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.update_sublist(ns.sublist_id, ns.name)
    msg = f&quot;✅ Renamed sublist {ns.sublist_id} to &#39;{ns.name}&#39;.&quot; if ok else f&quot;❌ Failed to rename sublist {ns.sublist_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_sublist_delete(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.delete_sublist(ns.sublist_id)
    msg = f&quot;✅ Deleted sublist {ns.sublist_id}.&quot; if ok else f&quot;❌ Failed to delete sublist {ns.sublist_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_task_add(client: PriorityListApiClient, ns: argparse.Namespace):
    params = {
        &quot;importance&quot;: ns.importance,
        &quot;time&quot;: ns.time,
        &quot;d_date&quot;: ns.due_date or &quot;&quot;,
        &quot;dependency_id&quot;: ns.dependency_id or &quot;&quot;,
    }
    new_task = client.create_task(ns.sublist_id, ns.name, **params)
    if new_task:
        msg = f&quot;✅ Created task &#39;{new_task[&#39;name&#39;]}&#39; (ID: {new_task[&#39;id&#39;]}) in sublist {ns.sublist_id}.&quot;
        print_human(msg, is_json_mode=ns.json)
        if ns.json:
            print_json(new_task)
    else:
        print_human(f&quot;❌ Failed to create task &#39;{ns.name}&#39;.&quot;, is_json_mode=ns.json)

def handle_task_update(client: PriorityListApiClient, ns: argparse.Namespace):
    updates = {k: v for k, v in vars(ns).items() if k in [
        &#39;name&#39;, &#39;sublist_id&#39;, &#39;importance&#39;, &#39;time&#39;, &#39;due_date&#39;, &#39;dependency_id&#39;
    ] and v is not None}
    
    if not updates:
        print_human(&quot;❌ Error: At least one field to update must be provided.&quot;, is_json_mode=ns.json)
        sys.exit(1)
        
    # Remap arg names to API field names
    if &#39;importance&#39; in updates: updates[&#39;score_i&#39;] = updates.pop(&#39;importance&#39;)
    if &#39;time&#39; in updates: updates[&#39;score_t&#39;] = updates.pop(&#39;time&#39;)
    if &#39;due_date&#39; in updates: updates[&#39;d_date&#39;] = updates.pop(&#39;due_date&#39;)

    ok = client.update_task(ns.task_id, updates)
    msg = f&quot;✅ Updated task {ns.task_id}.&quot; if ok else f&quot;❌ Failed to update task {ns.task_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

def handle_task_delete(client: PriorityListApiClient, ns: argparse.Namespace):
    ok = client.delete_task(ns.task_id)
    msg = f&quot;✅ Deleted task {ns.task_id}.&quot; if ok else f&quot;❌ Failed to delete task {ns.task_id}.&quot;
    print_human(msg, is_json_mode=ns.json)

# ─────────────────────────────────────────────────────────────
# Argument Parser
# ─────────────────────────────────────────────────────────────

def build_parser() -&gt; argparse.ArgumentParser:
    p = argparse.ArgumentParser(description=&quot;A robust CLI for prioritylist.app.&quot;, formatter_class=argparse.RawTextHelpFormatter)
    p.add_argument(&quot;--phpsessid&quot;, help=&quot;Your PHPSESSID cookie.&quot;)
    p.add_argument(&quot;--rkey&quot;, help=&quot;Your rkey cookie.&quot;)
    p.add_argument(&quot;--json&quot;, action=&quot;store_true&quot;, help=&quot;Output machine-readable JSON only.&quot;)

    sp = p.add_subparsers(dest=&quot;resource&quot;, required=True, help=&quot;The resource to manage.&quot;)

    # --- List Parser ---
    ls = sp.add_parser(&quot;list&quot;, help=&quot;Manage lists&quot;).add_subparsers(dest=&quot;action&quot;, required=True)
    ls.add_parser(&quot;pull-all&quot;, help=&quot;Fetch all lists and groups&quot;).set_defaults(func=handle_list_pull_all)
    ls_sh = ls.add_parser(&quot;show&quot;, help=&quot;Show full JSON details for one list&quot;)
    ls_sh.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to show&quot;)
    ls_sh.set_defaults(func=handle_list_show)
    ls_add = ls.add_parser(&quot;add&quot;, help=&quot;Add a new list&quot;)
    ls_add.add_argument(&quot;--name&quot;, required=True, help=&quot;Name for the new list&quot;)
    ls_add.set_defaults(func=handle_list_add)
    ls_upd = ls.add_parser(&quot;update&quot;, help=&quot;Rename a list&quot;)
    ls_upd.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to update&quot;)
    ls_upd.add_argument(&quot;--name&quot;, required=True, help=&quot;New name for the list&quot;)
    ls_upd.set_defaults(func=handle_list_update)
    ls_del = ls.add_parser(&quot;delete&quot;, help=&quot;Delete a list&quot;)
    ls_del.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to delete&quot;)
    ls_del.set_defaults(func=handle_list_delete)
    ls_star = ls.add_parser(&quot;star&quot;, help=&quot;Toggle star status on a list&quot;)
    ls_star.add_argument(&quot;list_id&quot;, type=int, help=&quot;ID of the list to star/unstar&quot;)
    ls_star.set_defaults(func=handle_list_star)

    # --- Sublist Parser ---
    sb = sp.add_parser(&quot;sublist&quot;, help=&quot;Manage sublists&quot;).add_subparsers(dest=&quot;action&quot;, required=True)
    sb_add = sb.add_parser(&quot;add&quot;, help=&quot;Add a new sublist&quot;)
    sb_add.add_argument(&quot;--list-id&quot;, type=int, required=True, help=&quot;ID of the parent list&quot;)
    sb_add.add_argument(&quot;--name&quot;, required=True, help=&quot;Name for the new sublist&quot;)
    sb_add.set_defaults(func=handle_sublist_add)
    sb_upd = sb.add_parser(&quot;update&quot;, help=&quot;Rename a sublist&quot;)
    sb_upd.add_argument(&quot;sublist_id&quot;, type=int, help=&quot;ID of the sublist to update&quot;)
    sb_upd.add_argument(&quot;--name&quot;, required=True, help=&quot;New name for the sublist&quot;)
    sb_upd.set_defaults(func=handle_sublist_update)
    sb_del = sb.add_parser(&quot;delete&quot;, help=&quot;Delete a sublist&quot;)
    sb_del.add_argument(&quot;sublist_id&quot;, type=int, help=&quot;ID of the sublist to delete&quot;)
    sb_del.set_defaults(func=handle_sublist_delete)

    # --- Task Parser ---
    tk = sp.add_parser(&quot;task&quot;, help=&quot;Manage tasks&quot;).add_subparsers(dest=&quot;action&quot;, required=True)
    tk_add = tk.add_parser(&quot;add&quot;, help=&quot;Add a new task&quot;)
    tk_add.add_argument(&quot;--sublist-id&quot;, type=int, required=True, help=&quot;ID of the parent sublist&quot;)
    tk_add.add_argument(&quot;--name&quot;, required=True, help=&quot;Name for the new task&quot;)
    tk_add.add_argument(&quot;-i&quot;, &quot;--importance&quot;, type=int, default=5, help=&quot;Importance score (1-10)&quot;)
    tk_add.add_argument(&quot;-t&quot;, &quot;--time&quot;, type=int, default=5, help=&quot;Time/Effort score (1-10)&quot;)
    tk_add.add_argument(&quot;--due-date&quot;, help=&quot;Due date in YYYY-MM-DD format&quot;)
    tk_add.add_argument(&quot;--dependency-id&quot;, type=int, help=&quot;ID of a prerequisite task&quot;)
    tk_add.set_defaults(func=handle_task_add)
    tk_upd = tk.add_parser(&quot;update&quot;, help=&quot;Update an existing task&quot;)
    tk_upd.add_argument(&quot;task_id&quot;, type=int, help=&quot;ID of the task to update&quot;)
    tk_upd.add_argument(&quot;--sublist-id&quot;, type=int, help=&quot;Move task to a new parent sublist&quot;)
    tk_upd.add_argument(&quot;--name&quot;, help=&quot;New name for the task&quot;)
    tk_upd.add_argument(&quot;-i&quot;, &quot;--importance&quot;, type=int, help=&quot;New importance score (1-10)&quot;)
    tk_upd.add_argument(&quot;-t&quot;, &quot;--time&quot;, type=int, help=&quot;New time/Effort score (1-10)&quot;)
    tk_upd.add_argument(&quot;--due-date&quot;, help=&quot;New due date in YYYY-MM-DD format&quot;)
    tk_upd.add_argument(&quot;--dependency-id&quot;, type=int, help=&quot;New ID of a prerequisite task&quot;)
    tk_upd.set_defaults(func=handle_task_update)
    tk_del = tk.add_parser(&quot;delete&quot;, help=&quot;Delete a task&quot;)
    tk_del.add_argument(&quot;task_id&quot;, type=int, help=&quot;ID of the task to delete&quot;)
    tk_del.set_defaults(func=handle_task_delete)

    return p

# ─────────────────────────────────────────────────────────────
# Main Execution
# ─────────────────────────────────────────────────────────────

def main():
    &quot;&quot;&quot;Main entry point for the script.&quot;&quot;&quot;
    if len(sys.argv) == 1:
        try:
            from ptpython.repl import embed
            print(&quot;▶️  No command provided. Starting interactive REPL...&quot;)
            creds_ns = argparse.Namespace(phpsessid=None, rkey=None)
            phpsessid, rkey = get_credentials(creds_ns)
            client = PriorityListApiClient(phpsessid, rkey)
            namespace = {&#39;client&#39;: client, &#39;print_json&#39;: print_json}
            print(&quot;✅ An API client is available as `client`.&quot;)
            embed(globals=namespace, locals=namespace)
        except ImportError:
            print(&quot;ℹ️ Optional dependency &#39;ptpython&#39; not found.&quot;, file=sys.stderr)
            print(&quot;  Run &#39;pip install ptpython&#39; for an enhanced interactive experience.&quot;, file=sys.stderr)
            print(&quot;\nDisplaying help instead:\n&quot;)
            build_parser().print_help()
        sys.exit(0)

    parser = build_parser()
    args = parser.parse_args()
    
    phpsessid, rkey = get_credentials(args)
    client = PriorityListApiClient(phpsessid, rkey)

    if hasattr(args, &#39;func&#39;):
        args.func(client, args)
    else:
        parser.print_help()

if __name__ == &quot;__main__&quot;:
    main()</code>
</section>
  <h4 id="command-line-interface-cli-and-user-experience-ux">
    
    
     <a href="#command-line-interface-cli-and-user-experience-ux">#</a><a href="#" aria-label="Back to top"><strong>Command-Line Interface (CLI) and User Experience (UX)</strong></a>
        
    
  </h4>
      

<ul>
  <li><strong>Nested Command Structure:</strong> The CLI now uses a more intuitive <code class="language-plaintext highlighter-rouge">resource action</code> format (e.g., <code class="language-plaintext highlighter-rouge">list add</code>, <code class="language-plaintext highlighter-rouge">task update</code>). This is a standard practice for modern CLIs and a vast improvement over the original flat command list.</li>
  <li><strong>Interactive REPL Mode:</strong> A major feature addition is the <code class="language-plaintext highlighter-rouge">ptpython</code>-based interactive REPL, which launches if the script is run without arguments. It provides an authenticated <code class="language-plaintext highlighter-rouge">client</code> object, allowing for powerful, exploratory API interactions without writing new scripts.</li>
  <li><strong>Clear and Concise Output:</strong> The use of emojis (✅, ❌, 📁, ⭐) provides immediate visual feedback on the status of operations.</li>
  <li><strong>Scripting-Friendly JSON Mode:</strong> The <code class="language-plaintext highlighter-rouge">--json</code> flag now guarantees that the only output to <code class="language-plaintext highlighter-rouge">stdout</code> is a clean JSON object, making it trivial to pipe the output of this tool to other programs like <code class="language-plaintext highlighter-rouge">jq</code>.</li>
</ul>
  <h4 id="4-security-enhancements">
    
    
     <a href="#4-security-enhancements">#</a><a href="#" aria-label="Back to top"><strong>4. Security Enhancements</strong></a>
        
    
  </h4>
      

<ul>
  <li><strong>Secure Credential Sourcing:</strong> The <code class="language-plaintext highlighter-rouge">get_credentials</code> function continues to provide a secure and flexible way to manage API keys, preventing them from being hard-coded. It checks arguments, environment variables, and a dedicated config file in a safe order of precedence.</li>
  <li><strong>Robust Input Handling:</strong> The API client’s improved error handling and response parsing make it less susceptible to crashes or unexpected behavior caused by malformed API responses.</li>
</ul>

        </div>
        
          URL: https://ib.bsb.br/python-client-to-interact-with-the-prioritylistapp-api
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/har-analyzer/" title="HAR analyzer" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/prioritylist/" title="prioritylist.app cheatsheet" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/ai-wiki/" title="AI wiki" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/apple-shortcuts-meta-automation/" title="Apple Shortcuts Meta-Automation" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-06-19 18:12:06
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/python-client-to-interact-with-the-prioritylistapp-api/"
        },
        "headline": "Python client to interact with the `prioritylist.app` API",
        "description": "",
        "datePublished": "2025-06-18T00:00:00+00:00",
        "dateModified": "2025-06-18T20:22:43+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
