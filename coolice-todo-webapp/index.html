<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        coolice todo webapp - infoBAG
      
    </title>
    <meta name="title" content="coolice todo webapp - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/coolice-todo-webapp/">
    <meta property="og:title" content="coolice todo webapp - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/coolice-todo-webapp/">
    <meta name="twitter:title" content="coolice todo webapp - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/coolice-todo-webapp/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          coolice todo webapp
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-09-10T00:00:00+00:00" class="post-date">
          10 Sep 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-09-11T20:49:57+00:00">
              11 Sep 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/coolice-todo-webapp" class="tag">coolice-todo-webapp</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        36364 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        3560 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-09-10-coolice-todo-webapp.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-09-10-coolice-todo-webapp.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          

          <div class="language-php highlighter-rouge"><div class="highlight"><section><code><span class="cp">&lt;?php</span>
<span class="k">declare</span><span class="p">(</span><span class="n">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="cm">/*
UX upgrades (fully implemented)
- Inline edits: Enter commits, Esc cancels and reverts, Tab moves to next, Shift+Tab to prev.
- Title: Enter saves, Esc cancels.
- Keyboard on list: Space toggles, Delete removes, E starts edit for focused item.
- Drag-and-drop reorder (disabled while filtering/searching); persists via new "reorder" API op.
- Filters &amp; search: All/Active/Completed + text search; persists in localStorage.
- Bulk ops: "Complete all"/"Uncheck all", "Clear completed", "Clear all" (with confirm).
- Undo for delete and clear completed (10s window).
- Recent boards history with datalist for quick switching.
- Accessibility and feedback: aria-live, counts, last updated, consistent flash messages.
- PWA retained with single-file assets; safer limits and headers; ETag + Last-Modified + 304 for fetch.
*/</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Security &amp; headers</span>
<span class="c1">/////////////////////////////</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">'X-Content-Type-Options: nosniff'</span><span class="p">);</span>

<span class="nv">$isHttps</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">'off'</span><span class="p">)</span>
  <span class="o">||</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PROTO'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PROTO'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'https'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$isHttps</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Strict-Transport-Security: max-age=31536000; includeSubDomains'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Config and helpers</span>
<span class="c1">/////////////////////////////</span>

<span class="nv">$scheme</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$isHttps</span> <span class="o">?</span> <span class="s1">'https'</span> <span class="o">:</span> <span class="s1">'http'</span><span class="p">);</span>
<span class="nv">$host</span>   <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_HOST'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$origin</span> <span class="o">=</span> <span class="nv">$scheme</span> <span class="mf">.</span> <span class="s1">'://'</span> <span class="mf">.</span> <span class="nv">$host</span><span class="p">;</span>

<span class="nv">$dataDir</span> <span class="o">=</span> <span class="nb">realpath</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/..'</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nb">realpath</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/..'</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'/data'</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../data'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dataDir</span><span class="p">))</span> <span class="p">{</span>
  <span class="o">@</span><span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dataDir</span><span class="p">,</span> <span class="mo">0755</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span> <span class="no">MAX_TEXT_LEN</span>  <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
<span class="k">const</span> <span class="no">MAX_TITLE_LEN</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>

<span class="k">function</span> <span class="n">id</span><span class="p">():</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">random_bytes</span><span class="p">(</span><span class="mi">6</span><span class="p">)),</span> <span class="s1">'+/'</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">),</span> <span class="s1">'='</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">safeSlug</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^a-zA-Z0-9_-]/'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$b</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="s1">'public'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">pathOf</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">'dataDir'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'/'</span> <span class="mf">.</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'.json'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">emptyBoard</span><span class="p">():</span> <span class="kt">array</span> <span class="p">{</span>
  <span class="nv">$t</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">[</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'My Todo'</span><span class="p">,</span> <span class="s1">'tasks'</span> <span class="o">=&gt;</span> <span class="p">[],</span> <span class="s1">'created'</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">,</span> <span class="s1">'updated'</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">loadBoard</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">):</span> <span class="kt">array</span> <span class="p">{</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nf">pathOf</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$f</span><span class="p">))</span> <span class="k">return</span> <span class="nf">emptyBoard</span><span class="p">();</span>
  <span class="nv">$raw</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
  <span class="nv">$j</span> <span class="o">=</span> <span class="nv">$raw</span> <span class="o">?</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$raw</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">is_array</span><span class="p">(</span><span class="nv">$j</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$j</span> <span class="o">:</span> <span class="nf">emptyBoard</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">saveBoard</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$b</span><span class="p">,</span> <span class="kt">array</span> <span class="nv">$d</span><span class="p">):</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nf">pathOf</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$d</span><span class="p">[</span><span class="s1">'updated'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
  <span class="nv">$h</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">'c+'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$h</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">flock</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="no">LOCK_EX</span><span class="p">);</span>
    <span class="nb">ftruncate</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$d</span><span class="p">,</span> <span class="no">JSON_PRETTY_PRINT</span> <span class="o">|</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">));</span>
    <span class="nb">fflush</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>
    <span class="nb">flock</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="no">LOCK_UN</span><span class="p">);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>
    <span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">emitJSON</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="kt">array</span> <span class="nv">$headers</span> <span class="o">=</span> <span class="p">[]):</span> <span class="kt">never</span> <span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$headers</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="nb">header</span><span class="p">(</span><span class="s2">"</span><span class="nv">$k</span><span class="s2">: </span><span class="nv">$v</span><span class="s2">"</span><span class="p">);</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json; charset=utf-8'</span><span class="p">);</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: no-cache, must-revalidate'</span><span class="p">);</span>
  <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">notModified</span><span class="p">():</span> <span class="kt">never</span> <span class="p">{</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'HTTP/1.1 304 Not Modified'</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">htmlHeader</span><span class="p">():</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: text/html; charset=utf-8'</span><span class="p">);</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: no-cache'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Asset router (manifest, sw, icons, favicon)</span>
<span class="c1">/////////////////////////////</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'asset'</span><span class="p">]))</span> <span class="p">{</span>
  <span class="nv">$asset</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'asset'</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$asset</span> <span class="o">===</span> <span class="s1">'manifest'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/manifest+json; charset=utf-8'</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: public, max-age=3600'</span><span class="p">);</span>
    <span class="c1">// Minimal base64 1x1 PNG</span>
    <span class="nv">$icon1x1</span> <span class="o">=</span> <span class="s1">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII='</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
      <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'memor.ia.br — Todos'</span><span class="p">,</span>
      <span class="s1">'short_name'</span> <span class="o">=&gt;</span> <span class="s1">'memor'</span><span class="p">,</span>
      <span class="s1">'start_url'</span> <span class="o">=&gt;</span> <span class="s1">'/?b=public'</span><span class="p">,</span>
      <span class="s1">'display'</span> <span class="o">=&gt;</span> <span class="s1">'standalone'</span><span class="p">,</span>
      <span class="s1">'background_color'</span> <span class="o">=&gt;</span> <span class="s1">'#ffffff'</span><span class="p">,</span>
      <span class="s1">'theme_color'</span> <span class="o">=&gt;</span> <span class="s1">'#111111'</span><span class="p">,</span>
      <span class="s1">'icons'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'src'</span> <span class="o">=&gt;</span> <span class="nv">$icon1x1</span><span class="p">,</span> <span class="s1">'sizes'</span> <span class="o">=&gt;</span> <span class="s1">'192x192'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'image/png'</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'src'</span> <span class="o">=&gt;</span> <span class="nv">$icon1x1</span><span class="p">,</span> <span class="s1">'sizes'</span> <span class="o">=&gt;</span> <span class="s1">'512x512'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'image/png'</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'src'</span> <span class="o">=&gt;</span> <span class="nv">$origin</span> <span class="mf">.</span> <span class="s1">'/?asset=favicon'</span><span class="p">,</span> <span class="s1">'sizes'</span> <span class="o">=&gt;</span> <span class="s1">'any'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'image/svg+xml'</span><span class="p">,</span> <span class="s1">'purpose'</span> <span class="o">=&gt;</span> <span class="s1">'any maskable'</span><span class="p">],</span>
      <span class="p">],</span>
      <span class="s1">'scope'</span> <span class="o">=&gt;</span> <span class="s1">'/'</span><span class="p">,</span>
    <span class="p">],</span> <span class="no">JSON_UNESCAPED_SLASHES</span> <span class="o">|</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$asset</span> <span class="o">===</span> <span class="s1">'sw'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/javascript; charset=utf-8'</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: public, max-age=3600'</span><span class="p">);</span>
    <span class="cp">?&gt;</span>
// Service Worker for memor.ia.br
const CACHE_NAME = 'memor-cache-v1.4';
const SHELL = [
  '/?b=public',
  '/?asset=manifest',
  '/?asset=favicon'
];

self.addEventListener('install', (e) =&gt; {
  e.waitUntil(caches.open(CACHE_NAME).then(c =&gt; c.addAll(SHELL)));
  self.skipWaiting();
});

self.addEventListener('activate', (e) =&gt; {
  e.waitUntil(
    caches.keys().then(keys =&gt; Promise.all(keys.map(k =&gt; (k!==CACHE_NAME ? caches.delete(k) : Promise.resolve()))))
  );
  self.clients.claim();
});

self.addEventListener('fetch', (e) =&gt; {
  const url = new URL(e.request.url);
  // API fetch for board -&gt; stale-while-revalidate
  if (url.searchParams.get('action') === 'fetch' <span class="err">&amp;&amp;</span> url.searchParams.get('b')) {
    e.respondWith((async () =&gt; {
      const cache = await caches.open(CACHE_NAME);
      const cached = await cache.match(e.request);
      const fetchPromise = fetch(e.request).then(res =&gt; {
        if (res <span class="err">&amp;&amp;</span> (res.status === 200 || res.status === 304)) {
          cache.put(e.request, res.clone());
        }
        return res;
      }).catch(() =&gt; cached);
      return cached || fetchPromise;
    })());
    return;
  }
  // HTML/other GET: network first; fallback to cache; simple offline page if none
  if (e.request.method === 'GET') {
    e.respondWith((async () =&gt; {
      try {
        const net = await fetch(e.request);
        const cache = await caches.open(CACHE_NAME);
        cache.put(e.request, net.clone());
        return net;
      } catch (err) {
        const cache = await caches.open(CACHE_NAME);
        const cached = await cache.match(e.request);
        return cached || new Response('<span class="cp">&lt;!doctype html&gt;</span><span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;&lt;title&gt;</span>Offline<span class="nt">&lt;/title&gt;&lt;h1&gt;</span>Offline<span class="nt">&lt;/h1&gt;&lt;p&gt;</span>The app is offline. Retry when back online.<span class="nt">&lt;/p&gt;</span>', { headers: {'Content-Type':'text/html; charset=utf-8'} });
      }
    })());
  }
});
    <span class="cp">&lt;?php</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$asset</span> <span class="o">===</span> <span class="s1">'favicon'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: image/svg+xml; charset=utf-8'</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: public, max-age=86400'</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">'&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"&gt;&lt;rect fill="#111" width="64" height="64" rx="12"/&gt;&lt;path d="M48 20L27 41l-11-9" stroke="#fff" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none"/&gt;&lt;/svg&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'HTTP/1.1 404 Not Found'</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// API: Board fetch (GET) with ETag/Last-Modified</span>
<span class="c1">/////////////////////////////</span>

<span class="nv">$action</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'action'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$bParam</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">'new'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$bid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">();</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: '</span> <span class="mf">.</span> <span class="nv">$origin</span> <span class="mf">.</span> <span class="s1">'/?b='</span> <span class="mf">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$bid</span><span class="p">));</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$action</span> <span class="o">===</span> <span class="s1">'fetch'</span> <span class="o">&amp;&amp;</span> <span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span><span class="p">);</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nf">pathOf</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$board</span> <span class="o">=</span> <span class="nf">loadBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
  <span class="nv">$raw</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$board</span><span class="p">,</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">);</span>
  <span class="nv">$etag</span> <span class="o">=</span> <span class="s1">'"'</span> <span class="mf">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$raw</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'"'</span><span class="p">;</span>
  <span class="nv">$lastModTs</span> <span class="o">=</span> <span class="nb">file_exists</span><span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="o">?</span> <span class="nb">filemtime</span><span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$board</span><span class="p">[</span><span class="s1">'updated'</span><span class="p">];</span>
  <span class="nv">$lastMod</span> <span class="o">=</span> <span class="nb">gmdate</span><span class="p">(</span><span class="s1">'D, d M Y H:i:s'</span><span class="p">,</span> <span class="nv">$lastModTs</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">' GMT'</span><span class="p">;</span>

  <span class="nv">$inm</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_IF_NONE_MATCH'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$ims</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_IF_MODIFIED_SINCE'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$inm</span> <span class="o">===</span> <span class="nv">$etag</span> <span class="o">||</span> <span class="nv">$ims</span> <span class="o">===</span> <span class="nv">$lastMod</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'ETag: '</span> <span class="mf">.</span> <span class="nv">$etag</span><span class="p">);</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Last-Modified: '</span> <span class="mf">.</span> <span class="nv">$lastMod</span><span class="p">);</span>
    <span class="nf">notModified</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'ETag'</span> <span class="o">=&gt;</span> <span class="nv">$etag</span><span class="p">,</span>
    <span class="s1">'Last-Modified'</span> <span class="o">=&gt;</span> <span class="nv">$lastMod</span>
  <span class="p">]);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// POST ops</span>
<span class="c1">/////////////////////////////</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span><span class="p">);</span>
  <span class="nv">$in</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'php://input'</span><span class="p">),</span> <span class="kc">true</span><span class="p">)</span> <span class="o">?:</span> <span class="p">[];</span>
  <span class="nv">$op</span> <span class="o">=</span> <span class="nv">$in</span><span class="p">[</span><span class="s1">'op'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$board</span> <span class="o">=</span> <span class="nf">loadBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'add'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$t</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$t</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TEXT_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
      <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nf">id</span><span class="p">(),</span> <span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">,</span> <span class="s1">'done'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">'ts'</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()];</span>
      <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'toggle'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$idv</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$idv</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">]</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">];</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">unset</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'edit'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$idv</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">);</span>
    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">));</span>
    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TEXT_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$idv</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$t</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$txt</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">unset</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'del'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$idv</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">);</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_filter</span><span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">],</span> <span class="k">fn</span><span class="p">(</span><span class="nv">$t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nv">$t</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">!==</span> <span class="nv">$idv</span><span class="p">));</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'title'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ttl</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$ttl</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="nv">$ttl</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$ttl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TITLE_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$ttl</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$ttl</span> <span class="o">:</span> <span class="s1">'My Todo'</span><span class="p">;</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'clear_done'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_filter</span><span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">],</span> <span class="k">fn</span><span class="p">(</span><span class="nv">$t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">])));</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// New: set all done/undone</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'set_all'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$done</span> <span class="o">=</span> <span class="p">(</span><span class="n">bool</span><span class="p">)(</span><span class="nv">$in</span><span class="p">[</span><span class="s1">'done'</span><span class="p">]</span> <span class="o">??</span> <span class="kc">false</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$t</span><span class="p">[</span><span class="s1">'done'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$done</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">unset</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// New: clear all</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'clear_all'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// New: reorder tasks by id list</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$op</span> <span class="o">===</span> <span class="s1">'reorder'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$in</span><span class="p">[</span><span class="s1">'order'</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="p">{</span>
      <span class="nv">$idx</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$order</span> <span class="k">as</span> <span class="nv">$pos</span> <span class="o">=&gt;</span> <span class="nv">$tid</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$idx</span><span class="p">[(</span><span class="n">string</span><span class="p">)</span><span class="nv">$tid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$pos</span><span class="p">;</span> <span class="p">}</span>
      <span class="nb">usort</span><span class="p">(</span><span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">],</span> <span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$idx</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ai</span> <span class="o">=</span> <span class="nv">$idx</span><span class="p">[</span><span class="nv">$a</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">??</span> <span class="kc">PHP_INT_MAX</span><span class="p">;</span>
        <span class="nv">$bi</span> <span class="o">=</span> <span class="nv">$idx</span><span class="p">[</span><span class="nv">$b</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">??</span> <span class="kc">PHP_INT_MAX</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$ai</span> <span class="o">&lt;=&gt;</span> <span class="nv">$bi</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">emitJSON</span><span class="p">(</span><span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nf">emitJSON</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'unknown op'</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// Quick add by URL (?add=Text) -&gt; add to board and redirect</span>
<span class="c1">/////////////////////////////</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'add'</span><span class="p">]))</span> <span class="p">{</span>
  <span class="nv">$b</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$bParam</span> <span class="o">:</span> <span class="s1">'public'</span><span class="p">);</span>
  <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'add'</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$txt</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">MAX_TEXT_LEN</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>
    <span class="nv">$board</span> <span class="o">=</span> <span class="nf">loadBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
    <span class="nv">$board</span><span class="p">[</span><span class="s1">'tasks'</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nf">id</span><span class="p">(),</span> <span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="nv">$txt</span><span class="p">,</span> <span class="s1">'done'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">'ts'</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()];</span>
    <span class="nf">saveBoard</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$board</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: '</span> <span class="mf">.</span> <span class="nv">$origin</span> <span class="mf">.</span> <span class="s1">'/?b='</span> <span class="mf">.</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$b</span><span class="p">),</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">303</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////</span>
<span class="c1">// HTML App</span>
<span class="c1">/////////////////////////////</span>

<span class="nv">$boardSlug</span> <span class="o">=</span> <span class="nf">safeSlug</span><span class="p">(</span><span class="nv">$bParam</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nv">$bParam</span> <span class="o">:</span> <span class="s1">'public'</span><span class="p">);</span>
<span class="nf">htmlHeader</span><span class="p">();</span>
<span class="cp">?&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width,initial-scale=1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"robots"</span> <span class="na">content=</span><span class="s">"noindex"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"manifest"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$origin</span><span class="p">,</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">/?asset=manifest"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"icon"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$origin</span><span class="p">,</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">/?asset=favicon"</span> <span class="na">type=</span><span class="s">"image/svg+xml"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"theme-color"</span> <span class="na">content=</span><span class="s">"#111111"</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>memor.ia.br <span class="ni">&amp;mdash;</span> Todos<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style&gt;</span>
  <span class="nd">:root</span> <span class="p">{</span> <span class="py">color-scheme</span><span class="p">:</span> <span class="n">light</span> <span class="n">dark</span><span class="p">;</span> <span class="py">--bg</span><span class="p">:</span><span class="m">#fff</span><span class="p">;</span> <span class="py">--fg</span><span class="p">:</span><span class="m">#111</span><span class="p">;</span> <span class="py">--muted</span><span class="p">:</span><span class="m">#777</span><span class="p">;</span> <span class="py">--border</span><span class="p">:</span><span class="m">#ddd</span><span class="p">;</span> <span class="py">--accent</span><span class="p">:</span><span class="m">#111</span><span class="p">;</span> <span class="py">--ok</span><span class="p">:</span><span class="m">#0a7f2e</span><span class="p">;</span> <span class="py">--warn</span><span class="p">:</span><span class="m">#a00</span><span class="p">;</span> <span class="py">--chip</span><span class="p">:</span><span class="m">#f1f1f1</span><span class="p">;</span> <span class="py">--chipA</span><span class="p">:</span><span class="m">#d1e9ff</span><span class="p">;</span> <span class="py">--focus</span><span class="p">:</span><span class="m">#5b9cff</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">prefers-color-scheme</span><span class="p">:</span> <span class="n">dark</span><span class="p">)</span> <span class="p">{</span>
    <span class="nd">:root</span> <span class="p">{</span> <span class="py">--bg</span><span class="p">:</span><span class="m">#0c0c0c</span><span class="p">;</span> <span class="py">--fg</span><span class="p">:</span><span class="m">#eee</span><span class="p">;</span> <span class="py">--muted</span><span class="p">:</span><span class="m">#aaa</span><span class="p">;</span> <span class="py">--border</span><span class="p">:</span><span class="m">#222</span><span class="p">;</span> <span class="py">--accent</span><span class="p">:</span><span class="m">#e5e5e5</span><span class="p">;</span> <span class="py">--ok</span><span class="p">:</span><span class="m">#4cc27f</span><span class="p">;</span> <span class="py">--warn</span><span class="p">:</span><span class="m">#ff736a</span><span class="p">;</span> <span class="py">--chip</span><span class="p">:</span><span class="m">#171717</span><span class="p">;</span> <span class="py">--chipA</span><span class="p">:</span><span class="m">#0f3050</span><span class="p">;</span> <span class="py">--focus</span><span class="p">:</span><span class="m">#6aa3ff</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="c">/* Prevent padding/border from causing overflow on small screens */</span>
  <span class="o">*,</span> <span class="o">*</span><span class="nd">::before</span><span class="o">,</span> <span class="o">*</span><span class="nd">::after</span> <span class="p">{</span> <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span> <span class="p">}</span>

  <span class="nt">html</span><span class="o">,</span><span class="nt">body</span><span class="p">{</span><span class="nl">height</span><span class="p">:</span><span class="m">100%</span><span class="p">}</span>
  <span class="nt">body</span><span class="p">{</span><span class="nl">margin</span><span class="p">:</span><span class="m">0</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--bg</span><span class="p">);</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--fg</span><span class="p">);</span><span class="nl">font</span><span class="p">:</span><span class="m">16px</span><span class="p">/</span><span class="m">1.5</span> <span class="n">system-ui</span><span class="p">,</span><span class="n">Segoe</span> <span class="n">UI</span><span class="p">,</span><span class="n">Roboto</span><span class="p">,</span><span class="n">Arial</span><span class="p">}</span>
  <span class="nc">.wrap</span><span class="p">{</span><span class="nl">max-width</span><span class="p">:</span><span class="m">920px</span><span class="p">;</span><span class="nl">margin</span><span class="p">:</span><span class="m">0</span> <span class="nb">auto</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">18px</span><span class="p">}</span>
  <span class="nc">.box</span><span class="p">{</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">12px</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">14px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0.02</span><span class="p">)}</span>
  <span class="c">/* Allow items to wrap instead of overflowing horizontally */</span>
  <span class="nc">.row</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">}</span>
  <span class="c">/* Inputs are flex items that may shrink; ensure they can */</span>
  <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">text</span><span class="o">],</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">search</span><span class="o">]</span><span class="p">{</span>
    <span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">;</span> <span class="c">/* allow shrink within flex containers */</span>
    <span class="nl">padding</span><span class="p">:</span><span class="m">.65rem</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="nb">transparent</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--fg</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nt">button</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">.6rem</span> <span class="m">.9rem</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">0</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--accent</span><span class="p">);</span><span class="nl">color</span><span class="p">:</span><span class="m">#fff</span><span class="p">;</span><span class="nl">cursor</span><span class="p">:</span><span class="nb">pointer</span><span class="p">}</span>
  <span class="nt">button</span><span class="nc">.secondary</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="nb">transparent</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--fg</span><span class="p">);</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">)}</span>
  <span class="nt">button</span><span class="nc">.warn</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--warn</span><span class="p">)}</span>
  <span class="nt">button</span><span class="nc">.ok</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--ok</span><span class="p">)}</span>
  <span class="nt">ul</span><span class="p">{</span><span class="nl">list-style</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">0</span><span class="p">;</span><span class="nl">margin</span><span class="p">:</span><span class="m">12px</span> <span class="m">0</span><span class="p">}</span>
  <span class="c">/* Let task rows wrap controls/text on narrow screens */</span>
  <span class="nt">li</span><span class="p">{</span>
    <span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span>
    <span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span>
    <span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span><span class="m">.45rem</span> <span class="m">.3rem</span><span class="p">;</span>
    <span class="nl">border-bottom</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span>
    <span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">li</span><span class="nd">:focus</span><span class="p">{</span><span class="nl">outline</span><span class="p">:</span><span class="m">2px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--focus</span><span class="p">);</span><span class="nl">outline-offset</span><span class="p">:</span><span class="m">2px</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">8px</span><span class="p">}</span>
  <span class="nt">li</span><span class="nc">.done</span> <span class="nc">.txt</span><span class="p">{</span><span class="nl">text-decoration</span><span class="p">:</span><span class="nb">line-through</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--muted</span><span class="p">)}</span>
  <span class="nc">.txt</span><span class="p">{</span>
    <span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">;</span> <span class="c">/* avoid pushing buttons offscreen */</span>
    <span class="nl">outline</span><span class="p">:</span><span class="nb">none</span>
  <span class="p">}</span>
  <span class="nc">.txt</span><span class="nd">:focus</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">.1</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">4px</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">2px</span><span class="p">}</span>
  <span class="nc">.meta</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">8px</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">;</span><span class="nl">margin-top</span><span class="p">:</span><span class="m">10px</span><span class="p">}</span>
  <span class="nc">.small</span><span class="p">{</span><span class="nl">font-size</span><span class="p">:</span><span class="m">.9rem</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--muted</span><span class="p">)}</span>
  <span class="nc">.pill</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">.1rem</span> <span class="m">.5rem</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">999px</span><span class="p">}</span>
  <span class="nc">.share</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">inline-flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">}</span>
  <span class="nc">.offline</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span><span class="nl">margin</span><span class="p">:</span><span class="m">12px</span> <span class="m">0</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="m">#fffbcc</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="m">#333</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="m">#e0dca6</span><span class="p">}</span>
  <span class="nc">.offline.show</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="nb">block</span><span class="p">}</span>
  <span class="nc">.right</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="nb">auto</span><span class="p">}</span>
  <span class="nc">.kbd</span><span class="p">{</span><span class="nl">font-family</span><span class="p">:</span><span class="n">ui-monospace</span><span class="p">,</span> <span class="n">SFMono-Regular</span><span class="p">,</span> <span class="n">Menlo</span><span class="p">,</span> <span class="n">Consolas</span><span class="p">,</span> <span class="nb">monospace</span><span class="p">;</span><span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">127</span><span class="p">,</span><span class="m">.18</span><span class="p">);</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">border-bottom-color</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.3</span><span class="p">);</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">6px</span><span class="p">;</span><span class="nl">padding</span><span class="p">:</span><span class="m">0</span> <span class="m">.3rem</span><span class="p">}</span>
  <span class="nc">.toolbar</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.5rem</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">;</span><span class="nl">align-items</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span><span class="nl">margin-bottom</span><span class="p">:</span><span class="m">.6rem</span><span class="p">}</span>
  <span class="nc">.chips</span><span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span><span class="py">gap</span><span class="p">:</span><span class="m">.4rem</span><span class="p">;</span><span class="nl">flex-wrap</span><span class="p">:</span><span class="n">wrap</span><span class="p">}</span>
  <span class="nc">.chip</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">.35rem</span> <span class="m">.6rem</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">999px</span><span class="p">;</span><span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--border</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--chip</span><span class="p">);</span><span class="nl">cursor</span><span class="p">:</span><span class="nb">pointer</span><span class="p">}</span>
  <span class="nc">.chip.active</span><span class="p">{</span><span class="nl">background</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--chipA</span><span class="p">)}</span>
  <span class="nc">.drag</span><span class="p">{</span><span class="nl">cursor</span><span class="p">:</span><span class="n">grab</span><span class="p">;</span><span class="py">user-select</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span><span class="nl">color</span><span class="p">:</span><span class="n">var</span><span class="p">(</span><span class="n">--muted</span><span class="p">);</span><span class="nl">padding</span><span class="p">:</span><span class="m">0</span> <span class="m">.4rem</span><span class="p">}</span>
  <span class="nc">.count</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="m">.4rem</span><span class="p">}</span>
  <span class="nc">.status</span><span class="p">{</span><span class="nl">min-height</span><span class="p">:</span><span class="m">1.4rem</span><span class="p">}</span>
  <span class="nc">.status</span> <span class="nt">button</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="m">.5rem</span><span class="p">}</span>
  <span class="nc">.sr</span><span class="p">{</span><span class="nl">position</span><span class="p">:</span><span class="nb">absolute</span><span class="p">;</span><span class="nl">left</span><span class="p">:</span><span class="m">-9999px</span><span class="p">;</span><span class="nl">top</span><span class="p">:</span><span class="nb">auto</span><span class="p">;</span><span class="nl">width</span><span class="p">:</span><span class="m">1px</span><span class="p">;</span><span class="nl">height</span><span class="p">:</span><span class="m">1px</span><span class="p">;</span><span class="nl">overflow</span><span class="p">:</span><span class="nb">hidden</span><span class="p">;}</span>

  <span class="c">/* Keep drag handle/checkbox/delete visible; text fills remaining space */</span>
  <span class="nt">li</span> <span class="o">&gt;</span> <span class="nc">.drag</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">0</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">}</span>
  <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">checkbox</span><span class="o">]</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">0</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">}</span>
  <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="o">[</span><span class="nt">aria-label</span><span class="o">=</span><span class="s1">"Delete task"</span><span class="o">]</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">0</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">}</span>

  <span class="c">/* Defensive text wrapping to avoid horizontal scroll from long tokens/URLs */</span>
  <span class="nc">.wrap</span><span class="o">,</span> <span class="nc">.box</span><span class="o">,</span> <span class="nc">.txt</span><span class="o">,</span> <span class="nf">#title</span><span class="o">,</span> <span class="nf">#newtodo</span><span class="o">,</span> <span class="nf">#search</span><span class="o">,</span> <span class="nf">#shareUrl</span> <span class="p">{</span>
    <span class="nl">overflow-wrap</span><span class="p">:</span><span class="n">anywhere</span><span class="p">;</span>
    <span class="nl">word-break</span><span class="p">:</span><span class="n">break-word</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">/* --- Responsive layout --- */</span>
  <span class="c">/* Toolbar: allow the shortcuts block to wrap to its own line on small screens */</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">620px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.wrap</span><span class="p">{</span><span class="nl">padding</span><span class="p">:</span><span class="m">12px</span><span class="p">}</span>
    <span class="nc">.toolbar</span> <span class="nc">.row</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.toolbar</span> <span class="nc">.row.right</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">;</span> <span class="nl">order</span><span class="p">:</span><span class="m">2</span><span class="p">;</span> <span class="nl">font-size</span><span class="p">:</span><span class="m">.95rem</span><span class="p">}</span>
  <span class="p">}</span>

  <span class="c">/* Title + bulk actions row:
     - Title takes full width on narrow viewports
     - Buttons wrap to two columns, then single column on very narrow screens */</span>
  <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nf">#title</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">320px</span><span class="p">;</span> <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">820px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nf">#title</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">620px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nf">#title</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="p">{</span>
      <span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="n">calc</span><span class="p">(</span><span class="m">50%</span> <span class="n">-</span> <span class="m">.5rem</span><span class="p">);</span>
      <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">420px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:first-of-type</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
  <span class="p">}</span>

  <span class="c">/* Add/search/filter row: allow clean wrapping */</span>
  <span class="nf">#newtodo</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">2</span> <span class="m">1</span> <span class="m">260px</span><span class="p">;</span> <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">}</span>
  <span class="nf">#search</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">180px</span><span class="p">;</span> <span class="nl">min-width</span><span class="p">:</span><span class="m">0</span><span class="p">}</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">620px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:nth-of-type</span><span class="o">(</span><span class="err">2</span><span class="o">)</span> <span class="o">&gt;</span> <span class="nf">#newtodo</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.box</span> <span class="o">&gt;</span> <span class="nc">.row</span><span class="nd">:nth-of-type</span><span class="o">(</span><span class="err">2</span><span class="o">)</span> <span class="o">&gt;</span> <span class="nf">#search</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="nc">.chips</span><span class="p">{</span><span class="nl">flex</span><span class="p">:</span><span class="m">1</span> <span class="m">1</span> <span class="m">100%</span><span class="p">}</span>
    <span class="c">/* Override inline max-widths so fields can span full width on small screens */</span>
    <span class="nf">#slug</span><span class="o">,</span> <span class="nf">#search</span><span class="o">,</span> <span class="nf">#shareUrl</span> <span class="p">{</span> <span class="nl">max-width</span><span class="p">:</span><span class="m">100%</span> <span class="cp">!important</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="c">/* List items: small screens may move Delete to next line neatly */</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">420px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nt">li</span><span class="p">{</span><span class="py">row-gap</span><span class="p">:</span><span class="m">.35rem</span><span class="p">}</span>
    <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">button</span><span class="o">[</span><span class="nt">aria-label</span><span class="o">=</span><span class="s1">"Delete task"</span><span class="o">]</span><span class="p">{</span><span class="nl">margin-left</span><span class="p">:</span><span class="nb">auto</span><span class="p">}</span>
  <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrap"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toolbar"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">style=</span><span class="s">"flex:1;gap:.5rem"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small pill"</span><span class="nt">&gt;</span>Board<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"slug"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$boardSlug</span><span class="p">,</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">aria-label=</span><span class="s">"Board slug"</span> <span class="na">style=</span><span class="s">"max-width:240px"</span> <span class="na">list=</span><span class="s">"boards"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">"boards"</span><span class="nt">&gt;&lt;/datalist&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"switch"</span> <span class="na">title=</span><span class="s">"Open board by slug"</span><span class="nt">&gt;</span>Open<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"newBoard"</span> <span class="na">title=</span><span class="s">"Create a new random board"</span><span class="nt">&gt;</span>New<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row right"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small"</span><span class="nt">&gt;</span>Shortcuts: <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>Enter<span class="nt">&lt;/span&gt;</span> add/edit, <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>Esc<span class="nt">&lt;/span&gt;</span> cancel, <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>Ctrl<span class="nt">&lt;/span&gt;</span>+<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"kbd"</span><span class="nt">&gt;</span>/<span class="nt">&lt;/span&gt;</span> focus<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"offline"</span> <span class="na">class=</span><span class="s">"offline"</span> <span class="na">role=</span><span class="s">"status"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;</span>You are offline. Changes will queue and sync when back online.<span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"box"</span> <span class="na">aria-label=</span><span class="s">"Todo app"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">style=</span><span class="s">"margin-bottom:.6rem"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"title"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"My Todo"</span> <span class="na">aria-label=</span><span class="s">"List title"</span> <span class="na">title=</span><span class="s">"Title (Enter to save, Esc to cancel)"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"saveTitle"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">title=</span><span class="s">"Save title"</span><span class="nt">&gt;</span>Save title<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"toggleAll"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">title=</span><span class="s">"Toggle all tasks"</span><span class="nt">&gt;</span>Complete all<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"clearDone"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">title=</span><span class="s">"Remove completed tasks"</span><span class="nt">&gt;</span>Clear completed<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"clearAll"</span> <span class="na">class=</span><span class="s">"warn"</span> <span class="na">title=</span><span class="s">"Remove all tasks"</span><span class="nt">&gt;</span>Clear all<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">style=</span><span class="s">"margin-bottom:.6rem"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"newtodo"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Add a task"</span> <span class="na">autofocus</span> <span class="na">aria-label=</span><span class="s">"New task"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"add"</span><span class="nt">&gt;</span>Add<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"search"</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">placeholder=</span><span class="s">"Search"</span> <span class="na">aria-label=</span><span class="s">"Search tasks"</span> <span class="na">style=</span><span class="s">"max-width:240px"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chips"</span> <span class="na">role=</span><span class="s">"tablist"</span> <span class="na">aria-label=</span><span class="s">"Filter tasks"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"chip active"</span> <span class="na">data-filter=</span><span class="s">"all"</span> <span class="na">role=</span><span class="s">"tab"</span> <span class="na">aria-selected=</span><span class="s">"true"</span><span class="nt">&gt;</span>All<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"chip"</span> <span class="na">data-filter=</span><span class="s">"active"</span> <span class="na">role=</span><span class="s">"tab"</span> <span class="na">aria-selected=</span><span class="s">"false"</span><span class="nt">&gt;</span>Active<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"chip"</span> <span class="na">data-filter=</span><span class="s">"done"</span> <span class="na">role=</span><span class="s">"tab"</span> <span class="na">aria-selected=</span><span class="s">"false"</span><span class="nt">&gt;</span>Completed<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"list"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;&lt;/ul&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small"</span><span class="nt">&gt;</span>Share this board URL:<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"shareUrl"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">readonly</span> <span class="na">style=</span><span class="s">"max-width:380px"</span> <span class="na">aria-label=</span><span class="s">"Share URL"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"copy"</span><span class="nt">&gt;</span>Copy<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small count"</span> <span class="na">id=</span><span class="s">"counts"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small right"</span> <span class="na">id=</span><span class="s">"updated"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small"</span><span class="nt">&gt;</span>Share this board URL:<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"shareUrl"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">readonly</span> <span class="na">style=</span><span class="s">"max-width:380px"</span> <span class="na">aria-label=</span><span class="s">"Share URL"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">id=</span><span class="s">"copy"</span><span class="nt">&gt;</span>Copy<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small count"</span> <span class="na">id=</span><span class="s">"counts"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"small right"</span> <span class="na">id=</span><span class="s">"updated"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"status small"</span> <span class="na">id=</span><span class="s">"status"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"undo"</span> <span class="na">class=</span><span class="s">"secondary"</span> <span class="na">style=</span><span class="s">"display:none"</span><span class="nt">&gt;</span>Undo<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"sr"</span> <span class="na">id=</span><span class="s">"srmsg"</span> <span class="na">aria-live=</span><span class="s">"polite"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="kd">const</span> <span class="nx">origin</span> <span class="o">=</span> <span class="cp">&lt;?=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$origin</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">bid</span> <span class="o">=</span> <span class="cp">&lt;?=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$boardSlug</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#list</span><span class="dl">'</span><span class="p">),</span> <span class="nx">input</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newtodo</span><span class="dl">'</span><span class="p">),</span> <span class="nx">title</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#title</span><span class="dl">'</span><span class="p">),</span> <span class="nx">statusEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#status</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">offlineBanner</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#offline</span><span class="dl">'</span><span class="p">),</span> <span class="nx">slugInput</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#slug</span><span class="dl">'</span><span class="p">),</span> <span class="nx">shareUrl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#shareUrl</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">countsEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#counts</span><span class="dl">'</span><span class="p">),</span> <span class="nx">updatedEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#updated</span><span class="dl">'</span><span class="p">),</span> <span class="nx">undoBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#undo</span><span class="dl">'</span><span class="p">),</span> <span class="nx">srmsg</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#srmsg</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">chips</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.chip</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">boardsDL</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#boards</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">boardETag</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">boardLastMod</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">isSyncing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">boardData</span> <span class="o">=</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span><span class="dl">'</span><span class="s1">My Todo</span><span class="dl">'</span><span class="p">,</span> <span class="na">tasks</span><span class="p">:[],</span> <span class="na">created</span><span class="p">:</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="o">|</span><span class="mi">0</span><span class="p">,</span> <span class="na">updated</span><span class="p">:</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="o">|</span><span class="mi">0</span><span class="p">};</span>
<span class="kd">let</span> <span class="nx">filter</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_filter</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">searchQuery</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_search</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">pendingEdit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// {id, orig}</span>
<span class="kd">let</span> <span class="nx">lastAction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// for undo</span>
<span class="kd">let</span> <span class="nx">undoTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">outboxKey</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`memor_outbox_</span><span class="p">${</span><span class="nx">b</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">recentBoardsKey</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">memor_recent_boards_v1</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Register SW</span>
<span class="k">if </span><span class="p">(</span><span class="dl">'</span><span class="s1">serviceWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">/?asset=sw</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">scope</span><span class="p">:</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Online/offline indicators</span>
<span class="kd">function</span> <span class="nf">updateOnlineUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">online</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nf">updateOnlineUI</span><span class="p">();</span> <span class="nf">flushOutbox</span><span class="p">();</span> <span class="nf">fetchBoard</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="p">});</span>
<span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">offline</span><span class="dl">'</span><span class="p">,</span> <span class="nx">updateOnlineUI</span><span class="p">);</span>
<span class="nf">updateOnlineUI</span><span class="p">();</span>

<span class="c1">// Copy/share URL setup</span>
<span class="kd">const</span> <span class="nx">boardURL</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">origin</span><span class="p">}</span><span class="s2">/?b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">bid</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
<span class="nx">shareUrl</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">boardURL</span><span class="p">;</span>
<span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#copy</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">clipboard</span><span class="p">.</span><span class="nf">writeText</span><span class="p">(</span><span class="nx">boardURL</span><span class="p">);</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Copied link</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Copy failed</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Helper: small status message</span>
<span class="kd">let</span> <span class="nx">flashTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">function</span> <span class="nf">flash</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">persistMs</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">clearTimeout</span><span class="p">(</span><span class="nx">flashTimer</span><span class="p">);</span>
  <span class="nx">statusEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">persistMs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flashTimer</span> <span class="o">=</span> <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">statusEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">''</span><span class="p">,</span> <span class="nx">persistMs</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">srmsg</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Undo handling</span>
<span class="kd">function</span> <span class="nf">showUndo</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">lastAction</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span> <span class="c1">// {type, payload}</span>
  <span class="nx">undoBtn</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">inline-block</span><span class="dl">'</span><span class="p">;</span>
  <span class="nf">clearTimeout</span><span class="p">(</span><span class="nx">undoTimer</span><span class="p">);</span>
  <span class="nx">undoTimer</span> <span class="o">=</span> <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nf">hideUndo</span><span class="p">();</span> <span class="p">},</span> <span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">hideUndo</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">lastAction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">undoBtn</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">undoBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">lastAction</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">act</span> <span class="o">=</span> <span class="nx">lastAction</span><span class="p">;</span>
  <span class="nf">hideUndo</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">act</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">act</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="k">await</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">add</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">});</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Undid delete</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">act</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">clear_done</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">t</span> <span class="k">of</span> <span class="nx">act</span><span class="p">.</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">add</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Restored completed</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Render helpers</span>
<span class="kd">function</span> <span class="nf">fmtRelTime</span><span class="p">(</span><span class="nx">ts</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span> <span class="o">-</span> <span class="nx">ts</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">just now</span><span class="dl">'</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">s</span><span class="p">}</span><span class="s2">s ago`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">s</span><span class="o">/</span><span class="mi">60</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">m</span><span class="p">}</span><span class="s2">m ago`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">m</span><span class="o">/</span><span class="mi">60</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">h</span><span class="p">}</span><span class="s2">h ago`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">h</span><span class="o">/</span><span class="mi">24</span><span class="p">);</span>
  <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">d</span><span class="p">}</span><span class="s2">d ago`</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">updateMeta</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">activeCount</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">||</span> <span class="p">[]).</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">total</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">countsEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">total</span> <span class="p">?</span> <span class="s2">`</span><span class="p">${</span><span class="nx">activeCount</span><span class="p">}</span><span class="s2"> item</span><span class="p">${</span><span class="nx">activeCount</span><span class="o">!==</span><span class="mi">1</span><span class="p">?</span><span class="dl">'</span><span class="s1">s</span><span class="dl">'</span><span class="p">:</span><span class="dl">''</span><span class="p">}</span><span class="s2"> left • </span><span class="p">${</span><span class="nx">total</span><span class="p">}</span><span class="s2"> total`</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">No tasks</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">updatedEl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Updated </span><span class="p">${</span><span class="nf">fmtRelTime</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">updated</span><span class="o">||</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="o">|</span><span class="mi">0</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#toggleAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">activeCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Complete all</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Uncheck all</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Filtering</span>
<span class="kd">function</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">tasks</span><span class="p">.</span><span class="nf">slice</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">q</span> <span class="o">=</span> <span class="p">(</span><span class="nx">searchQuery</span><span class="o">||</span><span class="dl">''</span><span class="p">).</span><span class="nf">toLowerCase</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">q</span><span class="p">)</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="o">||</span><span class="dl">''</span><span class="p">).</span><span class="nf">toLowerCase</span><span class="p">().</span><span class="nf">includes</span><span class="p">(</span><span class="nx">q</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">arr</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">updateFilterUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">chips</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">ch</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="nx">ch</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-filter</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="nx">filter</span><span class="p">;</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">toggle</span><span class="p">(</span><span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">,</span> <span class="nx">isActive</span><span class="p">);</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">aria-selected</span><span class="dl">'</span><span class="p">,</span> <span class="nx">isActive</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">false</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#search</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">searchQuery</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">reorderAllowed</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">searchQuery</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Recent boards</span>
<span class="kd">function</span> <span class="nf">pushRecentBoard</span><span class="p">(</span><span class="nx">slug</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">recentBoardsKey</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">raw</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">raw</span><span class="p">)</span> <span class="p">:</span> <span class="p">[];</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span> <span class="o">!==</span> <span class="nx">slug</span><span class="p">);</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nf">unshift</span><span class="p">(</span><span class="nx">slug</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">recentBoardsKey</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span>
    <span class="nf">renderBoardsList</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">renderBoardsList</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">recentBoardsKey</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">raw</span> <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">raw</span><span class="p">)</span> <span class="p">:</span> <span class="p">[];</span>
    <span class="nx">boardsDL</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="s2">`&lt;option value="</span><span class="p">${</span><span class="nx">s</span><span class="p">}</span><span class="s2">"&gt;&lt;/option&gt;`</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Render board</span>
<span class="kd">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">boardData</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
  <span class="nx">title</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">My Todo</span><span class="dl">'</span><span class="p">;</span>
  <span class="nf">updateMeta</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
  <span class="nf">renderBoardsList</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">tasks</span> <span class="o">=</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">tasks</span> <span class="o">||</span> <span class="p">[]);</span>
  <span class="nx">list</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">allowDrag</span> <span class="o">=</span> <span class="nf">reorderAllowed</span><span class="p">();</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">allowDrag</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-drag-disabled</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nf">removeAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-drag-disabled</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">tasks</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">li</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">tabindex</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span> <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">draggable</span> <span class="o">=</span> <span class="nx">allowDrag</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
      <span class="s2">`&lt;span class="drag" title="</span><span class="p">${</span><span class="nx">allowDrag</span><span class="p">?</span><span class="dl">'</span><span class="s1">Drag to reorder</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">Reorder disabled while filtering/searching</span><span class="dl">'</span><span class="p">}</span><span class="s2">"&gt;⋮⋮&lt;/span&gt;
       &lt;input type="checkbox" </span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">?</span><span class="dl">'</span><span class="s1">checked</span><span class="dl">'</span><span class="p">:</span><span class="dl">''</span><span class="p">}</span><span class="s2"> data-id="</span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">" aria-label="Mark task done"&gt;
       &lt;span class="txt" contenteditable="true" data-id="</span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">" spellcheck="false" role="textbox" aria-multiline="false"&gt;&lt;/span&gt;
       &lt;button class="secondary" data-del="</span><span class="p">${</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">" aria-label="Delete task"&gt;Delete&lt;/button&gt;`</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.txt</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>

    <span class="c1">// Drag events</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">allowDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragstart</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nf">setData</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragging</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragend</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragging</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragover</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">dragging</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.dragging</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">dragging</span> <span class="o">||</span> <span class="nx">dragging</span> <span class="o">===</span> <span class="nx">li</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">getBoundingClientRect</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">before</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">list</span><span class="p">.</span><span class="nf">insertBefore</span><span class="p">(</span><span class="nx">dragging</span><span class="p">,</span> <span class="nx">before</span> <span class="p">?</span> <span class="nx">li</span> <span class="p">:</span> <span class="nx">li</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">li</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">drop</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">order</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">)).</span><span class="nf">map</span><span class="p">(</span><span class="nx">node</span> <span class="o">=&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">await</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">reorder</span><span class="dl">'</span><span class="p">,</span> <span class="nx">order</span><span class="p">});</span>
        <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Reordered</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">list</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Fetch with ETag support</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">fetchBoard</span><span class="p">(</span><span class="nx">force</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`?action=fetch&amp;b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">bid</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">boardETag</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">If-None-Match</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">boardETag</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">boardLastMod</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">If-Modified-Since</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">boardLastMod</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span><span class="nx">headers</span><span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Network error</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
    <span class="nx">boardETag</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">ETag</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">boardLastMod</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">Last-Modified</span><span class="dl">'</span><span class="p">);</span>
    <span class="nf">render</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
    <span class="nf">pushRecentBoard</span><span class="p">(</span><span class="nx">bid</span><span class="p">);</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Loaded</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Offline (cached view)</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Queue ops if offline/errors</span>
<span class="kd">function</span> <span class="nf">queueOp</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nf">outboxKey</span><span class="p">(</span><span class="nx">bid</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">[]</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">arr</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span>
  <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Flush queued ops</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">flushOutbox</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">isSyncing</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nf">outboxKey</span><span class="p">(</span><span class="nx">bid</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">[]</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="o">!</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="nx">isSyncing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">while </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">await</span> <span class="nf">op</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span><span class="na">silent</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nf">shift</span><span class="p">();</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">offlineBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">show</span><span class="dl">'</span><span class="p">);</span>
      <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Synced</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
      <span class="nf">fetchBoard</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// keep queue for retry</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">isSyncing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Perform operation</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">op</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="s2">`?b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">bid</span><span class="p">)}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">},</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
    <span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Bad response</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="nf">render</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">queueOp</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Queued (offline)</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Event handlers</span>
<span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">DOMContentLoaded</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Initialize filter UI</span>
  <span class="nx">chips</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">ch</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">filter</span> <span class="o">=</span> <span class="nx">ch</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-filter</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_filter</span><span class="dl">'</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
      <span class="nf">updateFilterUI</span><span class="p">();</span>
      <span class="nf">render</span><span class="p">(</span><span class="nx">boardData</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#search</span><span class="dl">'</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">searchQuery</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nf">trim</span><span class="p">();</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">memor_search</span><span class="dl">'</span><span class="p">,</span> <span class="nx">searchQuery</span><span class="p">);</span>
    <span class="nf">render</span><span class="p">(</span><span class="nx">boardData</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nf">updateFilterUI</span><span class="p">();</span>

  <span class="k">await</span> <span class="nf">fetchBoard</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">await</span> <span class="nf">flushOutbox</span><span class="p">();</span>

  <span class="c1">// Add new task</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#add</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nf">trim</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">add</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">v</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="dl">''</span><span class="p">;</span> <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Added</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">input</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#add</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Escape</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="dl">''</span><span class="p">;</span> <span class="nx">input</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span> <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Title save/cancel</span>
  <span class="kd">let</span> <span class="nx">titleOrig</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="nx">title</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">focus</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">titleOrig</span> <span class="o">=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="p">});</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveTitle</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">ttl</span> <span class="o">=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nf">trim</span><span class="p">()</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">My Todo</span><span class="dl">'</span><span class="p">;</span>
    <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="nx">ttl</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved</span><span class="dl">'</span><span class="p">,</span> <span class="mi">900</span><span class="p">));</span>
  <span class="p">};</span>
  <span class="nx">title</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveTitle</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">();</span> <span class="nx">title</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Escape</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nx">title</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">titleOrig</span><span class="p">;</span> <span class="nx">title</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Canceled</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">title</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">blur</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveTitle</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">());</span>

  <span class="c1">// Bulk buttons</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#clearDone</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cleared</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">filter</span><span class="p">(</span><span class="nx">t</span><span class="o">=&gt;</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">cleared</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">No completed tasks</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">clear_done</span><span class="dl">'</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cleared completed</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="nf">showUndo</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">clear_done</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">cleared</span><span class="p">});</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#clearAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">total</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">No tasks to clear</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">confirm</span><span class="p">(</span><span class="s2">`Delete all </span><span class="p">${</span><span class="nx">total</span><span class="p">}</span><span class="s2"> tasks?`</span><span class="p">))</span> <span class="p">{</span>
      <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">clear_all</span><span class="dl">'</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">All cleared</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#toggleAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">anyActive</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">some</span><span class="p">(</span><span class="nx">t</span><span class="o">=&gt;!</span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">);</span>
    <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">set_all</span><span class="dl">'</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="nx">anyActive</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="nx">anyActive</span><span class="p">?</span><span class="dl">'</span><span class="s1">Completed all</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">Unchecked all</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="c1">// Switch/open board by slug</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#switch</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">slugInput</span><span class="p">.</span><span class="nx">value</span><span class="o">||</span><span class="dl">''</span><span class="p">).</span><span class="nf">trim</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">s</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">origin</span><span class="p">}</span><span class="s2">/?b=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">s</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newBoard</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">origin</span><span class="p">}</span><span class="s2">/?action=new`</span><span class="p">;</span>

  <span class="c1">// Global keyboard</span>
  <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">n</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">!==</span> <span class="nx">input</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">!==</span> <span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">input</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// List interactions</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">checkbox</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">toggle</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">});</span> <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-del</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">find</span><span class="p">(</span><span class="nx">x</span><span class="o">=&gt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="o">===</span><span class="nx">id</span><span class="p">);</span>
      <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Deleted</span><span class="dl">'</span><span class="p">,</span> <span class="mi">900</span><span class="p">);</span> <span class="k">if </span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="nf">showUndo</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">t</span><span class="p">});</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// List keyboard (item-level)</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">closest</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">li</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="c1">// Per-item shortcuts when LI itself is focused</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">li</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="kd">const</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[type=checkbox]</span><span class="dl">'</span><span class="p">);</span> <span class="k">if </span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="o">!</span><span class="nx">cb</span><span class="p">.</span><span class="nx">checked</span><span class="p">;</span> <span class="nx">cb</span><span class="p">.</span><span class="nf">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nc">Event</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">));</span> <span class="p">}</span> <span class="p">}</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Delete</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Backspace</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-del]</span><span class="dl">'</span><span class="p">)?.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-del</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boardData</span><span class="p">.</span><span class="nx">tasks</span><span class="o">||</span><span class="p">[]).</span><span class="nf">find</span><span class="p">(</span><span class="nx">x</span><span class="o">=&gt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="o">===</span><span class="nx">id</span><span class="p">);</span>
          <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Deleted</span><span class="dl">'</span><span class="p">,</span> <span class="mi">900</span><span class="p">);</span> <span class="k">if </span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="nf">showUndo</span><span class="p">({</span><span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">del</span><span class="dl">'</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">t</span><span class="p">});</span> <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">e</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.txt</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span> <span class="nx">txt</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Contenteditable shortcuts</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">txt</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span> <span class="c1">// commit on blur</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Escape</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">pendingEdit</span> <span class="o">&amp;&amp;</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">orig</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span>
        <span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Canceled</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Tab</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">els</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.txt</span><span class="dl">'</span><span class="p">));</span>
        <span class="kd">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">els</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">els</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">)];</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">blur</span><span class="p">();</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="nx">next</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Inline edit lifecycle (commit-on-blur if changed)</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">focusin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">txt</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">pendingEdit</span> <span class="o">=</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">),</span> <span class="na">orig</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span> <span class="p">};</span>
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createRange</span><span class="p">();</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">selectNodeContents</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">collapse</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">sel</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nf">getSelection</span><span class="p">();</span>
      <span class="nx">sel</span><span class="p">.</span><span class="nf">removeAllRanges</span><span class="p">();</span>
      <span class="nx">sel</span><span class="p">.</span><span class="nf">addRange</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">list</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">blur</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">txt</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-id</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">textContent</span><span class="p">.</span><span class="nf">trim</span><span class="p">();</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">pendingEdit</span> <span class="o">&amp;&amp;</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">text</span> <span class="o">!==</span> <span class="nx">pendingEdit</span><span class="p">.</span><span class="nx">orig</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">op</span><span class="p">({</span><span class="na">op</span><span class="p">:</span><span class="dl">'</span><span class="s1">edit</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">}).</span><span class="nf">then</span><span class="p">(()</span><span class="o">=&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved</span><span class="dl">'</span><span class="p">,</span> <span class="mi">800</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">pendingEdit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Initialize UI state</span>
<span class="p">(</span><span class="kd">function</span> <span class="nf">initUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">updateFilterUI</span><span class="p">();</span>
<span class="p">})();</span>
<span class="nt">&lt;/script&gt;</span>
</code></section></div></div>

        </div>
        
          URL: https://ib.bsb.br/coolice-todo-webapp
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/galaxy-a34-custom-rom/" title="Galaxy A34 custom ROM" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/galaxy-a34-custom-rom/" title="Galaxy A34 custom ROM" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="javascript:void(0)" class="disabled" aria-disabled="true" title="No next in tag">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="No next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-09-13 23:15:10
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/coolice-todo-webapp/"
        },
        "headline": "coolice todo webapp",
        "description": "",
        "datePublished": "2025-09-10T00:00:00+00:00",
        "dateModified": "2025-09-11T20:49:57+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
