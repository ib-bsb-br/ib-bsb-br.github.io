<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    
      "Copy Spotter" and Deduplication — infoBAG
    
  </title>
  <meta name="title" content=""Copy Spotter" and Deduplication" />
  <meta name="description" content="can't steer unless already moving" />  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content=""Copy Spotter" and Deduplication — infoBAG" />
  <meta property="og:description" content="can't steer unless already moving" />
  <meta property="og:url" content="https://ib.bsb.br/copy-dedup/" />
  <meta property="og:type" content="article" />
  <meta property="og:site_name" content="infoBAG" />
    
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content=""Copy Spotter" and Deduplication — infoBAG">
  <meta name="twitter:description" content="can't steer unless already moving">
    
   <link rel="canonical" href="https://ib.bsb.br/copy-dedup/">
  <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">  
  
    <meta name="keywords" content="linux,scripts">
    
      <meta property="article:tag" content="linux">
    
      <meta property="article:tag" content="scripts">
    
    
  <!-- Favicons and Icons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
  <link href="/style.css" rel="stylesheet">
</head>
<body class="post-content-body">
  <header class="header-container">
    <nav aria-label="Main navigation" class="header-content">
      <a href="/" aria-label="Home">
        <img src="/favicon.ico" alt="Home" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/tags" aria-label="Tags">
        <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/events" aria-label="Events">
        <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="/archive" aria-label="Archive">
        <img src="/assets/Loose_Stone_Pile.gif" alt="Archive" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>      
    </nav>
    <h1 class="post-title">"Copy Spotter" and Deduplication</h1>
        <div class="post-meta">
          <time datetime="2024-06-01T03:00:00+00:00" class="post-date">
            01 Jun 2024</time>
          
            <span class="post-updated"> &rightarrowtail; <time datetime="2024-09-20T02:37:06+00:00">20 Sep 2024</time></span>
          
          
          <div class="post-tags">
            <p>
              
              Slug: <a href="https://ib.bsb.br/copy-dedup" class="tag">copy-dedup</a>
              
              Tags:
              
              <a href="https://ib.bsb.br/tags/#linux" class="tag">linux</a>
              
              
              <a href="https://ib.bsb.br/tags/#scripts" class="tag">scripts</a>
              
              
            </p>
          </div>
          
          <div class="post-actions">
            <p>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2024-06-01-copy-dedup.md" method="POST" target="_blank" rel="noopener noreferrer">
              <button type="submit" class="btn btn-danger">Improve this page? aberto.</button>
            </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2024-06-01-copy-dedup.md" method="POST" target="_blank" rel="noopener noreferrer">
              <button type="submit" class="btn btn-danger">View revision history</button>
            </form>
          </p>
            <a class="btn-primary">
              29212&hArr;1671
            </a>
          </div>
        </div>
  </header>
  <main class="content">
    <article class="post-wrapper">      
      <div class="post-content">
        
<ul><li><a href="#duplicate-file-remover">Duplicate-File-Remover</a></li><li><a href="#ordering-sort-similar-pairspy">Ordering (sort-SIMILAR-pairs.py):</a></li><li><a href="#grouping-pdf2folderspy">Grouping (pdf2folders.py):</a></li><li><a href="#removing-one-of-the-pair-rmsmallpdfpy">Removing one of the pair (rmSMALLpdf.py):</a></li></ul>
        <h1 id="duplicate-file-remover">
    
    
     <a href="#duplicate-file-remover">#</a><a href="#" aria-label="Back to top">Duplicate-File-Remover</a>
        
    
  </h1>
      

<p>https://github.com/Kilemonn/Duplicate-File-Remover</p>

<p>A command-line tool that takes input directories and create an output directory containing only unique files from the provided input directories. The files are determined as being unique based on its content hash.</p>
  <h1 id="ordering-sort-similar-pairspy">
    
    
     <a href="#ordering-sort-similar-pairspy">#</a><a href="#" aria-label="Back to top">Ordering (sort-SIMILAR-pairs.py):</a>
        
    
  </h1>
      

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="kn">import</span> <span class="n">base64</span>
<span class="kn">import</span> <span class="n">email</span>
<span class="kn">from</span> <span class="n">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Path to the .mhtml file
</span><span class="n">mhtml_file_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/&lt;!-- INSERT PATH --&gt;/_results.mhtml</span><span class="sh">"</span>
<span class="n">output_file_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/&lt;!-- INSERT PATH --&gt;/sorted_pairs.txt</span><span class="sh">"</span>

<span class="c1"># Function to extract HTML content from .mhtml file
</span><span class="k">def</span> <span class="nf">extract_html_from_mhtml</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">mhtml_content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>

    <span class="c1"># Parse the mhtml content
</span>    <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="p">.</span><span class="nf">message_from_bytes</span><span class="p">(</span><span class="n">mhtml_content</span><span class="p">)</span>

    <span class="c1"># Find the HTML part
</span>    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">.</span><span class="nf">walk</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">part</span><span class="p">.</span><span class="nf">get_content_type</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">text/html</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">html_content</span> <span class="o">=</span> <span class="n">part</span><span class="p">.</span><span class="nf">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">html_content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># Function to parse HTML and extract table data
</span><span class="k">def</span> <span class="nf">parse_html_table</span><span class="p">(</span><span class="n">html_content</span><span class="p">):</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="sh">'</span><span class="s">html5lib</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">table</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_html</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">table</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Function to process and sort the table data
</span><span class="k">def</span> <span class="nf">process_and_sort_table</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Extract the document names from the first row and column
</span>    <span class="n">document_names</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:].</span><span class="nf">tolist</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">document_names</span>
    <span class="n">df</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">document_names</span>

    <span class="c1"># Melt the DataFrame to get pairs and their similarity scores
</span>    <span class="n">melted_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="sh">'</span><span class="s">Document Pair</span><span class="sh">'</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="sh">'</span><span class="s">Similarity Score</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">melted_df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Document 1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Document 2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Similarity Score</span><span class="sh">'</span><span class="p">]</span>

    <span class="c1"># Drop NaN values and convert similarity scores to numeric
</span>    <span class="n">melted_df</span> <span class="o">=</span> <span class="n">melted_df</span><span class="p">.</span><span class="nf">dropna</span><span class="p">()</span>
    <span class="n">melted_df</span><span class="p">[</span><span class="sh">'</span><span class="s">Similarity Score</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_numeric</span><span class="p">(</span><span class="n">melted_df</span><span class="p">[</span><span class="sh">'</span><span class="s">Similarity Score</span><span class="sh">'</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="sh">'</span><span class="s">coerce</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># Sort the DataFrame by similarity scores
</span>    <span class="n">sorted_df</span> <span class="o">=</span> <span class="n">melted_df</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">Similarity Score</span><span class="sh">'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_df</span>

<span class="c1"># Function to write the sorted pairs to a text file
</span><span class="k">def</span> <span class="nf">write_sorted_pairs_to_file</span><span class="p">(</span><span class="n">sorted_df</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sorted_df</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">():</span>
            <span class="nb">file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Pair: &lt;!__</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">Document 1</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">__&gt; - &lt;!__</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">Document 2</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">__&gt;, Similarity Score: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">Similarity Score</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Main script execution
</span><span class="n">html_content</span> <span class="o">=</span> <span class="nf">extract_html_from_mhtml</span><span class="p">(</span><span class="n">mhtml_file_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">html_content</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="nf">parse_html_table</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
    <span class="n">sorted_df</span> <span class="o">=</span> <span class="nf">process_and_sort_table</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nf">write_sorted_pairs_to_file</span><span class="p">(</span><span class="n">sorted_df</span><span class="p">,</span> <span class="n">output_file_path</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Sorted pairs have been written to </span><span class="si">{</span><span class="n">output_file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">No HTML content found in the .mhtml file.</span><span class="sh">"</span><span class="p">)</span>
</code></section></div></div>
  <h1 id="grouping-pdf2folderspy">
    
    
     <a href="#grouping-pdf2folderspy">#</a><a href="#" aria-label="Back to top">Grouping (pdf2folders.py):</a>
        
    
  </h1>
      

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">shutil</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="k">def</span> <span class="nf">clean_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Removes special characters and converts spaces to underscores.</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">[^\w\s-]</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="n">filename</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_pdf</span><span class="p">(</span><span class="n">pdf_name</span><span class="p">,</span> <span class="n">pdf_dir</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Searches for a PDF file in the directory that matches the given name.</span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">):</span>
        <span class="n">cleaned_filename</span> <span class="o">=</span> <span class="nf">clean_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="nf">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cleaned_filename</span> <span class="o">==</span> <span class="nf">clean_filename</span><span class="p">(</span><span class="n">pdf_name</span><span class="p">).</span><span class="nf">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">create_and_move</span><span class="p">(</span><span class="n">pairs_file</span><span class="p">,</span> <span class="n">pdf_dir</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Creates folders for each PDF pair and moves the PDFs into them.

    Args:
        pairs_file (str): Path to the file containing the PDF pairs.
        pdf_dir (str): Path to the directory containing the PDFs.
    </span><span class="sh">"""</span>
    <span class="n">folder_count</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">pairs_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">Pair: &lt;!\s*(.*?)\s*&gt; - &lt;!\s*(.*?)\s*&gt;, Similarity Score.*</span><span class="sh">"</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">pdf1_name</span> <span class="o">=</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
                <span class="n">pdf2_name</span> <span class="o">=</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>

                <span class="c1"># Remove leading and trailing underscores
</span>                <span class="n">pdf1_name</span> <span class="o">=</span> <span class="n">pdf1_name</span><span class="p">.</span><span class="nf">strip</span><span class="p">(</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.pdf</span><span class="sh">"</span>
                <span class="n">pdf2_name</span> <span class="o">=</span> <span class="n">pdf2_name</span><span class="p">.</span><span class="nf">strip</span><span class="p">(</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.pdf</span><span class="sh">"</span>

                <span class="c1"># Find the actual PDF files
</span>                <span class="n">pdf1_path</span> <span class="o">=</span> <span class="nf">find_pdf</span><span class="p">(</span><span class="n">pdf1_name</span><span class="p">,</span> <span class="n">pdf_dir</span><span class="p">)</span>
                <span class="n">pdf2_path</span> <span class="o">=</span> <span class="nf">find_pdf</span><span class="p">(</span><span class="n">pdf2_name</span><span class="p">,</span> <span class="n">pdf_dir</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf1_path</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Warning: Could not find PDF: </span><span class="si">{</span><span class="n">pdf1_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf2_path</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Warning: Could not find PDF: </span><span class="si">{</span><span class="n">pdf2_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pdf1_path</span> <span class="ow">and</span> <span class="n">pdf2_path</span><span class="p">:</span>
                    <span class="c1"># Create a folder name using numeric notation
</span>                    <span class="n">folder_name</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">folder</span><span class="si">{</span><span class="n">folder_count</span><span class="si">:</span><span class="mi">03</span><span class="n">d</span><span class="si">}</span><span class="sh">"</span>
                    <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">)</span>

                    <span class="c1"># Create the folder if it doesn't exist
</span>                    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                    <span class="c1"># Move the PDFs into the folder
</span>                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">pdf1_path</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">)</span>
                        <span class="n">shutil</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">pdf2_path</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Moved </span><span class="si">{</span><span class="n">pdf1_name</span><span class="si">}</span><span class="s"> and </span><span class="si">{</span><span class="n">pdf2_name</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                        <span class="n">folder_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error moving files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">pairs_file</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/&lt;!-- INSERT PATH --&gt;/sorted_pairs.txt</span><span class="sh">"</span>  <span class="c1"># Replace with the actual path to your pairs file
</span>    <span class="n">pdf_dir</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/&lt;!-- INSERT PATH --&gt;/030.REFS</span><span class="sh">"</span>  <span class="c1"># Replace with the actual path to your PDF directory
</span>    <span class="nf">create_and_move</span><span class="p">(</span><span class="n">pairs_file</span><span class="p">,</span> <span class="n">pdf_dir</span><span class="p">)</span>
</code></section></div></div>
  <h1 id="removing-one-of-the-pair-rmsmallpdfpy">
    
    
     <a href="#removing-one-of-the-pair-rmsmallpdfpy">#</a><a href="#" aria-label="Back to top">Removing one of the pair (rmSMALLpdf.py):</a>
        
    
  </h1>
      

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="kn">import</span> <span class="n">os</span>

<span class="k">def</span> <span class="nf">delete_smaller_pdf</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Deletes the smaller PDF in the given folder.

    Args:
        folder_path (str): Path to the folder containing the PDFs.
    </span><span class="sh">"""</span>
    <span class="n">pdf_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">)]</span>
    
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">pdf_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Skipping folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s"> as it does not contain exactly two PDFs.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">pdf1_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">pdf_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">pdf2_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">pdf_files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">pdf1_size</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">pdf1_path</span><span class="p">)</span>
    <span class="n">pdf2_size</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">pdf2_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdf1_size</span> <span class="o">&lt;</span> <span class="n">pdf2_size</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="n">pdf1_path</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Deleted smaller PDF: </span><span class="si">{</span><span class="n">pdf1_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="n">pdf2_path</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Deleted smaller PDF: </span><span class="si">{</span><span class="n">pdf2_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">iterate_folders</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Iterates through each folder in the base directory and deletes the smaller PDF.

    Args:
        base_dir (str): Path to the base directory containing the folders.
    </span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">walk</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
            <span class="nf">delete_smaller_pdf</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/&lt;!-- INSERT PATH --&gt;/030.REFS</span><span class="sh">"</span>  <span class="c1"># Replace with the actual path to your base directory
</span>    <span class="nf">iterate_folders</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
</code></section></div></div>

      </div>
      URL: https://ib.bsb.br/copy-dedup
    </article>
    
    
    
    
    
    
    <nav class="post-navigation" aria-label="Post navigation">
      
      <div class="nav-arrow prev">
        <a href="/files-by-type/" title="Organize files by their extensions" rel="prev">
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ/lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
        </a>
      </div>
      
      
      <div class="nav-arrow next">
        <a href="/bibtex-check/" title="Python script to check LaTeX citations" rel="next">
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
        </a>
      </div>
      
    </nav>
    <pre>
      Duplicate-File-Remover

https://github.com/Kilemonn/Duplicate-File-Remover

A command-line tool that takes input directories and create an output directory containing only unique files from the provided input directories. The files are determined as being unique based on its content hash.

Ordering (sort-SIMILAR-pairs.py):

import base64
import email
from bs4 import BeautifulSoup
import pandas as pd

# Path to the .mhtml file
mhtml_file_path = "/&lt;!-- INSERT PATH --&gt;/_results.mhtml"
output_file_path = "/&lt;!-- INSERT PATH --&gt;/sorted_pairs.txt"

# Function to extract HTML content from .mhtml file
def extract_html_from_mhtml(file_path):
    with open(file_path, 'rb') as file:
        mhtml_content = file.read()

    # Parse the mhtml content
    msg = email.message_from_bytes(mhtml_content)

    # Find the HTML part
    for part in msg.walk():
        if part.get_content_type() == "text/html":
            html_content = part.get_payload(decode=True)
            return html_content.decode('utf-8')

    return None

# Function to parse HTML and extract table data
def parse_html_table(html_content):
    soup = BeautifulSoup(html_content, 'html5lib')
    table = soup.find('table')
    return pd.read_html(str(table))[0]

# Function to process and sort the table data
def process_and_sort_table(df):
    # Extract the document names from the first row and column
    document_names = df.iloc[0, 1:].tolist()
    df = df.iloc[1:, 1:]
    df.columns = document_names
    df.index = document_names

    # Melt the DataFrame to get pairs and their similarity scores
    melted_df = df.reset_index().melt(id_vars='index', var_name='Document Pair', value_name='Similarity Score')
    melted_df.columns = ['Document 1', 'Document 2', 'Similarity Score']

    # Drop NaN values and convert similarity scores to numeric
    melted_df = melted_df.dropna()
    melted_df['Similarity Score'] = pd.to_numeric(melted_df['Similarity Score'], errors='coerce')

    # Sort the DataFrame by similarity scores
    sorted_df = melted_df.sort_values(by='Similarity Score', ascending=False)
    return sorted_df

# Function to write the sorted pairs to a text file
def write_sorted_pairs_to_file(sorted_df, file_path):
    with open(file_path, 'w', encoding='utf-8') as file:
        for index, row in sorted_df.iterrows():
            file.write(f"Pair: &lt;!__{row['Document 1']}__&gt; - &lt;!__{row['Document 2']}__&gt;, Similarity Score: {row['Similarity Score']}\n")

# Main script execution
html_content = extract_html_from_mhtml(mhtml_file_path)
if html_content:
    df = parse_html_table(html_content)
    sorted_df = process_and_sort_table(df)
    write_sorted_pairs_to_file(sorted_df, output_file_path)
    print(f"Sorted pairs have been written to {output_file_path}")
else:
    print("No HTML content found in the .mhtml file.")


Grouping (pdf2folders.py):

import os
import shutil
import re

def clean_filename(filename):
    """Removes special characters and converts spaces to underscores."""
    return re.sub(r'[^\w\s-]', '', filename).replace(' ', '_')

def find_pdf(pdf_name, pdf_dir):
    """Searches for a PDF file in the directory that matches the given name."""
    for filename in os.listdir(pdf_dir):
        cleaned_filename = clean_filename(filename).lower()
        if cleaned_filename == clean_filename(pdf_name).lower():
            return os.path.join(pdf_dir, filename)
    return None

def create_and_move(pairs_file, pdf_dir):
    """
    Creates folders for each PDF pair and moves the PDFs into them.

    Args:
        pairs_file (str): Path to the file containing the PDF pairs.
        pdf_dir (str): Path to the directory containing the PDFs.
    """
    folder_count = 1

    with open(pairs_file, 'r') as f:
        for line in f:
            match = re.match(r"Pair: &lt;!\s*(.*?)\s*&gt; - &lt;!\s*(.*?)\s*&gt;, Similarity Score.*", line)
            if match:
                pdf1_name = match.group(1).strip()
                pdf2_name = match.group(2).strip()

                # Remove leading and trailing underscores
                pdf1_name = pdf1_name.strip('_') + ".pdf"
                pdf2_name = pdf2_name.strip('_') + ".pdf"

                # Find the actual PDF files
                pdf1_path = find_pdf(pdf1_name, pdf_dir)
                pdf2_path = find_pdf(pdf2_name, pdf_dir)

                if not pdf1_path:
                    print(f"Warning: Could not find PDF: {pdf1_name}")
                if not pdf2_path:
                    print(f"Warning: Could not find PDF: {pdf2_name}")

                if pdf1_path and pdf2_path:
                    # Create a folder name using numeric notation
                    folder_name = f"folder{folder_count:03d}"
                    folder_path = os.path.join(pdf_dir, folder_name)

                    # Create the folder if it doesn't exist
                    os.makedirs(folder_path, exist_ok=True)

                    # Move the PDFs into the folder
                    try:
                        shutil.move(pdf1_path, folder_path)
                        shutil.move(pdf2_path, folder_path)
                        print(f"Moved {pdf1_name} and {pdf2_name} to {folder_path}")
                        folder_count += 1
                    except Exception as e:
                        print(f"Error moving files: {e}")

if __name__ == "__main__":
    pairs_file = "/&lt;!-- INSERT PATH --&gt;/sorted_pairs.txt"  # Replace with the actual path to your pairs file
    pdf_dir = "/&lt;!-- INSERT PATH --&gt;/030.REFS"  # Replace with the actual path to your PDF directory
    create_and_move(pairs_file, pdf_dir)


Removing one of the pair (rmSMALLpdf.py):

import os

def delete_smaller_pdf(folder_path):
    """
    Deletes the smaller PDF in the given folder.

    Args:
        folder_path (str): Path to the folder containing the PDFs.
    """
    pdf_files = [f for f in os.listdir(folder_path) if f.endswith('.pdf')]
    
    if len(pdf_files) != 2:
        print(f"Skipping folder {folder_path} as it does not contain exactly two PDFs.")
        return

    pdf1_path = os.path.join(folder_path, pdf_files[0])
    pdf2_path = os.path.join(folder_path, pdf_files[1])

    pdf1_size = os.path.getsize(pdf1_path)
    pdf2_size = os.path.getsize(pdf2_path)

    if pdf1_size &lt; pdf2_size:
        os.remove(pdf1_path)
        print(f"Deleted smaller PDF: {pdf1_path}")
    else:
        os.remove(pdf2_path)
        print(f"Deleted smaller PDF: {pdf2_path}")

def iterate_folders(base_dir):
    """
    Iterates through each folder in the base directory and deletes the smaller PDF.

    Args:
        base_dir (str): Path to the base directory containing the folders.
    """
    for root, dirs, files in os.walk(base_dir):
        for dir_name in dirs:
            folder_path = os.path.join(root, dir_name)
            delete_smaller_pdf(folder_path)

if __name__ == "__main__":
    base_dir = "/&lt;!-- INSERT PATH --&gt;/030.REFS"  # Replace with the actual path to your base directory
    iterate_folders(base_dir)


    </pre>    
    
    <div class="comment-box">
      Reference:
      <a href="https://github.com/Wazzabeee/copy-spotter" title="https://github.com/Wazzabeee/copy-spotter">https://github.com/Wazzabeee/copy-spotter</a>
    </div>
    
  </main>
  <footer class="site-footer">
    <p><a href="#" aria-label="Back to top"><img src="/assets/Rope_(Old).gif" alt="Back to top" width="32" height="32" loading="lazy"></a>2024-12-17 20:45:31<a href="/" aria-label="Homepage">&#8505; infoBAG</a></p>
  </footer>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://ib.bsb.br/copy-dedup/"
    },
    "headline": ""Copy Spotter" and Deduplication",
    "description": "",
    "datePublished": "2024-06-01T03:00:00+00:00",
    "dateModified": "2024-09-20T02:37:06+00:00",
    "author": {
      "@type": "Person",
      "name": "Author"
    },
    "publisher": {
      "@type": "Organization",
      "name": "infoBAG",
      
    }
    
  }
  </script>  
  <script src="/assets/js/prism.js" defer></script>
</body>
</html>
