<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        backup bash script - infoBAG
      
    </title>
    <meta name="title" content="backup bash script - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/backup-bash-script/">
    <meta property="og:title" content="backup bash script - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/backup-bash-script/">
    <meta name="twitter:title" content="backup bash script - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/backup-bash-script/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          backup bash script
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-05-12T00:00:00+00:00" class="post-date">
          12 May 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-11-20T01:41:34+00:00">
              20 Nov 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/backup-bash-script" class="tag">backup-bash-script</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        13316 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        1352 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-05-12-backup-bash-script.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-05-12-backup-bash-script.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          

          <section class="code-block-container" role="group" aria-label="Bash Code Block" data-filename="bash_code_block.sh" data-code="#!/usr/bin/env bash

# ==============================================================================
# Script Name: comprehensive_backup_v3.sh
# Description: Robust tar+zstd backup with pre-checks, progress (pv), optional
#              buffering (mbuffer), exclusions, and detailed exit-code handling.
# Usage:       sudo bash comprehensive_backup_v3.sh
# Requirements: bash, tar, zstd, du, df, awk, numfmt, stat
#               Optional: pv, mbuffer, ionice
# ==============================================================================

set -o pipefail
umask 077
IFS=$&#39;\n\t&#39;

# --- Configuration defaults ---
DEFAULT_SOURCE_DIR=&quot;/media/usb0&quot;
DEFAULT_DEST_DIR=&quot;/media/usb5&quot;
DEFAULT_FILENAME_BASE=&quot;backup_usb0&quot;
DEFAULT_COMPRESSION_LEVEL=9          # 1–19, higher = better compression, slower
DEFAULT_USE_PV=&quot;y&quot;
DEFAULT_USE_MBUFFER=&quot;y&quot;
DEFAULT_MBUFFER_SIZE=&quot;6G&quot;            # e.g., 128M, 512M, 1G, 6G
DEFAULT_EXCLUDE_PATTERNS=()          # e.g., (&#39;./cache/*&#39; &#39;*.tmp&#39;)

# --- Helper functions ---
print_separator() {
  printf &#39;%0.s-&#39; {1..70}
  printf &#39;\n&#39;
}

die() {
  printf &#39;Error: %s\n&#39; &quot;$*&quot; &gt;&amp;2
  exit 1
}

warn() {
  printf &#39;Warning: %s\n&#39; &quot;$*&quot; &gt;&amp;2
}

info() {
  printf &#39;%s\n&#39; &quot;$*&quot;
}

check_command() {
  if ! command -v &quot;$1&quot; &gt;/dev/null 2&gt;&amp;1; then
    die &quot;Required command &#39;$1&#39; not found. Install it (e.g., &#39;sudo apt install $1&#39;).&quot;
  fi
}

read_with_default() {
  # $1 = prompt, $2 = default
  local prompt default reply
  prompt=$1
  default=$2
  read -r -p &quot;$prompt&quot; reply
  if [[ -z $reply ]]; then
    reply=$default
  fi
  printf &#39;%s&#39; &quot;$reply&quot;
}

confirm_yes() {
  # Prompt user; return 0 if yes, 1 otherwise
  local prompt reply
  prompt=$1
  read -r -p &quot;$prompt&quot; reply
  reply=${reply:-n}
  case &quot;${reply,,}&quot; in
    y|yes) return 0 ;;
    *)     return 1 ;;
  esac
}

# --- Root check ---
if [[ $EUID -ne 0 ]]; then
  die &quot;This script must be run with sudo/root privileges.&quot;
fi

START_TIME=$(date +%s)

on_exit() {
  local exit_code=$?
  local end_time elapsed h m s
  end_time=$(date +%s)
  elapsed=$((end_time - START_TIME))
  h=$((elapsed / 3600))
  m=$(((elapsed % 3600) / 60))
  s=$((elapsed % 60))
  print_separator
  printf &#39;Total runtime: %02d:%02d:%02d (exit code %d)\n&#39; &quot;$h&quot; &quot;$m&quot; &quot;$s&quot; &quot;$exit_code&quot;
}
trap on_exit EXIT

# --- Dependency checks ---
print_separator
info &quot;Checking required commands...&quot;
check_command tar
check_command zstd
check_command du
check_command df
check_command awk
check_command numfmt
check_command stat

# Optional tools checked only if used later
OPTIONAL_PV_PRESENT=0
OPTIONAL_MBUFFER_PRESENT=0
if command -v pv &gt;/dev/null 2&gt;&amp;1; then
  OPTIONAL_PV_PRESENT=1
fi
if command -v mbuffer &gt;/dev/null 2&gt;&amp;1; then
  OPTIONAL_MBUFFER_PRESENT=1
fi
info &quot;Core commands available.&quot;

# --- Interactive configuration ---
print_separator
info &quot;Configure backup parameters (press Enter for defaults).&quot;

SOURCE_DIR=$(read_with_default &quot;Source directory [${DEFAULT_SOURCE_DIR}]: &quot; &quot;$DEFAULT_SOURCE_DIR&quot;)
DEST_DIR=$(read_with_default &quot;Destination directory [${DEFAULT_DEST_DIR}]: &quot; &quot;$DEFAULT_DEST_DIR&quot;)
FILENAME_BASE=$(read_with_default &quot;Base filename for archive [${DEFAULT_FILENAME_BASE}]: &quot; &quot;$DEFAULT_FILENAME_BASE&quot;)

COMPRESSION_LEVEL=$(read_with_default &quot;Compression level (1=fast,19=best,default=${DEFAULT_COMPRESSION_LEVEL}): &quot; &quot;$DEFAULT_COMPRESSION_LEVEL&quot;)
if ! [[ &quot;$COMPRESSION_LEVEL&quot; =~ ^[1-9]$|^1[0-9]$ ]]; then
  warn &quot;Invalid compression level &#39;$COMPRESSION_LEVEL&#39;; using default ${DEFAULT_COMPRESSION_LEVEL}.&quot;
  COMPRESSION_LEVEL=$DEFAULT_COMPRESSION_LEVEL
fi

USE_PV=$(read_with_default &quot;Use &#39;pv&#39; for progress monitoring? (Y/n) [${DEFAULT_USE_PV}]: &quot; &quot;$DEFAULT_USE_PV&quot;)
case &quot;${USE_PV,,}&quot; in
  y|yes) USE_PV=&quot;y&quot; ;;
  n|no)  USE_PV=&quot;n&quot; ;;
  *)     USE_PV=&quot;$DEFAULT_USE_PV&quot; ;;
esac

USE_MBUFFER=$(read_with_default &quot;Use &#39;mbuffer&#39; for I/O buffering? (Y/n) [${DEFAULT_USE_MBUFFER}]: &quot; &quot;$DEFAULT_USE_MBUFFER&quot;)
case &quot;${USE_MBUFFER,,}&quot; in
  y|yes) USE_MBUFFER=&quot;y&quot; ;;
  n|no)  USE_MBUFFER=&quot;n&quot; ;;
  *)     USE_MBUFFER=&quot;$DEFAULT_USE_MBUFFER&quot; ;;
esac

MBUFFER_SIZE=$DEFAULT_MBUFFER_SIZE
if [[ &quot;$USE_MBUFFER&quot; == &quot;y&quot; ]]; then
  if (( OPTIONAL_MBUFFER_PRESENT == 0 )); then
    warn &quot;&#39;mbuffer&#39; not found; disabling mbuffer usage.&quot;
    USE_MBUFFER=&quot;n&quot;
  else
    MBUFFER_SIZE=$(read_with_default &quot;mbuffer size (e.g., 256M, 1G) [${DEFAULT_MBUFFER_SIZE}]: &quot; &quot;$DEFAULT_MBUFFER_SIZE&quot;)
  fi
fi

if [[ &quot;$USE_PV&quot; == &quot;y&quot; &amp;&amp; $OPTIONAL_PV_PRESENT -eq 0 ]]; then
  warn &quot;&#39;pv&#39; not found; disabling pv usage.&quot;
  USE_PV=&quot;n&quot;
fi

# Exclude patterns input
info &quot;Enter exclude patterns one per line (relative to source, e.g., &#39;./cache/*&#39;, &#39;*.tmp&#39;).&quot;
info &quot;Press Enter on an empty line to finish.&quot;
EXCLUDE_PATTERNS=()
while :; do
  read -r -p &quot;Exclude pattern (or Enter to finish): &quot; pattern
  if [[ -z $pattern ]]; then
    break
  fi
  EXCLUDE_PATTERNS+=(&quot;$pattern&quot;)
done
if ((${#EXCLUDE_PATTERNS[@]} == 0)); then
  EXCLUDE_PATTERNS=(&quot;${DEFAULT_EXCLUDE_PATTERNS[@]}&quot;)
fi

# --- Pre-checks ---
print_separator
info &quot;Performing pre-checks...&quot;

# Directory checks
[[ -d $SOURCE_DIR ]] || die &quot;Source directory &#39;$SOURCE_DIR&#39; does not exist or is not a directory.&quot;
[[ -d $DEST_DIR ]]   || die &quot;Destination directory &#39;$DEST_DIR&#39; does not exist or is not a directory.&quot;

if ! mountpoint -q &quot;$SOURCE_DIR&quot;; then
  warn &quot;Source directory &#39;$SOURCE_DIR&#39; is not a dedicated mount point.&quot;
fi
if ! mountpoint -q &quot;$DEST_DIR&quot;; then
  warn &quot;Destination directory &#39;$DEST_DIR&#39; is not a dedicated mount point.&quot;
fi

# Source size
info &quot;Calculating source size (du -sb)...&quot;
if ! SRC_SIZE_LINE=$(du -sb -- &quot;$SOURCE_DIR&quot; 2&gt;/dev/null); then
  die &quot;Could not determine source size with du -sb &#39;$SOURCE_DIR&#39;.&quot;
fi
SRC_SIZE_BYTES=$(awk &#39;{print $1}&#39; &lt;&lt;&lt;&quot;$SRC_SIZE_LINE&quot;)
if [[ -z $SRC_SIZE_BYTES ]]; then
  die &quot;Failed to parse source size from du output.&quot;
fi
SRC_SIZE_HUMAN=$(numfmt --to=iec &quot;$SRC_SIZE_BYTES&quot;)
info &quot;Source size: ${SRC_SIZE_HUMAN} (${SRC_SIZE_BYTES} bytes)&quot;

if (( SRC_SIZE_BYTES &lt;= 4096 )); then
  warn &quot;Source directory size is very small; it may be effectively empty.&quot;
fi

# Destination free space
if ! DEST_AVAIL_BYTES=$(df --output=avail -B1 -- &quot;$DEST_DIR&quot; 2&gt;/dev/null | awk &#39;NR==2{print $1}&#39;); then
  die &quot;Could not determine destination available space for &#39;$DEST_DIR&#39;.&quot;
fi
if [[ -z $DEST_AVAIL_BYTES ]]; then
  die &quot;Failed to parse destination available space.&quot;
fi
DEST_AVAIL_HUMAN=$(numfmt --to=iec &quot;$DEST_AVAIL_BYTES&quot;)
info &quot;Destination available space: ${DEST_AVAIL_HUMAN} (${DEST_AVAIL_BYTES} bytes)&quot;

if (( SRC_SIZE_BYTES &gt; DEST_AVAIL_BYTES )); then
  print_separator
  warn &quot;Source size (${SRC_SIZE_HUMAN}) is larger than destination free space (${DEST_AVAIL_HUMAN}).&quot;
  warn &quot;Backup will only succeed if compression reduces data below available space.&quot;
elif (( DEST_AVAIL_BYTES &lt; SRC_SIZE_BYTES / 2 )); then
  warn &quot;Destination free space is less than half the source size; ensure compression is effective.&quot;
fi

# Destination file path
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
DEST_FILENAME=&quot;${FILENAME_BASE}_L${COMPRESSION_LEVEL}_${TIMESTAMP}.tar.zst&quot;
DEST_FILE_PATH=&quot;${DEST_DIR%/}/$DEST_FILENAME&quot;

if [[ -e $DEST_FILE_PATH ]]; then
  if confirm_yes &quot;Destination file &#39;$DEST_FILE_PATH&#39; exists. Overwrite? (y/N): &quot;; then
    warn &quot;Overwriting existing file.&quot;
  else
    info &quot;Aborting.&quot;
    exit 0
  fi
fi

# --- Summary and confirmation ---
print_separator
info &quot;Backup summary:&quot;
info &quot;  Source:      $SOURCE_DIR ($SRC_SIZE_HUMAN)&quot;
info &quot;  Destination: $DEST_FILE_PATH&quot;
info &quot;  Compression: zstd level $COMPRESSION_LEVEL&quot;

PROGRESS_STR=&quot;pv disabled&quot;
[[ $USE_PV == y ]] &amp;&amp; PROGRESS_STR=&quot;pv enabled&quot;
BUFFER_STR=&quot;none&quot;
[[ $USE_MBUFFER == y ]] &amp;&amp; BUFFER_STR=&quot;mbuffer ($MBUFFER_SIZE)&quot;

info &quot;  Progress:    $PROGRESS_STR&quot;
info &quot;  IO buffer:   $BUFFER_STR&quot;

if ((${#EXCLUDE_PATTERNS[@]} &gt; 0)); then
  info &quot;  Exclusions:  ${EXCLUDE_PATTERNS[*]}&quot;
fi
print_separator

if ! confirm_yes &quot;Proceed with backup? (y/N): &quot;; then
  info &quot;Aborted by user.&quot;
  exit 0
fi

# Optionally lower priority for the backup process
if confirm_yes &quot;Lower CPU/IO priority for backup (recommended on busy systems)? (y/N): &quot;; then
  if command -v ionice &gt;/dev/null 2&gt;&amp;1; then
    ionice -c3 -p &quot;$$&quot; &gt;/dev/null 2&gt;&amp;1 || warn &quot;ionice failed to adjust I/O priority.&quot;
  fi
  renice 10 -p &quot;$$&quot; &gt;/dev/null 2&gt;&amp;1 || true
fi

# --- Build tar command array ---
TAR_CMD=(tar -cf -)
for pattern in &quot;${EXCLUDE_PATTERNS[@]}&quot;; do
  TAR_CMD+=(--exclude=&quot;$pattern&quot;)
done
TAR_CMD+=(-C &quot;$SOURCE_DIR&quot; .)

# --- Execute backup pipeline ---
print_separator
PIPE_DESC=&quot;tar | &quot;
[[ $USE_PV == y ]] &amp;&amp; PIPE_DESC+=&quot;pv | &quot;
[[ $USE_MBUFFER == y ]] &amp;&amp; PIPE_DESC+=&quot;mbuffer | &quot;
PIPE_DESC+=&quot;zstd&quot;
info &quot;Starting backup process...&quot;
info &quot;Running $PIPE_DESC ...&quot;
print_separator

PIPE_STATUS=()
EXECUTION_EXIT_CODE=0

run_pipeline() {
  if [[ $USE_PV == y &amp;&amp; $USE_MBUFFER == y ]]; then
    &quot;${TAR_CMD[@]}&quot; \
      | pv -s &quot;$SRC_SIZE_BYTES&quot; \
      | mbuffer -m &quot;$MBUFFER_SIZE&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  elif [[ $USE_PV == y &amp;&amp; $USE_MBUFFER != y ]]; then
    &quot;${TAR_CMD[@]}&quot; \
      | pv -s &quot;$SRC_SIZE_BYTES&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  elif [[ $USE_PV != y &amp;&amp; $USE_MBUFFER == y ]]; then
    &quot;${TAR_CMD[@]}&quot; \
      | mbuffer -m &quot;$MBUFFER_SIZE&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  else
    &quot;${TAR_CMD[@]}&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  fi
}

run_pipeline
EXECUTION_EXIT_CODE=$?
PIPE_STATUS=(&quot;${PIPESTATUS[@]}&quot;)

print_separator
info &quot;Backup process finished.&quot;
info &quot;Checking pipeline exit codes: ${PIPE_STATUS[*]:-none}&quot;

STAGE_NAMES=(&quot;tar&quot;)
if [[ $USE_PV == y ]]; then STAGE_NAMES+=(&quot;pv&quot;); fi
if [[ $USE_MBUFFER == y ]]; then STAGE_NAMES+=(&quot;mbuffer&quot;); fi
STAGE_NAMES+=(&quot;zstd&quot;)

FINAL_EXIT_CODE=0
for i in &quot;${!PIPE_STATUS[@]}&quot;; do
  stage_name=${STAGE_NAMES[$i]:-stage_$i}
  stage_status=${PIPE_STATUS[$i]}
  if [[ $stage_status -ne 0 ]]; then
    printf &#39;Error: Stage %s failed with exit code %d\n&#39; &quot;$stage_name&quot; &quot;$stage_status&quot; &gt;&amp;2
    if [[ $FINAL_EXIT_CODE -eq 0 ]]; then
      FINAL_EXIT_CODE=$stage_status
    fi
  fi
done

if [[ $FINAL_EXIT_CODE -eq 0 &amp;&amp; $EXECUTION_EXIT_CODE -ne 0 ]]; then
  warn &quot;Overall pipeline exit code is $EXECUTION_EXIT_CODE despite all stages reporting success.&quot;
  FINAL_EXIT_CODE=$EXECUTION_EXIT_CODE
fi

if [[ $FINAL_EXIT_CODE -ne 0 ]]; then
  printf &#39;Backup FAILED (exit code %d). Archive may be incomplete: %s\n&#39; &quot;$FINAL_EXIT_CODE&quot; &quot;$DEST_FILE_PATH&quot; &gt;&amp;2
  exit &quot;$FINAL_EXIT_CODE&quot;
fi

info &quot;Pipeline completed successfully.&quot;

# --- Post-execution: report size and optional verification ---
if ! COMPRESSED_SIZE_BYTES=$(stat -c%s -- &quot;$DEST_FILE_PATH&quot; 2&gt;/dev/null); then
  warn &quot;Could not stat archive &#39;$DEST_FILE_PATH&#39;.&quot;
else
  COMPRESSED_SIZE_HUMAN=$(numfmt --to=iec &quot;$COMPRESSED_SIZE_BYTES&quot;)
  info &quot;Archive saved to: $DEST_FILE_PATH&quot;
  info &quot;Compressed size:  ${COMPRESSED_SIZE_HUMAN} (${COMPRESSED_SIZE_BYTES} bytes)&quot;
fi

print_separator
info &quot;Verification commands:&quot;
info &quot;  zstd -t \&quot;$DEST_FILE_PATH\&quot;&quot;
info &quot;  tar --list -I zstd -f \&quot;$DEST_FILE_PATH\&quot; | less&quot;

if confirm_yes &quot;Run &#39;zstd -t&#39; now to test archive integrity? (y/N): &quot;; then
  print_separator
  info &quot;Running: zstd -t \&quot;$DEST_FILE_PATH\&quot;&quot;
  if zstd -t &quot;$DEST_FILE_PATH&quot;; then
    info &quot;Integrity test PASSED.&quot;
  else
    warn &quot;Integrity test FAILED.&quot;
  fi
fi

exit 0" data-download-link="" data-download-label="Download Bash">
  <code class="language-bash">#!/usr/bin/env bash

# ==============================================================================
# Script Name: comprehensive_backup_v3.sh
# Description: Robust tar+zstd backup with pre-checks, progress (pv), optional
#              buffering (mbuffer), exclusions, and detailed exit-code handling.
# Usage:       sudo bash comprehensive_backup_v3.sh
# Requirements: bash, tar, zstd, du, df, awk, numfmt, stat
#               Optional: pv, mbuffer, ionice
# ==============================================================================

set -o pipefail
umask 077
IFS=$&#39;\n\t&#39;

# --- Configuration defaults ---
DEFAULT_SOURCE_DIR=&quot;/media/usb0&quot;
DEFAULT_DEST_DIR=&quot;/media/usb5&quot;
DEFAULT_FILENAME_BASE=&quot;backup_usb0&quot;
DEFAULT_COMPRESSION_LEVEL=9          # 1–19, higher = better compression, slower
DEFAULT_USE_PV=&quot;y&quot;
DEFAULT_USE_MBUFFER=&quot;y&quot;
DEFAULT_MBUFFER_SIZE=&quot;6G&quot;            # e.g., 128M, 512M, 1G, 6G
DEFAULT_EXCLUDE_PATTERNS=()          # e.g., (&#39;./cache/*&#39; &#39;*.tmp&#39;)

# --- Helper functions ---
print_separator() {
  printf &#39;%0.s-&#39; {1..70}
  printf &#39;\n&#39;
}

die() {
  printf &#39;Error: %s\n&#39; &quot;$*&quot; &gt;&amp;2
  exit 1
}

warn() {
  printf &#39;Warning: %s\n&#39; &quot;$*&quot; &gt;&amp;2
}

info() {
  printf &#39;%s\n&#39; &quot;$*&quot;
}

check_command() {
  if ! command -v &quot;$1&quot; &gt;/dev/null 2&gt;&amp;1; then
    die &quot;Required command &#39;$1&#39; not found. Install it (e.g., &#39;sudo apt install $1&#39;).&quot;
  fi
}

read_with_default() {
  # $1 = prompt, $2 = default
  local prompt default reply
  prompt=$1
  default=$2
  read -r -p &quot;$prompt&quot; reply
  if [[ -z $reply ]]; then
    reply=$default
  fi
  printf &#39;%s&#39; &quot;$reply&quot;
}

confirm_yes() {
  # Prompt user; return 0 if yes, 1 otherwise
  local prompt reply
  prompt=$1
  read -r -p &quot;$prompt&quot; reply
  reply=${reply:-n}
  case &quot;${reply,,}&quot; in
    y|yes) return 0 ;;
    *)     return 1 ;;
  esac
}

# --- Root check ---
if [[ $EUID -ne 0 ]]; then
  die &quot;This script must be run with sudo/root privileges.&quot;
fi

START_TIME=$(date +%s)

on_exit() {
  local exit_code=$?
  local end_time elapsed h m s
  end_time=$(date +%s)
  elapsed=$((end_time - START_TIME))
  h=$((elapsed / 3600))
  m=$(((elapsed % 3600) / 60))
  s=$((elapsed % 60))
  print_separator
  printf &#39;Total runtime: %02d:%02d:%02d (exit code %d)\n&#39; &quot;$h&quot; &quot;$m&quot; &quot;$s&quot; &quot;$exit_code&quot;
}
trap on_exit EXIT

# --- Dependency checks ---
print_separator
info &quot;Checking required commands...&quot;
check_command tar
check_command zstd
check_command du
check_command df
check_command awk
check_command numfmt
check_command stat

# Optional tools checked only if used later
OPTIONAL_PV_PRESENT=0
OPTIONAL_MBUFFER_PRESENT=0
if command -v pv &gt;/dev/null 2&gt;&amp;1; then
  OPTIONAL_PV_PRESENT=1
fi
if command -v mbuffer &gt;/dev/null 2&gt;&amp;1; then
  OPTIONAL_MBUFFER_PRESENT=1
fi
info &quot;Core commands available.&quot;

# --- Interactive configuration ---
print_separator
info &quot;Configure backup parameters (press Enter for defaults).&quot;

SOURCE_DIR=$(read_with_default &quot;Source directory [${DEFAULT_SOURCE_DIR}]: &quot; &quot;$DEFAULT_SOURCE_DIR&quot;)
DEST_DIR=$(read_with_default &quot;Destination directory [${DEFAULT_DEST_DIR}]: &quot; &quot;$DEFAULT_DEST_DIR&quot;)
FILENAME_BASE=$(read_with_default &quot;Base filename for archive [${DEFAULT_FILENAME_BASE}]: &quot; &quot;$DEFAULT_FILENAME_BASE&quot;)

COMPRESSION_LEVEL=$(read_with_default &quot;Compression level (1=fast,19=best,default=${DEFAULT_COMPRESSION_LEVEL}): &quot; &quot;$DEFAULT_COMPRESSION_LEVEL&quot;)
if ! [[ &quot;$COMPRESSION_LEVEL&quot; =~ ^[1-9]$|^1[0-9]$ ]]; then
  warn &quot;Invalid compression level &#39;$COMPRESSION_LEVEL&#39;; using default ${DEFAULT_COMPRESSION_LEVEL}.&quot;
  COMPRESSION_LEVEL=$DEFAULT_COMPRESSION_LEVEL
fi

USE_PV=$(read_with_default &quot;Use &#39;pv&#39; for progress monitoring? (Y/n) [${DEFAULT_USE_PV}]: &quot; &quot;$DEFAULT_USE_PV&quot;)
case &quot;${USE_PV,,}&quot; in
  y|yes) USE_PV=&quot;y&quot; ;;
  n|no)  USE_PV=&quot;n&quot; ;;
  *)     USE_PV=&quot;$DEFAULT_USE_PV&quot; ;;
esac

USE_MBUFFER=$(read_with_default &quot;Use &#39;mbuffer&#39; for I/O buffering? (Y/n) [${DEFAULT_USE_MBUFFER}]: &quot; &quot;$DEFAULT_USE_MBUFFER&quot;)
case &quot;${USE_MBUFFER,,}&quot; in
  y|yes) USE_MBUFFER=&quot;y&quot; ;;
  n|no)  USE_MBUFFER=&quot;n&quot; ;;
  *)     USE_MBUFFER=&quot;$DEFAULT_USE_MBUFFER&quot; ;;
esac

MBUFFER_SIZE=$DEFAULT_MBUFFER_SIZE
if [[ &quot;$USE_MBUFFER&quot; == &quot;y&quot; ]]; then
  if (( OPTIONAL_MBUFFER_PRESENT == 0 )); then
    warn &quot;&#39;mbuffer&#39; not found; disabling mbuffer usage.&quot;
    USE_MBUFFER=&quot;n&quot;
  else
    MBUFFER_SIZE=$(read_with_default &quot;mbuffer size (e.g., 256M, 1G) [${DEFAULT_MBUFFER_SIZE}]: &quot; &quot;$DEFAULT_MBUFFER_SIZE&quot;)
  fi
fi

if [[ &quot;$USE_PV&quot; == &quot;y&quot; &amp;&amp; $OPTIONAL_PV_PRESENT -eq 0 ]]; then
  warn &quot;&#39;pv&#39; not found; disabling pv usage.&quot;
  USE_PV=&quot;n&quot;
fi

# Exclude patterns input
info &quot;Enter exclude patterns one per line (relative to source, e.g., &#39;./cache/*&#39;, &#39;*.tmp&#39;).&quot;
info &quot;Press Enter on an empty line to finish.&quot;
EXCLUDE_PATTERNS=()
while :; do
  read -r -p &quot;Exclude pattern (or Enter to finish): &quot; pattern
  if [[ -z $pattern ]]; then
    break
  fi
  EXCLUDE_PATTERNS+=(&quot;$pattern&quot;)
done
if ((${#EXCLUDE_PATTERNS[@]} == 0)); then
  EXCLUDE_PATTERNS=(&quot;${DEFAULT_EXCLUDE_PATTERNS[@]}&quot;)
fi

# --- Pre-checks ---
print_separator
info &quot;Performing pre-checks...&quot;

# Directory checks
[[ -d $SOURCE_DIR ]] || die &quot;Source directory &#39;$SOURCE_DIR&#39; does not exist or is not a directory.&quot;
[[ -d $DEST_DIR ]]   || die &quot;Destination directory &#39;$DEST_DIR&#39; does not exist or is not a directory.&quot;

if ! mountpoint -q &quot;$SOURCE_DIR&quot;; then
  warn &quot;Source directory &#39;$SOURCE_DIR&#39; is not a dedicated mount point.&quot;
fi
if ! mountpoint -q &quot;$DEST_DIR&quot;; then
  warn &quot;Destination directory &#39;$DEST_DIR&#39; is not a dedicated mount point.&quot;
fi

# Source size
info &quot;Calculating source size (du -sb)...&quot;
if ! SRC_SIZE_LINE=$(du -sb -- &quot;$SOURCE_DIR&quot; 2&gt;/dev/null); then
  die &quot;Could not determine source size with du -sb &#39;$SOURCE_DIR&#39;.&quot;
fi
SRC_SIZE_BYTES=$(awk &#39;{print $1}&#39; &lt;&lt;&lt;&quot;$SRC_SIZE_LINE&quot;)
if [[ -z $SRC_SIZE_BYTES ]]; then
  die &quot;Failed to parse source size from du output.&quot;
fi
SRC_SIZE_HUMAN=$(numfmt --to=iec &quot;$SRC_SIZE_BYTES&quot;)
info &quot;Source size: ${SRC_SIZE_HUMAN} (${SRC_SIZE_BYTES} bytes)&quot;

if (( SRC_SIZE_BYTES &lt;= 4096 )); then
  warn &quot;Source directory size is very small; it may be effectively empty.&quot;
fi

# Destination free space
if ! DEST_AVAIL_BYTES=$(df --output=avail -B1 -- &quot;$DEST_DIR&quot; 2&gt;/dev/null | awk &#39;NR==2{print $1}&#39;); then
  die &quot;Could not determine destination available space for &#39;$DEST_DIR&#39;.&quot;
fi
if [[ -z $DEST_AVAIL_BYTES ]]; then
  die &quot;Failed to parse destination available space.&quot;
fi
DEST_AVAIL_HUMAN=$(numfmt --to=iec &quot;$DEST_AVAIL_BYTES&quot;)
info &quot;Destination available space: ${DEST_AVAIL_HUMAN} (${DEST_AVAIL_BYTES} bytes)&quot;

if (( SRC_SIZE_BYTES &gt; DEST_AVAIL_BYTES )); then
  print_separator
  warn &quot;Source size (${SRC_SIZE_HUMAN}) is larger than destination free space (${DEST_AVAIL_HUMAN}).&quot;
  warn &quot;Backup will only succeed if compression reduces data below available space.&quot;
elif (( DEST_AVAIL_BYTES &lt; SRC_SIZE_BYTES / 2 )); then
  warn &quot;Destination free space is less than half the source size; ensure compression is effective.&quot;
fi

# Destination file path
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
DEST_FILENAME=&quot;${FILENAME_BASE}_L${COMPRESSION_LEVEL}_${TIMESTAMP}.tar.zst&quot;
DEST_FILE_PATH=&quot;${DEST_DIR%/}/$DEST_FILENAME&quot;

if [[ -e $DEST_FILE_PATH ]]; then
  if confirm_yes &quot;Destination file &#39;$DEST_FILE_PATH&#39; exists. Overwrite? (y/N): &quot;; then
    warn &quot;Overwriting existing file.&quot;
  else
    info &quot;Aborting.&quot;
    exit 0
  fi
fi

# --- Summary and confirmation ---
print_separator
info &quot;Backup summary:&quot;
info &quot;  Source:      $SOURCE_DIR ($SRC_SIZE_HUMAN)&quot;
info &quot;  Destination: $DEST_FILE_PATH&quot;
info &quot;  Compression: zstd level $COMPRESSION_LEVEL&quot;

PROGRESS_STR=&quot;pv disabled&quot;
[[ $USE_PV == y ]] &amp;&amp; PROGRESS_STR=&quot;pv enabled&quot;
BUFFER_STR=&quot;none&quot;
[[ $USE_MBUFFER == y ]] &amp;&amp; BUFFER_STR=&quot;mbuffer ($MBUFFER_SIZE)&quot;

info &quot;  Progress:    $PROGRESS_STR&quot;
info &quot;  IO buffer:   $BUFFER_STR&quot;

if ((${#EXCLUDE_PATTERNS[@]} &gt; 0)); then
  info &quot;  Exclusions:  ${EXCLUDE_PATTERNS[*]}&quot;
fi
print_separator

if ! confirm_yes &quot;Proceed with backup? (y/N): &quot;; then
  info &quot;Aborted by user.&quot;
  exit 0
fi

# Optionally lower priority for the backup process
if confirm_yes &quot;Lower CPU/IO priority for backup (recommended on busy systems)? (y/N): &quot;; then
  if command -v ionice &gt;/dev/null 2&gt;&amp;1; then
    ionice -c3 -p &quot;$$&quot; &gt;/dev/null 2&gt;&amp;1 || warn &quot;ionice failed to adjust I/O priority.&quot;
  fi
  renice 10 -p &quot;$$&quot; &gt;/dev/null 2&gt;&amp;1 || true
fi

# --- Build tar command array ---
TAR_CMD=(tar -cf -)
for pattern in &quot;${EXCLUDE_PATTERNS[@]}&quot;; do
  TAR_CMD+=(--exclude=&quot;$pattern&quot;)
done
TAR_CMD+=(-C &quot;$SOURCE_DIR&quot; .)

# --- Execute backup pipeline ---
print_separator
PIPE_DESC=&quot;tar | &quot;
[[ $USE_PV == y ]] &amp;&amp; PIPE_DESC+=&quot;pv | &quot;
[[ $USE_MBUFFER == y ]] &amp;&amp; PIPE_DESC+=&quot;mbuffer | &quot;
PIPE_DESC+=&quot;zstd&quot;
info &quot;Starting backup process...&quot;
info &quot;Running $PIPE_DESC ...&quot;
print_separator

PIPE_STATUS=()
EXECUTION_EXIT_CODE=0

run_pipeline() {
  if [[ $USE_PV == y &amp;&amp; $USE_MBUFFER == y ]]; then
    &quot;${TAR_CMD[@]}&quot; \
      | pv -s &quot;$SRC_SIZE_BYTES&quot; \
      | mbuffer -m &quot;$MBUFFER_SIZE&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  elif [[ $USE_PV == y &amp;&amp; $USE_MBUFFER != y ]]; then
    &quot;${TAR_CMD[@]}&quot; \
      | pv -s &quot;$SRC_SIZE_BYTES&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  elif [[ $USE_PV != y &amp;&amp; $USE_MBUFFER == y ]]; then
    &quot;${TAR_CMD[@]}&quot; \
      | mbuffer -m &quot;$MBUFFER_SIZE&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  else
    &quot;${TAR_CMD[@]}&quot; \
      | zstd -T0 &quot;-${COMPRESSION_LEVEL}&quot; -o &quot;$DEST_FILE_PATH&quot;
  fi
}

run_pipeline
EXECUTION_EXIT_CODE=$?
PIPE_STATUS=(&quot;${PIPESTATUS[@]}&quot;)

print_separator
info &quot;Backup process finished.&quot;
info &quot;Checking pipeline exit codes: ${PIPE_STATUS[*]:-none}&quot;

STAGE_NAMES=(&quot;tar&quot;)
if [[ $USE_PV == y ]]; then STAGE_NAMES+=(&quot;pv&quot;); fi
if [[ $USE_MBUFFER == y ]]; then STAGE_NAMES+=(&quot;mbuffer&quot;); fi
STAGE_NAMES+=(&quot;zstd&quot;)

FINAL_EXIT_CODE=0
for i in &quot;${!PIPE_STATUS[@]}&quot;; do
  stage_name=${STAGE_NAMES[$i]:-stage_$i}
  stage_status=${PIPE_STATUS[$i]}
  if [[ $stage_status -ne 0 ]]; then
    printf &#39;Error: Stage %s failed with exit code %d\n&#39; &quot;$stage_name&quot; &quot;$stage_status&quot; &gt;&amp;2
    if [[ $FINAL_EXIT_CODE -eq 0 ]]; then
      FINAL_EXIT_CODE=$stage_status
    fi
  fi
done

if [[ $FINAL_EXIT_CODE -eq 0 &amp;&amp; $EXECUTION_EXIT_CODE -ne 0 ]]; then
  warn &quot;Overall pipeline exit code is $EXECUTION_EXIT_CODE despite all stages reporting success.&quot;
  FINAL_EXIT_CODE=$EXECUTION_EXIT_CODE
fi

if [[ $FINAL_EXIT_CODE -ne 0 ]]; then
  printf &#39;Backup FAILED (exit code %d). Archive may be incomplete: %s\n&#39; &quot;$FINAL_EXIT_CODE&quot; &quot;$DEST_FILE_PATH&quot; &gt;&amp;2
  exit &quot;$FINAL_EXIT_CODE&quot;
fi

info &quot;Pipeline completed successfully.&quot;

# --- Post-execution: report size and optional verification ---
if ! COMPRESSED_SIZE_BYTES=$(stat -c%s -- &quot;$DEST_FILE_PATH&quot; 2&gt;/dev/null); then
  warn &quot;Could not stat archive &#39;$DEST_FILE_PATH&#39;.&quot;
else
  COMPRESSED_SIZE_HUMAN=$(numfmt --to=iec &quot;$COMPRESSED_SIZE_BYTES&quot;)
  info &quot;Archive saved to: $DEST_FILE_PATH&quot;
  info &quot;Compressed size:  ${COMPRESSED_SIZE_HUMAN} (${COMPRESSED_SIZE_BYTES} bytes)&quot;
fi

print_separator
info &quot;Verification commands:&quot;
info &quot;  zstd -t \&quot;$DEST_FILE_PATH\&quot;&quot;
info &quot;  tar --list -I zstd -f \&quot;$DEST_FILE_PATH\&quot; | less&quot;

if confirm_yes &quot;Run &#39;zstd -t&#39; now to test archive integrity? (y/N): &quot;; then
  print_separator
  info &quot;Running: zstd -t \&quot;$DEST_FILE_PATH\&quot;&quot;
  if zstd -t &quot;$DEST_FILE_PATH&quot;; then
    info &quot;Integrity test PASSED.&quot;
  else
    warn &quot;Integrity test FAILED.&quot;
  fi
fi

exit 0</code>
</section>

        </div>
        
          URL: https://ib.bsb.br/backup-bash-script
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/tigerbird/" title="NetBird Cloud & TigerVNC: Secure SSH & VNC Access" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/rk3588-init/" title="Fixing rk3588 Init Scripts" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/performance-governor-optimizations-script/" title="Performance Governor optimizations Script" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/github-actions-build-workflow-locally-on-a-debian/" title="GitHub Actions Build Workflow Locally on a Debian" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2026-01-04 20:56:46
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/backup-bash-script/"
        },
        "headline": "backup bash script",
        "description": "",
        "datePublished": "2025-05-12T00:00:00+00:00",
        "dateModified": "2025-11-20T01:41:34+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
