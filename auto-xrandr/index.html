<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        auto xrandr for multi-monitor setup - infoBAG
      
    </title>
    <meta name="title" content="auto xrandr for multi-monitor setup - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/auto-xrandr/">
    <meta property="og:title" content="auto xrandr for multi-monitor setup - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/auto-xrandr/">
    <meta name="twitter:title" content="auto xrandr for multi-monitor setup - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/auto-xrandr/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          auto xrandr for multi-monitor setup
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-10-07T00:00:00+00:00" class="post-date">
          07 Oct 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-10-14T17:14:47+00:00">
              14 Oct 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/auto-xrandr" class="tag">auto-xrandr</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        31032 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        3308 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-10-07-auto-xrandr.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-10-07-auto-xrandr.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#documentation">documentation</a><ul><li><a href="#a-tests-first-verification">A. Tests-First Verification</a><ul><li><a href="#a1-test-matrix">A1. Test Matrix</a></li><li><a href="#a2-pester-samples">A2. Pester Samples</a></li></ul></li><li><a href="#b-background--scope">B. Background &amp; Scope</a></li><li><a href="#c-supported-environments">C. Supported Environments</a></li><li><a href="#d-featurerequest-status-matrix">D. Feature/Request Status Matrix</a></li><li><a href="#e-usage">E. Usage</a></li><li><a href="#f-dependencies--authority">F. Dependencies &amp; Authority</a></li><li><a href="#g-design--key-functions">G. Design &amp; Key Functions</a></li><li><a href="#h-data-model--files">H. Data Model &amp; Files</a></li><li><a href="#i-error-handling--exit-codes">I. Error Handling &amp; Exit Codes</a></li><li><a href="#j-deployment--autostart">J. Deployment &amp; Autostart</a></li><li><a href="#k-troubleshooting">K. Troubleshooting</a></li><li><a href="#l-versioning">L. Versioning</a></li><li><a href="#m-causality-links-why--how-validated">M. Causality Links (Why → How Validated)</a></li></ul></li></ul>
          <h1 id="documentation">
    
    
     <a href="#documentation">#</a><a href="#" aria-label="Back to top">documentation</a>
        
    
  </h1>
      
  <h2 id="a-tests-first-verification">
    
    
     <a href="#a-tests-first-verification">#</a><a href="#" aria-label="Back to top">A. Tests-First Verification</a>
        
    
  </h2>
      
  <h3 id="a1-test-matrix">
    
    
     <a href="#a1-test-matrix">#</a><a href="#" aria-label="Back to top">A1. Test Matrix</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Behavior</th>
      <th>Trigger/Command</th>
      <th>Expectation</th>
      <th>Exit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>T-HELP</td>
      <td>Help prints header block</td>
      <td><code class="language-plaintext highlighter-rouge">pwsh -File ./pwsh_monitor_working.ps1 -Help</code></td>
      <td>Usage text includes OPTIONS &amp; EXIT CODES</td>
      <td>0</td>
    </tr>
    <tr>
      <td>T-HEADLESS</td>
      <td>Headless detection</td>
      <td>Unset <code class="language-plaintext highlighter-rouge">DISPLAY</code> + break <code class="language-plaintext highlighter-rouge">xrandr</code></td>
      <td>Error then exit</td>
      <td>20</td>
    </tr>
    <tr>
      <td>T-MISS-DEP</td>
      <td>Missing dep and <code class="language-plaintext highlighter-rouge">-NoInstall</code></td>
      <td>Remove <code class="language-plaintext highlighter-rouge">xrandr</code> from PATH</td>
      <td>Named missing dep; fail fast</td>
      <td>2</td>
    </tr>
    <tr>
      <td>T-AUTOINSTALL</td>
      <td>Auto-install needs root</td>
      <td><code class="language-plaintext highlighter-rouge">-AutoInstall</code> as non-root</td>
      <td>Error “requires root”</td>
      <td>2</td>
    </tr>
    <tr>
      <td>T-INTERACTIVE</td>
      <td>Interactive selection</td>
      <td>≥2 monitors</td>
      <td>Overlay confirm; accepted mode</td>
      <td>0</td>
    </tr>
    <tr>
      <td>T-APPLY-SAVED</td>
      <td>Non-interactive apply</td>
      <td>Valid JSON config</td>
      <td>One-line summary JSON</td>
      <td>0</td>
    </tr>
    <tr>
      <td>T-APPLY-NOCONFIG</td>
      <td>Missing config</td>
      <td><code class="language-plaintext highlighter-rouge">-ApplySavedLayout</code> w/ nonexistent file</td>
      <td>Warning</td>
      <td>23</td>
    </tr>
    <tr>
      <td>T-JSON-ERROR</td>
      <td>Malformed JSON</td>
      <td>Bad config file</td>
      <td>Error</td>
      <td>24</td>
    </tr>
    <tr>
      <td>T-INVALID-CONFIG</td>
      <td>Empty/invalid object</td>
      <td>Corrupt config</td>
      <td>Error</td>
      <td>22</td>
    </tr>
    <tr>
      <td>T-FINAL-APPLY-ERROR</td>
      <td>xrandr fails on final</td>
      <td>Mock nonzero exit</td>
      <td>Warning</td>
      <td>1</td>
    </tr>
    <tr>
      <td>T-PRIMARY</td>
      <td>Largest area → primary</td>
      <td>Mixed resolutions</td>
      <td><code class="language-plaintext highlighter-rouge">--primary</code> set</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
  <h3 id="a2-pester-samples">
    
    
     <a href="#a2-pester-samples">#</a><a href="#" aria-label="Back to top">A2. Pester Samples</a>
        
    
  </h3>
      

<p><strong>tests/Docs.Tests.ps1</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><section><code><span class="n">Describe</span><span class="w"> </span><span class="s1">'Documentation coverage'</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">It</span><span class="w"> </span><span class="s1">'Help text exists and includes sections'</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pwsh</span><span class="w"> </span><span class="nt">-NoLogo</span><span class="w"> </span><span class="nt">-NoProfile</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="o">.</span><span class="nx">/pwsh_monitor_working.ps1</span><span class="w"> </span><span class="nt">-Help</span><span class="w">
    </span><span class="nv">$out</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="o">-Match</span><span class="w"> </span><span class="s1">'OPTIONS'</span><span class="w">
    </span><span class="nv">$out</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="o">-Match</span><span class="w"> </span><span class="s1">'EXIT CODES'</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">It</span><span class="w"> </span><span class="s1">'JSON summary schema on success'</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'{"HDMI-1":"1920x1080"}'</span><span class="w">
    </span><span class="nv">$tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-TemporaryFile</span><span class="w">
    </span><span class="nx">Set-Content</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$tmp</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="nv">$cfg</span><span class="w"> </span><span class="nt">-Encoding</span><span class="w"> </span><span class="nx">UTF8</span><span class="w">
    </span><span class="nv">$json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pwsh</span><span class="w"> </span><span class="nt">-NoLogo</span><span class="w"> </span><span class="nt">-NoProfile</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="o">.</span><span class="nx">/pwsh_monitor_working.ps1</span><span class="w"> </span><span class="nt">-ApplySavedLayout</span><span class="w"> </span><span class="nt">-ConfigPath</span><span class="w"> </span><span class="nv">$tmp</span><span class="w">
    </span><span class="n">Remove-Item</span><span class="w"> </span><span class="nv">$tmp</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
    </span><span class="nv">$obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="w">
    </span><span class="nv">$obj</span><span class="o">.</span><span class="nf">ok</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nt">-BeTrue</span><span class="w">
    </span><span class="nv">$obj</span><span class="o">.</span><span class="nf">mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nt">-Be</span><span class="w"> </span><span class="s1">'apply-saved'</span><span class="w">
    </span><span class="nv">$obj</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">primary</span><span class="p">,</span><span class="nx">order</span><span class="p">,</span><span class="nx">chosen</span><span class="p">,</span><span class="nx">configFile</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="o">-Not</span><span class="w"> </span><span class="nt">-BeNullOrEmpty</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></section></div></div>

<p><strong>tests/XrandrParsing.Tests.ps1</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><section><code><span class="n">Describe</span><span class="w"> </span><span class="s1">'xrandr parsing'</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">It</span><span class="w"> </span><span class="s1">'Parses connected outputs'</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Mock</span><span class="w"> </span><span class="nx">Get-XrandrLines</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@(</span><span class="s1">'HDMI-1 connected primary 1920x1080+0+0'</span><span class="p">,</span><span class="w"> </span><span class="s1">'DP-1 connected 2560x1440+1920+0'</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">(</span><span class="n">Get-ConnectedOutputs</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nt">-Be</span><span class="w"> </span><span class="p">@(</span><span class="s1">'HDMI-1'</span><span class="p">,</span><span class="s1">'DP-1'</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">It</span><span class="w"> </span><span class="s1">'Extracts modes for an output'</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Mock</span><span class="w"> </span><span class="nx">Get-XrandrLines</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@(</span><span class="w">
      </span><span class="s1">'HDMI-1 connected'</span><span class="p">,</span><span class="w"> </span><span class="s1">'  1920x1080 60.00*+'</span><span class="p">,</span><span class="w"> </span><span class="s1">'  1280x720 60.00'</span><span class="p">,</span><span class="w">
      </span><span class="s1">'DP-1 connected'</span><span class="p">,</span><span class="w">   </span><span class="s1">'  2560x1440 59.95*'</span><span class="p">,</span><span class="w"> </span><span class="s1">'  1920x1080 60.00'</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">(</span><span class="n">Get-OutputModes</span><span class="w"> </span><span class="s1">'HDMI-1'</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nt">-Contain</span><span class="w"> </span><span class="s1">'1920x1080'</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">It</span><span class="w"> </span><span class="s1">'Verifies geometry match'</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Mock</span><span class="w"> </span><span class="nx">Get-CurrentGeometry</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="n">pscustomobject</span><span class="p">]@{</span><span class="nx">W</span><span class="o">=</span><span class="mi">1920</span><span class="p">;</span><span class="nx">H</span><span class="o">=</span><span class="mi">1080</span><span class="p">;</span><span class="nx">X</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">(</span><span class="n">Verify-OutputGeometry</span><span class="w"> </span><span class="s1">'HDMI-1'</span><span class="w"> </span><span class="s1">'1920x1080'</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nt">-BeTrue</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></section></div></div>

<p><strong>tests/ExitCodes.Tests.ps1</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><section><code><span class="n">Describe</span><span class="w"> </span><span class="s1">'Exit codes'</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">It</span><span class="w"> </span><span class="s1">'-ApplySavedLayout missing file =&gt; 23'</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Start-Process</span><span class="w"> </span><span class="nx">pwsh</span><span class="w"> </span><span class="nt">-ArgumentList</span><span class="w"> </span><span class="s1">'-File'</span><span class="p">,</span><span class="s1">'./pwsh_monitor_working.ps1'</span><span class="p">,</span><span class="s1">'-ApplySavedLayout'</span><span class="p">,</span><span class="s1">'-ConfigPath'</span><span class="p">,</span><span class="s1">'/nope.json'</span><span class="w"> </span><span class="nt">-PassThru</span><span class="w"> </span><span class="nt">-Wait</span><span class="w">
    </span><span class="nv">$p</span><span class="o">.</span><span class="nf">ExitCode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nt">-Be</span><span class="w"> </span><span class="nx">23</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></section></div></div>
  <h2 id="b-background--scope">
    
    
     <a href="#b-background--scope">#</a><a href="#" aria-label="Back to top">B. Background &amp; Scope</a>
        
    
  </h2>
      

<ul>
  <li><strong>Problem:</strong> Multi-monitor setup is error-prone across WMs and distros.</li>
  <li><strong>Goal:</strong> Interactive discovery + verification; persisted JSON; non-interactive reapply; machine-parseable success.</li>
  <li><strong>Scope:</strong> X11 <code class="language-plaintext highlighter-rouge">xrandr</code> only; Wayland not supported.</li>
</ul>
  <h2 id="c-supported-environments">
    
    
     <a href="#c-supported-environments">#</a><a href="#" aria-label="Back to top">C. Supported Environments</a>
        
    
  </h2>
      

<ul>
  <li>Debian/Ubuntu(+derivatives), Fedora/RHEL/CentOS, openSUSE, Arch-based; WM/terminal agnostic.</li>
  <li>Requires <code class="language-plaintext highlighter-rouge">xrandr</code>, <code class="language-plaintext highlighter-rouge">python3</code> with <code class="language-plaintext highlighter-rouge">tkinter</code>, and PowerShell 7+.</li>
</ul>
  <h2 id="d-featurerequest-status-matrix">
    
    
     <a href="#d-featurerequest-status-matrix">#</a><a href="#" aria-label="Back to top">D. Feature/Request Status Matrix</a>
        
    
  </h2>
      

<table>
  <thead>
    <tr>
      <th>Request</th>
      <th>Status</th>
      <th>Implementation Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-ConfigPath</code> override</td>
      <td>Implemented</td>
      <td>Default <code class="language-plaintext highlighter-rouge">$HOME/.config/pwsh-monitor-layout.json</code>; used in both paths</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-Help</code></td>
      <td>Implemented</td>
      <td><code class="language-plaintext highlighter-rouge">Show-Help</code> extracts header <code class="language-plaintext highlighter-rouge">&lt;# ... #&gt;</code> and exits 0</td>
    </tr>
    <tr>
      <td>One-line success JSON</td>
      <td>Implemented</td>
      <td>Both interactive and apply-saved paths emit schema</td>
    </tr>
    <tr>
      <td>Portability auto-install</td>
      <td>Implemented</td>
      <td>PM detection + root requirement</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-NoInstall</code> fast-fail</td>
      <td>Implemented</td>
      <td>Throws if missing dep; exit 2</td>
    </tr>
    <tr>
      <td>Headless explicit exit</td>
      <td>Implemented</td>
      <td><code class="language-plaintext highlighter-rouge">Assert-XSessionOrExit</code> → exit 20</td>
    </tr>
    <tr>
      <td>Autostart <code class="language-plaintext highlighter-rouge">.desktop</code></td>
      <td>Implemented</td>
      <td>Writes to <code class="language-plaintext highlighter-rouge">~/.config/autostart/</code> with proper Exec</td>
    </tr>
  </tbody>
</table>
  <h2 id="e-usage">
    
    
     <a href="#e-usage">#</a><a href="#" aria-label="Back to top">E. Usage</a>
        
    
  </h2>
      

<ul>
  <li><strong>Interactive:</strong> <code class="language-plaintext highlighter-rouge">pwsh -File ./pwsh_monitor_working.ps1</code></li>
  <li><strong>Auto-install (root):</strong> <code class="language-plaintext highlighter-rouge">sudo pwsh -File ./pwsh_monitor_working.ps1 -AutoInstall</code></li>
  <li><strong>Apply saved:</strong> <code class="language-plaintext highlighter-rouge">pwsh -File ./pwsh_monitor_working.ps1 -ApplySavedLayout [-ConfigPath &lt;file&gt;]</code></li>
  <li><strong>Help:</strong> <code class="language-plaintext highlighter-rouge">pwsh -File ./pwsh_monitor_working.ps1 -Help</code></li>
</ul>
  <h2 id="f-dependencies--authority">
    
    
     <a href="#f-dependencies--authority">#</a><a href="#" aria-label="Back to top">F. Dependencies &amp; Authority</a>
        
    
  </h2>
      

<ul>
  <li>Ensured via <code class="language-plaintext highlighter-rouge">Ensure-Dep</code>; PMs: <code class="language-plaintext highlighter-rouge">apt</code>, <code class="language-plaintext highlighter-rouge">dnf</code>, <code class="language-plaintext highlighter-rouge">zypper</code>, <code class="language-plaintext highlighter-rouge">pacman</code>. Root required for auto-install.</li>
  <li>When root, sets <code class="language-plaintext highlighter-rouge">XAUTHORITY</code> to target user; defaults <code class="language-plaintext highlighter-rouge">DISPLAY</code> to <code class="language-plaintext highlighter-rouge">:0</code> if unset.</li>
</ul>
  <h2 id="g-design--key-functions">
    
    
     <a href="#g-design--key-functions">#</a><a href="#" aria-label="Back to top">G. Design &amp; Key Functions</a>
        
    
  </h2>
      

<ul>
  <li>Parsing/validation (<code class="language-plaintext highlighter-rouge">Get-ConnectedOutputs</code>, <code class="language-plaintext highlighter-rouge">Get-OutputModes</code>, <code class="language-plaintext highlighter-rouge">Get-CurrentGeometry</code>, <code class="language-plaintext highlighter-rouge">Verify-OutputGeometry</code>).</li>
  <li>Application (<code class="language-plaintext highlighter-rouge">Apply-Layout</code> with cumulative width positioning; <code class="language-plaintext highlighter-rouge">--primary</code> set by area heuristic).</li>
  <li>Overlay (<code class="language-plaintext highlighter-rouge">Show-OverlayTk</code>) for visual confirmation.</li>
  <li>Persistence/autostart and summary emission.</li>
</ul>
  <h2 id="h-data-model--files">
    
    
     <a href="#h-data-model--files">#</a><a href="#" aria-label="Back to top">H. Data Model &amp; Files</a>
        
    
  </h2>
      

<ul>
  <li><strong>Config JSON (ordered mapping):</strong></li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><section><code><span class="p">{</span><span class="w">
  </span><span class="nl">"HDMI-1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1920x1080"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"DP-1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2560x1440"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></section></div></div>

<ul>
  <li><strong>Success Summary (stdout, single line):</strong></li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><section><code><span class="p">{</span><span class="nl">"ok"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"mode"</span><span class="p">:</span><span class="s2">"interactive"</span><span class="p">,</span><span class="nl">"primary"</span><span class="p">:</span><span class="s2">"HDMI-1"</span><span class="p">,</span><span class="nl">"order"</span><span class="p">:[</span><span class="s2">"HDMI-1"</span><span class="p">,</span><span class="s2">"DP-1"</span><span class="p">],</span><span class="nl">"chosen"</span><span class="p">:{</span><span class="nl">"HDMI-1"</span><span class="p">:</span><span class="s2">"1920x1080"</span><span class="p">,</span><span class="nl">"DP-1"</span><span class="p">:</span><span class="s2">"2560x1440"</span><span class="p">},</span><span class="nl">"configFile"</span><span class="p">:</span><span class="s2">"/home/user/.config/pwsh-monitor-layout.json"</span><span class="p">}</span><span class="w">
</span></code></section></div></div>

<ul>
  <li><strong>Transcripts:</strong> <code class="language-plaintext highlighter-rouge">/tmp/pwsh_monitor_working-YYYYMMDD-HHMMSS.log</code> (fallback <code class="language-plaintext highlighter-rouge">$HOME/...</code>).</li>
  <li><strong>Autostart:</strong> <code class="language-plaintext highlighter-rouge">~/.config/autostart/pwsh_monitor_working.desktop</code>.</li>
</ul>
  <h2 id="i-error-handling--exit-codes">
    
    
     <a href="#i-error-handling--exit-codes">#</a><a href="#" aria-label="Back to top">I. Error Handling &amp; Exit Codes</a>
        
    
  </h2>
      

<table>
  <thead>
    <tr>
      <th style="text-align: right">Code</th>
      <th>Meaning</th>
      <th>Typical Source</th>
      <th>Remedy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td>Success</td>
      <td>Normal completion</td>
      <td>—</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td>General/user abort/final apply failed</td>
      <td><code class="language-plaintext highlighter-rouge">Prompt-YNQ</code> quit; <code class="language-plaintext highlighter-rouge">Apply-Layout</code> fail</td>
      <td>Retry with <code class="language-plaintext highlighter-rouge">-DebugMode</code> or adjust modes</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td>Missing dep / install failure</td>
      <td><code class="language-plaintext highlighter-rouge">Ensure-Dep</code>/<code class="language-plaintext highlighter-rouge">Install-Dep</code></td>
      <td>Install packages or use <code class="language-plaintext highlighter-rouge">-AutoInstall</code> as root</td>
    </tr>
    <tr>
      <td style="text-align: right">20</td>
      <td>Headless / no X11</td>
      <td><code class="language-plaintext highlighter-rouge">Assert-XSessionOrExit</code></td>
      <td>Start X11; ensure <code class="language-plaintext highlighter-rouge">xrandr</code> works</td>
    </tr>
    <tr>
      <td style="text-align: right">21</td>
      <td>No connected monitors</td>
      <td><code class="language-plaintext highlighter-rouge">Get-ConnectedOutputs</code></td>
      <td>Check hardware/cables</td>
    </tr>
    <tr>
      <td style="text-align: right">22</td>
      <td>Invalid/empty config</td>
      <td>Apply-saved path</td>
      <td>Fix JSON</td>
    </tr>
    <tr>
      <td style="text-align: right">23</td>
      <td>Config file not found</td>
      <td>Apply-saved path</td>
      <td>Provide correct <code class="language-plaintext highlighter-rouge">-ConfigPath</code></td>
    </tr>
    <tr>
      <td style="text-align: right">24</td>
      <td>JSON parse error</td>
      <td>Apply-saved path</td>
      <td>Fix JSON syntax</td>
    </tr>
    <tr>
      <td style="text-align: right">25</td>
      <td>Permission/ownership error</td>
      <td>Autostart/config setup</td>
      <td>Correct ownership and perms</td>
    </tr>
  </tbody>
</table>
  <h2 id="j-deployment--autostart">
    
    
     <a href="#j-deployment--autostart">#</a><a href="#" aria-label="Back to top">J. Deployment &amp; Autostart</a>
        
    
  </h2>
      

<ul>
  <li>First run interactively to generate JSON; confirm overlay; verify autostart <code class="language-plaintext highlighter-rouge">.desktop</code>.</li>
  <li>For login issues, inspect latest transcript under <code class="language-plaintext highlighter-rouge">/tmp</code>.</li>
</ul>
  <h2 id="k-troubleshooting">
    
    
     <a href="#k-troubleshooting">#</a><a href="#" aria-label="Back to top">K. Troubleshooting</a>
        
    
  </h2>
      

<ul>
  <li><strong>Overlay missing:</strong> Install <code class="language-plaintext highlighter-rouge">python3-tk</code>/<code class="language-plaintext highlighter-rouge">tk</code>; some WMs may block undecorated topmost windows.</li>
  <li><strong>Apply-saved fails:</strong> Outputs may be renamed (docks/GPUs); re-run interactive flow to refresh JSON.</li>
  <li><strong>Headless (20):</strong> Ensure <code class="language-plaintext highlighter-rouge">DISPLAY</code> and functioning X server.</li>
</ul>
  <h2 id="l-versioning">
    
    
     <a href="#l-versioning">#</a><a href="#" aria-label="Back to top">L. Versioning</a>
        
    
  </h2>
      

<ul>
  <li><strong>v0.1 (2025-10-14):</strong> Initial structured docs and tests-first plan.</li>
</ul>
  <h2 id="m-causality-links-why--how-validated">
    
    
     <a href="#m-causality-links-why--how-validated">#</a><a href="#" aria-label="Back to top">M. Causality Links (Why → How Validated)</a>
        
    
  </h2>
      

<ul>
  <li><strong>Correct ordering:</strong> User selection + overlay → Pester interactive smoke + manual confirmation.</li>
  <li><strong>Accurate geometry:</strong> Compare <code class="language-plaintext highlighter-rouge">Get-CurrentGeometry</code> against selected mode → Pester unit test for verifier.</li>
  <li><strong>Reproducibility:</strong> Persist ordered mapping; non-interactive apply → schema test; exit-code tests.</li>
  <li><strong>Robust setup:</strong> Auto-install with PM detection; guarded by root → negative test for non-root.</li>
  <li><strong>Headless clarity:</strong> Explicit exit 20 → smoke test with unset <code class="language-plaintext highlighter-rouge">DISPLAY</code>.</li>
</ul>

<section class="code-block-container" role="group" aria-label="Bash Code Block" data-filename="bash_code_block.sh" data-code="#!/usr/bin/env pwsh
&lt;# 
pwsh_monitor_working.ps1 — Interactive + non-interactive multi-monitor configurator for X11 (Linux)

TARGET: Debian/Ubuntu/Derivatives, Fedora/RHEL/CentOS, openSUSE, Arch-based (pwsh, xrandr)
WM/TERM agnostic (works with ratpoison/Alacritty etc.)

KEY CAPABILITIES
- Interactive discovery of output order (left→right) and resolution selection per monitor using xrandr.
- Verifies applied geometry; shows a Tk red-border overlay to confirm the active monitor.
- Saves chosen layout to JSON and can re-apply non-interactively on login/autostart.
- Robust logging (Start-Transcript), strict error behavior, and explicit exit codes.

NEW/REQUESTED IMPROVEMENTS
- -ConfigPath &lt;file&gt; to override default config path (default: ~/.config/pwsh-monitor-layout.json).
- -Help: Prints usage, options, examples, and exit codes then exits 0.
- Emits a one-line machine-parseable JSON summary on success for both interactive and apply-saved paths.
- Portability hardening: auto-install gated by distro/pm detection (apt-get/dnf/zypper/pacman).
- -NoInstall: disable auto-install; fail fast if dependencies missing.
- Headless handling: detect missing X11/xrandr availability and exit with explicit code.

USAGE (examples)
  # First run (interactive):
  pwsh -File ./pwsh_monitor_working.ps1

  # Auto-install missing deps (root required):
  sudo pwsh -File ./pwsh_monitor_working.ps1 -AutoInstall

  # Save config to a specific path:
  pwsh -File ./pwsh_monitor_working.ps1 -ConfigPath &quot;$HOME/.config/my-monitor-layout.json&quot;

  # Non-interactive apply of saved layout (good for autostart):
  pwsh -File ./pwsh_monitor_working.ps1 -ApplySavedLayout

  # Print help:
  pwsh -File ./pwsh_monitor_working.ps1 -Help

OPTIONS
  -DebugMode             Verbose logging during execution.
  -AutoInstall           Attempt to install dependencies via detected package manager.
  -NoInstall             Do not install; fail fast if dependencies are missing.
  -ApplySavedLayout      Apply saved layout from the config JSON and exit.
  -OverlaySeconds &lt;int&gt;  Seconds to keep the red overlay visible when testing (default: 5).
  -TargetUser &lt;string&gt;   Login user for ownership of autostart/config when run as root (default: SUDO_USER/USER/linaro).
  -ScriptInstallPath     Path to place a self-copy used by autostart (default: $HOME/pwsh_monitor_working.ps1).
  -ConfigPath            Override config JSON path (default: $HOME/.config/pwsh-monitor-layout.json).
  -Help                  Show this help and exit.

EXIT CODES
  0  Success
  1  General error / user abort / final apply failed
  2  Missing dependency and -NoInstall provided (or auto-install disabled/unsupported)
 20  Headless / no X11 session detected (no DISPLAY or xrandr unusable)
 21  No connected monitors detected
 22  Invalid/empty configuration when using -ApplySavedLayout
 23  Config file not found for -ApplySavedLayout
 24  JSON parse error for -ConfigPath
 25  Permission or ownership errors during autostart/config setup

MACHINE-PARSABLE SUMMARY
  On success, prints a single line JSON to stdout like:
  {&quot;ok&quot;:true,&quot;mode&quot;:&quot;interactive&quot;,&quot;primary&quot;:&quot;HDMI-1&quot;,&quot;order&quot;:[&quot;HDMI-1&quot;,&quot;DP-1&quot;],&quot;chosen&quot;:{&quot;HDMI-1&quot;:&quot;1920x1080&quot;,&quot;DP-1&quot;:&quot;2560x1440&quot;},&quot;configFile&quot;:&quot;/home/user/.config/pwsh-monitor-layout.json&quot;}

#&gt;

[CmdletBinding()]
param(
    [switch] $DebugMode,
    [switch] $AutoInstall,
    [switch] $NoInstall,
    [switch] $ApplySavedLayout,
    [switch] $Help,
    [int]    $OverlaySeconds = 5,
    [string] $TargetUser = ($env:SUDO_USER ?? $env:USER ?? &#39;linaro&#39;),
    [string] $ScriptInstallPath = &quot;$HOME/pwsh_monitor_working.ps1&quot;,
    [string] $ConfigPath
)

Set-StrictMode -Version Latest
$ErrorActionPreference = &#39;Stop&#39;
if ($DebugMode) { $VerbosePreference = &#39;Continue&#39; }

function Stop-TranscriptSafe { try { Stop-Transcript | Out-Null } catch {} }

# Transcript
$tsFile = &quot;/tmp/pwsh_monitor_working-$(Get-Date -Format &#39;yyyyMMdd-HHmmss&#39;).log&quot;
try { Start-Transcript -Path $tsFile -Force | Out-Null } catch {
    $tsFile = Join-Path $HOME &quot;pwsh_monitor_working-$(Get-Date -Format &#39;yyyyMMdd-HHmmss&#39;).log&quot;
    try { Start-Transcript -Path $tsFile -Force | Out-Null } catch {}
}
Write-Verbose &quot;Transcript: $tsFile&quot;

# ---------- Helpers ----------
function Show-Help {
    $path = $PSCommandPath
    if (-not $path) { $path = $MyInvocation.MyCommand.Path }
    $content = Get-Content -Raw -Path $path
    $helpBlock = [regex]::Match($content, &#39;(?s)&lt;#\s*(.*?)\s*#&gt;&#39;).Groups[1].Value
    if ([string]::IsNullOrWhiteSpace($helpBlock)) {
        Write-Output &quot;Usage: pwsh -File $path [-AutoInstall|-NoInstall] [-ApplySavedLayout] [-ConfigPath &lt;file&gt;] [-OverlaySeconds &lt;int&gt;] [-DebugMode] [-Help]&quot;
    } else {
        Write-Output $helpBlock.Trim()
    }
}

function Test-Cmd([string]$Name) { $null -ne (Get-Command -Name $Name -ErrorAction SilentlyContinue) }

function Test-IsRoot {
    try { ((&amp; id &#39;-u&#39; 2&gt;$null) -eq 0) } catch {
        try { ((&amp; whoami) -eq &#39;root&#39;) } catch { ($env:USER -eq &#39;root&#39;) }
    }
}

function Detect-PackageManager {
    if (Test-Cmd &#39;apt-get&#39;) { return &#39;apt&#39; }
    if (Test-Cmd &#39;dnf&#39;)     { return &#39;dnf&#39; }
    if (Test-Cmd &#39;zypper&#39;)  { return &#39;zypper&#39; }
    if (Test-Cmd &#39;pacman&#39;)  { return &#39;pacman&#39; }
    return $null
}

function Install-Dep([string]$pkg) {
    $pm = Detect-PackageManager
    if (-not $pm) { throw &#39;No supported package manager found.&#39; }
    if (-not (Test-IsRoot)) { throw &#39;Auto-install requires root.&#39; }

    switch ($pm) {
        &#39;apt&#39;    { &amp; apt-get update -y; &amp; apt-get install -y $pkg }
        &#39;dnf&#39;    { &amp; dnf install -y $pkg }
        &#39;zypper&#39; { &amp; zypper -n install -y $pkg }
        &#39;pacman&#39; { &amp; pacman -Sy --noconfirm $pkg }
    }
}

function Ensure-Dep([string]$cmd, [string]$pkg, [string]$friendly) {
    if (Test-Cmd $cmd) { return }
    if ($NoInstall) { throw &quot;Missing dependency &#39;$friendly&#39; and -NoInstall was specified.&quot; }
    if (-not $AutoInstall) { throw &quot;Missing dependency &#39;$friendly&#39;. Rerun with -AutoInstall or install &#39;$pkg&#39; manually.&quot; }
    Install-Dep $pkg
    if (-not (Test-Cmd $cmd)) { throw &quot;Dependency &#39;$friendly&#39; not available after install.&quot; }
}

function Test-PythonTk {
@&#39;
import sys
try:
    import tkinter as t
    root = t.Tk()
    root.withdraw()
    print(&quot;OK&quot;)
except Exception as e:
    print(&quot;ERR&quot;, e)
    sys.exit(1)
&#39;@ | Set-Content -Path ($tmp = [IO.Path]::GetTempFileName() + &#39;.py&#39;) -Encoding UTF8
    try {
        $p = Start-Process -FilePath &#39;python3&#39; -ArgumentList @($tmp) -PassThru -NoNewWindow -Wait
        return ($p.ExitCode -eq 0)
    } finally {
        try { Remove-Item $tmp -Force -ErrorAction SilentlyContinue } catch {}
    }
}

function Assert-XSessionOrExit {
    if (-not $env:DISPLAY) { $env:DISPLAY = &#39;:0&#39; }
    for ($i=0; $i -lt 6; $i++) {
        try { &amp; xrandr --current | Out-Null; return } catch { Start-Sleep -Milliseconds 300 }
    }
    Write-Error &#39;No X11 display/xrandr available (headless or X not running).&#39;
    Stop-TranscriptSafe; exit 20
}

# ---------- Dependency checks ----------
try {
    Ensure-Dep &#39;xrandr&#39;  &#39;x11-xserver-utils&#39; &#39;xrandr&#39;
    Ensure-Dep &#39;python3&#39; &#39;python3&#39;           &#39;python3&#39;
} catch {
    Write-Error $_.Exception.Message
    Stop-TranscriptSafe; exit 2
}

# ---------- X11 availability ----------
Assert-XSessionOrExit

# tkinter (package name differs by distro)
if (-not (Test-PythonTk)) {
    try {
        $pm = Detect-PackageManager
        switch ($pm) {
            &#39;apt&#39;    { Install-Dep &#39;python3-tk&#39; }
            &#39;dnf&#39;    { Install-Dep &#39;python3-tkinter&#39; }
            &#39;zypper&#39; { Install-Dep &#39;python3-tk&#39; }
            &#39;pacman&#39; { Install-Dep &#39;tk&#39; }
            default  { throw &#39;Unsupported package manager for tkinter.&#39; }
        }
    } catch {
        Write-Error &quot;Unable to install/verify tkinter: $($_.Exception.Message)&quot;
        Stop-TranscriptSafe; exit 2
    }
    if (-not (Test-PythonTk)) {
        Write-Error &#39;python3-tk/tkinter not available after installation.&#39;
        Stop-TranscriptSafe; exit 2
    }
}

# ---------- X11 env + authority ----------
$root = Test-IsRoot
$homeTarget = if ($root) { &quot;/home/$TargetUser&quot; } else { $HOME }
if (-not $env:DISPLAY) { $env:DISPLAY = &#39;:0&#39; }
if ($root) {
    $xaUser = &quot;/home/$TargetUser/.Xauthority&quot;
    if (Test-Path $xaUser) { $env:XAUTHORITY = $xaUser }
    elseif (Test-Path &#39;/root/.Xauthority&#39;) { $env:XAUTHORITY = &#39;/root/.Xauthority&#39; }
} elseif (-not $env:XAUTHORITY) {
    $env:XAUTHORITY = Join-Path $HOME &#39;.Xauthority&#39;
}

# Config path default
if (-not $ConfigPath -or [string]::IsNullOrWhiteSpace($ConfigPath)) {
    $ConfigPath = Join-Path (Join-Path $homeTarget &#39;.config&#39;) &#39;pwsh-monitor-layout.json&#39;
}

# ---------- Early exits ----------
if ($Help) { Show-Help; Stop-TranscriptSafe; exit 0 }

# ---------- xrandr helpers ----------
function Get-XrandrLines { (&amp; xrandr --query | Out-String) -split &quot;`n&quot; }

function Get-ConnectedOutputs {
    Get-XrandrLines | ForEach-Object {
        if ($_ -match &#39;^\s*(\S+)\s+connected&#39;) { $Matches[1] }
    }
}

function Sort-OutputsPreferred([string[]]$Outputs) {
    $order = @(&#39;HDMI&#39;,&#39;DP&#39;,&#39;DVI&#39;,&#39;VGA&#39;,&#39;eDP&#39;)
    $picked = [System.Collections.Generic.List[string]]::new()
    foreach ($p in $order) {
        $Outputs | Where-Object { $_ -like &quot;$p*&quot; } | ForEach-Object { [void]$picked.Add($_) }
    }
    $Outputs | Where-Object { $picked -notcontains $_ } | ForEach-Object { [void]$picked.Add($_) }
    $picked | Select-Object -Unique
}

function Get-OutputModes([string]$Output) {
    $lines = Get-XrandrLines
    $in = $false
    $modes = [System.Collections.Generic.List[string]]::new()
    foreach ($ln in $lines) {
        if (-not $in) {
            if ($ln -match &quot;^\s*$([Regex]::Escape($Output))\s+connected&quot;) { $in = $true; continue }
        } else {
            if ($ln -match &#39;^\S+\s+(connected|disconnected)&#39;) { break }
            if ($ln -match &#39;^\s+([0-9]{3,5}x[0-9]{3,5}\S*)&#39;) {
                $t = $Matches[1]
                if (-not $modes.Contains($t)) { [void]$modes.Add($t) }
            }
        }
    }
    if ($modes.Count -eq 0) { throw &quot;No modes parsed for $Output&quot; }
    return $modes.ToArray()
}

function Get-Size([string]$Token) {
    if ($Token -notmatch &#39;^(\d{3,5})x(\d{3,5})&#39;) { throw &quot;Invalid mode token: $Token&quot; }
    [pscustomobject]@{ W = [int]$Matches[1]; H = [int]$Matches[2] }
}

function Get-CurrentGeometry([string]$Output) {
    $pattern = &quot;^{0}\b&quot; -f [Regex]::Escape($Output)
    $ln = Get-XrandrLines | Where-Object { $_ -match $pattern } | Select-Object -First 1
    if (-not $ln) { return $null }
    $m = [regex]::Match($ln, &#39;(\d{3,5}x\d{3,5})\+(\d+)\+(\d+)&#39;)
    if (-not $m.Success) { return $null }
    $wxh = $m.Groups[1].Value
    $x = [int]$m.Groups[2].Value
    $y = [int]$m.Groups[3].Value
    $m2 = [regex]::Match($wxh, &#39;^(\d{3,5})x(\d{3,5})$&#39;)
    if (-not $m2.Success) { return $null }
    [pscustomobject]@{ W = [int]$m2.Groups[1].Value; H = [int]$m2.Groups[2].Value; X = $x; Y = $y }
}

function Invoke-Xrandr([string[]]$XRArgs) {
    $p = Start-Process -FilePath &#39;xrandr&#39; -ArgumentList $XRArgs -PassThru -NoNewWindow -Wait
    if ($DebugMode) { Write-Verbose (&quot;xrandr &quot; + ($XRArgs -join &#39; &#39;) + &quot; =&gt; &quot; + $p.ExitCode) }
    $p.ExitCode
}

function Apply-Layout([System.Collections.Specialized.OrderedDictionary]$Map) {
    $x = 0
    foreach ($o in $Map.Keys) {
        $tok = [string]$Map[$o]
        $code = Invoke-Xrandr @(&#39;--output&#39;, $o, &#39;--mode&#39;, $tok, &#39;--pos&#39;, (&quot;{0}x0&quot; -f $x), &#39;--rotate&#39;, &#39;normal&#39;)
        if ($code -ne 0) {
            Write-Warning (&quot;xrandr failed for {0} token {1} (exit {2})&quot; -f $o, $tok, $code)
            return $false
        }
        Start-Sleep -Milliseconds 120
        $sz = Get-Size $tok
        $x += $sz.W
    }
    Start-Sleep -Milliseconds 180
    return $true
}

function Verify-OutputGeometry([string]$Output, [string]$Token) {
    $want = Get-Size $Token
    $cur = Get-CurrentGeometry $Output
    if (-not $cur) {
        if ($DebugMode) { Write-Verbose &quot;Verify: no geometry for $Output&quot; }
        return $false
    }
    $ok = ($cur.W -eq $want.W -and $cur.H -eq $want.H)
    if ($DebugMode) {
        Write-Verbose (&quot;Verify: {0} current={1}x{2} vs want={3}x{4} =&gt; {5}&quot; -f $Output, $cur.W, $cur.H, $want.W, $want.H, $ok)
    }
    $ok
}

function Show-OverlayTk([int]$W,[int]$H,[int]$X,[int]$Y,[int]$Seconds) {
$py = @&#39;
import sys, tkinter as t
w, h, x, y, sec = map(int, sys.argv[1:6])
root = t.Tk()
root.overrideredirect(1)
root.attributes(&quot;-topmost&quot;, True)
root.geometry(f&quot;{w}x{h}+{x}+{y}&quot;)
t.Frame(root, width=w, height=h, highlightbackground=&quot;red&quot;, highlightthickness=8).pack()
root.after(sec*1000, root.destroy)
root.mainloop()
&#39;@
    $tmp = [IO.Path]::GetTempFileName() + &#39;.py&#39;
    [IO.File]::WriteAllText($tmp, $py)
    $p = Start-Process -FilePath &#39;python3&#39; -ArgumentList @($tmp, $W, $H, $X, $Y, $Seconds) -PassThru -NoNewWindow
    $timeout = [Math]::Max($Seconds + 3, 8)
    $exited = $true
    try { Wait-Process -Id $p.Id -Timeout $timeout } catch { $exited = $false }
    if (-not $exited) {
        try { Stop-Process -Id $p.Id -Force -ErrorAction SilentlyContinue } catch {}
        Write-Warning &#39;Overlay timeout; killed.&#39;
    }
    try { Remove-Item $tmp -Force -ErrorAction SilentlyContinue } catch {}
}

function Prompt-YNQ([string]$Msg) {
    while ($true) {
        $r = Read-Host $Msg
        switch -Regex ($r) {
            &#39;^(?i)y$&#39; { return &#39;y&#39; }
            &#39;^(?i)n$&#39; { return &#39;n&#39; }
            &#39;^(?i)q$&#39; { return &#39;q&#39; }
            default   { Write-Host &#39;Please type y, n, or q.&#39; -ForegroundColor Yellow }
        }
    }
}

# ---------- Apply saved layout fast-path ----------
if ($ApplySavedLayout) {
    if (-not (Test-Path $ConfigPath)) {
        Write-Warning &quot;Config not found: $ConfigPath&quot;
        Stop-TranscriptSafe; exit 23
    }
    try {
        $raw = Get-Content -Raw -Path $ConfigPath
        $obj = $raw | ConvertFrom-Json
    } catch {
        Write-Error &quot;Failed to parse config JSON: $($_.Exception.Message)&quot;
        Stop-TranscriptSafe; exit 24
    }
    if (-not $obj) { Write-Error &#39;Empty/invalid configuration object.&#39;; Stop-TranscriptSafe; exit 22 }

    $orderedChosen = [System.Collections.Specialized.OrderedDictionary]::new()
    foreach ($p in $obj.PSObject.Properties) {
        $orderedChosen[$p.Name] = [string]$p.Value
    }

    if ($orderedChosen.Count -eq 0) { Write-Error &#39;No entries in configuration.&#39;; Stop-TranscriptSafe; exit 22 }

    if (-not (Apply-Layout $orderedChosen)) {
        Write-Warning &#39;Applying saved layout reported errors.&#39;
        Stop-TranscriptSafe; exit 1
    }

    $primary = $null; $maxA = -1
    foreach ($o in $orderedChosen.Keys) {
        $sz = Get-Size ([string]$orderedChosen[$o])
        $a  = $sz.W * $sz.H
        if ($a -gt $maxA) { $primary = $o; $maxA = $a }
    }
    $null = Invoke-Xrandr @(&#39;--output&#39;, $primary, &#39;--primary&#39;)

    $summary = [pscustomobject]@{
        ok         = $true
        mode       = &#39;apply-saved&#39;
        primary    = $primary
        order      = @($orderedChosen.Keys)
        chosen     = $orderedChosen
        configFile = $ConfigPath
    } | ConvertTo-Json -Compress
    Write-Output $summary
    Stop-TranscriptSafe; exit 0
}

# ---------- Probe outputs ----------
$outs = Get-ConnectedOutputs
if (-not $outs -or $outs.Count -eq 0) { Write-Error &#39;No connected monitors detected.&#39;; Stop-TranscriptSafe; exit 21 }

# ---------- Interactive ordering ----------
$orderedOuts = [System.Collections.Generic.List[string]]::new()
if ($outs.Count -gt 1) {
    $remaining = [System.Collections.Generic.List[string]]::new()
    $remaining.AddRange([string[]]$outs)
    Write-Host &quot;Multiple monitors detected: $($remaining -join &#39;, &#39;)&quot; -ForegroundColor Cyan
    while ($remaining.Count -gt 0) {
        if ($orderedOuts.Count -eq 0) {
            Write-Host &quot;Which monitor should be on the far left?&quot;
        } else {
            Write-Host &quot;Which monitor should be to the right of $($orderedOuts[-1])?&quot;
        }
        for ($i=0; $i -lt $remaining.Count; $i++) { Write-Host &quot;  [$($i+1)] $($remaining[$i])&quot; }
        $ans = Read-Host &quot;Enter number (1-$($remaining.Count))&quot;
        if (($ans -match &#39;^\d+$&#39;) -and ([int]$ans -ge 1) -and ([int]$ans -le $remaining.Count)) {
            $choiceIndex = [int]$ans - 1
            $orderedOuts.Add($remaining[$choiceIndex])
            $remaining.RemoveAt($choiceIndex)
        } else {
            Write-Warning &quot;Invalid selection.&quot;
        }
    }
} else {
    $orderedOuts.Add($outs[0])
}
Write-Host &quot;Final monitor order (left-to-right): $($orderedOuts -join &#39; -&gt; &#39;)&quot; -ForegroundColor Green

# ---------- Gather modes ----------
$All   = @{}
$First = @{}
foreach ($o in $orderedOuts) {
    $m = Get-OutputModes $o
    $All[$o] = $m
    $First[$o] = $m[0]
    if ($DebugMode) { Write-Verbose (&quot;Modes[{0}] (#{1}): {2}&quot; -f $o, $m.Count, ($m -join &#39; &#39;)) }
}

$Chosen = [System.Collections.Specialized.OrderedDictionary]::new()
foreach ($o in $orderedOuts) { $Chosen[$o] = $null }

# ---------- Per-output interactive selection ----------
foreach ($current in $orderedOuts) {
    Write-Host (&quot;======== Configuring {0} ========&quot; -f $current) -ForegroundColor Cyan
    $cands = @($All[$current])
    $accepted = $false

    for ($i = 0; $i -lt $cands.Count; $i++) {
        $tok = $cands[$i]
        Write-Host (&quot;---&gt; [{0}/{1}] Trying {2} for {3}&quot; -f ($i + 1), $cands.Count, $tok, $current) -ForegroundColor Green

        $proposal = [System.Collections.Specialized.OrderedDictionary]::new()
        foreach ($o in $orderedOuts) {
            if ($o -eq $current) { $proposal[$o] = $tok }
            else { $proposal[$o] = ($Chosen[$o] ?? $First[$o]) }
        }

        if (-not (Apply-Layout $proposal)) { Write-Warning (&quot;Skip {0}: xrandr exit!=0&quot; -f $tok); continue }
        if (-not (Verify-OutputGeometry $current $tok)) { Write-Warning (&quot;Skip {0}: geometry mismatch&quot; -f $tok); continue }

        $xoff = 0
        foreach ($o in $orderedOuts) {
            if ($o -eq $current) { break }
            $sz = Get-Size ([string]$proposal[$o])
            $xoff += $sz.W
        }
        $szC = Get-Size $tok
        Show-OverlayTk -W $szC.W -H $szC.H -X $xoff -Y 0 -Seconds $OverlaySeconds

        $ans = Prompt-YNQ (&quot;Was the red rectangle fully enclosed on {0} at {1}? [y=accept / n=next / q=quit]&quot; -f $current, $tok)
        if ($ans -eq &#39;y&#39;) { $Chosen[$current] = $tok; $accepted = $true; break }
        if ($ans -eq &#39;q&#39;) { Write-Warning &#39;User aborted.&#39;; Stop-TranscriptSafe; exit 1 }
    }

    if (-not $accepted) {
        $fb = $First[$current]
        Write-Warning (&quot;No accepted mode for {0}. Falling back to {1}&quot; -f $current, $fb)
        $Chosen[$current] = $fb
    }
}

# ---------- Final apply ----------
Write-Host &quot;Final configuration selected. Applying...&quot; -ForegroundColor Cyan
if (-not (Apply-Layout $Chosen)) {
    Write-Warning &#39;Final layout application reported errors.&#39;
    Stop-TranscriptSafe; exit 1
}

# choose primary as largest area
$primary = $null; $maxA = -1
foreach ($o in $orderedOuts) {
    $sz = Get-Size ([string]$Chosen[$o])
    $a  = $sz.W * $sz.H
    if ($a -gt $maxA) { $primary = $o; $maxA = $a }
}
$null = Invoke-Xrandr @(&#39;--output&#39;, $primary, &#39;--primary&#39;)

# ---------- Save config + autostart ----------
try {
    $configDir = Split-Path -Parent $ConfigPath
    if (-not (Test-Path $configDir)) {
        if ($root) { &amp; sudo -u $TargetUser mkdir -p -- $configDir }
        else       { New-Item -ItemType Directory -Path $configDir -Force | Out-Null }
    }

    $tmpChosen = [ordered]@{}
    foreach ($k in $Chosen.Keys) { $tmpChosen[$k] = [string]$Chosen[$k] }
    ($tmpChosen | ConvertTo-Json) | Set-Content -Path $ConfigPath -Encoding UTF8
    if ($root) { &amp; chown &quot;${TargetUser}:${TargetUser}&quot; $ConfigPath }
    Write-Host &quot;[INFO] Configuration saved to $ConfigPath&quot; -ForegroundColor DarkCyan

    $autoDir = Join-Path $homeTarget &#39;.config/autostart&#39;
    if (-not (Test-Path $autoDir)) {
        if ($root) { &amp; sudo -u $TargetUser mkdir -p -- $autoDir }
        else       { New-Item -ItemType Directory -Path $autoDir -Force | Out-Null }
    }
    if (-not (Test-Path $ScriptInstallPath)) {
        $src = $PSCommandPath; if (-not $src) { $src = $MyInvocation.MyCommand.Path }
        Copy-Item -Path $src -Destination $ScriptInstallPath -Force
        if ($root) { &amp; chown &quot;${TargetUser}:${TargetUser}&quot; $ScriptInstallPath }
        &amp; chmod +x $ScriptInstallPath
    }
    $desktopFile = Join-Path $autoDir &#39;pwsh_monitor_working.desktop&#39;
    $execLine = &quot;pwsh -File $ScriptInstallPath -ApplySavedLayout -ConfigPath `&quot;$ConfigPath`&quot;&quot;
@&quot;
[Desktop Entry]
Type=Application
Exec=$execLine
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
Name=PwshAutoMonitor
Comment=Autoconfigure monitors layout (pwsh)
&quot;@ | Set-Content -Path $desktopFile -Encoding UTF8 -NoNewline
    if ($root) { &amp; chown &quot;${TargetUser}:${TargetUser}&quot; $desktopFile }
    &amp; chmod 0644 $desktopFile
    Write-Host (&quot;[INFO] Autostart installed at {0} for user {1}&quot; -f $desktopFile, $TargetUser) -ForegroundColor DarkCyan
} catch {
    Write-Warning (&quot;Autostart/config setup issue: {0}&quot; -f $_.Exception.Message)
}

# ---------- Success summary (single-line JSON) ----------
$summary2 = [pscustomobject]@{
    ok         = $true
    mode       = &#39;interactive&#39;
    primary    = $primary
    order      = @($orderedOuts)
    chosen     = $Chosen
    configFile = $ConfigPath
} | ConvertTo-Json -Compress
Write-Output $summary2

Stop-TranscriptSafe
exit 0" data-download-link="" data-download-label="Download Bash">
  <code class="language-bash">#!/usr/bin/env pwsh
&lt;# 
pwsh_monitor_working.ps1 — Interactive + non-interactive multi-monitor configurator for X11 (Linux)

TARGET: Debian/Ubuntu/Derivatives, Fedora/RHEL/CentOS, openSUSE, Arch-based (pwsh, xrandr)
WM/TERM agnostic (works with ratpoison/Alacritty etc.)

KEY CAPABILITIES
- Interactive discovery of output order (left→right) and resolution selection per monitor using xrandr.
- Verifies applied geometry; shows a Tk red-border overlay to confirm the active monitor.
- Saves chosen layout to JSON and can re-apply non-interactively on login/autostart.
- Robust logging (Start-Transcript), strict error behavior, and explicit exit codes.

NEW/REQUESTED IMPROVEMENTS
- -ConfigPath &lt;file&gt; to override default config path (default: ~/.config/pwsh-monitor-layout.json).
- -Help: Prints usage, options, examples, and exit codes then exits 0.
- Emits a one-line machine-parseable JSON summary on success for both interactive and apply-saved paths.
- Portability hardening: auto-install gated by distro/pm detection (apt-get/dnf/zypper/pacman).
- -NoInstall: disable auto-install; fail fast if dependencies missing.
- Headless handling: detect missing X11/xrandr availability and exit with explicit code.

USAGE (examples)
  # First run (interactive):
  pwsh -File ./pwsh_monitor_working.ps1

  # Auto-install missing deps (root required):
  sudo pwsh -File ./pwsh_monitor_working.ps1 -AutoInstall

  # Save config to a specific path:
  pwsh -File ./pwsh_monitor_working.ps1 -ConfigPath &quot;$HOME/.config/my-monitor-layout.json&quot;

  # Non-interactive apply of saved layout (good for autostart):
  pwsh -File ./pwsh_monitor_working.ps1 -ApplySavedLayout

  # Print help:
  pwsh -File ./pwsh_monitor_working.ps1 -Help

OPTIONS
  -DebugMode             Verbose logging during execution.
  -AutoInstall           Attempt to install dependencies via detected package manager.
  -NoInstall             Do not install; fail fast if dependencies are missing.
  -ApplySavedLayout      Apply saved layout from the config JSON and exit.
  -OverlaySeconds &lt;int&gt;  Seconds to keep the red overlay visible when testing (default: 5).
  -TargetUser &lt;string&gt;   Login user for ownership of autostart/config when run as root (default: SUDO_USER/USER/linaro).
  -ScriptInstallPath     Path to place a self-copy used by autostart (default: $HOME/pwsh_monitor_working.ps1).
  -ConfigPath            Override config JSON path (default: $HOME/.config/pwsh-monitor-layout.json).
  -Help                  Show this help and exit.

EXIT CODES
  0  Success
  1  General error / user abort / final apply failed
  2  Missing dependency and -NoInstall provided (or auto-install disabled/unsupported)
 20  Headless / no X11 session detected (no DISPLAY or xrandr unusable)
 21  No connected monitors detected
 22  Invalid/empty configuration when using -ApplySavedLayout
 23  Config file not found for -ApplySavedLayout
 24  JSON parse error for -ConfigPath
 25  Permission or ownership errors during autostart/config setup

MACHINE-PARSABLE SUMMARY
  On success, prints a single line JSON to stdout like:
  {&quot;ok&quot;:true,&quot;mode&quot;:&quot;interactive&quot;,&quot;primary&quot;:&quot;HDMI-1&quot;,&quot;order&quot;:[&quot;HDMI-1&quot;,&quot;DP-1&quot;],&quot;chosen&quot;:{&quot;HDMI-1&quot;:&quot;1920x1080&quot;,&quot;DP-1&quot;:&quot;2560x1440&quot;},&quot;configFile&quot;:&quot;/home/user/.config/pwsh-monitor-layout.json&quot;}

#&gt;

[CmdletBinding()]
param(
    [switch] $DebugMode,
    [switch] $AutoInstall,
    [switch] $NoInstall,
    [switch] $ApplySavedLayout,
    [switch] $Help,
    [int]    $OverlaySeconds = 5,
    [string] $TargetUser = ($env:SUDO_USER ?? $env:USER ?? &#39;linaro&#39;),
    [string] $ScriptInstallPath = &quot;$HOME/pwsh_monitor_working.ps1&quot;,
    [string] $ConfigPath
)

Set-StrictMode -Version Latest
$ErrorActionPreference = &#39;Stop&#39;
if ($DebugMode) { $VerbosePreference = &#39;Continue&#39; }

function Stop-TranscriptSafe { try { Stop-Transcript | Out-Null } catch {} }

# Transcript
$tsFile = &quot;/tmp/pwsh_monitor_working-$(Get-Date -Format &#39;yyyyMMdd-HHmmss&#39;).log&quot;
try { Start-Transcript -Path $tsFile -Force | Out-Null } catch {
    $tsFile = Join-Path $HOME &quot;pwsh_monitor_working-$(Get-Date -Format &#39;yyyyMMdd-HHmmss&#39;).log&quot;
    try { Start-Transcript -Path $tsFile -Force | Out-Null } catch {}
}
Write-Verbose &quot;Transcript: $tsFile&quot;

# ---------- Helpers ----------
function Show-Help {
    $path = $PSCommandPath
    if (-not $path) { $path = $MyInvocation.MyCommand.Path }
    $content = Get-Content -Raw -Path $path
    $helpBlock = [regex]::Match($content, &#39;(?s)&lt;#\s*(.*?)\s*#&gt;&#39;).Groups[1].Value
    if ([string]::IsNullOrWhiteSpace($helpBlock)) {
        Write-Output &quot;Usage: pwsh -File $path [-AutoInstall|-NoInstall] [-ApplySavedLayout] [-ConfigPath &lt;file&gt;] [-OverlaySeconds &lt;int&gt;] [-DebugMode] [-Help]&quot;
    } else {
        Write-Output $helpBlock.Trim()
    }
}

function Test-Cmd([string]$Name) { $null -ne (Get-Command -Name $Name -ErrorAction SilentlyContinue) }

function Test-IsRoot {
    try { ((&amp; id &#39;-u&#39; 2&gt;$null) -eq 0) } catch {
        try { ((&amp; whoami) -eq &#39;root&#39;) } catch { ($env:USER -eq &#39;root&#39;) }
    }
}

function Detect-PackageManager {
    if (Test-Cmd &#39;apt-get&#39;) { return &#39;apt&#39; }
    if (Test-Cmd &#39;dnf&#39;)     { return &#39;dnf&#39; }
    if (Test-Cmd &#39;zypper&#39;)  { return &#39;zypper&#39; }
    if (Test-Cmd &#39;pacman&#39;)  { return &#39;pacman&#39; }
    return $null
}

function Install-Dep([string]$pkg) {
    $pm = Detect-PackageManager
    if (-not $pm) { throw &#39;No supported package manager found.&#39; }
    if (-not (Test-IsRoot)) { throw &#39;Auto-install requires root.&#39; }

    switch ($pm) {
        &#39;apt&#39;    { &amp; apt-get update -y; &amp; apt-get install -y $pkg }
        &#39;dnf&#39;    { &amp; dnf install -y $pkg }
        &#39;zypper&#39; { &amp; zypper -n install -y $pkg }
        &#39;pacman&#39; { &amp; pacman -Sy --noconfirm $pkg }
    }
}

function Ensure-Dep([string]$cmd, [string]$pkg, [string]$friendly) {
    if (Test-Cmd $cmd) { return }
    if ($NoInstall) { throw &quot;Missing dependency &#39;$friendly&#39; and -NoInstall was specified.&quot; }
    if (-not $AutoInstall) { throw &quot;Missing dependency &#39;$friendly&#39;. Rerun with -AutoInstall or install &#39;$pkg&#39; manually.&quot; }
    Install-Dep $pkg
    if (-not (Test-Cmd $cmd)) { throw &quot;Dependency &#39;$friendly&#39; not available after install.&quot; }
}

function Test-PythonTk {
@&#39;
import sys
try:
    import tkinter as t
    root = t.Tk()
    root.withdraw()
    print(&quot;OK&quot;)
except Exception as e:
    print(&quot;ERR&quot;, e)
    sys.exit(1)
&#39;@ | Set-Content -Path ($tmp = [IO.Path]::GetTempFileName() + &#39;.py&#39;) -Encoding UTF8
    try {
        $p = Start-Process -FilePath &#39;python3&#39; -ArgumentList @($tmp) -PassThru -NoNewWindow -Wait
        return ($p.ExitCode -eq 0)
    } finally {
        try { Remove-Item $tmp -Force -ErrorAction SilentlyContinue } catch {}
    }
}

function Assert-XSessionOrExit {
    if (-not $env:DISPLAY) { $env:DISPLAY = &#39;:0&#39; }
    for ($i=0; $i -lt 6; $i++) {
        try { &amp; xrandr --current | Out-Null; return } catch { Start-Sleep -Milliseconds 300 }
    }
    Write-Error &#39;No X11 display/xrandr available (headless or X not running).&#39;
    Stop-TranscriptSafe; exit 20
}

# ---------- Dependency checks ----------
try {
    Ensure-Dep &#39;xrandr&#39;  &#39;x11-xserver-utils&#39; &#39;xrandr&#39;
    Ensure-Dep &#39;python3&#39; &#39;python3&#39;           &#39;python3&#39;
} catch {
    Write-Error $_.Exception.Message
    Stop-TranscriptSafe; exit 2
}

# ---------- X11 availability ----------
Assert-XSessionOrExit

# tkinter (package name differs by distro)
if (-not (Test-PythonTk)) {
    try {
        $pm = Detect-PackageManager
        switch ($pm) {
            &#39;apt&#39;    { Install-Dep &#39;python3-tk&#39; }
            &#39;dnf&#39;    { Install-Dep &#39;python3-tkinter&#39; }
            &#39;zypper&#39; { Install-Dep &#39;python3-tk&#39; }
            &#39;pacman&#39; { Install-Dep &#39;tk&#39; }
            default  { throw &#39;Unsupported package manager for tkinter.&#39; }
        }
    } catch {
        Write-Error &quot;Unable to install/verify tkinter: $($_.Exception.Message)&quot;
        Stop-TranscriptSafe; exit 2
    }
    if (-not (Test-PythonTk)) {
        Write-Error &#39;python3-tk/tkinter not available after installation.&#39;
        Stop-TranscriptSafe; exit 2
    }
}

# ---------- X11 env + authority ----------
$root = Test-IsRoot
$homeTarget = if ($root) { &quot;/home/$TargetUser&quot; } else { $HOME }
if (-not $env:DISPLAY) { $env:DISPLAY = &#39;:0&#39; }
if ($root) {
    $xaUser = &quot;/home/$TargetUser/.Xauthority&quot;
    if (Test-Path $xaUser) { $env:XAUTHORITY = $xaUser }
    elseif (Test-Path &#39;/root/.Xauthority&#39;) { $env:XAUTHORITY = &#39;/root/.Xauthority&#39; }
} elseif (-not $env:XAUTHORITY) {
    $env:XAUTHORITY = Join-Path $HOME &#39;.Xauthority&#39;
}

# Config path default
if (-not $ConfigPath -or [string]::IsNullOrWhiteSpace($ConfigPath)) {
    $ConfigPath = Join-Path (Join-Path $homeTarget &#39;.config&#39;) &#39;pwsh-monitor-layout.json&#39;
}

# ---------- Early exits ----------
if ($Help) { Show-Help; Stop-TranscriptSafe; exit 0 }

# ---------- xrandr helpers ----------
function Get-XrandrLines { (&amp; xrandr --query | Out-String) -split &quot;`n&quot; }

function Get-ConnectedOutputs {
    Get-XrandrLines | ForEach-Object {
        if ($_ -match &#39;^\s*(\S+)\s+connected&#39;) { $Matches[1] }
    }
}

function Sort-OutputsPreferred([string[]]$Outputs) {
    $order = @(&#39;HDMI&#39;,&#39;DP&#39;,&#39;DVI&#39;,&#39;VGA&#39;,&#39;eDP&#39;)
    $picked = [System.Collections.Generic.List[string]]::new()
    foreach ($p in $order) {
        $Outputs | Where-Object { $_ -like &quot;$p*&quot; } | ForEach-Object { [void]$picked.Add($_) }
    }
    $Outputs | Where-Object { $picked -notcontains $_ } | ForEach-Object { [void]$picked.Add($_) }
    $picked | Select-Object -Unique
}

function Get-OutputModes([string]$Output) {
    $lines = Get-XrandrLines
    $in = $false
    $modes = [System.Collections.Generic.List[string]]::new()
    foreach ($ln in $lines) {
        if (-not $in) {
            if ($ln -match &quot;^\s*$([Regex]::Escape($Output))\s+connected&quot;) { $in = $true; continue }
        } else {
            if ($ln -match &#39;^\S+\s+(connected|disconnected)&#39;) { break }
            if ($ln -match &#39;^\s+([0-9]{3,5}x[0-9]{3,5}\S*)&#39;) {
                $t = $Matches[1]
                if (-not $modes.Contains($t)) { [void]$modes.Add($t) }
            }
        }
    }
    if ($modes.Count -eq 0) { throw &quot;No modes parsed for $Output&quot; }
    return $modes.ToArray()
}

function Get-Size([string]$Token) {
    if ($Token -notmatch &#39;^(\d{3,5})x(\d{3,5})&#39;) { throw &quot;Invalid mode token: $Token&quot; }
    [pscustomobject]@{ W = [int]$Matches[1]; H = [int]$Matches[2] }
}

function Get-CurrentGeometry([string]$Output) {
    $pattern = &quot;^{0}\b&quot; -f [Regex]::Escape($Output)
    $ln = Get-XrandrLines | Where-Object { $_ -match $pattern } | Select-Object -First 1
    if (-not $ln) { return $null }
    $m = [regex]::Match($ln, &#39;(\d{3,5}x\d{3,5})\+(\d+)\+(\d+)&#39;)
    if (-not $m.Success) { return $null }
    $wxh = $m.Groups[1].Value
    $x = [int]$m.Groups[2].Value
    $y = [int]$m.Groups[3].Value
    $m2 = [regex]::Match($wxh, &#39;^(\d{3,5})x(\d{3,5})$&#39;)
    if (-not $m2.Success) { return $null }
    [pscustomobject]@{ W = [int]$m2.Groups[1].Value; H = [int]$m2.Groups[2].Value; X = $x; Y = $y }
}

function Invoke-Xrandr([string[]]$XRArgs) {
    $p = Start-Process -FilePath &#39;xrandr&#39; -ArgumentList $XRArgs -PassThru -NoNewWindow -Wait
    if ($DebugMode) { Write-Verbose (&quot;xrandr &quot; + ($XRArgs -join &#39; &#39;) + &quot; =&gt; &quot; + $p.ExitCode) }
    $p.ExitCode
}

function Apply-Layout([System.Collections.Specialized.OrderedDictionary]$Map) {
    $x = 0
    foreach ($o in $Map.Keys) {
        $tok = [string]$Map[$o]
        $code = Invoke-Xrandr @(&#39;--output&#39;, $o, &#39;--mode&#39;, $tok, &#39;--pos&#39;, (&quot;{0}x0&quot; -f $x), &#39;--rotate&#39;, &#39;normal&#39;)
        if ($code -ne 0) {
            Write-Warning (&quot;xrandr failed for {0} token {1} (exit {2})&quot; -f $o, $tok, $code)
            return $false
        }
        Start-Sleep -Milliseconds 120
        $sz = Get-Size $tok
        $x += $sz.W
    }
    Start-Sleep -Milliseconds 180
    return $true
}

function Verify-OutputGeometry([string]$Output, [string]$Token) {
    $want = Get-Size $Token
    $cur = Get-CurrentGeometry $Output
    if (-not $cur) {
        if ($DebugMode) { Write-Verbose &quot;Verify: no geometry for $Output&quot; }
        return $false
    }
    $ok = ($cur.W -eq $want.W -and $cur.H -eq $want.H)
    if ($DebugMode) {
        Write-Verbose (&quot;Verify: {0} current={1}x{2} vs want={3}x{4} =&gt; {5}&quot; -f $Output, $cur.W, $cur.H, $want.W, $want.H, $ok)
    }
    $ok
}

function Show-OverlayTk([int]$W,[int]$H,[int]$X,[int]$Y,[int]$Seconds) {
$py = @&#39;
import sys, tkinter as t
w, h, x, y, sec = map(int, sys.argv[1:6])
root = t.Tk()
root.overrideredirect(1)
root.attributes(&quot;-topmost&quot;, True)
root.geometry(f&quot;{w}x{h}+{x}+{y}&quot;)
t.Frame(root, width=w, height=h, highlightbackground=&quot;red&quot;, highlightthickness=8).pack()
root.after(sec*1000, root.destroy)
root.mainloop()
&#39;@
    $tmp = [IO.Path]::GetTempFileName() + &#39;.py&#39;
    [IO.File]::WriteAllText($tmp, $py)
    $p = Start-Process -FilePath &#39;python3&#39; -ArgumentList @($tmp, $W, $H, $X, $Y, $Seconds) -PassThru -NoNewWindow
    $timeout = [Math]::Max($Seconds + 3, 8)
    $exited = $true
    try { Wait-Process -Id $p.Id -Timeout $timeout } catch { $exited = $false }
    if (-not $exited) {
        try { Stop-Process -Id $p.Id -Force -ErrorAction SilentlyContinue } catch {}
        Write-Warning &#39;Overlay timeout; killed.&#39;
    }
    try { Remove-Item $tmp -Force -ErrorAction SilentlyContinue } catch {}
}

function Prompt-YNQ([string]$Msg) {
    while ($true) {
        $r = Read-Host $Msg
        switch -Regex ($r) {
            &#39;^(?i)y$&#39; { return &#39;y&#39; }
            &#39;^(?i)n$&#39; { return &#39;n&#39; }
            &#39;^(?i)q$&#39; { return &#39;q&#39; }
            default   { Write-Host &#39;Please type y, n, or q.&#39; -ForegroundColor Yellow }
        }
    }
}

# ---------- Apply saved layout fast-path ----------
if ($ApplySavedLayout) {
    if (-not (Test-Path $ConfigPath)) {
        Write-Warning &quot;Config not found: $ConfigPath&quot;
        Stop-TranscriptSafe; exit 23
    }
    try {
        $raw = Get-Content -Raw -Path $ConfigPath
        $obj = $raw | ConvertFrom-Json
    } catch {
        Write-Error &quot;Failed to parse config JSON: $($_.Exception.Message)&quot;
        Stop-TranscriptSafe; exit 24
    }
    if (-not $obj) { Write-Error &#39;Empty/invalid configuration object.&#39;; Stop-TranscriptSafe; exit 22 }

    $orderedChosen = [System.Collections.Specialized.OrderedDictionary]::new()
    foreach ($p in $obj.PSObject.Properties) {
        $orderedChosen[$p.Name] = [string]$p.Value
    }

    if ($orderedChosen.Count -eq 0) { Write-Error &#39;No entries in configuration.&#39;; Stop-TranscriptSafe; exit 22 }

    if (-not (Apply-Layout $orderedChosen)) {
        Write-Warning &#39;Applying saved layout reported errors.&#39;
        Stop-TranscriptSafe; exit 1
    }

    $primary = $null; $maxA = -1
    foreach ($o in $orderedChosen.Keys) {
        $sz = Get-Size ([string]$orderedChosen[$o])
        $a  = $sz.W * $sz.H
        if ($a -gt $maxA) { $primary = $o; $maxA = $a }
    }
    $null = Invoke-Xrandr @(&#39;--output&#39;, $primary, &#39;--primary&#39;)

    $summary = [pscustomobject]@{
        ok         = $true
        mode       = &#39;apply-saved&#39;
        primary    = $primary
        order      = @($orderedChosen.Keys)
        chosen     = $orderedChosen
        configFile = $ConfigPath
    } | ConvertTo-Json -Compress
    Write-Output $summary
    Stop-TranscriptSafe; exit 0
}

# ---------- Probe outputs ----------
$outs = Get-ConnectedOutputs
if (-not $outs -or $outs.Count -eq 0) { Write-Error &#39;No connected monitors detected.&#39;; Stop-TranscriptSafe; exit 21 }

# ---------- Interactive ordering ----------
$orderedOuts = [System.Collections.Generic.List[string]]::new()
if ($outs.Count -gt 1) {
    $remaining = [System.Collections.Generic.List[string]]::new()
    $remaining.AddRange([string[]]$outs)
    Write-Host &quot;Multiple monitors detected: $($remaining -join &#39;, &#39;)&quot; -ForegroundColor Cyan
    while ($remaining.Count -gt 0) {
        if ($orderedOuts.Count -eq 0) {
            Write-Host &quot;Which monitor should be on the far left?&quot;
        } else {
            Write-Host &quot;Which monitor should be to the right of $($orderedOuts[-1])?&quot;
        }
        for ($i=0; $i -lt $remaining.Count; $i++) { Write-Host &quot;  [$($i+1)] $($remaining[$i])&quot; }
        $ans = Read-Host &quot;Enter number (1-$($remaining.Count))&quot;
        if (($ans -match &#39;^\d+$&#39;) -and ([int]$ans -ge 1) -and ([int]$ans -le $remaining.Count)) {
            $choiceIndex = [int]$ans - 1
            $orderedOuts.Add($remaining[$choiceIndex])
            $remaining.RemoveAt($choiceIndex)
        } else {
            Write-Warning &quot;Invalid selection.&quot;
        }
    }
} else {
    $orderedOuts.Add($outs[0])
}
Write-Host &quot;Final monitor order (left-to-right): $($orderedOuts -join &#39; -&gt; &#39;)&quot; -ForegroundColor Green

# ---------- Gather modes ----------
$All   = @{}
$First = @{}
foreach ($o in $orderedOuts) {
    $m = Get-OutputModes $o
    $All[$o] = $m
    $First[$o] = $m[0]
    if ($DebugMode) { Write-Verbose (&quot;Modes[{0}] (#{1}): {2}&quot; -f $o, $m.Count, ($m -join &#39; &#39;)) }
}

$Chosen = [System.Collections.Specialized.OrderedDictionary]::new()
foreach ($o in $orderedOuts) { $Chosen[$o] = $null }

# ---------- Per-output interactive selection ----------
foreach ($current in $orderedOuts) {
    Write-Host (&quot;======== Configuring {0} ========&quot; -f $current) -ForegroundColor Cyan
    $cands = @($All[$current])
    $accepted = $false

    for ($i = 0; $i -lt $cands.Count; $i++) {
        $tok = $cands[$i]
        Write-Host (&quot;---&gt; [{0}/{1}] Trying {2} for {3}&quot; -f ($i + 1), $cands.Count, $tok, $current) -ForegroundColor Green

        $proposal = [System.Collections.Specialized.OrderedDictionary]::new()
        foreach ($o in $orderedOuts) {
            if ($o -eq $current) { $proposal[$o] = $tok }
            else { $proposal[$o] = ($Chosen[$o] ?? $First[$o]) }
        }

        if (-not (Apply-Layout $proposal)) { Write-Warning (&quot;Skip {0}: xrandr exit!=0&quot; -f $tok); continue }
        if (-not (Verify-OutputGeometry $current $tok)) { Write-Warning (&quot;Skip {0}: geometry mismatch&quot; -f $tok); continue }

        $xoff = 0
        foreach ($o in $orderedOuts) {
            if ($o -eq $current) { break }
            $sz = Get-Size ([string]$proposal[$o])
            $xoff += $sz.W
        }
        $szC = Get-Size $tok
        Show-OverlayTk -W $szC.W -H $szC.H -X $xoff -Y 0 -Seconds $OverlaySeconds

        $ans = Prompt-YNQ (&quot;Was the red rectangle fully enclosed on {0} at {1}? [y=accept / n=next / q=quit]&quot; -f $current, $tok)
        if ($ans -eq &#39;y&#39;) { $Chosen[$current] = $tok; $accepted = $true; break }
        if ($ans -eq &#39;q&#39;) { Write-Warning &#39;User aborted.&#39;; Stop-TranscriptSafe; exit 1 }
    }

    if (-not $accepted) {
        $fb = $First[$current]
        Write-Warning (&quot;No accepted mode for {0}. Falling back to {1}&quot; -f $current, $fb)
        $Chosen[$current] = $fb
    }
}

# ---------- Final apply ----------
Write-Host &quot;Final configuration selected. Applying...&quot; -ForegroundColor Cyan
if (-not (Apply-Layout $Chosen)) {
    Write-Warning &#39;Final layout application reported errors.&#39;
    Stop-TranscriptSafe; exit 1
}

# choose primary as largest area
$primary = $null; $maxA = -1
foreach ($o in $orderedOuts) {
    $sz = Get-Size ([string]$Chosen[$o])
    $a  = $sz.W * $sz.H
    if ($a -gt $maxA) { $primary = $o; $maxA = $a }
}
$null = Invoke-Xrandr @(&#39;--output&#39;, $primary, &#39;--primary&#39;)

# ---------- Save config + autostart ----------
try {
    $configDir = Split-Path -Parent $ConfigPath
    if (-not (Test-Path $configDir)) {
        if ($root) { &amp; sudo -u $TargetUser mkdir -p -- $configDir }
        else       { New-Item -ItemType Directory -Path $configDir -Force | Out-Null }
    }

    $tmpChosen = [ordered]@{}
    foreach ($k in $Chosen.Keys) { $tmpChosen[$k] = [string]$Chosen[$k] }
    ($tmpChosen | ConvertTo-Json) | Set-Content -Path $ConfigPath -Encoding UTF8
    if ($root) { &amp; chown &quot;${TargetUser}:${TargetUser}&quot; $ConfigPath }
    Write-Host &quot;[INFO] Configuration saved to $ConfigPath&quot; -ForegroundColor DarkCyan

    $autoDir = Join-Path $homeTarget &#39;.config/autostart&#39;
    if (-not (Test-Path $autoDir)) {
        if ($root) { &amp; sudo -u $TargetUser mkdir -p -- $autoDir }
        else       { New-Item -ItemType Directory -Path $autoDir -Force | Out-Null }
    }
    if (-not (Test-Path $ScriptInstallPath)) {
        $src = $PSCommandPath; if (-not $src) { $src = $MyInvocation.MyCommand.Path }
        Copy-Item -Path $src -Destination $ScriptInstallPath -Force
        if ($root) { &amp; chown &quot;${TargetUser}:${TargetUser}&quot; $ScriptInstallPath }
        &amp; chmod +x $ScriptInstallPath
    }
    $desktopFile = Join-Path $autoDir &#39;pwsh_monitor_working.desktop&#39;
    $execLine = &quot;pwsh -File $ScriptInstallPath -ApplySavedLayout -ConfigPath `&quot;$ConfigPath`&quot;&quot;
@&quot;
[Desktop Entry]
Type=Application
Exec=$execLine
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
Name=PwshAutoMonitor
Comment=Autoconfigure monitors layout (pwsh)
&quot;@ | Set-Content -Path $desktopFile -Encoding UTF8 -NoNewline
    if ($root) { &amp; chown &quot;${TargetUser}:${TargetUser}&quot; $desktopFile }
    &amp; chmod 0644 $desktopFile
    Write-Host (&quot;[INFO] Autostart installed at {0} for user {1}&quot; -f $desktopFile, $TargetUser) -ForegroundColor DarkCyan
} catch {
    Write-Warning (&quot;Autostart/config setup issue: {0}&quot; -f $_.Exception.Message)
}

# ---------- Success summary (single-line JSON) ----------
$summary2 = [pscustomobject]@{
    ok         = $true
    mode       = &#39;interactive&#39;
    primary    = $primary
    order      = @($orderedOuts)
    chosen     = $Chosen
    configFile = $ConfigPath
} | ConvertTo-Json -Compress
Write-Output $summary2

Stop-TranscriptSafe
exit 0</code>
</section>

        </div>
        
          URL: https://ib.bsb.br/auto-xrandr
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/b3-sell/" title="b3 - SELL" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/prf/" title="prf" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/fifa-twobutton-controls/" title="FIFA Two‑Button Controls" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/da-term/" title="DirectAdmin terminal custom commands" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-11-19 22:46:22
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/auto-xrandr/"
        },
        "headline": "auto xrandr for multi-monitor setup",
        "description": "",
        "datePublished": "2025-10-07T00:00:00+00:00",
        "dateModified": "2025-10-14T17:14:47+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
