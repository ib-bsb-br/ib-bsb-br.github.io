<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        SBNB linux within Ubuntu Ansible Playbook - infoBAG
      
    </title>
    <meta name="title" content="SBNB linux within Ubuntu Ansible Playbook - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/sbnb-ansible-ubuntu/">
    <meta property="og:title" content="SBNB linux within Ubuntu Ansible Playbook - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/sbnb-ansible-ubuntu/">
    <meta name="twitter:title" content="SBNB linux within Ubuntu Ansible Playbook - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/sbnb-ansible-ubuntu/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          SBNB linux within Ubuntu Ansible Playbook
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-05-17T00:00:00+00:00" class="post-date">
          17 May 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-05-18T19:11:11+00:00">
              18 May 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/sbnb-ansible-ubuntu" class="tag">sbnb-ansible-ubuntu</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        23209 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        3074 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-05-17-sbnb-ansible-ubuntu.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-05-17-sbnb-ansible-ubuntu.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#ansible-playbook-yml">ansible playbook yml</a></li></ul>
          <ol>
  <li><strong>Python 3 Installation:</strong> This playbook assumes the target Ubuntu 24.04 machine has Python 3 installed. Ansible is written in Python, and its modules are executed on the managed node (even if it’s <code class="language-plaintext highlighter-rouge">localhost</code>) using the system’s Python interpreter. Ubuntu 24.04 server typically includes Python 3 by default.</li>
  <li><strong>Provided Raw OS Image:</strong> The bootable raw operating system image (e.g., created by mkosi or similar tools) MUST be present at the location specified by <code class="language-plaintext highlighter-rouge">provided_raw_image_path</code> (default: <code class="language-plaintext highlighter-rouge">/root/IncusOS.raw</code>) on the target machine. This image should contain a complete filesystem ready to be booted.</li>
  <li><strong>Provided Incus Metadata Archive:</strong> An Incus metadata archive (typically <code class="language-plaintext highlighter-rouge">metadata.tar.xz</code>) MUST be present at the location specified by <code class="language-plaintext highlighter-rouge">provided_metadata_path</code> (default: <code class="language-plaintext highlighter-rouge">/root/metadata.tar.xz</code>) on the target machine. This file describes the image properties to Incus, such as architecture, creation date, and OS details, which are crucial for <code class="language-plaintext highlighter-rouge">incus image import</code>. (Alternatively, a <code class="language-plaintext highlighter-rouge">metadata.yaml</code> file can sometimes be used, depending on how the image and metadata were originally packaged, though this playbook assumes <code class="language-plaintext highlighter-rouge">metadata.tar.xz</code> as per the original context).</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><section><code><span class="c1"># Incus metadata for SBNB Linux VM Image</span>
<span class="na">architecture</span><span class="pi">:</span> <span class="s2">"</span><span class="s">x86_64"</span>
<span class="na">creation_date</span><span class="pi">:</span> <span class="m">1747850911</span> <span class="c1"># Unix timestamp (seconds since epoch, UTC) for: Sat, 17 May 2025 12:48:31 GMT</span>
<span class="na">expiry_date</span><span class="pi">:</span> <span class="m">0</span> <span class="c1"># 0 means the image does not expire</span>
<span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">virtual-machine"</span> <span class="c1"># Specifies that this image is for a virtual machine</span>

<span class="na">properties</span><span class="pi">:</span>
  <span class="na">os</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBNB</span><span class="nv"> </span><span class="s">Linux"</span>
  <span class="na">distribution</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sbnb-linux"</span> <span class="c1"># Often lowercase version of os property</span>
  <span class="na">release</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20250517"</span> <span class="c1"># Release identifier, YYYYMMDD format is common. Can be "rolling" or a specific version.</span>
  <span class="na">variant</span><span class="pi">:</span> <span class="s2">"</span><span class="s">default"</span>
  <span class="na">architecture</span><span class="pi">:</span> <span class="s2">"</span><span class="s">x86_64"</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sbnb-linux-20250517"</span> <span class="c1"># A descriptive name: os-release-variant</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBNB</span><span class="nv"> </span><span class="s">Linux</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">revolutionary</span><span class="nv"> </span><span class="s">minimalist</span><span class="nv"> </span><span class="s">Linux</span><span class="nv"> </span><span class="s">distribution</span><span class="nv"> </span><span class="s">designed</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">boot</span><span class="nv"> </span><span class="s">bare-metal</span><span class="nv"> </span><span class="s">servers</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">enable</span><span class="nv"> </span><span class="s">remote</span><span class="nv"> </span><span class="s">connections</span><span class="nv"> </span><span class="s">through</span><span class="nv"> </span><span class="s">fast</span><span class="nv"> </span><span class="s">tunnels.</span><span class="nv"> </span><span class="s">It</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">ideal</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">environments</span><span class="nv"> </span><span class="s">ranging</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">home</span><span class="nv"> </span><span class="s">labs</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">distributed</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">centers.</span><span class="nv"> </span><span class="s">SBNB</span><span class="nv"> </span><span class="s">Linux</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">simplified,</span><span class="nv"> </span><span class="s">automated,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">resilient</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">power</span><span class="nv"> </span><span class="s">outages,</span><span class="nv"> </span><span class="s">supporting</span><span class="nv"> </span><span class="s">confidential</span><span class="nv"> </span><span class="s">computing</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ensure</span><span class="nv"> </span><span class="s">secure</span><span class="nv"> </span><span class="s">operations</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">untrusted</span><span class="nv"> </span><span class="s">locations."</span>
  <span class="na">serial</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span> <span class="c1"># Incus will populate this</span>
  <span class="na">requirements.secureboot</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span> <span class="c1"># SBNB Linux's build.yml makes sbnb.efi, implies UEFI. Assume no explicit Secure Boot support.</span>
  <span class="na">requirements.csm</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span> <span class="c1"># UEFI is expected.</span>

<span class="c1"># For VM images, the 'templates' section is typically not used for guest file templating</span>
<span class="c1"># as it is for containers. It can be omitted or left empty.</span>
<span class="na">templates</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="c1"># The 'files' section lists files from the metadata archive itself that Incus processes.</span>
<span class="c1"># For basic VM images, this is usually empty.</span>
<span class="na">files</span><span class="pi">:</span> <span class="pi">[]</span>
</code></section></div></div>
  <h1 id="ansible-playbook-yml">
    
    
     <a href="#ansible-playbook-yml">#</a><a href="#" aria-label="Back to top">ansible playbook yml</a>
        
    
  </h1>
      

<section class="code-block-container" role="group" aria-label="Yaml Code Block" data-filename="yaml_code_block.yaml" data-code="- name: Setup Incus and Start VM from Provided Image
  hosts: localhost * Designed to be run directly on the target bare-metal Ubuntu 24.04.
                   * Change to your specific host or group name if targeting remote machines.
  connection: local * Uses the local connection plugin as we are targeting the machine Ansible is run on.
                    * Change to ‘ssh’ if connecting to remote hosts.
  become: yes * Most tasks require elevated (sudo) privileges for system-level changes like package
              * installation, Incus setup, and managing files in /root.
  vars:
    * Path on the target machine where the pre-existing raw OS image is located.
    * The /root/ path is used as an example assuming the image is placed there with root ownership.
    * Adjust if your image is located elsewhere and ensure appropriate read permissions for Ansible.
    provided_raw_image_path: “/root/IncusOS.raw”

    * Path on the target machine where the Incus metadata archive (e.g., metadata.tar.xz) is located.
    * This file is required by `incus image import` to understand the properties of the image.
    provided_metadata_path: “/root/metadata.tar.xz”

    * Temporary path where the .raw image will be converted to .qcow2 format before import.
    * This path should be writable by the user/process performing the qemu-img conversion.
    * Using /root/ here as other critical files are also assumed to be there.
    converted_qcow2_image_path: “/root/os-image.qcow2”

  tasks:
    - name: Check if provided IncusOS.raw image exists on target
      ansible.builtin.stat:
        path: “”
      register: raw_image_stat * Registers the result of the stat command into this variable.

    - name: Fail if IncusOS.raw image does not exist
      ansible.builtin.fail:
        msg: “Prerequisite failed: The raw image  does not exist on the target machine! Please ensure it is present before running this playbook.”
      when: not raw_image_stat.stat.exists * Fails if the ‘exists’ attribute from stat is false.

    - name: Check if provided metadata.tar.xz exists on target
      ansible.builtin.stat:
        path: “”
      register: metadata_stat

    - name: Fail if metadata.tar.xz does not exist
      ansible.builtin.fail:
        msg: “Prerequisite failed: The metadata archive  does not exist on the target machine! This is required for Incus image import.”
      when: not metadata_stat.stat.exists

    - name: Install essential system dependencies for Incus and image management
      ansible.builtin.apt:
        name:
          * binutils: Provides a collection of binary tools, including ‘ar’, ‘nm’, ‘objdump’, etc.
          *           While not directly used by every step here, it’s a common foundational package.
          - binutils
          * debian-archive-keyring: Contains GPG keys for verifying Debian/Ubuntu archive signatures.
          *                         Ensures authenticity of packages downloaded by apt.
          - debian-archive-keyring
          * qemu-utils: Provides the ‘qemu-img’ utility, which is essential for converting disk image
          *             formats (e.g., from .raw to .qcow2).
          - qemu-utils
          * Note: Incus itself, when installed via the Zabbly script, will pull in its own direct
          * dependencies such as liblxc, bridge-utils, etc.
        state: present * Ensures these packages are installed.
        update_cache: true * Runs ‘apt-get update’ before attempting to install packages.

    - name: Setup Incus (Install and Initialize)
      block: * Groups related tasks for better organization and error handling if needed.
        - name: Check if Incus command is already available
          ansible.builtin.command: incus —version
          register: incus_check * Stores the command’s output, including return code (rc).
          changed_when: false * This task doesn’t change system state, it’s a check.
          failed_when: false * Do not fail the playbook if incus is not found; we’ll install it.

        - name: Download and run Incus installation script (if Incus not found)
          ansible.builtin.shell: * Using shell module for commands involving pipes.
            * This command downloads the Zabbly script for Incus daily builds and executes it with sudo bash.
            * The Zabbly script typically adds a PPA/repository and installs the Incus package.
            cmd: “curl -s https://pkgs.zabbly.com/get/incus-daily | sudo bash”
            warn: false * Suppresses Ansible warnings about using shell for commands like curl.
          when: incus_check.rc != 0 * Only execute if the ‘incus —version’ command failed (rc != 0).

        - name: Check if Incus has been initialized
          ansible.builtin.command: incus profile show default
          * A successfully initialized Incus instance will have a ‘default’ profile.
          * If this command fails, it’s a strong indicator that `incus admin init` hasn’t completed.
          register: incus_init_check_before * Register before potential init
          changed_when: false
          failed_when: false * Don’t fail; use rc to decide if init is needed.

        - name: Initialize Incus daemon using auto configuration (if not already initialized)
          ansible.builtin.command: incus admin init —auto
          * The ‘—auto’ flag configures Incus with sensible defaults. This typically includes:
          * - A default storage pool (e.g., ZFS on a loop device if zfsutils-linux is installed,
          *   or a directory-based pool at /var/lib/incus/storage-pools/default otherwise).
          * - A default network bridge (e.g., `incusbr0`) providing NATed internet access to instances.
          * - Sets up the server for immediate use. For more granular control over storage or networking,
          *   `incus admin init` can be run interactively.
          when: incus_init_check_before.rc != 0 * Only run if the ‘incus profile show default’ command failed.
          changed_when: true * This command inherently changes system state if it runs the initialization.

        - name: Check if Incus socket exists after potential initialization
          ansible.builtin.stat:
            path: /var/lib/incus/unix.socket
          register: incus_socket_stat_after_init

        - name: Ensure Incus socket has 0666 permissions (replicating GHA behavior)
          ansible.builtin.file:
            path: /var/lib/incus/unix.socket
            mode: ‘0666’ * Sets read/write for owner, group, and others.
          * This task runs with ‘become: yes’ due to the play-level setting.
          * The original GHA workflow used ‘sudo chmod 666’.
          * Note: While `0666` permissions replicate the original workflow’s behavior, this is highly
          * permissive. In production environments, it’s strongly recommended to manage access to the
          * Incus socket via group membership (e.g., adding trusted users to the `incus` or `incus-admin`
          * group, which `incus admin init` might help configure or which can be done manually)
          * rather than world-writable permissions.
          when: incus_socket_stat_after_init.stat.exists and (incus_socket_stat_after_init.stat.issock or incus_socket_stat_after_init.stat.islnk)
          * The condition ensures the chmod is only attempted if the socket (or a symlink to it) exists.

    - name: Prepare and Import Provided Incus Image
      block:
        - name: Convert provided .raw image to .qcow2 format
          ansible.builtin.command:
            * qemu-img convert: Utility to convert disk images between formats.
            * -f raw: Specifies the source image format is raw.
            * -O qcow2: Specifies the output image format is QCOW2 (QEMU Copy On Write 2).
            * QCOW2 is a common format for VMs, supporting features like snapshots, thin provisioning,
            * and potentially better performance for some workloads compared to raw images.
            cmd: “qemu-img convert -f raw -O qcow2  ”
          changed_when: true * This command creates or overwrites the output qcow2 file.

        - name: Import converted qcow2 image into Incus
          ansible.builtin.command:
            * incus image import: Command to import an image into the Incus image store.
            * —alias incus-os: Assigns an alias ‘incus-os’ to the imported image for easy reference later.
            * : Path to the metadata archive (e.g., metadata.tar.xz).
            * : Path to the root filesystem image (now in qcow2 format).
            * If an image with the same alias or fingerprint already exists, this command might error
            * or behave differently based on Incus version. This playbook assumes a fresh import.
            cmd: “incus image import —alias incus-os  ”
          changed_when: true * This command adds a new image to the Incus store.

    - name: Create and Start Incus Virtual Machine
      block:
        - name: Create Incus VM ‘test-incus-os’ from the imported image
          ansible.builtin.command:
            cmd: &gt;
              incus create —quiet —vm incus-os test-incus-os
              -c security.secureboot=false
              -c limits.cpu=2
              -c limits.memory=2GiB
              -d root,size=50GiB
            * —quiet: Suppresses progress output.
            * —vm: Specifies that a virtual machine (not a container) should be created.
            * incus-os: Alias of the image to use (imported in the previous step).
            * test-incus-os: Name for the new VM instance.
            * Configuration options (-c key=value):
            *   security.secureboot=false: Disables Secure Boot for the VM. This is often necessary for
            *                            custom-built or generic images that may not have signed bootloaders
            *                            compatible with the host’s Secure Boot validation.
            *   limits.cpu=2: Allocates a maximum of 2 CPU cores to the VM.
            *   limits.memory=2GiB: Allocates 2 GiB of RAM to the VM.
            * Device options (-d device,properties):
            *   root,size=50GiB: Configures the root disk device, ensuring it has a size of 50 GiB.
            *                    Incus will typically expand the image’s filesystem to fill this size.
          changed_when: true * This command creates a new VM instance.

        - name: Add virtual TPM (Trusted Platform Module) device to ‘test-incus-os’
          ansible.builtin.command:
            cmd: incus config device add test-incus-os vtpm tpm
            * This adds a software-emulated TPM (vTPM) device named ‘vtpm’ of type ‘tpm’ to the VM.
            * A vTPM can be utilized by the guest OS for features like full-disk encryption (e.g., BitLocker, LUKS),
            * measured boot, or other security functionalities that rely on a TPM.
          changed_when: true * This command modifies the VM’s configuration.

        - name: Start the ‘test-incus-os’ VM
          ansible.builtin.command:
            cmd: incus start test-incus-os
          changed_when: true * This command changes the state of the VM to running.

        - name: Wait for the VM to become responsive
          ansible.builtin.command:
            * incus exec &lt;vm_name&gt; — &lt;command&gt;: Executes a command inside the specified VM.
            * /usr/bin/true: A simple command that does nothing and exits with status 0 if successful.
            * This is a common and lightweight way to check if the VM’s OS has booted sufficiently
            * to allow command execution via Incus.
            cmd: incus exec test-incus-os — /usr/bin/true
          register: vm_status * Stores the result of the command.
          until: vm_status.rc == 0 * Loop until the command executes successfully (return code 0).
          retries: 20 * Maximum number of retries.
          delay: 3 * Wait 3 seconds between retries (total wait time up to 60 seconds).
          changed_when: false * This task only checks status, doesn’t change system state.

        - name: Additional pause (1 minute) as per original workflow logic
          ansible.builtin.pause:
            minutes: 1
            * This pause might have been included in the original workflow to allow services
            * or applications inside the newly started VM to fully initialize before proceeding
            * with further tests or operations that might depend on those internal services.
          when: vm_status.rc == 0 * Only pause if the VM became responsive.

        - name: List Incus instances for final verification
          ansible.builtin.command: incus list
          register: incus_list_output
          changed_when: false

        - name: Display current Incus instances
          ansible.builtin.debug:
            var: incus_list_output.stdout_lines * Shows the standard output of ‘incus list’.

    - name: Cleanup temporary qcow2 image (optional step)
      ansible.builtin.file:
        path: “”
        state: absent * Ensures the file is removed.
      * This step is useful to free up disk space if the converted qcow2 image is no longer needed
      * after being imported into Incus’s storage pool (Incus makes its own copy).
      when: true * Set to ‘false’ or remove this task if you want to keep the qcow2 image for debugging.
      tags:
        - cleanup * Allows skipping this task with —skip-tags cleanup or running only it with —tags cleanup." data-download-link="" data-download-label="Download Yaml">
  <code class="language-yaml">- name: Setup Incus and Start VM from Provided Image
  hosts: localhost * Designed to be run directly on the target bare-metal Ubuntu 24.04.
                   * Change to your specific host or group name if targeting remote machines.
  connection: local * Uses the local connection plugin as we are targeting the machine Ansible is run on.
                    * Change to ‘ssh’ if connecting to remote hosts.
  become: yes * Most tasks require elevated (sudo) privileges for system-level changes like package
              * installation, Incus setup, and managing files in /root.
  vars:
    * Path on the target machine where the pre-existing raw OS image is located.
    * The /root/ path is used as an example assuming the image is placed there with root ownership.
    * Adjust if your image is located elsewhere and ensure appropriate read permissions for Ansible.
    provided_raw_image_path: “/root/IncusOS.raw”

    * Path on the target machine where the Incus metadata archive (e.g., metadata.tar.xz) is located.
    * This file is required by `incus image import` to understand the properties of the image.
    provided_metadata_path: “/root/metadata.tar.xz”

    * Temporary path where the .raw image will be converted to .qcow2 format before import.
    * This path should be writable by the user/process performing the qemu-img conversion.
    * Using /root/ here as other critical files are also assumed to be there.
    converted_qcow2_image_path: “/root/os-image.qcow2”

  tasks:
    - name: Check if provided IncusOS.raw image exists on target
      ansible.builtin.stat:
        path: “”
      register: raw_image_stat * Registers the result of the stat command into this variable.

    - name: Fail if IncusOS.raw image does not exist
      ansible.builtin.fail:
        msg: “Prerequisite failed: The raw image  does not exist on the target machine! Please ensure it is present before running this playbook.”
      when: not raw_image_stat.stat.exists * Fails if the ‘exists’ attribute from stat is false.

    - name: Check if provided metadata.tar.xz exists on target
      ansible.builtin.stat:
        path: “”
      register: metadata_stat

    - name: Fail if metadata.tar.xz does not exist
      ansible.builtin.fail:
        msg: “Prerequisite failed: The metadata archive  does not exist on the target machine! This is required for Incus image import.”
      when: not metadata_stat.stat.exists

    - name: Install essential system dependencies for Incus and image management
      ansible.builtin.apt:
        name:
          * binutils: Provides a collection of binary tools, including ‘ar’, ‘nm’, ‘objdump’, etc.
          *           While not directly used by every step here, it’s a common foundational package.
          - binutils
          * debian-archive-keyring: Contains GPG keys for verifying Debian/Ubuntu archive signatures.
          *                         Ensures authenticity of packages downloaded by apt.
          - debian-archive-keyring
          * qemu-utils: Provides the ‘qemu-img’ utility, which is essential for converting disk image
          *             formats (e.g., from .raw to .qcow2).
          - qemu-utils
          * Note: Incus itself, when installed via the Zabbly script, will pull in its own direct
          * dependencies such as liblxc, bridge-utils, etc.
        state: present * Ensures these packages are installed.
        update_cache: true * Runs ‘apt-get update’ before attempting to install packages.

    - name: Setup Incus (Install and Initialize)
      block: * Groups related tasks for better organization and error handling if needed.
        - name: Check if Incus command is already available
          ansible.builtin.command: incus —version
          register: incus_check * Stores the command’s output, including return code (rc).
          changed_when: false * This task doesn’t change system state, it’s a check.
          failed_when: false * Do not fail the playbook if incus is not found; we’ll install it.

        - name: Download and run Incus installation script (if Incus not found)
          ansible.builtin.shell: * Using shell module for commands involving pipes.
            * This command downloads the Zabbly script for Incus daily builds and executes it with sudo bash.
            * The Zabbly script typically adds a PPA/repository and installs the Incus package.
            cmd: “curl -s https://pkgs.zabbly.com/get/incus-daily | sudo bash”
            warn: false * Suppresses Ansible warnings about using shell for commands like curl.
          when: incus_check.rc != 0 * Only execute if the ‘incus —version’ command failed (rc != 0).

        - name: Check if Incus has been initialized
          ansible.builtin.command: incus profile show default
          * A successfully initialized Incus instance will have a ‘default’ profile.
          * If this command fails, it’s a strong indicator that `incus admin init` hasn’t completed.
          register: incus_init_check_before * Register before potential init
          changed_when: false
          failed_when: false * Don’t fail; use rc to decide if init is needed.

        - name: Initialize Incus daemon using auto configuration (if not already initialized)
          ansible.builtin.command: incus admin init —auto
          * The ‘—auto’ flag configures Incus with sensible defaults. This typically includes:
          * - A default storage pool (e.g., ZFS on a loop device if zfsutils-linux is installed,
          *   or a directory-based pool at /var/lib/incus/storage-pools/default otherwise).
          * - A default network bridge (e.g., `incusbr0`) providing NATed internet access to instances.
          * - Sets up the server for immediate use. For more granular control over storage or networking,
          *   `incus admin init` can be run interactively.
          when: incus_init_check_before.rc != 0 * Only run if the ‘incus profile show default’ command failed.
          changed_when: true * This command inherently changes system state if it runs the initialization.

        - name: Check if Incus socket exists after potential initialization
          ansible.builtin.stat:
            path: /var/lib/incus/unix.socket
          register: incus_socket_stat_after_init

        - name: Ensure Incus socket has 0666 permissions (replicating GHA behavior)
          ansible.builtin.file:
            path: /var/lib/incus/unix.socket
            mode: ‘0666’ * Sets read/write for owner, group, and others.
          * This task runs with ‘become: yes’ due to the play-level setting.
          * The original GHA workflow used ‘sudo chmod 666’.
          * Note: While `0666` permissions replicate the original workflow’s behavior, this is highly
          * permissive. In production environments, it’s strongly recommended to manage access to the
          * Incus socket via group membership (e.g., adding trusted users to the `incus` or `incus-admin`
          * group, which `incus admin init` might help configure or which can be done manually)
          * rather than world-writable permissions.
          when: incus_socket_stat_after_init.stat.exists and (incus_socket_stat_after_init.stat.issock or incus_socket_stat_after_init.stat.islnk)
          * The condition ensures the chmod is only attempted if the socket (or a symlink to it) exists.

    - name: Prepare and Import Provided Incus Image
      block:
        - name: Convert provided .raw image to .qcow2 format
          ansible.builtin.command:
            * qemu-img convert: Utility to convert disk images between formats.
            * -f raw: Specifies the source image format is raw.
            * -O qcow2: Specifies the output image format is QCOW2 (QEMU Copy On Write 2).
            * QCOW2 is a common format for VMs, supporting features like snapshots, thin provisioning,
            * and potentially better performance for some workloads compared to raw images.
            cmd: “qemu-img convert -f raw -O qcow2  ”
          changed_when: true * This command creates or overwrites the output qcow2 file.

        - name: Import converted qcow2 image into Incus
          ansible.builtin.command:
            * incus image import: Command to import an image into the Incus image store.
            * —alias incus-os: Assigns an alias ‘incus-os’ to the imported image for easy reference later.
            * : Path to the metadata archive (e.g., metadata.tar.xz).
            * : Path to the root filesystem image (now in qcow2 format).
            * If an image with the same alias or fingerprint already exists, this command might error
            * or behave differently based on Incus version. This playbook assumes a fresh import.
            cmd: “incus image import —alias incus-os  ”
          changed_when: true * This command adds a new image to the Incus store.

    - name: Create and Start Incus Virtual Machine
      block:
        - name: Create Incus VM ‘test-incus-os’ from the imported image
          ansible.builtin.command:
            cmd: &gt;
              incus create —quiet —vm incus-os test-incus-os
              -c security.secureboot=false
              -c limits.cpu=2
              -c limits.memory=2GiB
              -d root,size=50GiB
            * —quiet: Suppresses progress output.
            * —vm: Specifies that a virtual machine (not a container) should be created.
            * incus-os: Alias of the image to use (imported in the previous step).
            * test-incus-os: Name for the new VM instance.
            * Configuration options (-c key=value):
            *   security.secureboot=false: Disables Secure Boot for the VM. This is often necessary for
            *                            custom-built or generic images that may not have signed bootloaders
            *                            compatible with the host’s Secure Boot validation.
            *   limits.cpu=2: Allocates a maximum of 2 CPU cores to the VM.
            *   limits.memory=2GiB: Allocates 2 GiB of RAM to the VM.
            * Device options (-d device,properties):
            *   root,size=50GiB: Configures the root disk device, ensuring it has a size of 50 GiB.
            *                    Incus will typically expand the image’s filesystem to fill this size.
          changed_when: true * This command creates a new VM instance.

        - name: Add virtual TPM (Trusted Platform Module) device to ‘test-incus-os’
          ansible.builtin.command:
            cmd: incus config device add test-incus-os vtpm tpm
            * This adds a software-emulated TPM (vTPM) device named ‘vtpm’ of type ‘tpm’ to the VM.
            * A vTPM can be utilized by the guest OS for features like full-disk encryption (e.g., BitLocker, LUKS),
            * measured boot, or other security functionalities that rely on a TPM.
          changed_when: true * This command modifies the VM’s configuration.

        - name: Start the ‘test-incus-os’ VM
          ansible.builtin.command:
            cmd: incus start test-incus-os
          changed_when: true * This command changes the state of the VM to running.

        - name: Wait for the VM to become responsive
          ansible.builtin.command:
            * incus exec &lt;vm_name&gt; — &lt;command&gt;: Executes a command inside the specified VM.
            * /usr/bin/true: A simple command that does nothing and exits with status 0 if successful.
            * This is a common and lightweight way to check if the VM’s OS has booted sufficiently
            * to allow command execution via Incus.
            cmd: incus exec test-incus-os — /usr/bin/true
          register: vm_status * Stores the result of the command.
          until: vm_status.rc == 0 * Loop until the command executes successfully (return code 0).
          retries: 20 * Maximum number of retries.
          delay: 3 * Wait 3 seconds between retries (total wait time up to 60 seconds).
          changed_when: false * This task only checks status, doesn’t change system state.

        - name: Additional pause (1 minute) as per original workflow logic
          ansible.builtin.pause:
            minutes: 1
            * This pause might have been included in the original workflow to allow services
            * or applications inside the newly started VM to fully initialize before proceeding
            * with further tests or operations that might depend on those internal services.
          when: vm_status.rc == 0 * Only pause if the VM became responsive.

        - name: List Incus instances for final verification
          ansible.builtin.command: incus list
          register: incus_list_output
          changed_when: false

        - name: Display current Incus instances
          ansible.builtin.debug:
            var: incus_list_output.stdout_lines * Shows the standard output of ‘incus list’.

    - name: Cleanup temporary qcow2 image (optional step)
      ansible.builtin.file:
        path: “”
        state: absent * Ensures the file is removed.
      * This step is useful to free up disk space if the converted qcow2 image is no longer needed
      * after being imported into Incus’s storage pool (Incus makes its own copy).
      when: true * Set to ‘false’ or remove this task if you want to keep the qcow2 image for debugging.
      tags:
        - cleanup * Allows skipping this task with —skip-tags cleanup or running only it with —tags cleanup.</code>
</section>

<p><strong>Explanation of How to Use (Expanded):</strong></p>

<ol>
  <li>
    <p><strong>Save the Playbook:</strong> Save the content above into a file named, for example, <code class="language-plaintext highlighter-rouge">setup_incus_from_provided_image.yml</code> on the machine you’ll use to run Ansible (this could be the target Ubuntu 24.04 machine itself if <code class="language-plaintext highlighter-rouge">connection: local</code>).</p>
  </li>
  <li><strong>Prepare Prerequisites on the Target Ubuntu 24.04 Machine:</strong>
    <ul>
      <li><strong>Python 3:</strong> Ensure Python 3 is installed. For Ubuntu 24.04 Server, it’s typically present. You can check with <code class="language-plaintext highlighter-rouge">python3 —version</code>. If missing (unlikely for a server OS), install it: <code class="language-plaintext highlighter-rouge">sudo apt update &amp;&amp; sudo apt install python3</code>.</li>
      <li><strong>Raw OS Image:</strong> Place your bootable raw OS image (e.g., <code class="language-plaintext highlighter-rouge">IncusOS.raw</code>) at the exact path specified in the <code class="language-plaintext highlighter-rouge">provided_raw_image_path</code> variable (default: <code class="language-plaintext highlighter-rouge">/root/IncusOS.raw</code>). Ensure this file is readable by the root user (as the playbook uses <code class="language-plaintext highlighter-rouge">become: yes</code>).</li>
      <li><strong>Incus Metadata Archive:</strong> Place the corresponding Incus metadata archive (e.g., <code class="language-plaintext highlighter-rouge">metadata.tar.xz</code> or potentially a <code class="language-plaintext highlighter-rouge">metadata.yaml</code>) at the path specified in <code class="language-plaintext highlighter-rouge">provided_metadata_path</code> (default: <code class="language-plaintext highlighter-rouge">/root/metadata.tar.xz</code>). This file is crucial for Incus to understand the image’s properties.</li>
    </ul>
  </li>
  <li><strong>Install Ansible on the Control Machine (or Target if running locally):</strong>
    <ul>
      <li>If you are running the playbook directly on the target Ubuntu 24.04 machine (using <code class="language-plaintext highlighter-rouge">connection: local</code>), install Ansible on it:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> ansible
</code></section></div>        </div>
      </li>
      <li>If you are running Ansible from a separate control node to manage the Ubuntu 24.04 machine remotely, ensure Ansible is installed on your control node.</li>
    </ul>
  </li>
  <li><strong>Run the Ansible Playbook:</strong>
    <ul>
      <li><strong>Locally on the Target Machine:</strong>
Navigate to the directory where you saved <code class="language-plaintext highlighter-rouge">setup_incus_from_provided_image.yml</code> and run:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>ansible-playbook setup_incus_from_provided_image.yml
</code></section></div>        </div>
        <p>You generally need <code class="language-plaintext highlighter-rouge">sudo</code> when using <code class="language-plaintext highlighter-rouge">connection: local</code> and <code class="language-plaintext highlighter-rouge">become: yes</code> because:
a.  The playbook performs privileged operations (package installs, service management, file operations in <code class="language-plaintext highlighter-rouge">/root</code>).
b.  <code class="language-plaintext highlighter-rouge">connection: local</code> means Ansible uses the privileges of the user executing <code class="language-plaintext highlighter-rouge">ansible-playbook</code>. If that user is not root, <code class="language-plaintext highlighter-rouge">become</code> will attempt to use <code class="language-plaintext highlighter-rouge">sudo</code> to elevate privileges.
If your regular user has passwordless <code class="language-plaintext highlighter-rouge">sudo</code> configured for all necessary commands, you might be able to run it without the <code class="language-plaintext highlighter-rouge">sudo</code> prefix, and Ansible’s <code class="language-plaintext highlighter-rouge">become</code> mechanism will handle the elevation.</p>
      </li>
      <li><strong>From a Remote Ansible Control Node:</strong>
If you’ve configured <code class="language-plaintext highlighter-rouge">hosts</code> in the playbook to point to your remote Ubuntu 24.04 machine (e.g., <code class="language-plaintext highlighter-rouge">myubuntuserver</code>) and have an Ansible inventory file (<code class="language-plaintext highlighter-rouge">your_inventory_file</code>) set up with SSH access to the target:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>ansible-playbook <span class="nt">-i</span> your_inventory_file setup_incus_from_provided_image.yml
</code></section></div>        </div>
        <p>Ensure the user specified in your inventory for the target host (e.g., <code class="language-plaintext highlighter-rouge">ansible_user=your_ssh_user</code>) has <code class="language-plaintext highlighter-rouge">sudo</code> privileges, as <code class="language-plaintext highlighter-rouge">become: yes</code> will be used on the remote host.</p>
      </li>
    </ul>
  </li>
  <li><strong>Useful Ansible Playbook Flags:</strong>
    <ul>
      <li><strong>Dry Run (Check Mode):</strong> To see what changes Ansible <em>would</em> make without actually executing them. This is highly recommended before running a new playbook for the first time.
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>ansible-playbook setup_incus_from_provided_image.yml —check
</code></section></div>        </div>
      </li>
      <li><strong>Show Differences:</strong> To see the exact changes that would be made to files (useful with or without <code class="language-plaintext highlighter-rouge">—check</code>). This helps understand what content is being modified.
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>ansible-playbook setup_incus_from_provided_image.yml —diff
</code></section></div>        </div>
      </li>
      <li><strong>Verbosity:</strong> Increase verbosity for more detailed output, which can be helpful for troubleshooting (e.g., <code class="language-plaintext highlighter-rouge">-v</code> for basic, <code class="language-plaintext highlighter-rouge">-vv</code> for more detail, <code class="language-plaintext highlighter-rouge">-vvv</code> for connection debug, <code class="language-plaintext highlighter-rouge">-vvvv</code> for even more).
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>ansible-playbook setup_incus_from_provided_image.yml <span class="nt">-vv</span>
</code></section></div>        </div>
      </li>
      <li><strong>Tags:</strong> To run or skip specific parts of the playbook. For example, to skip the cleanup task:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>ansible-playbook setup_incus_from_provided_image.yml —skip-tags cleanup
</code></section></div>        </div>
        <p>Or to run <em>only</em> the cleanup task (assuming other tasks have completed successfully before):</p>
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>ansible-playbook setup_incus_from_provided_image.yml —tags cleanup
</code></section></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Troubleshooting Incus:</strong>
    <ul>
      <li>If you encounter issues with Incus services not starting correctly or VM misbehavior, checking the Incus daemon logs is a good first step:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="nb">sudo </span>journalctl <span class="nt">-u</span> incus.service <span class="nt">-n</span> 100 —no-pager
</code></section></div>        </div>
      </li>
      <li>For issues specific to an instance after it’s created:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>incus info test-incus-os —show-log
</code></section></div>        </div>
      </li>
      <li>You can also try to access the console of the VM:
        <div class="language-bash highlighter-rouge"><div class="highlight"><section><code>incus console test-incus-os —type<span class="o">=</span>pty
</code></section></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<p><strong>Summary of Key Changes and Simplifications (Expanded):</strong></p>

<ul>
  <li><strong>No Build Process:</strong> The most significant characteristic of this playbook is the complete removal of tasks related to source code checkout (Git), Go language setup, <code class="language-plaintext highlighter-rouge">pipx</code> and <code class="language-plaintext highlighter-rouge">mkosi</code> installation, and the <code class="language-plaintext highlighter-rouge">make</code> command for building the OS image. This is because the core assumption now is that <code class="language-plaintext highlighter-rouge">IncusOS.raw</code> is pre-built and provided directly on the target system.</li>
  <li><strong>Direct Image Usage:</strong> The playbook now directly consumes the user-provided <code class="language-plaintext highlighter-rouge">/root/IncusOS.raw</code> and an associated <code class="language-plaintext highlighter-rouge">/root/metadata.tar.xz</code> (or <code class="language-plaintext highlighter-rouge">metadata.yaml</code> if adapted). This makes the playbook much simpler if an image generation pipeline already exists separately.</li>
  <li><strong>Simplified Dependencies:</strong> The list of system packages installed via <code class="language-plaintext highlighter-rouge">apt</code> is reduced to only those essential for image conversion (<code class="language-plaintext highlighter-rouge">qemu-utils</code>) and general system health/repository access (<code class="language-plaintext highlighter-rouge">binutils</code>, <code class="language-plaintext highlighter-rouge">debian-archive-keyring</code>), as Incus’s own installation script (from Zabbly) handles its specific dependencies like <code class="language-plaintext highlighter-rouge">liblxc1</code>, <code class="language-plaintext highlighter-rouge">squashfs-tools</code>, etc.</li>
  <li><strong>Focus on Incus Setup and VM Lifecycle:</strong> The playbook’s primary operational focus shifts to robustly installing and initializing Incus, converting the provided raw image to the <code class="language-plaintext highlighter-rouge">qcow2</code> format (which offers benefits like thin provisioning and snapshot capabilities), importing this image into the Incus image store with a clear alias, and then proceeding with VM creation, specific configuration (like adding a vTPM for enhanced guest security), startup, and responsiveness checks.</li>
  <li><strong>Prerequisite Validation:</strong> Explicit <code class="language-plaintext highlighter-rouge">ansible.builtin.stat</code> tasks are included at the beginning to verify the existence of the crucial <code class="language-plaintext highlighter-rouge">IncusOS.raw</code> and <code class="language-plaintext highlighter-rouge">metadata.tar.xz</code> files. The playbook will fail early with a clear message if these prerequisites are not met, which significantly improves usability and aids in rapid error diagnosis.</li>
  <li><strong>Variable Simplification:</strong> The <code class="language-plaintext highlighter-rouge">vars</code> section is streamlined, primarily defining the paths to the pre-existing image and metadata files, making it easy for the user to configure these critical inputs.</li>
  <li><strong>Optional Cleanup:</strong> A tagged task for cleaning up the intermediate <code class="language-plaintext highlighter-rouge">os-image.qcow2</code> file is included. This is good practice as Incus makes its own copy of the image in its storage pool, so the temporary qcow2 file may no longer be needed and can be removed to save disk space. The use of tags gives the user fine-grained control over this step.</li>
</ul>

        </div>
        
          URL: https://ib.bsb.br/sbnb-ansible-ubuntu
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/czkawka-dedup-workflow/" title="czkawka dedup workflow" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/testdiskphotorec-to-recover-partitionsfiles/" title="TestDisk/PhotoRec to Recover Partitions/Files" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/testdiskphotorec-to-recover-partitionsfiles/" title="TestDisk/PhotoRec to Recover Partitions/Files" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/czkawka-dedup-workflow/" title="czkawka dedup workflow" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-07-08 13:45:17
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/sbnb-ansible-ubuntu/"
        },
        "headline": "SBNB linux within Ubuntu Ansible Playbook",
        "description": "",
        "datePublished": "2025-05-17T00:00:00+00:00",
        "dateModified": "2025-05-18T19:11:11+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
