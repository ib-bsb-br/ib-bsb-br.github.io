<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        Requirements for sysprep.bat on Windows (Server 2003 + Win11) - infoBAG
      
    </title>
    <meta name="title" content="Requirements for sysprep.bat on Windows (Server 2003 + Win11) - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/sysprep/">
    <meta property="og:title" content="Requirements for sysprep.bat on Windows (Server 2003 + Win11) - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/sysprep/">
    <meta name="twitter:title" content="Requirements for sysprep.bat on Windows (Server 2003 + Win11) - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/sysprep/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="aid&gt;software&gt;windows">
      
        <meta property="article:tag" content="aid&gt;software&gt;windows">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          Requirements for sysprep.bat on Windows (Server 2003 + Win11)
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-04-16T00:00:00+00:00" class="post-date">
          16 Apr 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-04-17T18:02:07+00:00">
              17 Apr 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/sysprep" class="tag">sysprep</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#aid-software-windows" class="tag">aid>software>windows</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        63272 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        8219 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-04-16-sysprep.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-04-16-sysprep.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#server-2003">Server 2003</a><ul><li><a href="#sysprepbat">sysprep.bat</a><ul><li><a href="#1-sysinternals-sync-syncexe"><strong>1. Sysinternals Sync (sync.exe)</strong></a></li><li><a href="#2-driver-scanner-spdrvscnexe"><strong>2. Driver Scanner (spdrvscn.exe)</strong></a></li><li><a href="#3-kill-process-utility-killexe"><strong>3. Kill Process Utility (kill.exe)</strong></a></li><li><a href="#4-system-preparation-tool-sysprepexe"><strong>4. System Preparation Tool (sysprep.exe)</strong></a></li><li><a href="#5-directory-structure-csysprepdrivers"><strong>5. Directory Structure (C:\Sysprep\drivers)</strong></a></li></ul></li></ul></li><li><a href="#windows-11">Windows 11</a><ul><li><a href="#preparing-a-windows-11-image-using-sysprep-a-modern-guide">Preparing a Windows 11 Image using Sysprep: A Modern Guide</a><ul><li><a href="#requirements-and-considerations-for-windows-11-sysprep">Requirements and Considerations for Windows 11 Sysprep</a></li></ul></li><li><a href="#workflow">Workflow</a><ul><li><a href="#step-1-build-the-reference-machine">Step 1: Build the Reference Machine</a></li><li><a href="#step-2-create-the-unattendxml-answer-file">Step 2: Create the <code class="language-plaintext highlighter-rouge">unattend.xml</code> Answer File</a></li><li><a href="#step-3-inject-drivers-offline-optional-method">Step 3: Inject Drivers Offline (Optional Method)</a></li><li><a href="#step-4-final-customizations-in-audit-mode-recommended">Step 4: Final Customizations in Audit Mode (Recommended)</a></li><li><a href="#step-5-pre-sysprep-cleanup">Step 5: Pre-Sysprep Cleanup</a></li><li><a href="#step-6-execute-sysprep">Step 6: Execute Sysprep</a></li><li><a href="#important-sysprep-limitations-and-considerations">Important: Sysprep Limitations and Considerations</a></li><li><a href="#step-7-capture-the-image">Step 7: Capture the Image</a></li><li><a href="#troubleshooting-common-sysprep-failures">Troubleshooting Common Sysprep Failures</a></li><li><a href="#conclusion-and-next-steps">Conclusion and Next Steps</a></li></ul></li></ul></li></ul>
          <h1 id="server-2003">
    
    
     <a href="#server-2003">#</a><a href="#" aria-label="Back to top">Server 2003</a>
        
    
  </h1>
      
  <h2 id="sysprepbat">
    
    
     <a href="#sysprepbat">#</a><a href="#" aria-label="Back to top">sysprep.bat</a>
        
    
  </h2>
      

<section class="code-block-container" role="group" aria-label="Bat Code Block" data-filename="bat_code_block.txt" data-code="@ECHO OFF
CLS
ECHO System Preparation Tool
ECHO.
ECHO Before continuing please:
ECHO 1. Be sure that the pre-sysprep steps were followed.
ECHO 2. Image the computer previous to this, as the sysprep
ECHO process may fail and this would corrupt the installation
ECHO you have prepared.
ECHO 3. Restart the computer before attempting this so that
ECHO system buffers are cleared.
ECHO 4. Close all open windows before continuing.
ECHO.
pause

ECHO.
ECHO Flushing data to disks (preliminary):
sync -r -e /accepteula

ECHO.
ECHO Cleaning up old driver caches:
del /s /q c:\sysprep\drivers\infcache.1

ECHO.
ECHO Creating driver path (SysPrep Driver Scanner):
spdrvscn /p c:\sysprep\drivers /e inf /d C:\windows\inf /m &quot;Image: ~month/~day/~year&quot; /o &quot;Image created at ~hour:~minute:~second on ~month/~day/~year (~weekday).&quot; /a /s /q

ECHO.
ECHO Closing open SMB connections:
net use * /delete /yes

ECHO.
ECHO Terminating unneeded processes:
kill /f vptray
kill /f ccapp
kill /f explorer
kill /f alg
kill /f ati2evxx
kill /f ccevtmgr
kill /f ccsetmgr
kill /f defwatch
kill /f lucoms~1
kill /f mdm

ECHO.
ECHO Stopping unnessary services:
net stop alerter /yes
net stop wuauserv /yes
net stop browser /yes
net stop cryptsvc /yes
net stop dhcp /yes
net stop mdm /yes
net stop trkwks /yes
net stop protectedstorage /yes
net stop remoteregistry /yes
net stop seclogon /yes
net stop samss /yes
net stop wscsvc /yes
net stop lanmanagerserver /yes
net stop &quot;symantec antivirus&quot; /yes
net stop defwatch /yes
net stop ccevtmgr /yes
net stop sndsrvc /yes
net stop ccpwdsvc /yes
net stop ccsetmgr /yes
net stop sens /yes
net stop srservice /yes
net stop schedule /yes
net stop lmhosts /yes
net stop ups /yes
net stop uphclean /yes
net stop webclient /yes
net stop audiosrv /yes
net stop sharedaccess /yes
net stop msiserver /yes
net stop w32time /yes
net stop wzcsvc /yes
net stop lanmanworkstation /yes
net stop spooler /yes

ECHO.
ECHO Flushing data to disks (finalization):
sync -r -e

ECHO.
ECHO Executing system preparation tool (reseal / minisetup)...
start sysprep -reseal -mini -quiet" data-download-link="" data-download-label="Download Bat">
  <code class="language-bat">@ECHO OFF
CLS
ECHO System Preparation Tool
ECHO.
ECHO Before continuing please:
ECHO 1. Be sure that the pre-sysprep steps were followed.
ECHO 2. Image the computer previous to this, as the sysprep
ECHO process may fail and this would corrupt the installation
ECHO you have prepared.
ECHO 3. Restart the computer before attempting this so that
ECHO system buffers are cleared.
ECHO 4. Close all open windows before continuing.
ECHO.
pause

ECHO.
ECHO Flushing data to disks (preliminary):
sync -r -e /accepteula

ECHO.
ECHO Cleaning up old driver caches:
del /s /q c:\sysprep\drivers\infcache.1

ECHO.
ECHO Creating driver path (SysPrep Driver Scanner):
spdrvscn /p c:\sysprep\drivers /e inf /d C:\windows\inf /m &quot;Image: ~month/~day/~year&quot; /o &quot;Image created at ~hour:~minute:~second on ~month/~day/~year (~weekday).&quot; /a /s /q

ECHO.
ECHO Closing open SMB connections:
net use * /delete /yes

ECHO.
ECHO Terminating unneeded processes:
kill /f vptray
kill /f ccapp
kill /f explorer
kill /f alg
kill /f ati2evxx
kill /f ccevtmgr
kill /f ccsetmgr
kill /f defwatch
kill /f lucoms~1
kill /f mdm

ECHO.
ECHO Stopping unnessary services:
net stop alerter /yes
net stop wuauserv /yes
net stop browser /yes
net stop cryptsvc /yes
net stop dhcp /yes
net stop mdm /yes
net stop trkwks /yes
net stop protectedstorage /yes
net stop remoteregistry /yes
net stop seclogon /yes
net stop samss /yes
net stop wscsvc /yes
net stop lanmanagerserver /yes
net stop &quot;symantec antivirus&quot; /yes
net stop defwatch /yes
net stop ccevtmgr /yes
net stop sndsrvc /yes
net stop ccpwdsvc /yes
net stop ccsetmgr /yes
net stop sens /yes
net stop srservice /yes
net stop schedule /yes
net stop lmhosts /yes
net stop ups /yes
net stop uphclean /yes
net stop webclient /yes
net stop audiosrv /yes
net stop sharedaccess /yes
net stop msiserver /yes
net stop w32time /yes
net stop wzcsvc /yes
net stop lanmanworkstation /yes
net stop spooler /yes

ECHO.
ECHO Flushing data to disks (finalization):
sync -r -e

ECHO.
ECHO Executing system preparation tool (reseal / minisetup)...
start sysprep -reseal -mini -quiet</code>
</section>

<p>To successfully execute the provided sysprep.bat script during a System Preparation (Sysprep) process on Windows Server 2003 Standard R2 x64, specific external software, utilities, and directory structures must be correctly configured and accessible. This document provides a detailed outline of these essential requirements. Sysprep itself is used to generalize a Windows installation, removing unique identifiers like the Security Identifier (SID) and configuring the OS to run an initial setup wizard (Mini-Setup) on the next boot, making the image suitable for deployment onto multiple machines. The process often involves external tools, like those in this script, to ensure data integrity by flushing disk caches, manage device drivers effectively for hardware independence across different target machines, and terminate potentially problematic background processes before sealing the final image. Failing to meet these prerequisites by having missing components or incorrect configurations will likely cause script execution errors, prevent the Sysprep process from completing successfully, or lead to deployment failures and unstable systems on target computers.</p>

<p><strong>Important Note on Privileges:</strong> Executing this script requires Administrator privileges. Many actions performed, such as stopping system services, deleting files in protected locations (implicitly, via infcache.1), potentially placing tools in C:\Windows\System32, and running sysprep.exe itself, necessitate elevated rights. Ensure you are running the script from an administrative command prompt.</p>

<p>Standard Windows commands (ECHO, CLS, pause, del, net, start), which are integral parts of the Windows command-line environment, are assumed to be present in their default system locations (typically C:\Windows\System32) and are therefore not detailed as separate requirements below.</p>
  <h3 id="1-sysinternals-sync-syncexe">
    
    
     <a href="#1-sysinternals-sync-syncexe">#</a><a href="#" aria-label="Back to top"><strong>1. Sysinternals Sync (sync.exe)</strong></a>
        
    
  </h3>
      

<ul>
  <li><strong>Purpose in Script:</strong> The script utilizes sync.exe (sync -r -e /accepteula and sync -r -e) to force the operating system to flush all modified file system data held in memory (cached data) to the physical disk drives. This is a critical step before finalizing system changes or shutting down, especially before the Sysprep reseal operation, as it ensures data consistency and minimizes the risk of data loss or corruption if the system were to shut down unexpectedly. The /accepteula flag is used once to automatically accept the Sysinternals End User License Agreement, preventing the script from pausing for user input. The -r flag ensures it flushes files in subdirectories, and -e attempts to flush and eject removable media.</li>
  <li><strong>Required Software:</strong> The specific executable sync.exe from the widely recognized Microsoft Sysinternals Suite. Using other utilities named ‘sync’ may not provide the same functionality or accept the same command-line arguments.
    <ul>
      <li><em>Acquisition:</em> This tool is typically downloaded directly from the official Microsoft Sysinternals documentation pages or website. For older operating systems like Windows Server 2003, ensure you obtain a version of the tool known to be compatible; archives of older Sysinternals suites may be necessary.</li>
    </ul>
  </li>
  <li><strong>Required Location:</strong> For the script to run sync.exe, the executable must be located where the command processor can find it. This means placing sync.exe either in a directory listed in the system’s PATH environment variable (like C:\Windows\System32) or directly in the same directory where the sysprep.bat script is being executed.</li>
  <li><strong>Common Placement:</strong> Placing sync.exe in C:\Windows\System32 is a frequent practice as it makes the tool available system-wide for various administrative scripts and tasks.</li>
</ul>
  <h3 id="2-driver-scanner-spdrvscnexe">
    
    
     <a href="#2-driver-scanner-spdrvscnexe">#</a><a href="#" aria-label="Back to top"><strong>2. Driver Scanner (spdrvscn.exe)</strong></a>
        
    
  </h3>
      

<ul>
  <li><strong>Purpose in Script:</strong> The command spdrvscn /p c:\sysprep\drivers … strongly suggests this executable performs a specialized role related to device driver management during the Sysprep process. Its function is likely crucial for ensuring the prepared image can boot and correctly install devices when deployed onto potentially diverse hardware configurations. This might involve tasks such as scanning the system for installed drivers, comparing them against a repository, injecting necessary Plug-and-Play (PnP) drivers into the image from the specified path (c:\sysprep\drivers), or perhaps pre-indexing drivers to accelerate PnP detection during Mini-Setup. Effective driver management is fundamental to Sysprep’s goal of hardware independence.</li>
  <li><strong>Required Software:</strong> An executable file specifically named spdrvscn.exe (or whatever tool this command actually invokes).
    <ul>
      <li><em>Note:</em> It is vital to understand that this is <strong>not</strong> a standard component of Windows Server 2003, nor is it part of common toolsets like Sysinternals or the Resource Kit Tools. It most likely represents a third-party utility or, quite possibly, a custom in-house tool developed specifically for the organization’s unique imaging workflow. Crucially, you must identify this <em>exact</em> spdrvscn.exe tool from your organization’s original imaging process and obtain it. Its specific function is unknown based solely on the script; attempting to substitute it with any other tool is impossible without knowing precisely what it does and will likely result in incorrect driver handling, deployment failures, or system instability (e.g., BSODs) on target machines.</li>
    </ul>
  </li>
  <li><strong>Required Location:</strong> Similar to other external tools, spdrvscn.exe must be placed where the script can execute it: either in a directory included within the system’s PATH environment variable or in the same directory from which the sysprep.bat script is being run.</li>
  <li><strong>Common Placement:</strong> Given its specialized nature and connection to Sysprep, it might logically reside within the C:\Sysprep folder structure itself (e.g., in a subfolder like C:\Sysprep\Tools). Alternatively, it could be placed in C:\Windows\System32 or a centrally managed custom tools directory that’s part of the system PATH. The script’s reference to c:\sysprep\drivers might hint that related tools are also kept under C:\Sysprep.</li>
</ul>
  <h3 id="3-kill-process-utility-killexe">
    
    
     <a href="#3-kill-process-utility-killexe">#</a><a href="#" aria-label="Back to top"><strong>3. Kill Process Utility (kill.exe)</strong></a>
        
    
  </h3>
      

<ul>
  <li><strong>Purpose in Script:</strong> The script uses kill.exe (with the /f flag for forceful termination) to stop specific background processes (vptray, ccapp, explorer, etc.) before proceeding with Sysprep. This is important to ensure a clean system state, prevent applications from interfering with the Sysprep operations (which modify many system files and registry settings), remove user-specific application states or running agents, and avoid potential conflicts during the resealing phase. The processes listed appear to include components of Symantec Antivirus (vptray, ccapp, ccevtmgr, ccsetmgr), the Windows shell (explorer), and various system or utility services.</li>
  <li><strong>Required Software:</strong> An executable named kill.exe. While Windows Server 2003 includes the native taskkill.exe command for terminating processes, this script explicitly relies on kill.exe. This specific utility often provided a simpler syntax or slightly different behavior compared to taskkill.
    <ul>
      <li><em>Acquisition:</em> kill.exe was a standard utility included in the freely downloadable Microsoft Windows Server 2003 Resource Kit Tools package. This package contained numerous helpful administrative utilities not included with the base OS.</li>
    </ul>
  </li>
  <li><strong>Required Location:</strong> The kill.exe executable must be found by the command interpreter. Place the file either in a directory that is part of the system’s PATH environment variable or directly in the same directory where the sysprep.bat script resides and is executed.</li>
  <li><strong>Common Placement:</strong> If the full Windows Server 2003 Resource Kit Tools package is installed, its installation directory is typically added to the system PATH automatically, making kill.exe accessible. A common alternative for deploying specific tools is to copy kill.exe directly into the C:\Windows\System32 folder.</li>
</ul>
  <h3 id="4-system-preparation-tool-sysprepexe">
    
    
     <a href="#4-system-preparation-tool-sysprepexe">#</a><a href="#" aria-label="Back to top"><strong>4. System Preparation Tool (sysprep.exe)</strong></a>
        
    
  </h3>
      

<ul>
  <li><strong>Purpose in Script:</strong> This is the core Microsoft utility essential for the entire image preparation process. The command start sysprep -reseal -mini -quiet initiates the final phase. Specifically, -reseal configures the system to run the Mini-Setup wizard (also known as Windows Welcome or OOBE - Out-Of-Box Experience) upon the next boot, clearing system-specific information like the SID. The -mini option specifies that the Mini-Setup wizard should run, allowing for customization during deployment (like setting computer name, joining a domain, etc.). The -quiet flag suppresses any graphical user interface or prompts from Sysprep itself, making it suitable for automated scripting.</li>
  <li><strong>Required Software:</strong> The main sysprep.exe executable and all its necessary supporting files (such as setupcl.exe, factory.exe, and various .inf or .dll files). These components work together; simply having sysprep.exe alone is insufficient. These files are specific to the operating system version, architecture (x64 in this case), and potentially the service pack level. Using mismatched versions can lead to unpredictable failures.
    <ul>
      <li><em>Acquisition:</em> The correct Sysprep files for Windows Server 2003 are typically located within the Deploy.cab compressed archive file found in the \Support\Tools\ directory on the official Windows Server 2003 installation media (CD or ISO). You must extract the <em>entire contents</em> of Deploy.cab to the designated Sysprep location using a tool capable of handling CAB archives (like expand.exe or built-in Windows functionality).</li>
    </ul>
  </li>
  <li><strong>Required Location:</strong> Sysprep files must be placed precisely where the operating system and the start sysprep command expect to find them. While Sysprep <em>might</em> be found if placed in the system PATH, this is not the standard or recommended practice for Windows Server 2003.</li>
  <li><strong>Standard Location:</strong> For Windows Server 2003, the universally accepted and expected location is the C:\Sysprep folder at the root of the system drive. You should manually create this folder if it doesn’t exist and then extract all files from the Deploy.cab archive directly into C:\Sysprep.</li>
</ul>
  <h3 id="5-directory-structure-csysprepdrivers">
    
    
     <a href="#5-directory-structure-csysprepdrivers">#</a><a href="#" aria-label="Back to top"><strong>5. Directory Structure (C:\Sysprep\drivers)</strong></a>
        
    
  </h3>
      

<ul>
  <li><strong>Purpose in Script:</strong> The script explicitly interacts with this directory in two ways: first, by deleting c:\sysprep\drivers\infcache.1, and second, by passing the path c:\sysprep\drivers as a parameter to spdrvscn.exe. The deletion of infcache.1 (a file Windows uses to cache information about discovered INF files) is likely intended to force a complete rebuild of the driver cache during Mini-Setup, ensuring that only explicitly provided or newly detected drivers are considered, rather than relying on potentially outdated cached information. The spdrvscn.exe tool, as discussed, likely uses this directory either as a source repository from which to inject necessary drivers into the image or as a target location to store information about the drivers it has processed for use during deployment.</li>
  <li><strong>Required:</strong> The directory path C:\Sysprep\drivers must physically exist on the file system <em>before</em> the sysprep.bat script is executed. If the directory is missing, the del command might simply report an error, but the spdrvscn.exe tool would likely fail catastrophically if it expects to read from or write to this specific location. The contents required within this directory depend entirely on the function of the custom spdrvscn.exe tool.</li>
</ul>

<p>Note on Services:<br />
The script includes a lengthy section dedicated to stopping numerous Windows services using net stop. Examples include security software (symantec antivirus, defwatch), Windows Update (wuauserv), networking services (dhcp, lanmanserver, lanmanworkstation), and various others. While the script attempts to stop these, their actual presence on the system isn’t strictly required for the net stop command itself to run (it will simply report an error like “The service name is invalid” or “The service has not been started” if the service doesn’t exist or isn’t running). However, the explicit inclusion of these commands strongly implies that the script was carefully crafted for a specific baseline system configuration where these services were typically installed and running. Stopping them is considered best practice before Sysprep to prevent interference with the generalization process (e.g., AV scanning/blocking file changes, Windows Update trying to install updates, DHCP client renewing leases during cloning, remote registry service allowing unwanted access). Failure to stop necessary services, especially those performing background file modifications or network communications, could compromise the integrity and stability of the sealed image.<br />
<strong>Verification Note:</strong> The information provided regarding sync.exe and kill.exe assumes the use of standard, compatible distributions from Microsoft Sysinternals and the Windows Server 2003 Resource Kit Tools, respectively. Given the significant age of the Windows Server 2003 operating system, it is absolutely crucial to verify that you are using tool versions explicitly stated as compatible with this OS and architecture (R2 x64). Using incompatible or newer versions not designed for WS2003 could lead to subtle errors or outright failures. Furthermore, the identity, specific function, and correct method for obtaining and implementing the non-standard spdrvscn.exe utility must be determined entirely from the documentation or institutional knowledge surrounding your organization’s specific, established imaging process. This document can only highlight its likely role based on the script’s commands.</p>

<p>Ensuring these prerequisites are met is essential for the successful execution of the sysprep.bat script and the creation of a reliable Windows Server 2003 image.</p>
  <h1 id="windows-11">
    
    
     <a href="#windows-11">#</a><a href="#" aria-label="Back to top">Windows 11</a>
        
    
  </h1>
      
  <h2 id="preparing-a-windows-11-image-using-sysprep-a-modern-guide">
    
    
     <a href="#preparing-a-windows-11-image-using-sysprep-a-modern-guide">#</a><a href="#" aria-label="Back to top">Preparing a Windows 11 Image using Sysprep: A Modern Guide</a>
        
    
  </h2>
      

<p>System Preparation (Sysprep) is Microsoft’s essential tool for preparing a customized Windows 11 installation for imaging and deployment. Its primary function is to <strong>generalize</strong> the operating system by removing unique identifiers (like the Security Identifier - SID) and configuring it to run the Out-of-Box Experience (OOBE) on the next boot. This allows the captured image to be deployed across multiple, potentially diverse hardware devices, each receiving a unique identity during setup.</p>

<p>Unlike older operating systems (e.g., Windows Server 2003) where Sysprep preparation often involved complex batch scripts using external utilities for tasks like driver injection, cache flushing, and aggressive process termination, Windows 11 utilizes a more integrated and robust approach. Modern Sysprep heavily relies on the built-in tool itself, combined with an <strong>answer file (<code class="language-plaintext highlighter-rouge">unattend.xml</code>)</strong> for automation and configuration.</p>

<p>This revised guide details the modern requirements and considerations for Sysprepping Windows 11, contrasting them with older methods and incorporating current best practices.</p>

<p><strong>Key Differences from Older Sysprep Workflows:</strong></p>

<ul>
  <li><strong>Built-in Tool:</strong> <code class="language-plaintext highlighter-rouge">sysprep.exe</code> is included in Windows 11 at <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Sysprep</code>. No extraction from installation media is needed.</li>
  <li><strong>Answer File (<code class="language-plaintext highlighter-rouge">unattend.xml</code>):</strong> This XML file is the cornerstone of modern Sysprep automation. It dictates OOBE settings, driver handling, commands to run, and much more, replacing many manual script steps.</li>
  <li><strong>Integrated Driver Management:</strong> Driver injection and persistence are managed via settings in <code class="language-plaintext highlighter-rouge">unattend.xml</code> or through offline image servicing with DISM (Deployment Image Servicing and Management). Custom tools like the <code class="language-plaintext highlighter-rouge">spdrvscn.exe</code> mentioned in the original context are obsolete.</li>
  <li><strong>Refined Process/Service Handling:</strong> Windows 11’s Sysprep <code class="language-plaintext highlighter-rouge">/generalize</code> process is more comprehensive in cleaning up system state. Aggressive termination of built-in services is strongly discouraged due to potential system instability. Built-in tools like <code class="language-plaintext highlighter-rouge">taskkill.exe</code> replace legacy utilities (<code class="language-plaintext highlighter-rouge">kill.exe</code>).</li>
  <li><strong>Filesystem Robustness:</strong> Modern NTFS and improved OS cache management reduce the critical need for manual cache flushing tools (<code class="language-plaintext highlighter-rouge">sync.exe</code>), though they can still be used as a precaution.</li>
</ul>

<p><strong>Important Note on Privileges:</strong> Executing Sysprep requires <strong>Administrator privileges</strong>. Always run <code class="language-plaintext highlighter-rouge">sysprep.exe</code> and any preparatory commands from an elevated Command Prompt or PowerShell session.</p>
  <h3 id="requirements-and-considerations-for-windows-11-sysprep">
    
    
     <a href="#requirements-and-considerations-for-windows-11-sysprep">#</a><a href="#" aria-label="Back to top">Requirements and Considerations for Windows 11 Sysprep</a>
        
    
  </h3>
      

<p>The modern workflow involves configuring the reference system, creating a comprehensive <code class="language-plaintext highlighter-rouge">unattend.xml</code> answer file, performing minimal necessary pre-Sysprep tasks, and then executing <code class="language-plaintext highlighter-rouge">sysprep.exe</code> with the correct parameters.</p>

<p><strong>1. System Preparation Tool (<code class="language-plaintext highlighter-rouge">sysprep.exe</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> The core utility for generalizing the Windows 11 installation.</li>
  <li><strong>Location:</strong> <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Sysprep\</code></li>
  <li><strong>Key Parameters:</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">/generalize</code>: <strong>Essential.</strong> Removes unique system information (SID, computer name, event logs, etc.). The system cannot be imaged for deployment without this.</li>
      <li><code class="language-plaintext highlighter-rouge">/oobe</code>: Configures Windows to boot into the Out-of-Box Experience (user setup phase) on the next start. Used for images intended for end-users.</li>
      <li><code class="language-plaintext highlighter-rouge">/audit</code>: Restarts the computer into audit mode, allowing further customization before OOBE.</li>
      <li><code class="language-plaintext highlighter-rouge">/shutdown</code>: Shuts down the machine after Sysprep completes. Use this when you intend to capture the image immediately.</li>
      <li><code class="language-plaintext highlighter-rouge">/reboot</code>: Reboots the machine after Sysprep completes.</li>
      <li><code class="language-plaintext highlighter-rouge">/quiet</code>: Suppresses on-screen confirmation messages. Useful for automation.</li>
      <li><code class="language-plaintext highlighter-rouge">/unattend:&lt;answerfile&gt;</code>: Applies settings specified in the <code class="language-plaintext highlighter-rouge">unattend.xml</code> file during the Sysprep process and subsequent setup phases. <strong>Highly recommended for automation and customization.</strong></li>
    </ul>
  </li>
  <li><strong>Example Command (for Image Capture):</strong>
  <code class="language-plaintext highlighter-rouge">C:\Windows\System32\Sysprep\sysprep.exe /generalize /oobe /shutdown /unattend:C:\path\to\your\unattend.xml</code></li>
  <li><strong>Reference:</strong> Search “Sysprep Command-Line Options” on Microsoft Learn for full details.</li>
</ul>

<p><strong>2. Answer File (<code class="language-plaintext highlighter-rouge">unattend.xml</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> Provides automated instructions for Windows Setup and Sysprep, controlling numerous settings across different configuration passes.</li>
  <li><strong>Key Functions:</strong>
    <ul>
      <li>Automating OOBE (language, locale, license key, user accounts, computer name, network config).</li>
      <li>Specifying driver search paths (<code class="language-plaintext highlighter-rouge">DriverPaths</code>).</li>
      <li>Persisting installed Plug-and-Play drivers (<code class="language-plaintext highlighter-rouge">PersistAllDeviceInstalls</code>).</li>
      <li>Running custom scripts or commands (<code class="language-plaintext highlighter-rouge">RunSynchronousCommand</code>, <code class="language-plaintext highlighter-rouge">RunAsynchronousCommand</code>).</li>
      <li>Configuring disk partitions, Windows features, security settings, and much more.</li>
    </ul>
  </li>
  <li><strong>Configuration Passes:</strong> Settings in <code class="language-plaintext highlighter-rouge">unattend.xml</code> are applied during specific phases (passes) of setup:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">generalize</code>: Settings applied when <code class="language-plaintext highlighter-rouge">sysprep /generalize</code> runs. Used for system-wide settings that shouldn’t depend on specific hardware.</li>
      <li><code class="language-plaintext highlighter-rouge">specialize</code>: Settings applied during the first boot after generalization, when Windows configures hardware-specific settings. Computer name, network settings, domain join often go here.</li>
      <li><code class="language-plaintext highlighter-rouge">oobeSystem</code>: Settings applied just before OOBE starts. Controls UI language, user accounts, etc.</li>
      <li>(Other passes like <code class="language-plaintext highlighter-rouge">windowsPE</code>, <code class="language-plaintext highlighter-rouge">auditSystem</code>, <code class="language-plaintext highlighter-rouge">auditUser</code>, <code class="language-plaintext highlighter-rouge">offlineServicing</code> exist for different scenarios).</li>
    </ul>
  </li>
  <li><strong>Creation:</strong> Use the <strong>Windows System Image Manager (WSIM)</strong>, available in the <strong>Windows Assessment and Deployment Kit (ADK)</strong>. The ADK is a free download from Microsoft (search the Microsoft website for “Download Windows ADK”). WSIM provides a GUI to create and validate <code class="language-plaintext highlighter-rouge">unattend.xml</code> files against a Windows image (<code class="language-plaintext highlighter-rouge">install.wim</code>).</li>
  <li><strong>Location:</strong> Can be placed in various locations (e.g., <code class="language-plaintext highlighter-rouge">C:\Windows\Panther</code>, removable media) but explicitly providing the path via <code class="language-plaintext highlighter-rouge">/unattend:</code> is the clearest method.</li>
  <li><strong>Reference:</strong> Search “Windows Setup Automation Overview” and “Answer files overview” on Microsoft Learn.</li>
</ul>

<p><strong>3. Driver Management (Replaces <code class="language-plaintext highlighter-rouge">spdrvscn.exe</code> / <code class="language-plaintext highlighter-rouge">C:\Sysprep\drivers</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> Ensure Windows can find and install necessary drivers during deployment, especially on different hardware.</li>
  <li><strong>Modern Methods:</strong>
    <ul>
      <li><strong>DISM (Offline Injection):</strong> Use <code class="language-plaintext highlighter-rouge">DISM /Image:C:\mount /Add-Driver /Driver:C:\drivers /Recurse</code> on a <em>mounted offline</em> Windows image (<code class="language-plaintext highlighter-rouge">.wim</code>) before deployment. This pre-installs drivers into the image’s driver store. Often the most robust method for large driver sets or ensuring drivers are present before PnP detection.</li>
      <li><strong><code class="language-plaintext highlighter-rouge">unattend.xml</code> - <code class="language-plaintext highlighter-rouge">DriverPaths</code>:</strong> Specify one or more paths (local or UNC) in the <code class="language-plaintext highlighter-rouge">Microsoft-Windows-PnpCustomizationsWinPE</code> or <code class="language-plaintext highlighter-rouge">Microsoft-Windows-PnpCustomizationsNonWinPE</code> components. During setup, Windows PnP will search these locations for matching drivers if needed. Useful for providing drivers “just-in-time”.</li>
      <li><strong><code class="language-plaintext highlighter-rouge">unattend.xml</code> - <code class="language-plaintext highlighter-rouge">PersistAllDeviceInstalls</code>:</strong> Setting in the <code class="language-plaintext highlighter-rouge">Microsoft-Windows-PnpSysprep</code> component (applied during the <code class="language-plaintext highlighter-rouge">generalize</code> pass). If <code class="language-plaintext highlighter-rouge">true</code>, Sysprep attempts to keep drivers for <em>all</em> currently installed PnP devices. <strong>Use with extreme caution.</strong> This can significantly increase image size and cause conflicts if deploying to hardware significantly different from the reference machine. Generally recommended to set to <code class="language-plaintext highlighter-rouge">false</code> (default) and use DISM or <code class="language-plaintext highlighter-rouge">DriverPaths</code> for necessary drivers.</li>
    </ul>
  </li>
  <li><strong>Obsolete:</strong> Custom scanning tools and manual cache deletion are unnecessary and unreliable. Rely on DISM and <code class="language-plaintext highlighter-rouge">unattend.xml</code>.</li>
  <li><strong>Reference:</strong> Search “Device Drivers and Deployment Overview” and “Add and Remove Drivers Offline using DISM” on Microsoft Learn.</li>
</ul>

<p><strong>4. Process Termination (Replaces <code class="language-plaintext highlighter-rouge">kill.exe</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> Optionally stop non-essential third-party applications that might interfere with Sysprep.</li>
  <li><strong>Modern Tool:</strong> <code class="language-plaintext highlighter-rouge">taskkill.exe</code> (built-in).
    <ul>
      <li><strong>Syntax:</strong> <code class="language-plaintext highlighter-rouge">taskkill /F /IM &lt;process_image_name.exe&gt;</code> (e.g., <code class="language-plaintext highlighter-rouge">taskkill /F /IM thirdpartyapp.exe</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">/F</code> forces termination; <code class="language-plaintext highlighter-rouge">/IM</code> specifies the image name.</li>
    </ul>
  </li>
  <li><strong>Caution:</strong> <strong>Do not terminate core Windows processes or services.</strong> Focus <em>only</em> on specific, known problematic third-party applications (e.g., some security agents might require specific stop procedures before Sysprep). Sysprep’s <code class="language-plaintext highlighter-rouge">/generalize</code> handles necessary system process cleanup.</li>
</ul>

<p><strong>5. Service Management (Replaces <code class="language-plaintext highlighter-rouge">net stop ...</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> Optionally stop services that might interfere.</li>
  <li><strong>Modern Approach:</strong> <strong>Strongly discouraged for built-in Windows services.</strong> Windows 11 service dependencies are complex, and stopping them can lead to instability or Sysprep failure. The <code class="language-plaintext highlighter-rouge">/generalize</code> pass correctly resets service states for deployment. The aggressive stopping seen in older scripts is generally unnecessary and risky.</li>
  <li><strong>If Necessary (Third-Party Only):</strong> If a specific <em>third-party</em> service <em>must</em> be stopped:
    <ul>
      <li>Use <code class="language-plaintext highlighter-rouge">net stop &lt;service_name&gt;</code> or <code class="language-plaintext highlighter-rouge">sc stop &lt;service_name&gt;</code>. Find the correct name via <code class="language-plaintext highlighter-rouge">services.msc</code> or <code class="language-plaintext highlighter-rouge">sc query</code>.</li>
    </ul>
  </li>
  <li><strong>Recommendation:</strong> Build your reference image cleanly. Avoid installing software or agents that interfere with Sysprep if possible. If third-party software requires specific handling before Sysprep, consult its vendor documentation.</li>
</ul>

<p><strong>6. Disk Cache Flushing (Optional - Replaces <code class="language-plaintext highlighter-rouge">sync.exe</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> Force in-memory file changes to be written to disk before shutdown.</li>
  <li><strong>Modern Tool:</strong> <code class="language-plaintext highlighter-rouge">sync.exe</code> or <code class="language-plaintext highlighter-rouge">sync64.exe</code> from Microsoft Sysinternals Suite (downloadable from Microsoft).
    <ul>
      <li><strong>Syntax:</strong> <code class="language-plaintext highlighter-rouge">sync64.exe -r</code> (use <code class="language-plaintext highlighter-rouge">sync64.exe</code> on 64-bit Windows 11). <code class="language-plaintext highlighter-rouge">/accepteula</code> may be needed on first run.</li>
    </ul>
  </li>
  <li><strong>Necessity:</strong> Optional precaution. Modern NTFS journaling makes data loss from cache less likely than on older systems, but flushing cache before the Sysprep shutdown is harmless and provides peace of mind for some administrators.</li>
</ul>

<p><strong>7. Network Drive Disconnection (Optional - <code class="language-plaintext highlighter-rouge">net use</code>)</strong></p>

<ul>
  <li><strong>Purpose:</strong> Ensure no network drives are mapped in the captured image.</li>
  <li><strong>Command:</strong> <code class="language-plaintext highlighter-rouge">net use * /delete /y</code> (remains valid in Windows 11).</li>
</ul>

<p><strong>8. Sysprep Limitations and Considerations</strong></p>

<ul>
  <li><strong>Upgrade Scenarios:</strong> Sysprep is <strong>not supported</strong> on Windows installations that were upgraded from a previous version. Always start with a clean installation for your reference image.</li>
  <li><strong>Sysprep Count:</strong> You can typically run <code class="language-plaintext highlighter-rouge">sysprep /generalize</code> up to 8 times on a single Windows image. The count can be checked via registry keys (search Microsoft documentation for “slmgr /dlv” or Sysprep generalize limits). Use Audit Mode for customizations instead of repeatedly generalizing.</li>
  <li><strong>Windows Store Apps (UWP):</strong> Sysprep can sometimes have issues with provisioned Store apps, especially if they’ve been updated or if new users have logged in. Microsoft provides guidance on handling UWP apps during Sysprep (often involving removing certain apps before generalizing). Consult current Microsoft documentation on “Sysprep fails UWP apps”.</li>
  <li><strong>Domain Membership:</strong> A machine must be removed from a domain <em>before</em> running <code class="language-plaintext highlighter-rouge">sysprep /generalize</code>. Domain join is configured via <code class="language-plaintext highlighter-rouge">unattend.xml</code> during the <code class="language-plaintext highlighter-rouge">specialize</code> pass after deployment.</li>
  <li><strong>Encryption:</strong> Disable BitLocker or other full-disk encryption before running Sysprep.</li>
</ul>
  <h2 id="workflow">
    
    
     <a href="#workflow">#</a><a href="#" aria-label="Back to top">Workflow</a>
        
    
  </h2>
      

<p><strong>Prerequisites:</strong></p>

<p>Before starting, ensure you have the following resources available:</p>

<ol>
  <li><strong>Windows 11 Enterprise N (23H2) ISO:</strong> The official installation media obtained through appropriate channels (e.g., Volume Licensing Service Center, Visual Studio Subscriptions). Using official media ensures integrity and compatibility. Ensure it matches the target architecture (typically x64).</li>
  <li><strong>Reference Machine:</strong> A dedicated physical computer or, preferably, a virtual machine (VM) where the master image will be built and customized.
    <ul>
      <li><strong>Why a VM is often preferred:</strong> VMs (like Hyper-V, VMware Workstation, VirtualBox) offer significant advantages:
        <ul>
          <li><strong>Snapshots:</strong> Easily create checkpoints before major changes (like running Sysprep), allowing you to revert if something goes wrong without rebuilding from scratch. Best practice involves taking snapshots at key stages: after the clean OS install, after installing updates and core applications, and immediately before executing the final Sysprep command (Step 6). This provides multiple rollback points.</li>
          <li><strong>Hardware Independence:</strong> Building on a VM with generic virtual hardware reduces potential driver conflicts when deploying to diverse physical hardware models.</li>
          <li><strong>Isolation:</strong> Provides a clean, isolated environment separate from your production network during the build process.</li>
          <li><strong>Ease of Capture:</strong> Capturing the virtual hard disk (VHD/VHDX) can sometimes be an alternative or supplement to WIM capture.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Windows Assessment and Deployment Kit (ADK) for Windows 11, 23H2:</strong> This toolkit contains essential deployment utilities.
    <ul>
      <li>Download the latest ADK version matching your target OS (23H2) from the official Microsoft website.</li>
      <li><strong>Required ADK Components:</strong> During installation, select at least:
        <ul>
          <li><strong>Deployment Tools:</strong> Includes the Deployment Imaging Servicing and Management tool (DISM), Windows System Image Manager (WSIM), and other command-line utilities.</li>
          <li><strong>User State Migration Tool (USMT):</strong> (Optional, but often installed alongside deployment tools).</li>
        </ul>
      </li>
      <li><strong>Required Add-on:</strong> Also download and install the corresponding <strong>Windows PE add-on for the ADK</strong>. This provides the Windows Preinstallation Environment (WinPE), a minimal OS used for booting machines for deployment and image capture tasks. (<em>Note: WinPE bootable media must be created separately using tools like <code class="language-plaintext highlighter-rouge">copype.cmd</code> and <code class="language-plaintext highlighter-rouge">MakeWinPEMedia.cmd</code> included in the ADK/PE Add-on. Consult Microsoft documentation for “Create WinPE bootable media”.</em>)</li>
    </ul>
  </li>
  <li><strong>Drivers (Optional but Recommended):</strong> Collect all necessary hardware drivers for the <em>target</em> computer models where this image will be deployed. Focus on critical drivers:
    <ul>
      <li>Network Interface Cards (NICs)</li>
      <li>Storage Controllers (SATA/NVMe/RAID)</li>
      <li>Chipset drivers</li>
      <li>Video drivers (can sometimes be installed post-deployment)</li>
      <li>Organize these drivers logically in folders (e.g., by model, then component type) within a central location accessible during the process (e.g., <code class="language-plaintext highlighter-rouge">C:\Drivers</code> on a network share or USB drive). Proper driver management is crucial for successful deployment.</li>
    </ul>
  </li>
  <li><strong>Sysinternals Suite (Optional):</strong> A collection of advanced Windows utilities. Download from the Microsoft Sysinternals site if you plan to use <code class="language-plaintext highlighter-rouge">sync64.exe</code> for explicitly flushing the disk cache before shutdown (Step 5). While not strictly mandatory on modern systems, it’s a harmless precautionary step.</li>
</ol><hr />
  <h3 id="step-1-build-the-reference-machine">
    
    
     <a href="#step-1-build-the-reference-machine">#</a><a href="#" aria-label="Back to top">Step 1: Build the Reference Machine</a>
        
    
  </h3>
      

<p>This foundational step involves installing and configuring the base Windows OS cleanly. The goal is a pristine state before customization and generalization.</p>

<ol>
  <li><strong>Clean Install Windows:</strong>
    <ul>
      <li>Boot the designated reference machine (physical or VM) using your prepared Windows 11 Enterprise N (23H2) ISO media (e.g., bootable USB created using the Media Creation Tool or Rufus, or by mounting the ISO in a VM).</li>
      <li>Follow the on-screen prompts. Select language, time/currency format, and keyboard layout.</li>
      <li>Click “Install now”.</li>
      <li>Enter a product key if required by your media/licensing, or select “I don’t have a product key” if using volume licensing (like KMS) where activation occurs post-deployment.</li>
      <li>When prompted for the operating system edition, carefully select <strong>Windows 11 Enterprise N</strong>. Choosing the wrong edition will require starting over. Ensure the architecture (x64) is correct.</li>
      <li>Accept the license terms.</li>
      <li>Choose <strong>“Custom: Install Windows only (advanced)”</strong>. <em>Do not</em> select “Upgrade”.</li>
      <li>Select the target disk/partition for installation. If necessary, delete existing partitions to ensure a completely clean state (Warning: This erases data). Let Windows Setup create the necessary partitions automatically.</li>
      <li>Windows will copy files and install the OS. The machine will reboot several times.</li>
      <li><strong>Crucially - OOBE Phase:</strong> During the Out-of-Box Experience (OOBE) setup phase:
        <ul>
          <li>When prompted to sign in with a Microsoft account, <strong>do not proceed</strong>. Look for alternative options like <strong>“Sign-in options”</strong> and select <strong>“Offline account”</strong>. If that’s unavailable, choose <strong>“Domain join instead”</strong> which will then prompt for a local account. Using a local account prevents the image from being tied to a specific Microsoft account or Azure AD tenant, which is essential for a general-purpose image.</li>
          <li>Create a temporary local administrator account. Use a simple, non-privileged name (e.g., <code class="language-plaintext highlighter-rouge">BuildAdmin</code> or <code class="language-plaintext highlighter-rouge">TempAdmin</code>). Set a reasonably strong password that you will remember, as you’ll need it for subsequent steps.</li>
          <li>Decline optional settings like online speech recognition, location services, diagnostic data submission (or configure according to organizational policy, but minimizing unique identifiers is generally preferred for a base image).</li>
        </ul>
      </li>
      <li>Complete the OOBE. Windows will finalize settings and log you into the temporary local administrator account.</li>
    </ul>
  </li>
  <li><strong>Post-Installation Configuration (Logged in as Local Admin):</strong>
    <ul>
      <li><strong>Install Essential Drivers (If Needed):</strong> Immediately after logging in, check Device Manager (<code class="language-plaintext highlighter-rouge">devmgmt.msc</code>). If critical devices like the network adapter lack drivers, install them manually from your collected driver repository. Basic functionality is key at this stage.</li>
      <li><strong>Windows Updates:</strong> Establish an internet connection. Go to <strong>Settings -&gt; Windows Update</strong> and click <strong>“Check for updates”</strong>. Install <em>all</em> available quality and security updates. This process may require multiple checks and reboots. Ensuring the image is fully patched <em>before</em> Sysprep is a critical security best practice and saves time during deployment.</li>
      <li><strong>Install Core Applications &amp; Runtimes:</strong> Install baseline software required for most users or systems in your organization. Examples:
        <ul>
          <li>Microsoft 365 Apps (if licensed)</li>
          <li>Standard web browsers (e.g., Chrome, Firefox - consider enterprise installers)</li>
          <li>PDF Reader (e.g., Adobe Reader)</li>
          <li>Basic utilities (e.g., 7-Zip)</li>
          <li>Essential runtimes/frameworks (e.g., latest .NET Framework versions, Visual C++ Redistributables often required by other apps).</li>
          <li><em>Avoid:</em> User-specific applications, software requiring unique licensing per machine during install, drivers for hardware not present on the reference machine (unless using DISM later), beta software. Keep the application footprint clean and standard. Crucially, before installing complex enterprise applications (like security suites, VPN clients, or management agents), consult the vendor’s documentation regarding their compatibility and recommended procedures for installation on a system intended for Sysprep. Some applications require specific configurations or cleanup steps before generalization.</li>
        </ul>
      </li>
      <li><strong>Basic OS Configuration:</strong> Apply system-wide configurations that should be part of the standard image:
        <ul>
          <li>Set Power Plan settings (e.g., to High Performance during build, though this can be changed post-deployment).</li>
          <li>Enable Remote Desktop if required for remote administration post-deployment.</li>
          <li>Configure basic security settings according to organizational policy (but avoid overly complex configurations that might interfere with Sysprep or deployment).</li>
          <li>Install root certificates if needed.</li>
        </ul>
      </li>
      <li><strong>Critical Restrictions During Image Build:</strong>
        <ul>
          <li><strong>DO NOT</strong> join the machine to an Active Directory domain. Sysprep will fail or cause issues if the machine is domain-joined. Domain join happens <em>after</em> deployment, often automated via the answer file.</li>
          <li><strong>DO NOT</strong> activate Windows using a retail or OEM key tied to this specific hardware. Activation for volume licenses (KMS or MAK) should occur after deployment on the target hardware.</li>
          <li><strong>DO NOT</strong> encrypt the drive (e.g., with BitLocker) at this stage. Encryption should be enabled post-deployment.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol><hr />
  <h3 id="step-2-create-the-unattendxml-answer-file">
    
    
     <a href="#step-2-create-the-unattendxml-answer-file">#</a><a href="#" aria-label="Back to top">Step 2: Create the <code class="language-plaintext highlighter-rouge">unattend.xml</code> Answer File</a>
        
    
  </h3>
      

<p>The <code class="language-plaintext highlighter-rouge">unattend.xml</code> file is the heart of Sysprep automation. It provides answers to configuration questions during different phases of setup, allowing for a “zero-touch” or “light-touch” deployment experience.</p>

<ol>
  <li><strong>Launch WSIM:</strong>
    <ul>
      <li>Navigate to the ADK installation location on your technician machine. Find and run <strong>Windows System Image Manager (WSIM)</strong>. Ensure you run it with Administrator privileges, as it needs to create catalog files.</li>
    </ul>
  </li>
  <li><strong>Load Windows Image &amp; Create Catalog:</strong>
    <ul>
      <li>Go to <strong>File -&gt; Select Windows Image</strong>.</li>
      <li>Browse to the <code class="language-plaintext highlighter-rouge">install.wim</code> (or <code class="language-plaintext highlighter-rouge">install.esd</code>) file located within the <code class="language-plaintext highlighter-rouge">\sources</code> directory of your Windows 11 Enterprise N 23H2 installation media.
        <ul>
          <li><em>Note on ESD vs. WIM:</em> If your media contains <code class="language-plaintext highlighter-rouge">install.esd</code>, you’ll need to convert it to the editable <code class="language-plaintext highlighter-rouge">install.wim</code> format first using DISM. To find the correct index number for the Enterprise N edition within the ESD file, first run:
            <pre><code class="language-cmd">DISM /Get-WimInfo /WimFile:C:\path\to\install.esd
</code></section>
            <p>Note the index number for “Windows 11 Enterprise N”. Then, use the export command (replace <code class="language-plaintext highlighter-rouge">X</code> with the correct index):</p>
            <pre><code class="language-cmd">DISM /Export-Image /SourceImageFile:C:\path\to\install.esd /SourceIndex:X /DestinationImageFile:C:\path\to\install.wim /Compress:Max /CheckIntegrity
</code></section>
          </li>
        </ul>
      </li>
      <li>When WSIM prompts <strong>“A catalog file cannot be opened…“</strong> and asks <strong>“Do you want to create a catalog file?”</strong>, click <strong>Yes</strong>.
        <ul>
          <li><strong>Catalog File (<code class="language-plaintext highlighter-rouge">.clg</code>) Explanation:</strong> WSIM needs to analyze the specific Windows image (<code class="language-plaintext highlighter-rouge">.wim</code>) you selected. It creates a catalog file (<code class="language-plaintext highlighter-rouge">.clg</code>) which acts like a database, listing all the configurable components and settings available <em>within that specific Windows image</em>. This allows WSIM to validate your answer file choices against the target OS version and edition. Catalog creation can take several minutes, especially on the first load.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Create New Answer File:</strong>
    <ul>
      <li>Once the catalog is created and loaded (you’ll see components listed in the “Windows Image” pane), go to <strong>File -&gt; New Answer File</strong>. A blank answer file structure appears in the “Answer File” pane.</li>
    </ul>
  </li>
  <li><strong>Add Components and Configure Settings:</strong>
    <ul>
      <li>This is where you define your automation settings using WSIM. In the “Windows Image” pane, find the desired components (like those controlling Shell Setup or International settings). Right-click the component or a specific setting underneath it, and choose “Add Setting to Pass X [Pass Name]”. Ensure settings are added to the correct configuration pass (<code class="language-plaintext highlighter-rouge">specialize</code> for hardware-specific setup, <code class="language-plaintext highlighter-rouge">oobeSystem</code> for user setup before OOBE, etc.). Below is a minimal, structured example showing components added to the <code class="language-plaintext highlighter-rouge">specialize</code> and <code class="language-plaintext highlighter-rouge">oobeSystem</code> passes. You must customize this using WSIM, adding/removing components and changing values (especially passwords, language/locale, timezone, computer name patterns) to match your requirements.</li>
    </ul>

    <div class="language-xml highlighter-rouge"><div class="highlight"><section><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;unattend</span> <span class="na">xmlns=</span><span class="s">"urn:schemas-microsoft-com:unattend"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;settings</span> <span class="na">pass=</span><span class="s">"specialize"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">"Microsoft-Windows-Shell-Setup"</span> <span class="na">processorArchitecture=</span><span class="s">"amd64"</span> <span class="na">publicKeyToken=</span><span class="s">"31bf3856ad364e35"</span> <span class="na">language=</span><span class="s">"neutral"</span> <span class="na">versionScope=</span><span class="s">"nonSxS"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;TimeZone&gt;</span>UTC<span class="nt">&lt;/TimeZone&gt;</span>
            <span class="nt">&lt;ComputerName&gt;</span>WIN11ENTN-*<span class="nt">&lt;/ComputerName&gt;</span>
            <span class="nt">&lt;RegisteredOrganization&gt;</span>Your Organization<span class="nt">&lt;/RegisteredOrganization&gt;</span>
            <span class="nt">&lt;RegisteredOwner&gt;</span>Admin Dept<span class="nt">&lt;/RegisteredOwner&gt;</span>
            <span class="nt">&lt;CopyProfile&gt;</span>false<span class="nt">&lt;/CopyProfile&gt;</span>
            <span class="nt">&lt;/component&gt;</span>
        <span class="nt">&lt;/settings&gt;</span>
    <span class="nt">&lt;settings</span> <span class="na">pass=</span><span class="s">"oobeSystem"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">"Microsoft-Windows-International-Core"</span> <span class="na">processorArchitecture=</span><span class="s">"amd64"</span> <span class="na">publicKeyToken=</span><span class="s">"31bf3856ad364e35"</span> <span class="na">language=</span><span class="s">"neutral"</span> <span class="na">versionScope=</span><span class="s">"nonSxS"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;InputLocale&gt;</span>en-US<span class="nt">&lt;/InputLocale&gt;</span>
            <span class="nt">&lt;SystemLocale&gt;</span>en-US<span class="nt">&lt;/SystemLocale&gt;</span>
            <span class="nt">&lt;UILanguage&gt;</span>en-US<span class="nt">&lt;/UILanguage&gt;</span>
            <span class="nt">&lt;UserLocale&gt;</span>en-US<span class="nt">&lt;/UserLocale&gt;</span>
        <span class="nt">&lt;/component&gt;</span>
        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">"Microsoft-Windows-Shell-Setup"</span> <span class="na">processorArchitecture=</span><span class="s">"amd64"</span> <span class="na">publicKeyToken=</span><span class="s">"31bf3856ad364e35"</span> <span class="na">language=</span><span class="s">"neutral"</span> <span class="na">versionScope=</span><span class="s">"nonSxS"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;OOBE&gt;</span>
                <span class="nt">&lt;HideEULAPage&gt;</span>true<span class="nt">&lt;/HideEULAPage&gt;</span>
                <span class="nt">&lt;HideOEMRegistrationScreen&gt;</span>true<span class="nt">&lt;/HideOEMRegistrationScreen&gt;</span>
                <span class="nt">&lt;HideOnlineAccountScreens&gt;</span>true<span class="nt">&lt;/HideOnlineAccountScreens&gt;</span>
                <span class="nt">&lt;HideWirelessSetupInOOBE&gt;</span>true<span class="nt">&lt;/HideWirelessSetupInOOBE&gt;</span>
                <span class="nt">&lt;ProtectYourPC&gt;</span>1<span class="nt">&lt;/ProtectYourPC&gt;</span>
                <span class="nt">&lt;NetworkLocation&gt;</span>Work<span class="nt">&lt;/NetworkLocation&gt;</span>
            <span class="nt">&lt;/OOBE&gt;</span>
            <span class="nt">&lt;UserAccounts&gt;</span>
                <span class="nt">&lt;LocalAccounts&gt;</span>
                    <span class="nt">&lt;LocalAccount</span> <span class="na">wcm:action=</span><span class="s">"add"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;Password&gt;</span>
                            <span class="nt">&lt;Value&gt;</span>UABzAHMAdwBvAHIAZAAxADIAMwA=<span class="nt">&lt;/Value&gt;</span>
                            <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
                        <span class="nt">&lt;/Password&gt;</span>
                        <span class="nt">&lt;Description&gt;</span>Local Administrator Account<span class="nt">&lt;/Description&gt;</span>
                        <span class="nt">&lt;DisplayName&gt;</span>Admin<span class="nt">&lt;/DisplayName&gt;</span>
                        <span class="nt">&lt;Group&gt;</span>Administrators<span class="nt">&lt;/Group&gt;</span>
                        <span class="nt">&lt;Name&gt;</span>Admin<span class="nt">&lt;/Name&gt;</span>
                    <span class="nt">&lt;/LocalAccount&gt;</span>
                <span class="nt">&lt;/LocalAccounts&gt;</span>
            <span class="nt">&lt;/UserAccounts&gt;</span>
        <span class="nt">&lt;/component&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
    <span class="nt">&lt;/unattend&gt;</span>
</code></section></div>    </div>
    <ul>
      <li><em>Note: This is a basic structural example. Use WSIM to add components to the correct passes and configure all required settings. Ensure you replace placeholder values like the password. To generate the required Base64 encoded password string, use PowerShell: <code class="language-plaintext highlighter-rouge">[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('YourNewPassword'))</code>. Paste the resulting Base64 string directly between the <code class="language-plaintext highlighter-rouge">&lt;Value&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;/Value&gt;</code> tags.</em></li>
    </ul>
  </li>
  <li><strong>Validate Answer File:</strong>
    <ul>
      <li>Before saving, use <strong>Tools -&gt; Validate Answer File</strong> in WSIM. This checks your configuration against the loaded catalog file. Address any errors or warnings listed in the “Messages” pane. Common issues involve incorrect data types, missing required settings, or settings placed in the wrong configuration pass. Validation is crucial for avoiding setup failures.</li>
    </ul>
  </li>
  <li><strong>Save Answer File:</strong>
    <ul>
      <li>Go to <strong>File -&gt; Save Answer File As…</strong>.</li>
      <li>Save the file with the exact name <code class="language-plaintext highlighter-rouge">unattend.xml</code>.</li>
    </ul>
  </li>
  <li><strong>Copy to Reference Machine:</strong>
    <ul>
      <li>Transfer the validated <code class="language-plaintext highlighter-rouge">unattend.xml</code> file to your reference machine. A common and easily accessible location is the root of the C: drive (<code class="language-plaintext highlighter-rouge">C:\unattend.xml</code>), as used in the Sysprep command later. Alternatively, placing it in <code class="language-plaintext highlighter-rouge">C:\Windows\Panther\</code> allows Sysprep to potentially find it automatically, but explicitly specifying the path with the <code class="language-plaintext highlighter-rouge">/unattend:</code> switch is generally more reliable.</li>
    </ul>
  </li>
</ol><hr />
  <h3 id="step-3-inject-drivers-offline-optional-method">
    
    
     <a href="#step-3-inject-drivers-offline-optional-method">#</a><a href="#" aria-label="Back to top">Step 3: Inject Drivers Offline (Optional Method)</a>
        
    
  </h3>
      

<p>This method integrates drivers directly into the Windows image file (<code class="language-plaintext highlighter-rouge">.wim</code>) <em>before</em> Sysprep or deployment. It’s beneficial for large driver sets or ensuring critical storage/network drivers are available very early in setup. If you prefer adding drivers during Audit Mode or relying solely on the <code class="language-plaintext highlighter-rouge">DriverPaths</code> setting in <code class="language-plaintext highlighter-rouge">unattend.xml</code> (which makes Windows search specified folders during setup), you can skip this step.</p>

<ol>
  <li><strong>Prepare:</strong>
    <ul>
      <li>Ensure the reference machine is cleanly shut down (if injecting into its offline OS) or that you have captured a base <code class="language-plaintext highlighter-rouge">.wim</code> file.</li>
      <li>Boot the reference machine (or a technician machine with the WIM file) using <strong>Windows PE</strong> media.</li>
      <li>Make your organized driver repository accessible from WinPE (e.g., connect a USB drive recognized as <code class="language-plaintext highlighter-rouge">D:</code>, or map a network share using <code class="language-plaintext highlighter-rouge">net use Z: \\server\share /user:domain\user password</code>). Let’s assume drivers are in <code class="language-plaintext highlighter-rouge">D:\Drivers</code>.</li>
    </ul>
  </li>
  <li><strong>Identify Windows Volume (if modifying live OS offline):</strong>
    <ul>
      <li>Open the Command Prompt in WinPE.</li>
      <li>Run <code class="language-plaintext highlighter-rouge">diskpart</code>.</li>
      <li>Inside diskpart, use <code class="language-plaintext highlighter-rouge">list volume</code> to identify the drive letter currently assigned to your main Windows installation (it might not be <code class="language-plaintext highlighter-rouge">C:</code> in WinPE). Note this letter (e.g., <code class="language-plaintext highlighter-rouge">E:</code>).</li>
      <li>Type <code class="language-plaintext highlighter-rouge">exit</code> to leave diskpart.</li>
    </ul>
  </li>
  <li><strong>Create Mount Directory (if modifying a WIM file):</strong>
    <ul>
      <li>If you are injecting drivers into a captured <code class="language-plaintext highlighter-rouge">.wim</code> file (not the live OS partition), create a temporary mount directory on your WinPE system or technician PC:
        <pre><code class="language-cmd">  md C:\Mount
</code></section>
      </li>
    </ul>
  </li>
  <li><strong>Mount Image (if modifying a WIM file):</strong>
    <ul>
      <li>Use DISM to mount the WIM file to the directory you created.
        <pre><code class="language-cmd">  DISM /Mount-Image /ImageFile:X:\Images\BaseWin11EntN.wim /Index:1 /MountDir:C:\Mount
</code></section>
        <ul>
          <li>Replace <code class="language-plaintext highlighter-rouge">X:\Images\BaseWin11EntN.wim</code> with the correct path to your captured image file.</li>
          <li><code class="language-plaintext highlighter-rouge">/Index:1</code>: Specifies the image index within the WIM file to mount. Always verify the correct index using <code class="language-plaintext highlighter-rouge">DISM /Get-WimInfo /WimFile:YourImage.wim</code>.</li>
          <li><code class="language-plaintext highlighter-rouge">/MountDir:C:\Mount</code>: Points to the empty directory created earlier.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Inject Drivers:</strong> Use the appropriate DISM command based on whether you are targeting a mounted WIM or an offline OS volume.
    <ul>
      <li><strong>Scenario A: Injecting into a Mounted WIM:</strong>
        <pre><code class="language-cmd">  DISM /Image:C:\Mount /Add-Driver /Driver:D:\Drivers /Recurse
</code></section>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/Image:C:\Mount</code>: Specifies the path to the mounted offline image.</li>
          <li><code class="language-plaintext highlighter-rouge">/Driver:D:\Drivers</code>: Path to the folder containing driver <code class="language-plaintext highlighter-rouge">.inf</code> files.</li>
          <li><code class="language-plaintext highlighter-rouge">/Recurse</code>: Searches for drivers in all subfolders.</li>
        </ul>
      </li>
      <li><strong>Scenario B: Injecting into the Offline OS Volume (e.g., <code class="language-plaintext highlighter-rouge">E:</code> identified earlier):</strong>
        <pre><code class="language-cmd">  DISM /Image:E:\ /Add-Driver /Driver:D:\Drivers /Recurse
</code></section>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/Image:E:\</code>: Specifies the root path of the offline Windows installation.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Unmount Image (Only if modifying a WIM file):</strong>
    <ul>
      <li>If you mounted a WIM in step 4, commit the changes and unmount it.
        <pre><code class="language-cmd">  DISM /Unmount-Image /MountDir:C:\Mount /Commit
</code></section>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/Commit</code>: Saves the changes. Use <code class="language-plaintext highlighter-rouge">/Discard</code> to cancel if errors occurred.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Reboot:</strong> If you modified the live OS offline (Scenario B), remove the WinPE media and reboot the reference machine normally. If you modified a WIM file (Scenario A), you can now use that updated WIM.</li>
</ol><hr />
  <h3 id="step-4-final-customizations-in-audit-mode-recommended">
    
    
     <a href="#step-4-final-customizations-in-audit-mode-recommended">#</a><a href="#" aria-label="Back to top">Step 4: Final Customizations in Audit Mode (Recommended)</a>
        
    
  </h3>
      

<p>Audit Mode provides a special administrative environment to make final customizations <em>before</em> the image is generalized and sealed. It’s preferred over making all changes in the initial temporary admin account because it uses the built-in Administrator account without creating a permanent user profile that needs cleanup, and it runs before user-specific settings are applied.</p>

<ol>
  <li><strong>Enter Audit Mode:</strong>
    <ul>
      <li><strong>Method 1 (From OOBE):</strong> If you just finished the clean install (Step 1) and are at the <em>very first</em> OOBE screen asking for region, press <strong>Ctrl+Shift+F3</strong>. The machine will reboot directly into Audit Mode.</li>
      <li><strong>Method 2 (From Running OS):</strong> If you have already completed OOBE and logged in, open an <strong>Administrator</strong> Command Prompt or PowerShell window and run:
        <pre><code class="language-cmd">  C:\Windows\System32\Sysprep\sysprep.exe /audit /reboot
</code></section>
      </li>
      <li>The machine will reboot and automatically log into the desktop using the built-in Administrator account. The “System Preparation Tool” (Sysprep) window will appear – <strong>do not</strong> interact with it <em>yet</em> unless you are finished with customizations. You can minimize it while you work.</li>
    </ul>
  </li>
  <li><strong>Perform Final Tasks:</strong>
    <ul>
      <li><strong>Install Remaining Applications:</strong> Install complex applications, software with system-wide dependencies, or anything missed in Step 1 that should be part of the final image. Audit mode is ideal for installers that need elevated privileges.</li>
      <li><strong>Apply Custom Configurations:</strong> Run configuration scripts (e.g., PowerShell <code class="language-plaintext highlighter-rouge">.ps1</code> scripts) to apply specific registry settings, configure security policies, or set default application behaviors.</li>
      <li><strong>Driver Installation (Alternative):</strong> You can also install drivers in Audit Mode if you didn’t inject them offline.</li>
      <li><strong><code class="language-plaintext highlighter-rouge">CopyProfile</code> Consideration:</strong> If you have made significant customizations to the <strong>desktop environment</strong> (e.g., Start Menu layout, taskbar icons, desktop background, Explorer settings) <em>while in Audit Mode</em> (logged in as the built-in Administrator), and you want these specific customizations to become the default for all <em>new</em> users created on machines deployed from this image, you need to set <code class="language-plaintext highlighter-rouge">&lt;CopyProfile&gt;true&lt;/CopyProfile&gt;</code> in the <code class="language-plaintext highlighter-rouge">specialize</code> pass of your <code class="language-plaintext highlighter-rouge">unattend.xml</code> (Step 2).
        <ul>
          <li><strong>Explanation:</strong> Setting <code class="language-plaintext highlighter-rouge">CopyProfile</code> to <code class="language-plaintext highlighter-rouge">true</code> tells Sysprep to copy the current state of the built-in Administrator profile (which you are customizing in Audit Mode) to the “Default User” profile template (<code class="language-plaintext highlighter-rouge">C:\Users\Default</code>). When a new user logs in for the first time, their profile is created based on this template.</li>
          <li><strong>Caution:</strong> While powerful, <code class="language-plaintext highlighter-rouge">CopyProfile</code> has historically been prone to issues, especially with modern/UWP apps, Start Menu search, and profile loading times. Test thoroughly if using it. Often, applying settings via Group Policy or configuration scripts post-deployment is more reliable. Consult Microsoft documentation on <code class="language-plaintext highlighter-rouge">CopyProfile</code> behavior and potential issues for the latest guidance. (Search Microsoft Learn for “Customize the default user profile by using CopyProfile”).</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Maintain Cleanliness:</strong> While in Audit Mode, avoid performing user-specific actions like excessive web browsing, checking personal email, or creating random files on the desktop or in user folders. The goal is to keep the image as clean and generic as possible.</li>
  <li><strong>Exiting Audit Mode:</strong> When all customizations in Audit Mode are complete, you will proceed to Step 5 (Cleanup) and then Step 6 (Execute Sysprep). You can trigger the generalization and shutdown either by using the command line in Step 6 or by bringing up the minimized “System Preparation Tool” window, selecting “Enter System Out-of-Box Experience (OOBE)” for System Cleanup Action, checking the “Generalize” box, and selecting “Shutdown” for Shutdown Options, then clicking OK. Using the command line with an answer file (Step 6) provides more explicit control.</li>
</ol><hr />
  <h3 id="step-5-pre-sysprep-cleanup">
    
    
     <a href="#step-5-pre-sysprep-cleanup">#</a><a href="#" aria-label="Back to top">Step 5: Pre-Sysprep Cleanup</a>
        
    
  </h3>
      

<p>These final cleanup steps, performed just before running the generalization command, help reduce the final image size and ensure a clean state. Run these from an <strong>Administrator</strong> Command Prompt or PowerShell session while still in Audit Mode (or after rebooting back into your temporary admin account if not using Audit Mode).</p>

<ol>
  <li><strong>Disk Cleanup:</strong>
    <ul>
      <li>Run the built-in Disk Cleanup utility (<code class="language-plaintext highlighter-rouge">cleanmgr.exe</code>) to remove temporary files, downloaded program files, setup logs, Windows Update cache, etc.</li>
      <li>First, configure the cleanup settings (this only needs to be done once per profile):
        <pre><code class="language-cmd">  cleanmgr /sageset:1
</code></section>
        <p>A window will pop up. Check the boxes for all categories you want to clean (e.g., Temporary Internet Files, Delivery Optimization Files, Windows Update Cleanup, Temporary files, Recycle Bin, Setup log files). Click OK.</p>
      </li>
      <li>Then, run the cleanup using the saved settings:
        <pre><code class="language-cmd">  cleanmgr /sagerun:1
</code></section>
        <p>This will perform the actual deletion, which might take some time. (<em>Note: While <code class="language-plaintext highlighter-rouge">cleanmgr.exe</code> is functional here, it is considered a legacy tool. For more modern cleanup, especially removing superseded Windows Update components, consider using DISM component cleanup commands like <code class="language-plaintext highlighter-rouge">DISM.exe /Online /Cleanup-Image /StartComponentCleanup /ResetBase</code> before Sysprep, or leveraging Storage Sense features.</em>)</p>
      </li>
    </ul>
  </li>
  <li><strong>Disconnect Network Drives (If any were mapped):</strong>
    <ul>
      <li>Ensure no network drives are connected, as these mappings won’t be valid on deployed machines.</li>
      <li>
        <pre><code class="language-cmd">  net use * /delete /y
</code></section>
      </li>
    </ul>
  </li>
  <li><strong>Stop Problematic Third-Party Services/Apps (If Necessary):</strong>
    <ul>
      <li>This step is <strong>only</strong> for specific, non-Microsoft software that you <em>know</em> interferes with the Sysprep process (e.g., some antivirus/endpoint security agents might lock files Sysprep needs to modify, or some management agents might try to communicate during generalization). <strong>Always consult the software vendor’s documentation</strong> for guidance on Sysprepping systems with their product installed. <strong>Do not</strong> arbitrarily stop built-in Windows services, as this is likely to cause Sysprep failure or an unstable image.</li>
      <li>Example (Hypothetical - Replace with actual service/process names):
        <pre><code class="language-cmd">  net stop "Problematic Third Party Service Name"
  taskkill /F /IM problematic_agent_process.exe
</code></section>
      </li>
    </ul>
  </li>
  <li><strong>Flush Disk Cache (Optional Precaution):</strong>
    <ul>
      <li>To ensure all pending disk writes are flushed from memory to the physical disk before Sysprep shuts down the machine, you can use <code class="language-plaintext highlighter-rouge">sync64.exe</code> from the Sysinternals Suite.</li>
      <li>If you downloaded Sysinternals and placed <code class="language-plaintext highlighter-rouge">sync64.exe</code> in a directory included in the system’s PATH environment variable (like <code class="language-plaintext highlighter-rouge">C:\Windows\System32</code>):
        <pre><code class="language-cmd">  sync64 -r
</code></section>
      </li>
      <li>Or, provide the full path to the executable:
        <pre><code class="language-cmd">  C:\Path\To\Sysinternals\sync64.exe -r
</code></section>
        <ul>
          <li>The <code class="language-plaintext highlighter-rouge">-r</code> flag ensures flushing includes files in subdirectories. While modern filesystems are robust, this adds an extra layer of safety against data inconsistency if an unexpected shutdown were to occur immediately after.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol><hr />
  <h3 id="step-6-execute-sysprep">
    
    
     <a href="#step-6-execute-sysprep">#</a><a href="#" aria-label="Back to top">Step 6: Execute Sysprep</a>
        
    
  </h3>
      

<p>This is the critical command that generalizes the Windows installation, making it ready for capture and deployment. <strong>This step is irreversible on the current OS installation without reverting to a VM snapshot or backup.</strong> Before running this, consider the limitations mentioned in the section below.</p>

<ol>
  <li><strong>Open Elevated Command Prompt/PowerShell:</strong> Ensure you are running with Administrator privileges.</li>
  <li><strong>Navigate to Sysprep Directory:</strong>
    <pre><code class="language-cmd">cd C:\Windows\System32\Sysprep
</code></section>
  </li>
  <li><strong>Run Sysprep Command:</strong>
    <ul>
      <li>Construct the command using the following essential switches:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/generalize</code>: <strong>Mandatory.</strong> This performs the core generalization process: removes the machine-specific SID, clears event logs, resets activation timers, removes unique hardware identifiers, processes specialize pass settings in <code class="language-plaintext highlighter-rouge">unattend.xml</code> related to generalization (like <code class="language-plaintext highlighter-rouge">PersistAllDeviceInstalls</code>). Without <code class="language-plaintext highlighter-rouge">/generalize</code>, the image cannot be safely deployed to other machines.</li>
          <li><code class="language-plaintext highlighter-rouge">/oobe</code>: Instructs Windows to boot into the Out-of-Box Experience (OOBE) on the <em>next</em> startup after deployment. This allows for machine-specific setup (like computer name if not set randomly, user creation if not automated). Use this for standard end-user deployments. (Use <code class="language-plaintext highlighter-rouge">/audit</code> instead if you intend the machine to boot back into Audit Mode after deployment for further layers of customization).</li>
          <li><code class="language-plaintext highlighter-rouge">/shutdown</code>: Instructs the system to shut down completely after Sysprep finishes. This is crucial because you need to capture the image <em>before</em> Windows boots up again in its generalized state. Booting it back into the full OS before capture would start the specialization process and potentially invalidate the generalized state.</li>
          <li><code class="language-plaintext highlighter-rouge">/unattend:C:\unattend.xml</code>: Explicitly tells Sysprep to use the settings defined in your answer file located at the specified path. This ensures your automation settings are applied correctly during generalization and the subsequent OOBE/specialize passes after deployment.</li>
        </ul>
      </li>
      <li><strong>The Command:</strong>
        <pre><code class="language-cmd">  .\sysprep.exe /generalize /oobe /shutdown /unattend:C:\unattend.xml
</code></section>
      </li>
    </ul>
  </li>
  <li><strong>Wait:</strong> Sysprep will now execute. You’ll see messages indicating its progress. This involves several phases, including processing settings from the <code class="language-plaintext highlighter-rouge">generalize</code> pass of your answer file. Once complete, the machine will shut down automatically. <strong>Do not power it back on into the installed Windows OS.</strong> It is now in a generalized state, ready for image capture.</li>
</ol><hr />
  <h3 id="important-sysprep-limitations-and-considerations">
    
    
     <a href="#important-sysprep-limitations-and-considerations">#</a><a href="#" aria-label="Back to top">Important: Sysprep Limitations and Considerations</a>
        
    
  </h3>
      

<p>Before running <code class="language-plaintext highlighter-rouge">/generalize</code> or when troubleshooting, be aware of these common Sysprep constraints:</p>

<ul>
  <li><strong>Upgrade Scenarios:</strong> Sysprep is <strong>not supported</strong> on Windows installations that were upgraded from a previous version (in-place upgrade). Always start with a clean installation for your reference image.</li>
  <li><strong>Sysprep Count:</strong> You can typically run <code class="language-plaintext highlighter-rouge">sysprep /generalize</code> only a limited number of times on a single Windows image (historically 3, currently up to 8 times, but relying on this limit is discouraged). Check the <code class="language-plaintext highlighter-rouge">GeneralizationState</code> in the registry (<code class="language-plaintext highlighter-rouge">HKEY_LOCAL_MACHINE\SYSTEM\Setup\Status\SysprepStatus</code>) or use <code class="language-plaintext highlighter-rouge">slmgr /dlv</code> to check rearm counts. Use Audit Mode for iterative customizations instead of repeatedly generalizing.</li>
  <li><strong>Windows Store Apps (UWP):</strong> Sysprep often fails if provisioned Store apps have been updated or if multiple users have interacted with them. The generalization process tries to clean up app packages, which can fail. Common practice involves removing problematic provisioned apps <em>before</em> running Sysprep, often using PowerShell cmdlets like <code class="language-plaintext highlighter-rouge">Get-AppxPackage | Remove-AppxPackage</code> and <code class="language-plaintext highlighter-rouge">Get-AppxProvisionedPackage | Remove-AppxProvisionedPackage</code>. Consult Microsoft documentation for “Sysprep fails UWP apps” for current recommendations and scripts.</li>
  <li><strong>Domain Membership:</strong> The reference machine <strong>must not</strong> be joined to an Active Directory domain when you run <code class="language-plaintext highlighter-rouge">sysprep /generalize</code>. Remove it from the domain first if necessary. Domain join should happen post-deployment.</li>
  <li><strong>Encryption:</strong> Full Disk Encryption (like BitLocker) must be disabled or fully decrypted <em>before</em> running Sysprep. Re-enable encryption after deployment.</li>
</ul><hr />
  <h3 id="step-7-capture-the-image">
    
    
     <a href="#step-7-capture-the-image">#</a><a href="#" aria-label="Back to top">Step 7: Capture the Image</a>
        
    
  </h3>
      

<p>With the reference machine shut down in a generalized state, you need to boot it using WinPE and capture the Windows installation partition into a deployable image file (<code class="language-plaintext highlighter-rouge">.wim</code>).</p>

<ol>
  <li><strong>Boot into Windows PE:</strong>
    <ul>
      <li>Boot the reference machine from your prepared Windows PE boot media (USB drive, DVD, or PXE network boot). Ensure the WinPE version corresponds to the ADK version used.</li>
    </ul>
  </li>
  <li><strong>Identify Volumes &amp; Prepare Storage:</strong>
    <ul>
      <li>Once WinPE loads to a command prompt, use <code class="language-plaintext highlighter-rouge">diskpart</code> again:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">diskpart</code></li>
          <li><code class="language-plaintext highlighter-rouge">list volume</code> -&gt; Identify the drive letter assigned to the main Windows partition you just Sysprepped (e.g., <code class="language-plaintext highlighter-rouge">C:</code>). Note its size.</li>
          <li><code class="language-plaintext highlighter-rouge">list volume</code> -&gt; Identify the drive letter for the location where you want to save the captured <code class="language-plaintext highlighter-rouge">.wim</code> image file. This needs sufficient free space (often 15-30GB or more). It could be:
            <ul>
              <li>Another partition on the local drive.</li>
              <li>An external USB drive (e.g., <code class="language-plaintext highlighter-rouge">D:</code>).</li>
              <li>A network share. If using a network share, map it first: <code class="language-plaintext highlighter-rouge">net use Z: \\YourFileServer\ImageShare /user:YourDomain\YourUser YourPassword</code> (Replace placeholders). Let’s assume the target is <code class="language-plaintext highlighter-rouge">D:\Images</code>.</li>
            </ul>
          </li>
          <li><code class="language-plaintext highlighter-rouge">exit</code> (to leave diskpart).</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Create Target Directory (If Needed):</strong>
    <ul>
      <li>Ensure the directory where you intend to save the image exists. For example, if saving to <code class="language-plaintext highlighter-rouge">D:\Images</code>:
        <pre><code class="language-cmd">md D:\Images
</code></section>
      </li>
    </ul>
  </li>
  <li><strong>Capture the Image using DISM:</strong>
    <ul>
      <li>Use the <code class="language-plaintext highlighter-rouge">DISM /Capture-Image</code> command. This reads the contents of the specified Windows partition and saves them into a compressed <code class="language-plaintext highlighter-rouge">.wim</code> file.</li>
    </ul>

    <pre><code class="language-cmd">DISM /Capture-Image /ImageFile:D:\Images\Win11EntN23H2_Sysprep.wim /CaptureDir:C:\ /Name:"Windows 11 Enterprise N 23H2 Sysprepped" /Description:"Base Image Win11 Ent N 23H2 - Captured on 2025-04-17" /Compress:max /CheckIntegrity /Verify
</code></section>
    <ul>
      <li><strong>Command Breakdown:</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/ImageFile:D:\Images\Win11EntN23H2_Sysprep.wim</code>: Specifies the full path and filename for the output <code class="language-plaintext highlighter-rouge">.wim</code> image file. Choose a descriptive name.</li>
          <li><code class="language-plaintext highlighter-rouge">/CaptureDir:C:\</code>: Specifies the <strong>root</strong> directory of the Windows installation partition you want to capture (the drive letter identified in WinPE).</li>
          <li><code class="language-plaintext highlighter-rouge">/Name:"Windows 11 Enterprise N 23H2 Sysprepped"</code>: Assigns a human-readable name to the image <em>inside</em> the WIM file (a WIM can contain multiple images).</li>
          <li><code class="language-plaintext highlighter-rouge">/Description:"Base Image Win11 Ent N 23H2 - Captured on 2025-04-17"</code>: Adds a description metadata tag to the image (using a static date here for clarity).</li>
          <li><code class="language-plaintext highlighter-rouge">/Compress:max</code>: Sets the compression level. Options are <code class="language-plaintext highlighter-rouge">max</code> (best compression, slowest capture), <code class="language-plaintext highlighter-rouge">fast</code> (less compression, faster capture), or <code class="language-plaintext highlighter-rouge">none</code>. <code class="language-plaintext highlighter-rouge">Max</code> is generally recommended for saving storage space.</li>
          <li><code class="language-plaintext highlighter-rouge">/CheckIntegrity</code>: Instructs DISM to detect and track <code class="language-plaintext highlighter-rouge">.wim</code> file corruption during the operation.</li>
          <li><code class="language-plaintext highlighter-rouge">/Verify</code>: Checks for errors and file duplication after capture. Both <code class="language-plaintext highlighter-rouge">/CheckIntegrity</code> and <code class="language-plaintext highlighter-rouge">/Verify</code> add time but increase confidence in the captured image’s integrity.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Wait:</strong> The image capture process will show progress (e.g., <code class="language-plaintext highlighter-rouge">[==========================100.0%==========================]</code>). This can take a considerable amount of time (anywhere from 15 minutes to over an hour) depending on the size of the Windows installation, the speed of the source and destination storage, and the chosen compression level.</li>
  <li><strong>Completion:</strong> Once DISM reports <code class="language-plaintext highlighter-rouge">The operation completed successfully.</code>, your deployable WIM image (<code class="language-plaintext highlighter-rouge">Win11EntN23H2_Sysprep.wim</code>) is ready on your target storage location (<code class="language-plaintext highlighter-rouge">D:\Images</code> in this example). You can now safely shut down the WinPE environment using the command: <code class="language-plaintext highlighter-rouge">wpeutil shutdown</code>.</li>
</ol><hr />
  <h3 id="troubleshooting-common-sysprep-failures">
    
    
     <a href="#troubleshooting-common-sysprep-failures">#</a><a href="#" aria-label="Back to top">Troubleshooting Common Sysprep Failures</a>
        
    
  </h3>
      

<p>If <code class="language-plaintext highlighter-rouge">sysprep /generalize</code> fails, investigate the log files for specific error messages. Key logs are typically found in:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">%WINDIR%\System32\Sysprep\Panther\setupact.log</code>: Detailed log of Sysprep actions.</li>
  <li><code class="language-plaintext highlighter-rouge">%WINDIR%\System32\Sysprep\Panther\setuperr.log</code>: Summary of errors encountered.</li>
  <li>(Older logs might be in <code class="language-plaintext highlighter-rouge">%WINDIR%\Panther\</code>)</li>
</ul>

<p>Common causes of failure include:</p>
<ul>
  <li><strong>Provisioned App Packages:</strong> As mentioned in Limitations, issues removing or generalizing built-in UWP apps are frequent culprits. Search the logs for errors related to specific package names and attempt removal using PowerShell before re-running Sysprep.</li>
  <li><strong>Running Processes/Services:</strong> A third-party service or application interfering with file/registry access needed by Sysprep.</li>
  <li><strong>Disk Space Issues:</strong> Insufficient disk space on the system drive.</li>
  <li><strong>Corrupted System Files:</strong> Run <code class="language-plaintext highlighter-rouge">sfc /scannow</code> before Sysprep.</li>
  <li><strong>Exceeding Generalization Limit:</strong> If the image has been generalized too many times.</li>
  <li><strong>System is Upgraded:</strong> Sysprep running on an in-place upgraded OS.</li>
</ul>

<p>Addressing the specific error messages found in the logs is key to resolving failures.</p><hr />
  <h3 id="conclusion-and-next-steps">
    
    
     <a href="#conclusion-and-next-steps">#</a><a href="#" aria-label="Back to top">Conclusion and Next Steps</a>
        
    
  </h3>
      

<p>Your generalized Windows 11 Enterprise N (23H2) image (<code class="language-plaintext highlighter-rouge">.wim</code> file) is now successfully created and captured. This image serves as a master template for deploying a standardized, pre-configured Windows environment.</p>

<p><strong>Deployment:</strong> This captured <code class="language-plaintext highlighter-rouge">.wim</code> image can now be deployed using various methods:</p>
<ul>
  <li><strong>Microsoft Deployment Toolkit (MDT):</strong> A free, powerful framework for automating OS deployment, driver injection, application installation, and more.</li>
  <li><strong>Microsoft Endpoint Configuration Manager (SCCM/ConfigMgr):</strong> An enterprise-grade solution for large-scale OS deployment, software distribution, and endpoint management.</li>
  <li><strong>Manual DISM /Apply-Image:</strong> Use DISM commands within WinPE to manually partition a target disk and apply the captured <code class="language-plaintext highlighter-rouge">.wim</code> image.</li>
  <li><strong>Other Third-Party Deployment Tools:</strong> Many other tools can deploy WIM images.</li>
</ul>

        </div>
        
          URL: https://ib.bsb.br/sysprep
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/windows11-incus/" title="Windows 11 within an Incus VM" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/dual-booting-windows-server-2003-linux-by-shrinking-ws2003-ntfs-partition/" title="Dual-Booting Windows Server 2003 & linux by shrinking WS2003 NTFS Partition" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "aid>software>windows"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-aid-software-windows" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/safeguard-windows/" title="Safeguard Windows 11 customization" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/clipse-listener-systemd-user-service/" title="Clipse Listener Systemd User Service" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    <div class="comment-box">
      Ref. 
      <a href="https://www.vernalex.com/guides/sysprep/index.shtml" title="https://www.vernalex.com/guides/sysprep/index.shtml">https://www.vernalex.com/guides/sysprep/index.shtml</a>
    </div>
    
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-06-18 05:25:49
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="aid-software-windows">
                  aid>software>windows
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/sysprep/"
        },
        "headline": "Requirements for sysprep.bat on Windows (Server 2003 + Win11)",
        "description": "",
        "datePublished": "2025-04-16T00:00:00+00:00",
        "dateModified": "2025-04-17T18:02:07+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
