<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        Maximizing VM Performance with Incus v2 - infoBAG
      
    </title>
    <meta name="title" content="Maximizing VM Performance with Incus v2 - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/maximizing-vm-performance-with-incus-v2/">
    <meta property="og:title" content="Maximizing VM Performance with Incus v2 - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/maximizing-vm-performance-with-incus-v2/">
    <meta name="twitter:title" content="Maximizing VM Performance with Incus v2 - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/maximizing-vm-performance-with-incus-v2/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="scratchpad">
      
        <meta property="article:tag" content="scratchpad">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          Maximizing VM Performance with Incus v2
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2025-05-19T00:00:00+00:00" class="post-date">
          19 May 2025
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-05-19T09:10:31+00:00">
              19 May 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/maximizing-vm-performance-with-incus-v2" class="tag">maximizing-vm-performance-with-incus-v2</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#scratchpad" class="tag">scratchpad</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        14418 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        2488 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2025-05-19-maximizing-vm-performance-with-incus-v2.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2025-05-19-maximizing-vm-performance-with-incus-v2.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          

          <p>Incus for Maximum Single VM Performance</p>

<p><strong>IMPORTANT NOTE:</strong> This guide provides a comprehensive approach to dedicating maximum resources to a single Incus virtual machine. Many values (e.g., <code class="language-plaintext highlighter-rouge">performant-vm</code>, CPU core lists like <code class="language-plaintext highlighter-rouge">1-7</code>, memory allocations like <code class="language-plaintext highlighter-rouge">60GiB</code>, disk paths like <code class="language-plaintext highlighter-rouge">/dev/sdb1</code>, network interfaces like <code class="language-plaintext highlighter-rouge">enp3s0</code>) are <strong>examples</strong>. You <strong>MUST</strong> adapt these to your specific hardware, total resources, and virtual machine requirements. Incorrectly applying these settings, especially kernel parameters or PCI passthrough, can lead to system instability or data loss. Proceed with caution and ensure you understand each step.</p>

<p><strong>I. Ubuntu Server Host Optimizations (The “Lean Hypervisor” Layer)</strong></p>

<p>The goal is to minimize the host OS’s footprint and tune it for optimal resource allocation to the VM.</p>

<p>1.  <strong>Minimal Installation:</strong>
    *   Start with the most minimal Ubuntu Server 25 installation. Avoid desktop environments, graphical tools, or any server roles not strictly required for Incus or essential system management.
    *   During installation, if prompted, deselect optional software bundles. Consider a “netboot” or “minimal ISO” if available.</p>

<p>2.  <strong>Disable Unnecessary Services:</strong>
    *   Audit and disable services that don’t contribute to running Incus or the VM.
        <code class="language-plaintext highlighter-rouge">bash
        sudo systemctl list-unit-files --type=service --state=enabled
        # Example: Disable apport, snapd (if not used for Incus), motd-news
        sudo systemctl stop apport snapd motd-news.timer
        sudo systemctl disable apport snapd motd-news.timer
       </code>
    *   Be cautious and ensure you understand a service’s role before disabling it.</p>

<p>3.  <strong>Kernel Boot Parameters (GRUB Configuration):</strong>
    <em>   Modify <code class="language-plaintext highlighter-rouge">/etc/default/grub</code> and add parameters to <code class="language-plaintext highlighter-rouge">GRUB_CMDLINE_LINUX_DEFAULT</code>. These significantly impact performance and resource isolation.
        *   <strong>Example for an 8-core CPU (0-7), reserving cores 1-7 for the VM, core 0 for the host:</strong>
            <code class="language-plaintext highlighter-rouge">isolcpus=1-7 nohz_full=1-7 rcu_nocbs=1-7</code>
        *   <strong>IOMMU (Essential for PCI Passthrough):</strong>
            <code class="language-plaintext highlighter-rouge">intel_iommu=on</code> (for Intel) or <code class="language-plaintext highlighter-rouge">amd_iommu=on iommu=pt</code> (for AMD; <code class="language-plaintext highlighter-rouge">iommu=pt</code> can improve passthrough compatibility).
        *   <strong>CPU P-State Control (for finer frequency management):</strong>
            <code class="language-plaintext highlighter-rouge">intel_pstate=disable</code> (for Intel, to use <code class="language-plaintext highlighter-rouge">acpi-cpufreq</code>) or <code class="language-plaintext highlighter-rouge">amd_pstate=passive</code> (for AMD).
        *   <strong>HugePages (Pre-allocation at boot):</strong>
            <code class="language-plaintext highlighter-rouge">hugepagesz=1G hugepages=30</code> (Example for 30GB of 1GB pages) or <code class="language-plaintext highlighter-rouge">hugepagesz=2M hugepages=15360</code> (Example for 30GB of 2MB pages). Adjust <code class="language-plaintext highlighter-rouge">hugepages</code> count based on VM memory.
        *   <strong>Security vs. Performance (Use with Extreme Caution):</strong>
            <code class="language-plaintext highlighter-rouge">mitigations=off</code> <strong>SECURITY RISK!</strong> Disables CPU speculative execution mitigations (e.g., Spectre/Meltdown). This can significantly boost performance but makes your system vulnerable. *Only consider this if the machine is in a highly trusted, isolated environment and performance is the absolute priority over security.</em>
    *   <strong>Combined Example for <code class="language-plaintext highlighter-rouge">GRUB_CMDLINE_LINUX_DEFAULT</code>:</strong>
        <code class="language-plaintext highlighter-rouge">"quiet splash isolcpus=1-7 nohz_full=1-7 rcu_nocbs=1-7 intel_iommu=on intel_pstate=disable hugepagesz=1G hugepages=30"</code> (Adapt for your core count, CPU type, and HugePage needs).
    *   After editing <code class="language-plaintext highlighter-rouge">/etc/default/grub</code>:
        <code class="language-plaintext highlighter-rouge">bash
        sudo update-grub
        sudo reboot
       </code>
    *   <strong>NUMA Consideration:</strong> If your system has multiple NUMA nodes (check with <code class="language-plaintext highlighter-rouge">lscpu</code>), ensure the cores specified in <code class="language-plaintext highlighter-rouge">isolcpus</code> belong to the same NUMA node to which you’ll also pin the VM’s memory and, ideally, passthrough devices.</p>

<p>4.  <strong>CPU Governor and Frequency:</strong>
    *   Set the CPU frequency scaling governor to <code class="language-plaintext highlighter-rouge">performance</code> for all cores (as host activity on isolated cores will be minimal, and dedicated cores should run at max).
        <code class="language-plaintext highlighter-rouge">bash
        sudo apt update &amp;&amp; sudo apt install -y cpufrequtils
        echo 'GOVERNOR="performance"' | sudo tee /etc/default/cpufrequtils
        sudo systemctl disable ondemand # Or other conservative governors
        sudo systemctl enable --now cpufrequtils
        # Verify: cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
       </code></p>

<p>5.  <strong>Memory: Swappiness and HugePages (Runtime):</strong>
    *   <strong>Swappiness:</strong> Reduce the host’s tendency to swap.
        <code class="language-plaintext highlighter-rouge">bash
        sudo sysctl vm.swappiness=1
        # Make permanent: echo 'vm.swappiness=1' | sudo tee -a /etc/sysctl.conf
       </code>
    *   <strong>HugePages (Runtime allocation if not done via kernel params or for adjustment):</strong>
        1.  Determine hugepage size: <code class="language-plaintext highlighter-rouge">cat /proc/meminfo | grep Hugepagesize</code> (usually 2MB or 1GB)
        2.  Allocate (example for 15360 pages of 2MB size, totaling ~30GB):
            <code class="language-plaintext highlighter-rouge">bash
            echo 15360 | sudo tee /proc/sys/vm/nr_hugepages
            # Make permanent: echo 'vm.nr_hugepages=15360' | sudo tee -a /etc/sysctl.conf
            # Ensure hugetlbfs is mounted: sudo mount -t hugetlbfs none /dev/hugepages (if not already)
           </code></p>

<p>6.  <strong>Disk I/O Scheduler:</strong>
    *   For NVMe drives, <code class="language-plaintext highlighter-rouge">none</code> is often best. For SATA SSDs, <code class="language-plaintext highlighter-rouge">mq-deadline</code> or <code class="language-plaintext highlighter-rouge">kyber</code>.
        <code class="language-plaintext highlighter-rouge">bash
        # Check current scheduler for nvme0n1:
        cat /sys/block/nvme0n1/queue/scheduler
        # Set to none for nvme0n1:
        echo none | sudo tee /sys/block/nvme0n1/queue/scheduler
       </code>
    *   <strong>Make persistent via udev rules:</strong> Create <code class="language-plaintext highlighter-rouge">/etc/udev/rules.d/60-ioschedulers.rules</code>:
        <code class="language-plaintext highlighter-rouge">
        ACTION=="add|change", KERNEL=="nvme[0-9]*n[0-9]*", ATTR{queue/scheduler}="none"
        ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/scheduler}="mq-deadline"
       </code>
        Reload rules: <code class="language-plaintext highlighter-rouge">sudo udevadm control --reload-rules &amp;&amp; sudo udevadm trigger</code></p>

<p>7.  <strong>IRQ Affinity (Advanced):</strong>
    *   Pin interrupts from high-throughput devices (NICs, storage controllers for VM) to host-reserved CPU cores (e.g., core 0 if <code class="language-plaintext highlighter-rouge">isolcpus=1-7</code>).
        1.  Identify device IRQs: <code class="language-plaintext highlighter-rouge">cat /proc/interrupts</code>
        2.  Disable <code class="language-plaintext highlighter-rouge">irqbalance</code> service: <code class="language-plaintext highlighter-rouge">sudo systemctl disable --now irqbalance</code>
        3.  Manually set affinity (e.g., pin IRQ <code class="language-plaintext highlighter-rouge">&lt;irq_num&gt;</code> to CPU0, mask is <code class="language-plaintext highlighter-rouge">1</code>):
            <code class="language-plaintext highlighter-rouge">echo 1 | sudo tee /proc/irq/&lt;irq_num&gt;/smp_affinity</code> (Replace <code class="language-plaintext highlighter-rouge">&lt;irq_num&gt;</code>)</p>

<p>8.  <strong>BIOS/UEFI Settings:</strong>
    *   Enable virtualization technologies: Intel VT-x, AMD-V.
    *   Enable IOMMU: Intel VT-d, AMD IOMMU/Vi.
    *   Disable aggressive power-saving features (deep C-states beyond C1/C2, BIOS-controlled frequency scaling if it interferes with OS control). Set power profiles to “Maximum Performance” or “OS Controlled.”
    *   Disable unused integrated peripherals (serial ports, audio).
    *   For NUMA systems: Ensure settings promote locality (e.g., memory interleaving might be “NUMA-aware” or “channel specific”).</p>

<p>9.  <strong>Consider <code class="language-plaintext highlighter-rouge">tuned</code> Utility:</strong>
    *   <code class="language-plaintext highlighter-rouge">tuned</code> can apply system-wide tuning profiles.
        <code class="language-plaintext highlighter-rouge">bash
        sudo apt install -y tuned
        sudo tuned-adm profile virtual-host
       </code>
    *   Review the profile and customize further if needed. Manual settings above might override or complement <code class="language-plaintext highlighter-rouge">tuned</code>.</p>

<p><strong>II. Incus Virtual Machine Configuration (Maximizing Resource Allocation)</strong></p>

<p>Configure the Incus VM (<code class="language-plaintext highlighter-rouge">performant-vm</code> in examples) to claim and efficiently use resources.</p>

<p>1.  <strong>CPU Allocation, Pinning, and Model:</strong>
    *   <strong><code class="language-plaintext highlighter-rouge">limits.cpu</code></strong>: Assign specific isolated host physical cores (e.g., host cores 1-7).
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.cpu 1-7
       </code>
    *   <strong><code class="language-plaintext highlighter-rouge">limits.cpu.allowance</code></strong>: Ensure 100% usage of assigned cores.
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.cpu.allowance 100%
       </code>
    *   <strong><code class="language-plaintext highlighter-rouge">limits.cpu.priority</code></strong>: Higher priority for VM tasks.
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.cpu.priority 10
       </code>
    *   <strong>CPU Model Passthrough (Expose Host CPU Features):</strong>
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm security.guest.features.cpu.host_passthrough=true
       </code>
    *   <strong>NUMA Pinning (If host cores 1-7 are on NUMA node 0):</strong>
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.cpu.nodes 0
       </code></p>

<p>2.  <strong>Memory Allocation:</strong>
    *   <strong><code class="language-plaintext highlighter-rouge">limits.memory</code></strong>: Allocate desired RAM (e.g., 60GiB for a 64GB system, leaving 4GB for host).
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.memory 60GiB
       </code>
    *   <strong><code class="language-plaintext highlighter-rouge">limits.memory.hugepages</code></strong>: Enable VM to use host-configured HugePages.
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.memory.hugepages true
       </code>
        Ensure <code class="language-plaintext highlighter-rouge">limits.memory</code> is a multiple of the hugepage size.
    *   <strong><code class="language-plaintext highlighter-rouge">limits.memory.enforce</code></strong>: Ensure VM gets its allocated memory.
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.memory.enforce hard
       </code>
    *   <strong>NUMA Pinning (Pin memory to the same NUMA node as CPUs, e.g., node 0):</strong>
        <code class="language-plaintext highlighter-rouge">bash
        incus config set performant-vm limits.memory.nodes 0
       </code></p>

<p>3.  <strong>Disk I/O Performance:</strong>
    *   <strong>Storage Backend:</strong>
        *   <strong>Direct Block Device Passthrough (Recommended for single disk performance):</strong>
            <code class="language-plaintext highlighter-rouge">bash
            # Example: Pass through /dev/sdb1 as the VM's root disk
            incus config device add performant-vm rootdisk disk source=/dev/sdb1 path=/
           </code>
        *   <strong>Or, LVM/ZFS Pool (Flexible, good for SSD/NVMe):</strong>
            <code class="language-plaintext highlighter-rouge">bash
            # Assuming 'mypool' is an existing LVM or ZFS storage pool on a fast device
            # incus storage volume create mypool vm_root_disk --type=block size=100GiB
            # incus config device add performant-vm rootdisk disk pool=mypool source=vm_root_disk path=/
            # For ZFS, consider pool/dataset tuning: atime=off, recordsize=128k (or match workload)
            # zfs set recordsize=128k mypool/virtual-machines/performant-vm.block # Example
            # zfs set atime=off mypool/virtual-machines/performant-vm.block # Example
           </code>
    *   <strong>Disk Cache Options for the device:</strong>
        <code class="language-plaintext highlighter-rouge">bash
        incus config device set performant-vm rootdisk cache none
       </code>
    *   <strong>I/O Mode:</strong>
        <code class="language-plaintext highlighter-rouge">bash
        incus config device set performant-vm rootdisk io writethrough
        # Modern QEMU often defaults well. `io_uring` is preferred if host kernel &amp; QEMU support it;
        # Incus may enable this automatically or via raw.qemu if needed for specific tuning.
       </code>
    *   Ensure the VM uses <code class="language-plaintext highlighter-rouge">virtio-blk</code> or <code class="language-plaintext highlighter-rouge">virtio-scsi</code> (usually default).</p>

<p>4.  <strong>Network I/O Performance:</strong>
    *   <strong>PCI Passthrough (SR-IOV or Full NIC for best performance):</strong>
        1.  Identify NIC PCI address: <code class="language-plaintext highlighter-rouge">lspci -nnk | grep -i ethernet</code>
        2.  (If SR-IOV) Create Virtual Function (VF) on the host.
        3.  Add to Incus VM (replace <code class="language-plaintext highlighter-rouge">enp3s0f0</code> with your host physical NIC or VF name):
            <code class="language-plaintext highlighter-rouge">bash
            incus config device add performant-vm eth0 nic nictype=physical parent=enp3s0f0
           </code>
    *   <strong><code class="language-plaintext highlighter-rouge">macvtap</code> (Good performance if PCI passthrough isn’t feasible):</strong>
        <code class="language-plaintext highlighter-rouge">bash
        # Replace enp2s0 with your host physical interface
        incus config device add performant-vm eth0 nic nictype=macvtap parent=enp2s0 mode=bridge
       </code>
        (<code class="language-plaintext highlighter-rouge">mode=bridge</code> allows host-guest communication. <code class="language-plaintext highlighter-rouge">private</code> or <code class="language-plaintext highlighter-rouge">vepa</code> modes restrict this).
    *   <strong>Multi-Queue <code class="language-plaintext highlighter-rouge">virtio-net</code> (N = number of vCPUs, or power of 2):</strong>
        <code class="language-plaintext highlighter-rouge">bash
        incus config device set performant-vm eth0 queues.rx 4
        incus config device set performant-vm eth0 queues.tx 4
        # Or if your Incus version supports a combined key:
        # incus config device set performant-vm eth0 queues 4
       </code></p>

<p>5.  <strong>Guest OS Considerations:</strong>
    *   Install <code class="language-plaintext highlighter-rouge">qemu-guest-agent</code> inside the VM for better integration (shutdown, time sync, etc.).
        *   Debian/Ubuntu guests: <code class="language-plaintext highlighter-rouge">sudo apt install qemu-guest-agent</code>
        *   RHEL/CentOS guests: <code class="language-plaintext highlighter-rouge">sudo yum install qemu-guest-agent</code>
    *   Ensure the guest OS uses virtio drivers for disk, network, etc. (standard for modern Linux).</p>

<p>6.  <strong>Disable Unused Virtual Hardware:</strong>
    *   Review <code class="language-plaintext highlighter-rouge">incus config show performant-vm --expanded</code>.
    *   If a USB tablet or other unneeded devices are present by default, consider removing them if not used:
        <code class="language-plaintext highlighter-rouge">bash
        # incus config device remove performant-vm &lt;device_name_from_expanded_config&gt;
       </code></p>

<p>7.  <strong><code class="language-plaintext highlighter-rouge">raw.qemu</code> (Use Sparingly for Advanced QEMU Options):</strong>
    *   For QEMU options not directly exposed by Incus. This is for advanced users.
        <code class="language-plaintext highlighter-rouge">bash
        # Example: incus config set performant-vm raw.qemu "-some-qemu-option value"
       </code></p>

<p><strong>III. Verification and Monitoring</strong></p>

<p>1.  <strong>Host Verification:</strong>
    *   Kernel parameters applied: <code class="language-plaintext highlighter-rouge">cat /proc/cmdline</code>
    *   CPU topology/NUMA: <code class="language-plaintext highlighter-rouge">lscpu</code>
    *   HugePages status: <code class="language-plaintext highlighter-rouge">cat /proc/meminfo | grep -i huge</code>
    *   QEMU process affinity (find PID of <code class="language-plaintext highlighter-rouge">performant-vm</code>’s QEMU process with <code class="language-plaintext highlighter-rouge">ps aux | grep qemu</code> or <code class="language-plaintext highlighter-rouge">incus info performant-vm --resources</code>): <code class="language-plaintext highlighter-rouge">taskset -cp &lt;qemu_pid&gt;</code> (should show affinity to isolated cores).
    *   I/O scheduler for devices: <code class="language-plaintext highlighter-rouge">cat /sys/block/nvme0n1/queue/scheduler</code></p>

<p>2.  <strong>Incus Verification:</strong>
    *   Full VM configuration: <code class="language-plaintext highlighter-rouge">incus config show performant-vm --expanded</code>
    *   VM status and resources: <code class="language-plaintext highlighter-rouge">incus info performant-vm</code> and <code class="language-plaintext highlighter-rouge">incus info performant-vm --resources</code></p>

<p>3.  <strong>Guest Verification (Inside the VM):</strong>
    *   CPU info: <code class="language-plaintext highlighter-rouge">lscpu</code>
    *   Memory: <code class="language-plaintext highlighter-rouge">free -h</code>, <code class="language-plaintext highlighter-rouge">cat /proc/meminfo | grep -i huge</code> (to see if guest is using hugepages from host)
    *   Kernel messages for hardware/driver info: <code class="language-plaintext highlighter-rouge">dmesg</code>
    *   Run relevant benchmarks (disk: <code class="language-plaintext highlighter-rouge">fio</code>; network: <code class="language-plaintext highlighter-rouge">iperf3</code>; CPU: <code class="language-plaintext highlighter-rouge">sysbench</code>, Phoronix Test Suite).</p>

<p>4.  <strong>Continuous Monitoring:</strong>
    *   <strong>Host:</strong> <code class="language-plaintext highlighter-rouge">htop</code> (observe CPU usage on isolated vs. host cores), <code class="language-plaintext highlighter-rouge">vmstat</code>, <code class="language-plaintext highlighter-rouge">iostat</code>, <code class="language-plaintext highlighter-rouge">perf top</code> (for deep dives).
    *   <strong>Incus:</strong> <code class="language-plaintext highlighter-rouge">incus top</code> (for Incus-specific metrics).</p>

<p><strong>IV. General Workflow &amp; Considerations</strong></p>

<p>*   <strong>Iterate and Benchmark:</strong> Performance tuning is often iterative. Change one major setting at a time and benchmark to observe its impact. What works best can be workload-dependent.
*   <strong>Stability is Paramount:</strong> While aiming for maximum performance, ensure the host and VM remain stable. An unstable host means an unstable VM.
*   <strong>Documentation:</strong> Document your specific changes and system configuration.
*   <strong>Recovery Plan:</strong> Before major GRUB or system config changes, ensure you have a way to recover (e.g., bootable USB, familiarity with recovery mode).
*   <strong>Incus Documentation:</strong> Specific commands and configuration keys can evolve. Always refer to the official Incus documentation for your version if you encounter discrepancies or need more detail.</p>

<p>By systematically applying these optimizations, you can significantly reduce overhead from both Ubuntu Server and Incus, allowing your primary virtual machine (<code class="language-plaintext highlighter-rouge">performant-vm</code>) to utilize the maximum available hardware resources and achieve performance much closer to bare-metal.</p>

        </div>
        
          URL: https://ib.bsb.br/maximizing-vm-performance-with-incus-v2
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/maximizing-vm-performance-with-incus-v1/" title="Maximizing VM Performance with Incus v1" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/messy-folder-reorganizer-documentation/" title="messy folder reorganizer documentation" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scratchpad"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scratchpad" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/messy-folder-reorganizer-documentation/" title="messy folder reorganizer documentation" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/maximizing-vm-performance-with-incus-v1/" title="Maximizing VM Performance with Incus v1" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2025-06-29 12:19:25
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="scratchpad">
                  scratchpad
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/maximizing-vm-performance-with-incus-v2/"
        },
        "headline": "Maximizing VM Performance with Incus v2",
        "description": "",
        "datePublished": "2025-05-19T00:00:00+00:00",
        "dateModified": "2025-05-19T09:10:31+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
