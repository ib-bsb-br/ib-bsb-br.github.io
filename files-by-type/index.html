<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        Organize files by type - infoBAG
      
    </title>
    <meta name="title" content="Organize files by type - infoBAG" />
    <meta name="description" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ib.bsb.br/files-by-type/">
    <meta property="og:title" content="Organize files by type - infoBAG">
    <meta property="og:description" content="">
    <meta property="og:image" content="/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://ib.bsb.br/files-by-type/">
    <meta name="twitter:title" content="Organize files by type - infoBAG">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/favicon.ico">
    <link rel="canonical" href="https://ib.bsb.br/files-by-type/">
    <link rel="alternate" type="application/rss+xml" title="infoBAG" href="https://ib.bsb.br/rss.xml">
    
      <meta name="keywords" content="software&gt;rust,scripts&gt;python">
      
        <meta property="article:tag" content="software&gt;rust">
      
        <meta property="article:tag" content="scripts&gt;python">
      
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="post-content-body">
    <header class="header-container">
      <nav aria-label="Main navigation" class="header-content">
        <a href="/" aria-label="Home">
          <img src="/favicon.ico" alt="Home" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/tags" aria-label="Tags">
          <img src="/assets/Label.gif" alt="Tags" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/send" aria-label="send">
          <img src="/assets/rot.gif" alt="send" class="favicon search-link" width="32" height="32" loading="lazy">
        </a> 
        <a href="/created" aria-label="archive created">
          <img src="/assets/Loose_Stone_Pile.gif" alt="archive created" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/events" aria-label="Events">
          <img src="/assets/Paralyse_Rune.gif" alt="Events" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
        <a href="/modified" aria-label="archive modified">
          <img src="/assets/Hole_(Rock).gif" alt="archive modified" class="favicon search-link" width="32" height="32" loading="lazy">
        </a>
    </nav>
      <h5 class="post-title">
        <a href="#bottom-of-page" aria-label="Go to bottom">
          Organize files by type
        </a>
      </h5>
      <div class="post-meta">
        <time datetime="2024-05-30T00:00:00+00:00" class="post-date">
          30 May 2024
        </time>
        
          <span class="post-updated">
            ↣
            <time datetime="2025-05-28T22:06:53+00:00">
              28 May 2025
            </time>
          </span>
        
        
          <p class="post-slug">
            Slug: <a href="https://ib.bsb.br/files-by-type" class="tag">files-by-type</a>
          </p>
        
        
          <p class="post-tags">
            Tags:
            
              <a href="https://ib.bsb.br/tags/#software-rust" class="tag">software>rust</a>
            
              <a href="https://ib.bsb.br/tags/#scripts-python" class="tag">scripts>python</a>
            
          </p>
        
      </div>
      <div class="post-actions">
        <div class="page-stats mt-3" role="status" aria-label="Page statistics">
      
      <span class="badge bg-primary">
        61180 characters
      </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
        5902 words
      </span>
      </div>
        <div class="action-buttons d-flex flex-wrap gap-2">
          
            
              <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/_posts/2024-05-30-files-by-type.md"
                    method="GET"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="d-inline-block">
                <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                  <span class="button-text">Improve this page?</span>
                  <span class="info-text">aberto.</span>
                </button>
              </form>
            
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/_posts/2024-05-30-files-by-type.md"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="View page revision history">
                View revision history
              </button>
            </form>
          
        </div>
      </div>
    </header>
    <main class="content">
      <article class="post-wrapper">
        <div class="post-content-body">
          
<ul><li><a href="#python-script-to-rename-files-without-extensions-by-mime-type">python script to rename files without extensions by mime-type</a></li><li><a href="#rust-approach">Rust approach</a><ul><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#creating-the-project">Creating the Project</a></li><li><a href="#building-the-project">Building the Project</a><ul><li><a href="#debug-build-for-development">Debug Build (For Development)</a></li><li><a href="#release-build-for-distribution">Release Build (For Distribution)</a></li></ul></li><li><a href="#running-the-tool">Running the Tool</a><ul><li><a href="#getting-help">Getting Help</a></li></ul></li><li><a href="#command-line-options">Command-Line Options</a><ul><li><a href="#basic-options">Basic Options</a></li><li><a href="#duplicate-handling-options">Duplicate Handling Options</a></li><li><a href="#advanced-options">Advanced Options</a></li></ul></li><li><a href="#organization-methods">Organization Methods</a></li><li><a href="#usage-examples-rust_file_organizer--s-homelinarodownloads2rust--t-homelinarodownloads---organize-by-extension---move-files---include-hidden---follow-links---timestamp-duplicates---remove-empty-source-dirs">Usage Examples <code class="language-plaintext highlighter-rouge">rust_file_organizer -s /home/linaro/Downloads/2rust/ -t /home/linaro/Downloads/ --organize-by extension --move-files --include-hidden --follow-links --timestamp-duplicates --remove-empty-source-dirs</code></a><ul><li><a href="#basic-file-organization-copy-by-category">Basic File Organization (Copy by Category)</a></li><li><a href="#moving-files--timestamping-duplicates">Moving Files &amp; Timestamping Duplicates</a></li><li><a href="#organizing-by-extension--including-hidden-files">Organizing by Extension &amp; Including Hidden Files</a></li><li><a href="#skipping-existing-files-during-copy">Skipping Existing Files During Copy</a></li><li><a href="#moving-files--cleaning-up-empty-source-directories">Moving Files &amp; Cleaning Up Empty Source Directories</a></li><li><a href="#using-a-custom-config-overwriting-logging-to-file">Using a Custom Config, Overwriting, Logging to File</a></li></ul></li><li><a href="#option-conflicts-and-dependencies">Option Conflicts and Dependencies</a></li><li><a href="#testing-your-installation">Testing Your Installation</a></li><li><a href="#configuration-file-format---config">Configuration File Format (<code class="language-plaintext highlighter-rouge">--config</code>)</a></li><li><a href="#troubleshooting">Troubleshooting</a><ul><li><a href="#common-issues">Common Issues</a></li><li><a href="#logging-for-diagnostics">Logging for Diagnostics</a></li></ul></li><li><a href="#mainrs">main.rs</a></li><li><a href="#python-approach">python approach</a></li></ul></li></ul>
          <h1 id="python-script-to-rename-files-without-extensions-by-mime-type">
    
    
     <a href="#python-script-to-rename-files-without-extensions-by-mime-type">#</a><a href="#" aria-label="Back to top">python script to rename files without extensions by mime-type</a>
        
    
  </h1>
      

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="c1">#!/usr/bin/env python
# -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">argparse</span>
<span class="kn">import</span> <span class="n">filetype</span> <span class="c1"># Assumes the h2non/filetype.py library is installed or in PYTHONPATH
</span>
<span class="k">def</span> <span class="nf">rename_files_in_directory</span><span class="p">(</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lowercase_ext</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Scans a directory (and optionally subdirectories) for files without extensions
    and renames them based on their detected file type using the </span><span class="sh">'</span><span class="s">filetype</span><span class="sh">'</span><span class="s"> library.

    Args:
        directory_path (str): The path to the directory to scan.
        dry_run (bool): If True, simulate renaming without actual changes.
        verbose (bool): If True, print more detailed output.
        recursive (bool): If True, process files in subdirectories as well.
        lowercase_ext (bool): If True, convert detected extensions to lowercase.
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error: Directory not found at </span><span class="sh">'</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Scanning </span><span class="si">{</span><span class="sh">'</span><span class="s">recursively </span><span class="sh">'</span> <span class="k">if</span> <span class="n">recursive</span> <span class="k">else</span> <span class="sh">''</span><span class="si">}</span><span class="s">in directory: </span><span class="sh">'</span><span class="si">{</span><span class="n">directory_path</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DRY RUN MODE: No files will actually be renamed.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lowercase_ext</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Extensions will be converted to lowercase.</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">renamed_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">type_unknown_skipped_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">target_exists_skipped_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">processed_files_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">already_has_ext_skipped_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Prepare file iteration
</span>    <span class="n">files_to_process</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files_in_current_dir</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">walk</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files_in_current_dir</span><span class="p">:</span>
                <span class="n">files_to_process</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
            <span class="c1"># Construct full path for files in the immediate directory
</span>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">files_to_process</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">original_filepath</span> <span class="ow">in</span> <span class="n">files_to_process</span><span class="p">:</span>
        <span class="n">processed_files_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Extract directory and filename for constructing new path later
</span>        <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">original_filepath</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">original_filepath</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">original_filepath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Skipping </span><span class="sh">'</span><span class="si">{</span><span class="n">original_filepath</span><span class="si">}</span><span class="sh">'</span><span class="s">: Not a regular file.</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">name_part</span><span class="p">,</span> <span class="n">ext_part</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ext_part</span><span class="p">:</span>  <span class="c1"># Process only if the file has no apparent extension
</span>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Processing </span><span class="sh">'</span><span class="si">{</span><span class="n">original_filepath</span><span class="si">}</span><span class="sh">'</span><span class="s">: Appears to have no extension.</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="n">filetype</span><span class="p">.</span><span class="nf">guess</span><span class="p">(</span><span class="n">original_filepath</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kind</span><span class="p">.</span><span class="n">extension</span><span class="p">:</span>
                    <span class="n">new_extension</span> <span class="o">=</span> <span class="n">kind</span><span class="p">.</span><span class="n">extension</span>
                    <span class="c1"># Ensure the new extension doesn't start with a dot
</span>                    <span class="k">if</span> <span class="n">new_extension</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">):</span>
                        <span class="n">new_extension</span> <span class="o">=</span> <span class="n">new_extension</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    
                    <span class="k">if</span> <span class="n">lowercase_ext</span><span class="p">:</span>
                        <span class="n">new_extension</span> <span class="o">=</span> <span class="n">new_extension</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
                    
                    <span class="c1"># name_part from splitext already contains the full name if no extension
</span>                    <span class="c1"># e.g. "myfile" -&gt; name_part="myfile"; ".bashrc" -&gt; name_part=".bashrc"
</span>                    <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name_part</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">new_extension</span><span class="si">}</span><span class="sh">"</span>
                    <span class="n">new_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Detected type: </span><span class="si">{</span><span class="n">kind</span><span class="p">.</span><span class="n">mime</span><span class="si">}</span><span class="s">, Suggested extension: </span><span class="sh">'</span><span class="si">{</span><span class="n">new_extension</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Proposed new name: </span><span class="sh">'</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">new_filepath</span><span class="p">):</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Warning: Target file </span><span class="sh">'</span><span class="si">{</span><span class="n">new_filepath</span><span class="si">}</span><span class="sh">'</span><span class="s"> already exists. Skipping rename of </span><span class="sh">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">'</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
                        <span class="n">target_exists_skipped_count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
                        <span class="n">os</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">original_filepath</span><span class="p">,</span> <span class="n">new_filepath</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Renamed </span><span class="sh">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">'</span><span class="s"> in </span><span class="sh">'</span><span class="si">{</span><span class="n">current_dir</span><span class="si">}</span><span class="sh">'</span><span class="s"> to </span><span class="sh">'</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>
                        <span class="n">renamed_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  DRY RUN: Would rename </span><span class="sh">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">'</span><span class="s"> in </span><span class="sh">'</span><span class="si">{</span><span class="n">current_dir</span><span class="si">}</span><span class="sh">'</span><span class="s"> to </span><span class="sh">'</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>
                        <span class="n">renamed_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># Count as if it were renamed for dry run summary
</span>                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Could not determine type or extension for </span><span class="sh">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">'</span><span class="s">. Skipping.</span><span class="sh">"</span><span class="p">)</span>
                    <span class="n">type_unknown_skipped_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Error processing </span><span class="sh">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Skipping </span><span class="sh">'</span><span class="si">{</span><span class="n">original_filepath</span><span class="si">}</span><span class="sh">'</span><span class="s">: Already has an extension (</span><span class="sh">'</span><span class="si">{</span><span class="n">ext_part</span><span class="si">}</span><span class="sh">'</span><span class="s">).</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">already_has_ext_skipped_count</span> <span class="o">+=</span><span class="mi">1</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">--- Summary ---</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Total files/items scanned or encountered: </span><span class="si">{</span><span class="n">processed_files_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Files that would be renamed: </span><span class="si">{</span><span class="n">renamed_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Files successfully renamed: </span><span class="si">{</span><span class="n">renamed_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Files skipped (already had extension): </span><span class="si">{</span><span class="n">already_has_ext_skipped_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Files skipped (type unknown/no suggested extension): </span><span class="si">{</span><span class="n">type_unknown_skipped_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Files skipped (target filename already exists): </span><span class="si">{</span><span class="n">target_exists_skipped_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Errors encountered during processing: </span><span class="si">{</span><span class="n">error_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">Rename files without extensions in a directory based on their detected type. Uses h2non/filetype.py.</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">RawTextHelpFormatter</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">directory</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">The path to the directory containing files to rename.</span><span class="sh">"</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">--dry-run</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Simulate renaming and show what changes would be made without actually modifying any files.</span><span class="sh">"</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">-v</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--verbose</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Enable verbose output, showing more details about the process.</span><span class="sh">"</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">-r</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--recursive</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Process files in subdirectories recursively.</span><span class="sh">"</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">--lowercase-ext</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Convert detected extensions to lowercase.</span><span class="sh">"</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="nf">rename_files_in_directory</span><span class="p">(</span>
        <span class="n">args</span><span class="p">.</span><span class="n">directory</span><span class="p">,</span> 
        <span class="n">args</span><span class="p">.</span><span class="n">dry_run</span><span class="p">,</span> 
        <span class="n">args</span><span class="p">.</span><span class="n">verbose</span><span class="p">,</span> 
        <span class="n">args</span><span class="p">.</span><span class="n">recursive</span><span class="p">,</span> 
        <span class="n">args</span><span class="p">.</span><span class="n">lowercase_ext</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></section></div></div>
  <h1 id="rust-approach">
    
    
     <a href="#rust-approach">#</a><a href="#" aria-label="Back to top">Rust approach</a>
        
    
  </h1>
      
  <h2 id="prerequisites">
    
    
     <a href="#prerequisites">#</a><a href="#" aria-label="Back to top">Prerequisites</a>
        
    
  </h2>
      

<p>Before you begin, you need to install Rust:</p>

<ol>
  <li>Visit <a href="https://rustup.rs/">https://rustup.rs/</a> to download the Rust installer.</li>
  <li>Run the installer to set up:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rustc</code> (the compiler)</li>
      <li><code class="language-plaintext highlighter-rouge">cargo</code> (the build tool and package manager)</li>
    </ul>
  </li>
</ol>
  <h2 id="creating-the-project">
    
    
     <a href="#creating-the-project">#</a><a href="#" aria-label="Back to top">Creating the Project</a>
        
    
  </h2>
      

<p>Open a command prompt or terminal (like PowerShell, CMD, or Git Bash) and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Create a new Rust project</span>
cargo new rust_file_organizer
<span class="nb">cd </span>rust_file_organizer

<span class="c"># Replace default files with project files</span>
<span class="c"># Replace the contents of Cargo.toml with the provided configuration (see below)</span>
<span class="c"># Replace the contents of src/main.rs with the provided source code (see below)</span>
</code></section></div></div>
  <h2 id="building-the-project">
    
    
     <a href="#building-the-project">#</a><a href="#" aria-label="Back to top">Building the Project</a>
        
    
  </h2>
      
  <h3 id="debug-build-for-development">
    
    
     <a href="#debug-build-for-development">#</a><a href="#" aria-label="Back to top">Debug Build (For Development)</a>
        
    
  </h3>
      

<p>Use this build for development and testing.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>cargo build
</code></section></div></div>

<p>The executable will be created in the <code class="language-plaintext highlighter-rouge">target/debug/rust_file_organizer.exe</code> directory.</p>
  <h3 id="release-build-for-distribution">
    
    
     <a href="#release-build-for-distribution">#</a><a href="#" aria-label="Back to top">Release Build (For Distribution)</a>
        
    
  </h3>
      

<p>Use this build for a smaller, optimized executable suitable for distribution.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>cargo build <span class="nt">--release</span>
</code></section></div></div>

<p>The executable will be created in the <code class="language-plaintext highlighter-rouge">target/release/rust_file_organizer.exe</code> directory.</p>
  <h2 id="running-the-tool">
    
    
     <a href="#running-the-tool">#</a><a href="#" aria-label="Back to top">Running the Tool</a>
        
    
  </h2>
      
  <h3 id="getting-help">
    
    
     <a href="#getting-help">#</a><a href="#" aria-label="Back to top">Getting Help</a>
        
    
  </h3>
      

<p>View the basic help message with available options:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-h</span>
</code></section></div></div>

<p>View the more detailed help message:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">--help</span>
</code></section></div></div>

<p><em>(Use <code class="language-plaintext highlighter-rouge">.\target\release\</code> instead of <code class="language-plaintext highlighter-rouge">.\target\debug\</code> if running the release build).</em></p>
  <h2 id="command-line-options">
    
    
     <a href="#command-line-options">#</a><a href="#" aria-label="Back to top">Command-Line Options</a>
        
    
  </h2>
      

<p>The Rust File Organizer requires two mandatory options:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--source &lt;DIR&gt;</code> or <code class="language-plaintext highlighter-rouge">-s &lt;DIR&gt;</code>: The source directory containing files to organize.</li>
  <li><code class="language-plaintext highlighter-rouge">--target &lt;DIR&gt;</code> or <code class="language-plaintext highlighter-rouge">-t &lt;DIR&gt;</code>: The target directory where organized files will be placed into subfolders.</li>
</ul>
  <h3 id="basic-options">
    
    
     <a href="#basic-options">#</a><a href="#" aria-label="Back to top">Basic Options</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Short</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--source &lt;DIR&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-s</code></td>
      <td style="text-align: left">Source directory to organize files from</td>
      <td style="text-align: left"><strong>(Required)</strong></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--target &lt;DIR&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-t</code></td>
      <td style="text-align: left">Target directory to place organized files</td>
      <td style="text-align: left"><strong>(Required)</strong></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--config &lt;FILE&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-c</code></td>
      <td style="text-align: left">Path to custom JSON configuration file</td>
      <td style="text-align: left">None (uses built-in defaults)</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--organize-by &lt;ORGANIZE_BY&gt;</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Organization method (<code class="language-plaintext highlighter-rouge">category</code>, <code class="language-plaintext highlighter-rouge">extension</code>)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">category</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--move-files</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Move files instead of copying them</td>
      <td style="text-align: left">False (copy mode)</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--include-hidden</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-i</code></td>
      <td style="text-align: left">Include hidden files and directories</td>
      <td style="text-align: left">False</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--follow-links</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-l</code></td>
      <td style="text-align: left">Follow symbolic links during directory traversal</td>
      <td style="text-align: left">False</td>
    </tr>
  </tbody>
</table>
  <h3 id="duplicate-handling-options">
    
    
     <a href="#duplicate-handling-options">#</a><a href="#" aria-label="Back to top">Duplicate Handling Options</a>
        
    
  </h3>
      

<p>These options control how the tool handles files that already exist in the target location with the same name. They conflict with each other – <strong>only use one</strong>. If none are specified, the default behavior is to <strong>overwrite</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Short</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--timestamp-duplicates</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Add timestamp to duplicate files</td>
      <td style="text-align: left">Disabled</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--skip-existing</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-k</code></td>
      <td style="text-align: left">Skip existing files in target</td>
      <td style="text-align: left">Disabled</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--overwrite</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"><strong>Explicitly</strong> overwrite existing files in target</td>
      <td style="text-align: left"><strong>Default Action</strong></td>
    </tr>
  </tbody>
</table>
  <h3 id="advanced-options">
    
    
     <a href="#advanced-options">#</a><a href="#" aria-label="Back to top">Advanced Options</a>
        
    
  </h3>
      

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Short</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--remove-empty-source-dirs</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Remove empty directories in source after moving files (requires <code class="language-plaintext highlighter-rouge">--move-files</code>)</td>
      <td style="text-align: left">False</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--log-file &lt;FILE&gt;</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Write logs to specified file (in addition to console)</td>
      <td style="text-align: left">None (console only)</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--log-level &lt;LOG_LEVEL&gt;</code></td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Set logging level (<code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">warn</code>, <code class="language-plaintext highlighter-rouge">info</code>, <code class="language-plaintext highlighter-rouge">debug</code>, <code class="language-plaintext highlighter-rouge">trace</code>)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">info</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--help</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-h</code></td>
      <td style="text-align: left">Print the concise help message and exit.</td>
      <td style="text-align: left">N/A</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--version</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-V</code></td>
      <td style="text-align: left">Print version information and exit.</td>
      <td style="text-align: left">N/A</td>
    </tr>
  </tbody>
</table>
  <h2 id="organization-methods">
    
    
     <a href="#organization-methods">#</a><a href="#" aria-label="Back to top">Organization Methods</a>
        
    
  </h2>
      

<p>The <code class="language-plaintext highlighter-rouge">--organize-by</code> option accepts the following values:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">category</code>: Organizes files into subfolders named by category, based on file extension mapping (default).</li>
  <li><code class="language-plaintext highlighter-rouge">extension</code>: Organizes files into subfolders named directly by their file extension (e.g., <code class="language-plaintext highlighter-rouge">.txt</code>, <code class="language-plaintext highlighter-rouge">.jpg</code>).</li>
</ul>
  <h2 id="usage-examples-rust_file_organizer--s-homelinarodownloads2rust--t-homelinarodownloads---organize-by-extension---move-files---include-hidden---follow-links---timestamp-duplicates---remove-empty-source-dirs">
    
    
     <a href="#usage-examples-rust_file_organizer--s-homelinarodownloads2rust--t-homelinarodownloads---organize-by-extension---move-files---include-hidden---follow-links---timestamp-duplicates---remove-empty-source-dirs">#</a><a href="#" aria-label="Back to top">Usage Examples <code class="language-plaintext highlighter-rouge">rust_file_organizer -s /home/linaro/Downloads/2rust/ -t /home/linaro/Downloads/ --organize-by extension --move-files --include-hidden --follow-links --timestamp-duplicates --remove-empty-source-dirs</code></a>
        
    
  </h2>
      

<p><em>(Remember to replace <code class="language-plaintext highlighter-rouge">YourUser</code>, <code class="language-plaintext highlighter-rouge">C:\Path\To\Source</code>, etc., with your actual paths. Examples use the debug build path.)</em></p>
  <h3 id="basic-file-organization-copy-by-category">
    
    
     <a href="#basic-file-organization-copy-by-category">#</a><a href="#" aria-label="Back to top">Basic File Organization (Copy by Category)</a>
        
    
  </h3>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">--source</span> C:<span class="se">\U</span>sers<span class="se">\Y</span>ourUser<span class="se">\D</span>ownloads <span class="nt">--target</span> C:<span class="se">\O</span>rganizedFiles
</code></section></div></div>
  <h3 id="moving-files--timestamping-duplicates">
    
    
     <a href="#moving-files--timestamping-duplicates">#</a><a href="#" aria-label="Back to top">Moving Files &amp; Timestamping Duplicates</a>
        
    
  </h3>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">--source</span> C:<span class="se">\U</span>sers<span class="se">\Y</span>ourUser<span class="se">\D</span>ownloads <span class="nt">--target</span> C:<span class="se">\O</span>rganizedFiles <span class="nt">--move-files</span> <span class="nt">--timestamp-duplicates</span>
</code></section></div></div>
  <h3 id="organizing-by-extension--including-hidden-files">
    
    
     <a href="#organizing-by-extension--including-hidden-files">#</a><a href="#" aria-label="Back to top">Organizing by Extension &amp; Including Hidden Files</a>
        
    
  </h3>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-s</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ath</span><span class="se">\T</span><span class="s2">o</span><span class="se">\S</span><span class="s2">ource"</span> <span class="nt">-t</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ath</span><span class="se">\T</span><span class="s2">o</span><span class="se">\T</span><span class="s2">arget"</span> <span class="nt">--organize-by</span> extension <span class="nt">--include-hidden</span>
</code></section></div></div>
  <h3 id="skipping-existing-files-during-copy">
    
    
     <a href="#skipping-existing-files-during-copy">#</a><a href="#" aria-label="Back to top">Skipping Existing Files During Copy</a>
        
    
  </h3>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-s</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ath</span><span class="se">\T</span><span class="s2">o</span><span class="se">\S</span><span class="s2">ource"</span> <span class="nt">-t</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ath</span><span class="se">\T</span><span class="s2">o</span><span class="se">\T</span><span class="s2">arget"</span> <span class="nt">--skip-existing</span>
</code></section></div></div>
  <h3 id="moving-files--cleaning-up-empty-source-directories">
    
    
     <a href="#moving-files--cleaning-up-empty-source-directories">#</a><a href="#" aria-label="Back to top">Moving Files &amp; Cleaning Up Empty Source Directories</a>
        
    
  </h3>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-s</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ath</span><span class="se">\T</span><span class="s2">o</span><span class="se">\S</span><span class="s2">ource"</span> <span class="nt">-t</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ath</span><span class="se">\T</span><span class="s2">o</span><span class="se">\T</span><span class="s2">arget"</span> <span class="nt">--move-files</span> <span class="nt">--remove-empty-source-dirs</span>
</code></section></div></div>
  <h3 id="using-a-custom-config-overwriting-logging-to-file">
    
    
     <a href="#using-a-custom-config-overwriting-logging-to-file">#</a><a href="#" aria-label="Back to top">Using a Custom Config, Overwriting, Logging to File</a>
        
    
  </h3>
      

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-s</span> .<span class="se">\i</span>nput <span class="nt">-t</span> .<span class="se">\o</span>utput <span class="nt">-c</span> .<span class="se">\m</span>y_config.json <span class="nt">--overwrite</span> <span class="nt">--log-file</span> activity.log <span class="nt">--log-level</span> debug
</code></section></div></div>
  <h2 id="option-conflicts-and-dependencies">
    
    
     <a href="#option-conflicts-and-dependencies">#</a><a href="#" aria-label="Back to top">Option Conflicts and Dependencies</a>
        
    
  </h2>
      

<ul>
  <li><strong>Duplicate Handling</strong>: <code class="language-plaintext highlighter-rouge">--timestamp-duplicates</code>, <code class="language-plaintext highlighter-rouge">--skip-existing</code>, and <code class="language-plaintext highlighter-rouge">--overwrite</code> conflict. Use at most one. Default is overwrite if none are specified.</li>
  <li><strong>Empty Directory Removal</strong>: <code class="language-plaintext highlighter-rouge">--remove-empty-source-dirs</code> requires <code class="language-plaintext highlighter-rouge">--move-files</code> to be active.</li>
</ul>
  <h2 id="testing-your-installation">
    
    
     <a href="#testing-your-installation">#</a><a href="#" aria-label="Back to top">Testing Your Installation</a>
        
    
  </h2>
      

<p>After building, verify it works:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code><span class="c"># Create test directories (using PowerShell/CMD syntax)</span>
<span class="nb">mkdir </span>test_source test_target

<span class="c"># Copy some test files (e.g., image.jpg, document.pdf) into test_source</span>

<span class="c"># Run the organizer</span>
.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-s</span> .<span class="se">\t</span>est_source <span class="nt">-t</span> .<span class="se">\t</span>est_target

<span class="c"># Check the test_target directory for organized subfolders (e.g., images, documents)</span>
</code></section></div></div>
  <h2 id="configuration-file-format---config">
    
    
     <a href="#configuration-file-format---config">#</a><a href="#" aria-label="Back to top">Configuration File Format (<code class="language-plaintext highlighter-rouge">--config</code>)</a>
        
    
  </h2>
      

<p>Provide a JSON file mapping category names (strings) to lists of file extensions (strings, including the leading dot).</p>

<p>Example <code class="language-plaintext highlighter-rouge">my_config.json</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><section><code><span class="p">{</span><span class="w">
  </span><span class="nl">"images"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">".jpg"</span><span class="p">,</span><span class="w"> </span><span class="s2">".jpeg"</span><span class="p">,</span><span class="w"> </span><span class="s2">".png"</span><span class="p">,</span><span class="w"> </span><span class="s2">".gif"</span><span class="p">,</span><span class="w"> </span><span class="s2">".bmp"</span><span class="p">,</span><span class="w"> </span><span class="s2">".webp"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">".pdf"</span><span class="p">,</span><span class="w"> </span><span class="s2">".docx"</span><span class="p">,</span><span class="w"> </span><span class="s2">".doc"</span><span class="p">,</span><span class="w"> </span><span class="s2">".txt"</span><span class="p">,</span><span class="w"> </span><span class="s2">".rtf"</span><span class="p">,</span><span class="w"> </span><span class="s2">".odt"</span><span class="p">,</span><span class="w"> </span><span class="s2">".xlsx"</span><span class="p">,</span><span class="w"> </span><span class="s2">".xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">".csv"</span><span class="p">,</span><span class="w"> </span><span class="s2">".pptx"</span><span class="p">,</span><span class="w"> </span><span class="s2">".ppt"</span><span class="p">,</span><span class="w"> </span><span class="s2">".md"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"archives"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">".zip"</span><span class="p">,</span><span class="w"> </span><span class="s2">".rar"</span><span class="p">,</span><span class="w"> </span><span class="s2">".tar"</span><span class="p">,</span><span class="w"> </span><span class="s2">".gz"</span><span class="p">,</span><span class="w"> </span><span class="s2">".7z"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">".rs"</span><span class="p">,</span><span class="w"> </span><span class="s2">".py"</span><span class="p">,</span><span class="w"> </span><span class="s2">".js"</span><span class="p">,</span><span class="w"> </span><span class="s2">".html"</span><span class="p">,</span><span class="w"> </span><span class="s2">".css"</span><span class="p">,</span><span class="w"> </span><span class="s2">".java"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"other"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></section></div></div>

<ul>
  <li>An <code class="language-plaintext highlighter-rouge">"other"</code> category is recommended to catch files whose extensions don’t match other categories. If organizing by category and a file doesn’t match any defined category (and no <code class="language-plaintext highlighter-rouge">"other"</code> category exists), it might be skipped or handled less predictably depending on implementation details. The built-in default configuration includes an “other” category.</li>
  <li>If a file has no extension, it will typically be placed in a <code class="language-plaintext highlighter-rouge">no_extension</code> folder when organizing by extension, or potentially skipped/placed in “other” when organizing by category.</li>
</ul>
  <h2 id="troubleshooting">
    
    
     <a href="#troubleshooting">#</a><a href="#" aria-label="Back to top">Troubleshooting</a>
        
    
  </h2>
      
  <h3 id="common-issues">
    
    
     <a href="#common-issues">#</a><a href="#" aria-label="Back to top">Common Issues</a>
        
    
  </h3>
      

<ol>
  <li><strong>Permission Errors</strong>: Ensure the application has read permissions for the entire source directory tree and write/create permissions for the target directory. Run as administrator if necessary, but be cautious.</li>
  <li><strong>Path Not Found</strong>: Double-check that the source and target paths are spelled correctly and accessible from where you are running the command. Use absolute paths if relative paths are causing issues.</li>
  <li><strong>Duplicate Handling</strong>: If files aren’t being handled as expected (e.g., overwritten when you wanted skipping), verify which duplicate handling flag (<code class="language-plaintext highlighter-rouge">--skip-existing</code>, <code class="language-plaintext highlighter-rouge">--timestamp-duplicates</code>, <code class="language-plaintext highlighter-rouge">--overwrite</code>) is active or if the default overwrite behavior is occurring.</li>
  <li><strong>Cross-Device Move Errors</strong>: If moving files (<code class="language-plaintext highlighter-rouge">--move-files</code>) between different drives or partitions fails, the tool attempts a copy-then-delete fallback. Ensure there’s enough space on the target drive for the copy.</li>
  <li><strong>Configuration File Errors</strong>: If using <code class="language-plaintext highlighter-rouge">--config</code>, ensure the JSON file is correctly formatted and the path is correct. Check logs for parsing errors.</li>
</ol>
  <h3 id="logging-for-diagnostics">
    
    
     <a href="#logging-for-diagnostics">#</a><a href="#" aria-label="Back to top">Logging for Diagnostics</a>
        
    
  </h3>
      

<p>Use the logging options to get more detailed information:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--log-level debug</code> or <code class="language-plaintext highlighter-rouge">--log-level trace</code>: Provides much more detailed output about scanning, decisions, and operations.</li>
  <li><code class="language-plaintext highlighter-rouge">--log-file &lt;path/to/logfile.log&gt;</code>: Writes all logs to a file, making it easier to review extensive output.</li>
</ul>

<p>Example for detailed logging to a file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><section><code>.<span class="se">\t</span>arget<span class="se">\d</span>ebug<span class="se">\r</span>ust_file_organizer.exe <span class="nt">-s</span> &lt;<span class="nb">source</span><span class="o">&gt;</span> <span class="nt">-t</span> &lt;target&gt; <span class="nt">--log-level</span> trace <span class="nt">--log-file</span> organizer.log
</code></section></div></div>

<p>Review the console output and the specified log file (<code class="language-plaintext highlighter-rouge">organizer.log</code> in the example) for specific error messages or steps where the process might be failing.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><section><code>
## Cargo.toml

```toml
# Cargo.toml (Fixed fern feature)
[package]
name = "rust_file_organizer"
version = "0.1.0"
edition = "2021"
description = "A Rust utility for organizing files by category or extension."
authors = ["AI Assistant"] # Replace with actual author
license = "MIT OR Apache-2.0" # Choose appropriate license

[dependencies]
# Command-line argument parsing
clap = { version = "4.5", features = ["derive", "cargo", "env"] } # cargo/env features allow reading from Cargo.toml/env vars

# Directory traversal
walkdir = "2.5"

# JSON parsing for configuration files
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# Logging framework
log = "0.4"
# Using fern for flexible file/console logging setup
# **Fix:** Enable the 'colored' feature for fern
fern = { version = "0.6", features = ["colored"] }

# Date and time handling for timestamps
chrono = "0.4"

# Flexible error handling and context reporting
anyhow = "1.0"

# Optional: More robust file operations (especially cross-device move)
# fs_extra = "1.3" # Keep commented unless needed; std lib fallback implemented

# Windows-specific dependencies are NOT needed here as std lib is used for hidden check
# [target.'cfg(windows)'.dependencies]
# windows = { version = "0.56", features = [...] }

# Release profile optimizations (optional but recommended for smaller/faster executables)
[profile.release]
# 'z' optimizes aggressively for size, potentially sacrificing some speed compared to 's' or '3'.
opt-level = 'z'
# Enable Link-Time Optimization across crates for potential performance gains and size reduction.
lto = true
# Maximize optimization opportunities by using a single codegen unit (can significantly increase compile times).
codegen-units = 1
# Remove symbols from the binary for smaller size.
# Alternatively, use `cargo strip` (requires `cargo install cargo-strip`) or set `debuginfo = 0` (removes debug symbols only).
strip = true
# Abort on panic instead of unwinding the stack. Reduces binary size but prevents catching panics.
panic = 'abort'
</code></section></div></div>
  <h2 id="mainrs">
    
    
     <a href="#mainrs">#</a><a href="#" aria-label="Back to top">main.rs</a>
        
    
  </h2>
      

<section class="code-block-container" role="group" aria-label="Rust Code Block" data-filename="rust_code_block.rs" data-code="// src/main.rs: Rust implementation of the file organizer utility.
// This version fixes compilation errors and ensures completeness.

use anyhow::{bail, Context, Result}; // Use anyhow for convenient error handling
use clap::Parser; // For command-line argument parsing
use chrono::Local; // For generating timestamps
use fern::colors::{Color, ColoredLevelConfig}; // For colored logging output
use log::{debug, error, info, warn, LevelFilter}; // Logging facade
use serde::Deserialize; // For deserializing JSON config
use std::{
    collections::{HashMap, HashSet},
    env, // For CARGO_PKG_VERSION
    // Removed unused &#39;File&#39; import
    fs::{self}, // Standard file system operations
    io::{self, ErrorKind},
    path::{Path, PathBuf},
    time::Instant, // For accurate duration measurement
};
use walkdir::{DirEntry, WalkDir}; // For efficient directory traversal

// --- Configuration Structures ---

/// Represents the structure of the JSON configuration file for categories.
#[derive(Deserialize, Debug, Clone)]
struct CategoriesConfig(HashMap&lt;String, Vec&lt;String&gt;&gt;);

/// Provides the default file categorization configuration.
fn default_categories() -&gt; CategoriesConfig {
    let mut map = HashMap::new();
    macro_rules! add_category {
($map:expr, $name:expr, [$($ext:expr),* $(,)?]) =&gt; {
    $map.insert($name.to_string(), vec![$($ext.to_string()),*]);
};
    }
    add_category!(map, &quot;images&quot;, [&quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.png&quot;, &quot;.gif&quot;, &quot;.bmp&quot;, &quot;.webp&quot;, &quot;.tiff&quot;, &quot;.svg&quot;, &quot;.ico&quot;]);
    add_category!(map, &quot;documents&quot;, [&quot;.pdf&quot;, &quot;.docx&quot;, &quot;.doc&quot;, &quot;.txt&quot;, &quot;.rtf&quot;, &quot;.odt&quot;, &quot;.xlsx&quot;, &quot;.xls&quot;, &quot;.csv&quot;, &quot;.pptx&quot;, &quot;.ppt&quot;, &quot;.md&quot;, &quot;.tex&quot;, &quot;.chm&quot;, &quot;.epub&quot;]);
    add_category!(map, &quot;videos&quot;, [&quot;.mp4&quot;, &quot;.avi&quot;, &quot;.mkv&quot;, &quot;.mov&quot;, &quot;.wmv&quot;, &quot;.flv&quot;, &quot;.webm&quot;]);
    add_category!(map, &quot;audio&quot;, [&quot;.mp3&quot;, &quot;.wav&quot;, &quot;.flac&quot;, &quot;.aac&quot;, &quot;.ogg&quot;, &quot;.m4a&quot;]);
    add_category!(map, &quot;archives&quot;, [&quot;.zip&quot;, &quot;.rar&quot;, &quot;.tar&quot;, &quot;.gz&quot;, &quot;.bz2&quot;, &quot;.7z&quot;, &quot;.iso&quot;]);
    add_category!(map, &quot;code&quot;, [&quot;.py&quot;, &quot;.java&quot;, &quot;.c&quot;, &quot;.cpp&quot;, &quot;.h&quot;, &quot;.cs&quot;, &quot;.html&quot;, &quot;.css&quot;, &quot;.js&quot;, &quot;.ts&quot;, &quot;.jsx&quot;, &quot;.tsx&quot;, &quot;.xml&quot;, &quot;.json&quot;, &quot;.yaml&quot;, &quot;.yml&quot;, &quot;.sh&quot;, &quot;.bat&quot;, &quot;.ps1&quot;, &quot;.rb&quot;, &quot;.php&quot;, &quot;.go&quot;, &quot;.rs&quot;, &quot;.swift&quot;, &quot;.kt&quot;, &quot;.ipynb&quot;, &quot;.sql&quot;, &quot;.toml&quot;]);
    add_category!(map, &quot;apps&quot;, [&quot;.exe&quot;, &quot;.msi&quot;, &quot;.apk&quot;, &quot;.dmg&quot;, &quot;.deb&quot;, &quot;.rpm&quot;, &quot;.app&quot;]);
    add_category!(map, &quot;fonts&quot;, [&quot;.ttf&quot;, &quot;.otf&quot;, &quot;.woff&quot;, &quot;.woff2&quot;]);
    add_category!(map, &quot;shortcuts&quot;, [&quot;.lnk&quot;, &quot;.url&quot;]);
    map.insert(&quot;other&quot;.to_string(), vec![]);
    CategoriesConfig(map)
}

/// Loads category configuration from a specified JSON file path.
fn load_config_file(config_path: Option&lt;&amp;PathBuf&gt;) -&gt; Result&lt;CategoriesConfig&gt; {
    match config_path {
Some(path) if path.is_file() =&gt; {
    info!(&quot;Loading category configuration from: {}&quot;, path.display());
    let file_content = fs::read_to_string(path)
.with_context(|| format!(&quot;Failed to read config file: {}&quot;, path.display()))?;
    let mut config: HashMap&lt;String, Vec&lt;String&gt;&gt; = serde_json::from_str(&amp;file_content)
.with_context(|| format!(&quot;Failed to parse JSON config file: {}&quot;, path.display()))?;
    config.entry(&quot;other&quot;.to_string()).or_insert_with(Vec::new);
    info!(&quot;Successfully loaded and validated custom configuration.&quot;);
    Ok(CategoriesConfig(config))
}
Some(path) =&gt; {
    warn!(
&quot;Config path &#39;{}&#39; provided but is not a valid file. Using default categories.&quot;,
path.display()
    );
    Ok(default_categories())
}
None =&gt; {
    info!(&quot;No config file specified. Using default category configuration.&quot;);
    Ok(default_categories())
}
    }
}

/// Determines the category name (String) for a given file based on its extension.
fn categorize_file(filename: &amp;Path, categories_config: &amp;CategoriesConfig) -&gt; String {
    let extension = filename
.extension()
.and_then(|s| s.to_str())
.map(|s| format!(&quot;.{}&quot;, s.to_lowercase()))
.unwrap_or_else(|| &quot;no_extension&quot;.to_string());
    if extension == &quot;no_extension&quot; { return extension; }
    for (category, extensions) in &amp;categories_config.0 {
if extensions.contains(&amp;extension) { return category.clone(); }
    }
    &quot;other&quot;.to_string()
}

// --- Platform Specific ---

/// Checks if a file or directory is hidden on Windows using standard library features.
#[cfg(windows)]
fn is_hidden(path: &amp;Path) -&gt; Result&lt;bool&gt; {
    use std::os::windows::fs::MetadataExt;
    let metadata = fs::metadata(path)
.with_context(|| format!(&quot;Failed to get metadata for {}&quot;, path.display()))?;
    let attributes = metadata.file_attributes();
    // Use the raw value 0x2 for FILE_ATTRIBUTE_HIDDEN when using std::os::windows::fs
    const FILE_ATTRIBUTE_HIDDEN_VALUE: u32 = 0x2;
    Ok((attributes &amp; FILE_ATTRIBUTE_HIDDEN_VALUE) != 0)
}

/// Checks if a file or directory is hidden on Unix-like systems (conventionally, starts with &#39;.&#39;).
#[cfg(not(windows))]
fn is_hidden(path: &amp;Path) -&gt; Result&lt;bool&gt; {
    Ok(path
.file_name()
.and_then(|s| s.to_str())
.map(|s| s.starts_with(&#39;.&#39;))
.unwrap_or(false))
}

/// Helper for walkdir filter_entry to check hidden status.
fn should_keep_entry(entry: &amp;DirEntry, include_hidden: bool) -&gt; bool {
    if include_hidden { return true; }
    match is_hidden(entry.path()) {
Ok(hidden) =&gt; !hidden,
Err(err) =&gt; {
    warn!(
&quot;Could not determine hidden status for {}: {}. Excluding entry.&quot;,
entry.path().display(), err
    );
    false // Exclude if check fails (safer default)
}
    }
}

// --- Command Line Arguments ---

#[derive(clap::ValueEnum, Clone, Debug, PartialEq, Eq)]
enum OrganizeMethod { Category, Extension, }

#[derive(Parser, Debug)]
#[command(author, version, about = &quot;Organize files by category or extension (Rust version).&quot;,
    long_about = &quot;A Rust utility for organizing files from source directories into categorized target folders based on file types or extensions.&quot;,
    help_template = &quot;{before-help}{name} {version}\n{author-with-newline}{about-with-newline}\n{usage-heading} {usage}\n\n{all-args}{after-help}&quot;
)]
struct CliArgs {
    #[arg(short, long, value_name = &quot;DIR&quot;)] source: PathBuf,
    #[arg(short, long, value_name = &quot;DIR&quot;)] target: PathBuf,
    #[arg(short, long, value_name = &quot;FILE&quot;)] config: Option&lt;PathBuf&gt;,
    #[arg(long, value_enum, default_value_t = OrganizeMethod::Category)] organize_by: OrganizeMethod,
    #[arg(long)] move_files: bool,
    #[arg(long, conflicts_with_all = [&quot;skip_existing&quot;, &quot;overwrite&quot;])] timestamp_duplicates: bool,
    #[arg(long, short = &#39;k&#39;, conflicts_with_all = [&quot;timestamp_duplicates&quot;, &quot;overwrite&quot;])] skip_existing: bool,
    #[arg(long, conflicts_with_all = [&quot;timestamp_duplicates&quot;, &quot;skip_existing&quot;])] overwrite: bool,
    #[arg(long, short = &#39;i&#39;)] include_hidden: bool,
    #[arg(long, short = &#39;l&#39;)] follow_links: bool,
    #[arg(long, requires = &quot;move_files&quot;)] remove_empty_source_dirs: bool,
    #[arg(long, value_name = &quot;FILE&quot;)] log_file: Option&lt;PathBuf&gt;,
    #[arg(long, value_parser = clap::value_parser!(LevelFilter), default_value = &quot;info&quot;)] log_level: LevelFilter,
}

// --- Core Logic ---

/// Holds statistics about the file processing operation.
#[derive(Debug, Default)]
struct ProcessStats {
    /// Count of directory entries successfully yielded by the filtered WalkDir iterator.
    total_scanned: u64,
    processed: u64,
    skipped: u64,
    errors: u64,
    failed_files: Vec&lt;(PathBuf, String)&gt;, // Stores paths and error context
}

/// Scans the source directory for unique file extensions.
fn get_all_extensions(
    source_directory: &amp;Path,
    include_hidden: bool,
    follow_links: bool,
) -&gt; Result&lt;HashSet&lt;String&gt;&gt; {
    let mut extensions = HashSet::new();
    info!(&quot;Scanning source directory for all unique file extensions...&quot;);
    let walker = WalkDir::new(source_directory)
.follow_links(follow_links)
.into_iter();
    let mut count = 0;
    for entry_result in walker.filter_entry(|e| should_keep_entry(e, include_hidden)) {
match entry_result {
    Ok(entry) =&gt; {
let path = entry.path();
if path.is_file() {
    count += 1;
    if let Some(ext) = path.extension().and_then(|e| e.to_str()) {
extensions.insert(ext.to_lowercase());
    }
    if count % 1000 == 0 { debug!(&quot;Scanned {} files for extensions...&quot;, count); }
}
    }
    Err(e) =&gt; warn!(&quot;Error accessing entry during extension scan: {}&quot;, e),
}
    }
    info!(&quot;Found {} unique extensions.&quot;, extensions.len());
    Ok(extensions)
}

/// Creates necessary target subfolders.
fn create_target_folders(
    base_dir: &amp;Path,
    organize_by: &amp;OrganizeMethod,
    categories_config: Option&lt;&amp;CategoriesConfig&gt;,
    all_extensions: Option&lt;&amp;HashSet&lt;String&gt;&gt;,
) -&gt; Result&lt;()&gt; {
    info!(&quot;Ensuring target base directory exists: {}&quot;, base_dir.display());
    fs::create_dir_all(base_dir)
.with_context(|| format!(&quot;Failed to create base target directory: {}&quot;, base_dir.display()))?;
    let folders_to_create: HashSet&lt;String&gt; = match organize_by {
OrganizeMethod::Category =&gt; {
    let mut folders = categories_config
.map(|cfg| cfg.0.keys().cloned().collect::&lt;HashSet&lt;String&gt;&gt;())
.unwrap_or_default();
    folders.insert(&quot;other&quot;.to_string());
    folders.insert(&quot;no_extension&quot;.to_string());
    folders
}
OrganizeMethod::Extension =&gt; {
    let mut folders = all_extensions.cloned().unwrap_or_default();
    folders.insert(&quot;no_extension&quot;.to_string());
    folders
}
    };
    info!(
&quot;Creating target subfolders (mode: {:?}). Total potential folders: {}&quot;,
organize_by,
folders_to_create.len()
    );
    let mut created_count = 0;
    for folder_name in &amp;folders_to_create {
if folder_name.is_empty() { warn!(&quot;Skipping creation of folder with empty name.&quot;); continue; }
let folder_path = base_dir.join(folder_name);
if !folder_path.exists() {
    fs::create_dir_all(&amp;folder_path).with_context(|| {
format!(&quot;Failed to create target folder &#39;{}&#39;&quot;, folder_path.display())
    })?;
    debug!(&quot;Created target folder: {}&quot;, folder_path.display());
    created_count += 1;
}
    }
    info!(&quot;Created {} new target subfolders.&quot;, created_count);
    Ok(())
}

/// Attempts to move a file, falling back to copy-then-delete on cross-device errors.
fn move_file_with_fallback(source: &amp;Path, target: &amp;Path) -&gt; io::Result&lt;()&gt; {
    match fs::rename(source, target) {
Ok(_) =&gt; Ok(()),
Err(rename_error) =&gt; {
    // Note: Relies on platform-specific OS error codes (Windows: 17, Unix: 18/libc::EXDEV). Might be brittle.
    let is_cross_device = || -&gt; bool {
#[cfg(windows)] { rename_error.raw_os_error() == Some(17) }
#[cfg(unix)] { rename_error.raw_os_error() == Some(18) }
#[cfg(not(any(windows, unix)))] { false }
    };
    if is_cross_device() {
warn!(&quot;Rename failed (cross-device error detected), attempting copy+delete fallback for move: {} -&gt; {}&quot;, source.display(), target.display());
// Note: std::fs::copy preserves permissions but not other metadata like modification time (unlike Python&#39;s shutil.copy2).
// For full metadata preservation, consider crates like `fs_extra` or platform-specific APIs.
fs::copy(source, target)?;
fs::remove_file(source)?;
Ok(())
    } else { Err(rename_error) }
}
    }
}


/// Main function to perform the file organization.
fn organize_files(args: &amp;CliArgs, categories_config: &amp;CategoriesConfig) -&gt; Result&lt;ProcessStats&gt; {
    if !args.source.is_dir() { bail!(&quot;Source directory &#39;{}&#39; is invalid or not found.&quot;, args.source.display()); }
    if !args.target.exists() {
info!(&quot;Creating target directory: {}&quot;, args.target.display());
fs::create_dir_all(&amp;args.target).with_context(|| format!(&quot;Could not create target directory &#39;{}&#39;&quot;, args.target.display()))?;
    } else if !args.target.is_dir() { bail!(&quot;Target path &#39;{}&#39; exists but is not a directory.&quot;, args.target.display()); }

    info!(&quot;Preparing target folders...&quot;);
    let extensions_for_folders = if args.organize_by == OrganizeMethod::Extension {
Some(get_all_extensions(&amp;args.source, args.include_hidden, args.follow_links)?)
    } else { None };
    create_target_folders(&amp;args.target, &amp;args.organize_by, Some(categories_config), extensions_for_folders.as_ref())?;

    info!(&quot;Starting file processing...&quot;);
    let mut stats = ProcessStats::default();
    let mut file_counter = 0u64;
    let walker = WalkDir::new(&amp;args.source).follow_links(args.follow_links).into_iter();

    for entry_result in walker.filter_entry(|e| should_keep_entry(e, args.include_hidden)) {
stats.total_scanned += 1; // Count filtered entries
let entry = match entry_result {
    Ok(e) =&gt; e,
    Err(e) =&gt; {
let path_display = e.path().unwrap_or_else(|| Path::new(&quot;?&quot;)).display();
error!(&quot;Error scanning path {}: {}&quot;, path_display, e);
stats.errors += 1;
// Provide default PathBuf if e.path() is None
stats.failed_files.push((
    e.path().map_or_else(|| PathBuf::from(&quot;?&quot;), |p| p.to_path_buf()),
    format!(&quot;Scan error: {:?}&quot;, e),
));
continue;
    }
};

if !entry.file_type().is_file() { stats.skipped += 1; continue; }

file_counter += 1;
let source_path = entry.path();
let progress_prefix = format!(&quot;[{}]&quot;, file_counter);

let file_result: Result&lt;()&gt; = (|| {
    let file_name = source_path.file_name().with_context(|| format!(&quot;Could not get filename for path: {}&quot;, source_path.display()))?;
    let target_subfolder_name = match args.organize_by {
OrganizeMethod::Category =&gt; categorize_file(source_path, categories_config),
OrganizeMethod::Extension =&gt; source_path.extension().and_then(|s| s.to_str()).map(|s| s.to_lowercase()).unwrap_or_else(|| &quot;no_extension&quot;.to_string()),
    };
    let target_folder_path = args.target.join(&amp;target_subfolder_name);
    let mut target_file_path = target_folder_path.join(file_name);

    if target_file_path.exists() {
if args.skip_existing {
    info!(&quot;{} Skipping (target exists): {}&quot;, progress_prefix, target_file_path.display());
    stats.skipped += 1; return Ok(());
} else if args.timestamp_duplicates {
    let original_target_path_display = target_file_path.display().to_string();
    let mut counter = 1;
    // Use file_name directly, it&#39;s already &amp;OsStr
    let stem = source_path.file_stem().unwrap_or(file_name);
    let ext = source_path.extension().unwrap_or_default();
    const MAX_TIMESTAMP_ATTEMPTS: u32 = 1000;
    loop {
let timestamp = Local::now().format(&quot;%Y%m%d_%H%M%S&quot;);
let mut new_name_os = std::ffi::OsString::new();
new_name_os.push(stem);
new_name_os.push(format!(&quot;_{}_{}&quot;, timestamp, counter));
if !ext.is_empty() { new_name_os.push(&quot;.&quot;); new_name_os.push(ext); }
target_file_path = target_folder_path.join(&amp;new_name_os);
if !target_file_path.exists() { break; }
counter += 1;
if counter &gt; MAX_TIMESTAMP_ATTEMPTS { bail!(&quot;Could not find unique timestamped name for {} after {} attempts. Skipping.&quot;, original_target_path_display, MAX_TIMESTAMP_ATTEMPTS); }
    }
    info!(&quot;{} Target exists &#39;{}&#39;. Renaming duplicate to: {}&quot;, progress_prefix, original_target_path_display, target_file_path.display());
} else if args.overwrite { warn!(&quot;{} Overwriting existing target file: {}&quot;, progress_prefix, target_file_path.display()); }
else { warn!(&quot;{} Overwriting existing target file (default): {}&quot;, progress_prefix, target_file_path.display()); }
    }

    fs::create_dir_all(&amp;target_folder_path).with_context(|| format!(&quot;Failed to ensure target directory &#39;{}&#39; exists&quot;, target_folder_path.display()))?;
    let operation_desc = if args.move_files { &quot;move&quot; } else { &quot;copy&quot; };
    debug!(&quot;{} Attempting to {} &#39;{}&#39; to &#39;{}&#39;&quot;, progress_prefix, operation_desc, source_path.display(), target_file_path.display());

    if args.move_files {
move_file_with_fallback(source_path, &amp;target_file_path).with_context(|| format!(&quot;Failed to move &#39;{}&#39; to &#39;{}&#39;&quot;, source_path.display(), target_file_path.display()))?;
    } else {
// Note: std::fs::copy preserves permissions but not other metadata like modification time (unlike Python&#39;s shutil.copy2).
// For full metadata preservation, consider crates like `fs_extra` or platform-specific APIs.
fs::copy(source_path, &amp;target_file_path).map(|_| ()).with_context(|| format!(&quot;Failed to copy &#39;{}&#39; to &#39;{}&#39;&quot;, source_path.display(), target_file_path.display()))?;
    }
    stats.processed += 1;
    Ok(())
})(); // End inner closure

if let Err(e) = file_result {
    error!(&quot;{} Failed to process &#39;{}&#39;: {:?}&quot;, progress_prefix, source_path.display(), e);
    stats.errors += 1;
    stats.failed_files.push((source_path.to_path_buf(), format!(&quot;{:?}&quot;, e)));
}
    } // End main loop

    Ok(stats)
}

/// Recursively removes empty folders starting from the bottom up.
fn remove_empty_folders(directory: &amp;Path) -&gt; Result&lt;u32&gt; {
    let mut removed_count = 0u32;
    info!(&quot;Attempting to remove empty directories within: {}&quot;, directory.display());
    let mut dirs_to_check = Vec::new();
    for entry_result in WalkDir::new(directory).min_depth(1) {
match entry_result {
    Ok(entry) if entry.file_type().is_dir() =&gt; { dirs_to_check.push(entry.into_path()); }
    Ok(_) =&gt; {}
    Err(e) =&gt; warn!(&quot;Error accessing entry during empty dir scan: {}&quot;, e),
}
    }
    dirs_to_check.sort_by(|a, b| b.components().count().cmp(&amp;a.components().count()));
    for dir_path in dirs_to_check {
if !dir_path.is_dir() { continue; }
match fs::read_dir(&amp;dir_path) {
    Ok(mut read_dir) =&gt; {
if read_dir.next().is_none() { // Directory is empty
    match fs::remove_dir(&amp;dir_path) {
Ok(_) =&gt; { info!(&quot;Removed empty directory: {}&quot;, dir_path.display()); removed_count += 1; }
Err(e) =&gt; { if e.kind() != ErrorKind::NotFound { warn!(&quot;Could not remove presumably empty directory &#39;{}&#39;: {}&quot;, dir_path.display(), e); } }
    }
}
    }
    Err(e) =&gt; { if e.kind() != ErrorKind::NotFound { warn!(&quot;Could not read directory &#39;{}&#39; to check emptiness: {}&quot;, dir_path.display(), e); } }
}
    }
    info!(&quot;Finished removing empty directories. Removed: {}&quot;, removed_count);
    Ok(removed_count)
}

// --- Logging Setup ---
/// Sets up logging using the fern crate.
fn setup_logging(log_level: LevelFilter, log_file: Option&lt;&amp;PathBuf&gt;) -&gt; Result&lt;()&gt; {
    let colors = ColoredLevelConfig::new().error(Color::Red).warn(Color::Yellow).info(Color::Green).debug(Color::Blue).trace(Color::BrightBlack);
    let base_config = fern::Dispatch::new()
.format(move |out, message, record| {
    out.finish(format_args!(
&quot;[{} {} {}] {}&quot;,
chrono::Local::now().format(&quot;%Y-%m-%d %H:%M:%S%.3f&quot;), colors.color(record.level()), record.target(), message
    ))
})
.level(log_level)
.level_for(&quot;hyper&quot;, LevelFilter::Warn).level_for(&quot;mio&quot;, LevelFilter::Warn).level_for(&quot;want&quot;, LevelFilter::Warn).level_for(&quot;reqwest&quot;, LevelFilter::Warn).level_for(&quot;rustls&quot;, LevelFilter::Warn);
    let stderr_logger = fern::Dispatch::new().filter(move |metadata| { log_level &lt;= LevelFilter::Debug || metadata.target().starts_with(env!(&quot;CARGO_PKG_NAME&quot;)) }).chain(std::io::stderr());
    let mut final_dispatch = base_config.chain(stderr_logger);
    let mut file_logger_ok = false;
    if let Some(log_path) = log_file {
match fern::log_file(log_path) {
    Ok(file_output) =&gt; { final_dispatch = final_dispatch.chain(file_output); file_logger_ok = true; }
    Err(e) =&gt; { eprintln!(&quot;Error: Failed to create log file &#39;{}&#39;: {}. Logging to console only.&quot;, log_path.display(), e); }
}
    }
    final_dispatch.apply().context(&quot;Failed to set up logging&quot;)?;
    if file_logger_ok { if let Some(path) = log_file { info!(&quot;File logging enabled to: {}&quot;, path.display()); } }
    Ok(())
}


// --- Main Application Entry Point ---
fn main() -&gt; Result&lt;()&gt; {
    let overall_start_time = Instant::now(); // Start timing
    let args = CliArgs::parse();
    setup_logging(args.log_level, args.log_file.as_ref())?;

    info!(&quot;Rust File Organizer (v{}) starting...&quot;, env!(&quot;CARGO_PKG_VERSION&quot;));
    debug!(&quot;Arguments received: {:?}&quot;, args);
    info!(&quot;Source directory: {}&quot;, args.source.display());
    info!(&quot;Target directory: {}&quot;, args.target.display());
    info!(&quot;Organization mode: {:?}&quot;, args.organize_by);
    info!(&quot;Operation: {}&quot;, if args.move_files { &quot;Move&quot; } else { &quot;Copy&quot; });
    info!(&quot;Include hidden: {}&quot;, args.include_hidden);
    info!(&quot;Follow links: {}&quot;, args.follow_links);
    if args.skip_existing { info!(&quot;Duplicate handling: Skip existing&quot;); }
    else if args.timestamp_duplicates { info!(&quot;Duplicate handling: Timestamp duplicates&quot;); }
    else if args.overwrite { info!(&quot;Duplicate handling: Overwrite existing (explicitly)&quot;); }
    else { info!(&quot;Duplicate handling: Overwrite existing (default)&quot;); }

    let categories = load_config_file(args.config.as_ref())?;
    let result = organize_files(&amp;args, &amp;categories);

    match result {
Ok(stats) =&gt; {
    if args.move_files &amp;&amp; args.remove_empty_source_dirs &amp;&amp; stats.processed &gt; 0 {
// Note: Cleanup errors are logged but do not cause a non-zero exit code.
if let Err(e) = remove_empty_folders(&amp;args.source) { error!(&quot;Error during empty source directory removal: {:?}&quot;, e); }
    }
    let overall_duration = overall_start_time.elapsed();
    let summary = format!(
&quot;Operation completed in {:.2?}. Scanned Entries: {}, Processed Files: {}, Skipped: {}, Errors: {}&quot;,
overall_duration, stats.total_scanned, stats.processed, stats.skipped, stats.errors
    );
    info!(&quot;{}&quot;, summary);
    println!(&quot;\n{}&quot;, summary);
    if stats.errors &gt; 0 {
eprintln!(&quot;\n--- Errors occurred during processing: ---&quot;);
for (path, error_msg) in &amp;stats.failed_files {
    eprintln!(&quot; - File: {}&quot;, path.display());
    eprintln!(&quot;   Error: {}&quot;, error_msg);
}
eprintln!(&quot;-----------------------------------------&quot;);
eprintln!(&quot;Warning: {} errors occurred. Please check logs (stderr/file) for full details.&quot;, stats.errors);
// Consider exiting with non-zero status for scripting if errors occurred
// std::process::exit(1);
    }
}
Err(e) =&gt; {
    error!(&quot;Critical error during file organization: {:?}&quot;, e);
    eprintln!(&quot;\nError: File organization failed critically. Check logs (stderr/file) for details.&quot;);
    std::process::exit(1);
}
    }
    info!(&quot;Rust File Organizer finished.&quot;);
    Ok(())
}

// --- Testing Notes ---
// To properly test this application, consider using crates like:
// - `assert_fs`: For creating temporary file/directory structures for tests.
// - `predicates`: For making assertions about file system state (e.g., file exists, content matches).
// - `assert_cmd`: For testing the command-line interface behavior, arguments, exit codes, and output.
//
// Example Test Scenarios (Conceptual):
// - Test basic copy/move by category and extension.
// - Test duplicate handling flags (skip, timestamp, overwrite) work correctly.
// - Test hidden file handling with and without the --include-hidden flag.
// - Test symbolic link handling with and without the --follow-links flag.
// - Test behavior with empty source or target directories.
// - Test custom configuration loading and verify correct categorization (including missing &#39;other&#39;).
// - Test empty directory removal after a successful move operation.
// - Test error handling for scenarios like insufficient permissions (harder to automate reliably).
// - Test long path handling specifically on Windows (requires careful test setup).
// - Test cross-device move fallback behavior.
// - Test handling of filenames with non-UTF8 characters (requires OsStr handling)." data-download-link="" data-download-label="Download Rust">
  <code class="language-rust">// src/main.rs: Rust implementation of the file organizer utility.
// This version fixes compilation errors and ensures completeness.

use anyhow::{bail, Context, Result}; // Use anyhow for convenient error handling
use clap::Parser; // For command-line argument parsing
use chrono::Local; // For generating timestamps
use fern::colors::{Color, ColoredLevelConfig}; // For colored logging output
use log::{debug, error, info, warn, LevelFilter}; // Logging facade
use serde::Deserialize; // For deserializing JSON config
use std::{
    collections::{HashMap, HashSet},
    env, // For CARGO_PKG_VERSION
    // Removed unused &#39;File&#39; import
    fs::{self}, // Standard file system operations
    io::{self, ErrorKind},
    path::{Path, PathBuf},
    time::Instant, // For accurate duration measurement
};
use walkdir::{DirEntry, WalkDir}; // For efficient directory traversal

// --- Configuration Structures ---

/// Represents the structure of the JSON configuration file for categories.
#[derive(Deserialize, Debug, Clone)]
struct CategoriesConfig(HashMap&lt;String, Vec&lt;String&gt;&gt;);

/// Provides the default file categorization configuration.
fn default_categories() -&gt; CategoriesConfig {
    let mut map = HashMap::new();
    macro_rules! add_category {
($map:expr, $name:expr, [$($ext:expr),* $(,)?]) =&gt; {
    $map.insert($name.to_string(), vec![$($ext.to_string()),*]);
};
    }
    add_category!(map, &quot;images&quot;, [&quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.png&quot;, &quot;.gif&quot;, &quot;.bmp&quot;, &quot;.webp&quot;, &quot;.tiff&quot;, &quot;.svg&quot;, &quot;.ico&quot;]);
    add_category!(map, &quot;documents&quot;, [&quot;.pdf&quot;, &quot;.docx&quot;, &quot;.doc&quot;, &quot;.txt&quot;, &quot;.rtf&quot;, &quot;.odt&quot;, &quot;.xlsx&quot;, &quot;.xls&quot;, &quot;.csv&quot;, &quot;.pptx&quot;, &quot;.ppt&quot;, &quot;.md&quot;, &quot;.tex&quot;, &quot;.chm&quot;, &quot;.epub&quot;]);
    add_category!(map, &quot;videos&quot;, [&quot;.mp4&quot;, &quot;.avi&quot;, &quot;.mkv&quot;, &quot;.mov&quot;, &quot;.wmv&quot;, &quot;.flv&quot;, &quot;.webm&quot;]);
    add_category!(map, &quot;audio&quot;, [&quot;.mp3&quot;, &quot;.wav&quot;, &quot;.flac&quot;, &quot;.aac&quot;, &quot;.ogg&quot;, &quot;.m4a&quot;]);
    add_category!(map, &quot;archives&quot;, [&quot;.zip&quot;, &quot;.rar&quot;, &quot;.tar&quot;, &quot;.gz&quot;, &quot;.bz2&quot;, &quot;.7z&quot;, &quot;.iso&quot;]);
    add_category!(map, &quot;code&quot;, [&quot;.py&quot;, &quot;.java&quot;, &quot;.c&quot;, &quot;.cpp&quot;, &quot;.h&quot;, &quot;.cs&quot;, &quot;.html&quot;, &quot;.css&quot;, &quot;.js&quot;, &quot;.ts&quot;, &quot;.jsx&quot;, &quot;.tsx&quot;, &quot;.xml&quot;, &quot;.json&quot;, &quot;.yaml&quot;, &quot;.yml&quot;, &quot;.sh&quot;, &quot;.bat&quot;, &quot;.ps1&quot;, &quot;.rb&quot;, &quot;.php&quot;, &quot;.go&quot;, &quot;.rs&quot;, &quot;.swift&quot;, &quot;.kt&quot;, &quot;.ipynb&quot;, &quot;.sql&quot;, &quot;.toml&quot;]);
    add_category!(map, &quot;apps&quot;, [&quot;.exe&quot;, &quot;.msi&quot;, &quot;.apk&quot;, &quot;.dmg&quot;, &quot;.deb&quot;, &quot;.rpm&quot;, &quot;.app&quot;]);
    add_category!(map, &quot;fonts&quot;, [&quot;.ttf&quot;, &quot;.otf&quot;, &quot;.woff&quot;, &quot;.woff2&quot;]);
    add_category!(map, &quot;shortcuts&quot;, [&quot;.lnk&quot;, &quot;.url&quot;]);
    map.insert(&quot;other&quot;.to_string(), vec![]);
    CategoriesConfig(map)
}

/// Loads category configuration from a specified JSON file path.
fn load_config_file(config_path: Option&lt;&amp;PathBuf&gt;) -&gt; Result&lt;CategoriesConfig&gt; {
    match config_path {
Some(path) if path.is_file() =&gt; {
    info!(&quot;Loading category configuration from: {}&quot;, path.display());
    let file_content = fs::read_to_string(path)
.with_context(|| format!(&quot;Failed to read config file: {}&quot;, path.display()))?;
    let mut config: HashMap&lt;String, Vec&lt;String&gt;&gt; = serde_json::from_str(&amp;file_content)
.with_context(|| format!(&quot;Failed to parse JSON config file: {}&quot;, path.display()))?;
    config.entry(&quot;other&quot;.to_string()).or_insert_with(Vec::new);
    info!(&quot;Successfully loaded and validated custom configuration.&quot;);
    Ok(CategoriesConfig(config))
}
Some(path) =&gt; {
    warn!(
&quot;Config path &#39;{}&#39; provided but is not a valid file. Using default categories.&quot;,
path.display()
    );
    Ok(default_categories())
}
None =&gt; {
    info!(&quot;No config file specified. Using default category configuration.&quot;);
    Ok(default_categories())
}
    }
}

/// Determines the category name (String) for a given file based on its extension.
fn categorize_file(filename: &amp;Path, categories_config: &amp;CategoriesConfig) -&gt; String {
    let extension = filename
.extension()
.and_then(|s| s.to_str())
.map(|s| format!(&quot;.{}&quot;, s.to_lowercase()))
.unwrap_or_else(|| &quot;no_extension&quot;.to_string());
    if extension == &quot;no_extension&quot; { return extension; }
    for (category, extensions) in &amp;categories_config.0 {
if extensions.contains(&amp;extension) { return category.clone(); }
    }
    &quot;other&quot;.to_string()
}

// --- Platform Specific ---

/// Checks if a file or directory is hidden on Windows using standard library features.
#[cfg(windows)]
fn is_hidden(path: &amp;Path) -&gt; Result&lt;bool&gt; {
    use std::os::windows::fs::MetadataExt;
    let metadata = fs::metadata(path)
.with_context(|| format!(&quot;Failed to get metadata for {}&quot;, path.display()))?;
    let attributes = metadata.file_attributes();
    // Use the raw value 0x2 for FILE_ATTRIBUTE_HIDDEN when using std::os::windows::fs
    const FILE_ATTRIBUTE_HIDDEN_VALUE: u32 = 0x2;
    Ok((attributes &amp; FILE_ATTRIBUTE_HIDDEN_VALUE) != 0)
}

/// Checks if a file or directory is hidden on Unix-like systems (conventionally, starts with &#39;.&#39;).
#[cfg(not(windows))]
fn is_hidden(path: &amp;Path) -&gt; Result&lt;bool&gt; {
    Ok(path
.file_name()
.and_then(|s| s.to_str())
.map(|s| s.starts_with(&#39;.&#39;))
.unwrap_or(false))
}

/// Helper for walkdir filter_entry to check hidden status.
fn should_keep_entry(entry: &amp;DirEntry, include_hidden: bool) -&gt; bool {
    if include_hidden { return true; }
    match is_hidden(entry.path()) {
Ok(hidden) =&gt; !hidden,
Err(err) =&gt; {
    warn!(
&quot;Could not determine hidden status for {}: {}. Excluding entry.&quot;,
entry.path().display(), err
    );
    false // Exclude if check fails (safer default)
}
    }
}

// --- Command Line Arguments ---

#[derive(clap::ValueEnum, Clone, Debug, PartialEq, Eq)]
enum OrganizeMethod { Category, Extension, }

#[derive(Parser, Debug)]
#[command(author, version, about = &quot;Organize files by category or extension (Rust version).&quot;,
    long_about = &quot;A Rust utility for organizing files from source directories into categorized target folders based on file types or extensions.&quot;,
    help_template = &quot;{before-help}{name} {version}\n{author-with-newline}{about-with-newline}\n{usage-heading} {usage}\n\n{all-args}{after-help}&quot;
)]
struct CliArgs {
    #[arg(short, long, value_name = &quot;DIR&quot;)] source: PathBuf,
    #[arg(short, long, value_name = &quot;DIR&quot;)] target: PathBuf,
    #[arg(short, long, value_name = &quot;FILE&quot;)] config: Option&lt;PathBuf&gt;,
    #[arg(long, value_enum, default_value_t = OrganizeMethod::Category)] organize_by: OrganizeMethod,
    #[arg(long)] move_files: bool,
    #[arg(long, conflicts_with_all = [&quot;skip_existing&quot;, &quot;overwrite&quot;])] timestamp_duplicates: bool,
    #[arg(long, short = &#39;k&#39;, conflicts_with_all = [&quot;timestamp_duplicates&quot;, &quot;overwrite&quot;])] skip_existing: bool,
    #[arg(long, conflicts_with_all = [&quot;timestamp_duplicates&quot;, &quot;skip_existing&quot;])] overwrite: bool,
    #[arg(long, short = &#39;i&#39;)] include_hidden: bool,
    #[arg(long, short = &#39;l&#39;)] follow_links: bool,
    #[arg(long, requires = &quot;move_files&quot;)] remove_empty_source_dirs: bool,
    #[arg(long, value_name = &quot;FILE&quot;)] log_file: Option&lt;PathBuf&gt;,
    #[arg(long, value_parser = clap::value_parser!(LevelFilter), default_value = &quot;info&quot;)] log_level: LevelFilter,
}

// --- Core Logic ---

/// Holds statistics about the file processing operation.
#[derive(Debug, Default)]
struct ProcessStats {
    /// Count of directory entries successfully yielded by the filtered WalkDir iterator.
    total_scanned: u64,
    processed: u64,
    skipped: u64,
    errors: u64,
    failed_files: Vec&lt;(PathBuf, String)&gt;, // Stores paths and error context
}

/// Scans the source directory for unique file extensions.
fn get_all_extensions(
    source_directory: &amp;Path,
    include_hidden: bool,
    follow_links: bool,
) -&gt; Result&lt;HashSet&lt;String&gt;&gt; {
    let mut extensions = HashSet::new();
    info!(&quot;Scanning source directory for all unique file extensions...&quot;);
    let walker = WalkDir::new(source_directory)
.follow_links(follow_links)
.into_iter();
    let mut count = 0;
    for entry_result in walker.filter_entry(|e| should_keep_entry(e, include_hidden)) {
match entry_result {
    Ok(entry) =&gt; {
let path = entry.path();
if path.is_file() {
    count += 1;
    if let Some(ext) = path.extension().and_then(|e| e.to_str()) {
extensions.insert(ext.to_lowercase());
    }
    if count % 1000 == 0 { debug!(&quot;Scanned {} files for extensions...&quot;, count); }
}
    }
    Err(e) =&gt; warn!(&quot;Error accessing entry during extension scan: {}&quot;, e),
}
    }
    info!(&quot;Found {} unique extensions.&quot;, extensions.len());
    Ok(extensions)
}

/// Creates necessary target subfolders.
fn create_target_folders(
    base_dir: &amp;Path,
    organize_by: &amp;OrganizeMethod,
    categories_config: Option&lt;&amp;CategoriesConfig&gt;,
    all_extensions: Option&lt;&amp;HashSet&lt;String&gt;&gt;,
) -&gt; Result&lt;()&gt; {
    info!(&quot;Ensuring target base directory exists: {}&quot;, base_dir.display());
    fs::create_dir_all(base_dir)
.with_context(|| format!(&quot;Failed to create base target directory: {}&quot;, base_dir.display()))?;
    let folders_to_create: HashSet&lt;String&gt; = match organize_by {
OrganizeMethod::Category =&gt; {
    let mut folders = categories_config
.map(|cfg| cfg.0.keys().cloned().collect::&lt;HashSet&lt;String&gt;&gt;())
.unwrap_or_default();
    folders.insert(&quot;other&quot;.to_string());
    folders.insert(&quot;no_extension&quot;.to_string());
    folders
}
OrganizeMethod::Extension =&gt; {
    let mut folders = all_extensions.cloned().unwrap_or_default();
    folders.insert(&quot;no_extension&quot;.to_string());
    folders
}
    };
    info!(
&quot;Creating target subfolders (mode: {:?}). Total potential folders: {}&quot;,
organize_by,
folders_to_create.len()
    );
    let mut created_count = 0;
    for folder_name in &amp;folders_to_create {
if folder_name.is_empty() { warn!(&quot;Skipping creation of folder with empty name.&quot;); continue; }
let folder_path = base_dir.join(folder_name);
if !folder_path.exists() {
    fs::create_dir_all(&amp;folder_path).with_context(|| {
format!(&quot;Failed to create target folder &#39;{}&#39;&quot;, folder_path.display())
    })?;
    debug!(&quot;Created target folder: {}&quot;, folder_path.display());
    created_count += 1;
}
    }
    info!(&quot;Created {} new target subfolders.&quot;, created_count);
    Ok(())
}

/// Attempts to move a file, falling back to copy-then-delete on cross-device errors.
fn move_file_with_fallback(source: &amp;Path, target: &amp;Path) -&gt; io::Result&lt;()&gt; {
    match fs::rename(source, target) {
Ok(_) =&gt; Ok(()),
Err(rename_error) =&gt; {
    // Note: Relies on platform-specific OS error codes (Windows: 17, Unix: 18/libc::EXDEV). Might be brittle.
    let is_cross_device = || -&gt; bool {
#[cfg(windows)] { rename_error.raw_os_error() == Some(17) }
#[cfg(unix)] { rename_error.raw_os_error() == Some(18) }
#[cfg(not(any(windows, unix)))] { false }
    };
    if is_cross_device() {
warn!(&quot;Rename failed (cross-device error detected), attempting copy+delete fallback for move: {} -&gt; {}&quot;, source.display(), target.display());
// Note: std::fs::copy preserves permissions but not other metadata like modification time (unlike Python&#39;s shutil.copy2).
// For full metadata preservation, consider crates like `fs_extra` or platform-specific APIs.
fs::copy(source, target)?;
fs::remove_file(source)?;
Ok(())
    } else { Err(rename_error) }
}
    }
}


/// Main function to perform the file organization.
fn organize_files(args: &amp;CliArgs, categories_config: &amp;CategoriesConfig) -&gt; Result&lt;ProcessStats&gt; {
    if !args.source.is_dir() { bail!(&quot;Source directory &#39;{}&#39; is invalid or not found.&quot;, args.source.display()); }
    if !args.target.exists() {
info!(&quot;Creating target directory: {}&quot;, args.target.display());
fs::create_dir_all(&amp;args.target).with_context(|| format!(&quot;Could not create target directory &#39;{}&#39;&quot;, args.target.display()))?;
    } else if !args.target.is_dir() { bail!(&quot;Target path &#39;{}&#39; exists but is not a directory.&quot;, args.target.display()); }

    info!(&quot;Preparing target folders...&quot;);
    let extensions_for_folders = if args.organize_by == OrganizeMethod::Extension {
Some(get_all_extensions(&amp;args.source, args.include_hidden, args.follow_links)?)
    } else { None };
    create_target_folders(&amp;args.target, &amp;args.organize_by, Some(categories_config), extensions_for_folders.as_ref())?;

    info!(&quot;Starting file processing...&quot;);
    let mut stats = ProcessStats::default();
    let mut file_counter = 0u64;
    let walker = WalkDir::new(&amp;args.source).follow_links(args.follow_links).into_iter();

    for entry_result in walker.filter_entry(|e| should_keep_entry(e, args.include_hidden)) {
stats.total_scanned += 1; // Count filtered entries
let entry = match entry_result {
    Ok(e) =&gt; e,
    Err(e) =&gt; {
let path_display = e.path().unwrap_or_else(|| Path::new(&quot;?&quot;)).display();
error!(&quot;Error scanning path {}: {}&quot;, path_display, e);
stats.errors += 1;
// Provide default PathBuf if e.path() is None
stats.failed_files.push((
    e.path().map_or_else(|| PathBuf::from(&quot;?&quot;), |p| p.to_path_buf()),
    format!(&quot;Scan error: {:?}&quot;, e),
));
continue;
    }
};

if !entry.file_type().is_file() { stats.skipped += 1; continue; }

file_counter += 1;
let source_path = entry.path();
let progress_prefix = format!(&quot;[{}]&quot;, file_counter);

let file_result: Result&lt;()&gt; = (|| {
    let file_name = source_path.file_name().with_context(|| format!(&quot;Could not get filename for path: {}&quot;, source_path.display()))?;
    let target_subfolder_name = match args.organize_by {
OrganizeMethod::Category =&gt; categorize_file(source_path, categories_config),
OrganizeMethod::Extension =&gt; source_path.extension().and_then(|s| s.to_str()).map(|s| s.to_lowercase()).unwrap_or_else(|| &quot;no_extension&quot;.to_string()),
    };
    let target_folder_path = args.target.join(&amp;target_subfolder_name);
    let mut target_file_path = target_folder_path.join(file_name);

    if target_file_path.exists() {
if args.skip_existing {
    info!(&quot;{} Skipping (target exists): {}&quot;, progress_prefix, target_file_path.display());
    stats.skipped += 1; return Ok(());
} else if args.timestamp_duplicates {
    let original_target_path_display = target_file_path.display().to_string();
    let mut counter = 1;
    // Use file_name directly, it&#39;s already &amp;OsStr
    let stem = source_path.file_stem().unwrap_or(file_name);
    let ext = source_path.extension().unwrap_or_default();
    const MAX_TIMESTAMP_ATTEMPTS: u32 = 1000;
    loop {
let timestamp = Local::now().format(&quot;%Y%m%d_%H%M%S&quot;);
let mut new_name_os = std::ffi::OsString::new();
new_name_os.push(stem);
new_name_os.push(format!(&quot;_{}_{}&quot;, timestamp, counter));
if !ext.is_empty() { new_name_os.push(&quot;.&quot;); new_name_os.push(ext); }
target_file_path = target_folder_path.join(&amp;new_name_os);
if !target_file_path.exists() { break; }
counter += 1;
if counter &gt; MAX_TIMESTAMP_ATTEMPTS { bail!(&quot;Could not find unique timestamped name for {} after {} attempts. Skipping.&quot;, original_target_path_display, MAX_TIMESTAMP_ATTEMPTS); }
    }
    info!(&quot;{} Target exists &#39;{}&#39;. Renaming duplicate to: {}&quot;, progress_prefix, original_target_path_display, target_file_path.display());
} else if args.overwrite { warn!(&quot;{} Overwriting existing target file: {}&quot;, progress_prefix, target_file_path.display()); }
else { warn!(&quot;{} Overwriting existing target file (default): {}&quot;, progress_prefix, target_file_path.display()); }
    }

    fs::create_dir_all(&amp;target_folder_path).with_context(|| format!(&quot;Failed to ensure target directory &#39;{}&#39; exists&quot;, target_folder_path.display()))?;
    let operation_desc = if args.move_files { &quot;move&quot; } else { &quot;copy&quot; };
    debug!(&quot;{} Attempting to {} &#39;{}&#39; to &#39;{}&#39;&quot;, progress_prefix, operation_desc, source_path.display(), target_file_path.display());

    if args.move_files {
move_file_with_fallback(source_path, &amp;target_file_path).with_context(|| format!(&quot;Failed to move &#39;{}&#39; to &#39;{}&#39;&quot;, source_path.display(), target_file_path.display()))?;
    } else {
// Note: std::fs::copy preserves permissions but not other metadata like modification time (unlike Python&#39;s shutil.copy2).
// For full metadata preservation, consider crates like `fs_extra` or platform-specific APIs.
fs::copy(source_path, &amp;target_file_path).map(|_| ()).with_context(|| format!(&quot;Failed to copy &#39;{}&#39; to &#39;{}&#39;&quot;, source_path.display(), target_file_path.display()))?;
    }
    stats.processed += 1;
    Ok(())
})(); // End inner closure

if let Err(e) = file_result {
    error!(&quot;{} Failed to process &#39;{}&#39;: {:?}&quot;, progress_prefix, source_path.display(), e);
    stats.errors += 1;
    stats.failed_files.push((source_path.to_path_buf(), format!(&quot;{:?}&quot;, e)));
}
    } // End main loop

    Ok(stats)
}

/// Recursively removes empty folders starting from the bottom up.
fn remove_empty_folders(directory: &amp;Path) -&gt; Result&lt;u32&gt; {
    let mut removed_count = 0u32;
    info!(&quot;Attempting to remove empty directories within: {}&quot;, directory.display());
    let mut dirs_to_check = Vec::new();
    for entry_result in WalkDir::new(directory).min_depth(1) {
match entry_result {
    Ok(entry) if entry.file_type().is_dir() =&gt; { dirs_to_check.push(entry.into_path()); }
    Ok(_) =&gt; {}
    Err(e) =&gt; warn!(&quot;Error accessing entry during empty dir scan: {}&quot;, e),
}
    }
    dirs_to_check.sort_by(|a, b| b.components().count().cmp(&amp;a.components().count()));
    for dir_path in dirs_to_check {
if !dir_path.is_dir() { continue; }
match fs::read_dir(&amp;dir_path) {
    Ok(mut read_dir) =&gt; {
if read_dir.next().is_none() { // Directory is empty
    match fs::remove_dir(&amp;dir_path) {
Ok(_) =&gt; { info!(&quot;Removed empty directory: {}&quot;, dir_path.display()); removed_count += 1; }
Err(e) =&gt; { if e.kind() != ErrorKind::NotFound { warn!(&quot;Could not remove presumably empty directory &#39;{}&#39;: {}&quot;, dir_path.display(), e); } }
    }
}
    }
    Err(e) =&gt; { if e.kind() != ErrorKind::NotFound { warn!(&quot;Could not read directory &#39;{}&#39; to check emptiness: {}&quot;, dir_path.display(), e); } }
}
    }
    info!(&quot;Finished removing empty directories. Removed: {}&quot;, removed_count);
    Ok(removed_count)
}

// --- Logging Setup ---
/// Sets up logging using the fern crate.
fn setup_logging(log_level: LevelFilter, log_file: Option&lt;&amp;PathBuf&gt;) -&gt; Result&lt;()&gt; {
    let colors = ColoredLevelConfig::new().error(Color::Red).warn(Color::Yellow).info(Color::Green).debug(Color::Blue).trace(Color::BrightBlack);
    let base_config = fern::Dispatch::new()
.format(move |out, message, record| {
    out.finish(format_args!(
&quot;[{} {} {}] {}&quot;,
chrono::Local::now().format(&quot;%Y-%m-%d %H:%M:%S%.3f&quot;), colors.color(record.level()), record.target(), message
    ))
})
.level(log_level)
.level_for(&quot;hyper&quot;, LevelFilter::Warn).level_for(&quot;mio&quot;, LevelFilter::Warn).level_for(&quot;want&quot;, LevelFilter::Warn).level_for(&quot;reqwest&quot;, LevelFilter::Warn).level_for(&quot;rustls&quot;, LevelFilter::Warn);
    let stderr_logger = fern::Dispatch::new().filter(move |metadata| { log_level &lt;= LevelFilter::Debug || metadata.target().starts_with(env!(&quot;CARGO_PKG_NAME&quot;)) }).chain(std::io::stderr());
    let mut final_dispatch = base_config.chain(stderr_logger);
    let mut file_logger_ok = false;
    if let Some(log_path) = log_file {
match fern::log_file(log_path) {
    Ok(file_output) =&gt; { final_dispatch = final_dispatch.chain(file_output); file_logger_ok = true; }
    Err(e) =&gt; { eprintln!(&quot;Error: Failed to create log file &#39;{}&#39;: {}. Logging to console only.&quot;, log_path.display(), e); }
}
    }
    final_dispatch.apply().context(&quot;Failed to set up logging&quot;)?;
    if file_logger_ok { if let Some(path) = log_file { info!(&quot;File logging enabled to: {}&quot;, path.display()); } }
    Ok(())
}


// --- Main Application Entry Point ---
fn main() -&gt; Result&lt;()&gt; {
    let overall_start_time = Instant::now(); // Start timing
    let args = CliArgs::parse();
    setup_logging(args.log_level, args.log_file.as_ref())?;

    info!(&quot;Rust File Organizer (v{}) starting...&quot;, env!(&quot;CARGO_PKG_VERSION&quot;));
    debug!(&quot;Arguments received: {:?}&quot;, args);
    info!(&quot;Source directory: {}&quot;, args.source.display());
    info!(&quot;Target directory: {}&quot;, args.target.display());
    info!(&quot;Organization mode: {:?}&quot;, args.organize_by);
    info!(&quot;Operation: {}&quot;, if args.move_files { &quot;Move&quot; } else { &quot;Copy&quot; });
    info!(&quot;Include hidden: {}&quot;, args.include_hidden);
    info!(&quot;Follow links: {}&quot;, args.follow_links);
    if args.skip_existing { info!(&quot;Duplicate handling: Skip existing&quot;); }
    else if args.timestamp_duplicates { info!(&quot;Duplicate handling: Timestamp duplicates&quot;); }
    else if args.overwrite { info!(&quot;Duplicate handling: Overwrite existing (explicitly)&quot;); }
    else { info!(&quot;Duplicate handling: Overwrite existing (default)&quot;); }

    let categories = load_config_file(args.config.as_ref())?;
    let result = organize_files(&amp;args, &amp;categories);

    match result {
Ok(stats) =&gt; {
    if args.move_files &amp;&amp; args.remove_empty_source_dirs &amp;&amp; stats.processed &gt; 0 {
// Note: Cleanup errors are logged but do not cause a non-zero exit code.
if let Err(e) = remove_empty_folders(&amp;args.source) { error!(&quot;Error during empty source directory removal: {:?}&quot;, e); }
    }
    let overall_duration = overall_start_time.elapsed();
    let summary = format!(
&quot;Operation completed in {:.2?}. Scanned Entries: {}, Processed Files: {}, Skipped: {}, Errors: {}&quot;,
overall_duration, stats.total_scanned, stats.processed, stats.skipped, stats.errors
    );
    info!(&quot;{}&quot;, summary);
    println!(&quot;\n{}&quot;, summary);
    if stats.errors &gt; 0 {
eprintln!(&quot;\n--- Errors occurred during processing: ---&quot;);
for (path, error_msg) in &amp;stats.failed_files {
    eprintln!(&quot; - File: {}&quot;, path.display());
    eprintln!(&quot;   Error: {}&quot;, error_msg);
}
eprintln!(&quot;-----------------------------------------&quot;);
eprintln!(&quot;Warning: {} errors occurred. Please check logs (stderr/file) for full details.&quot;, stats.errors);
// Consider exiting with non-zero status for scripting if errors occurred
// std::process::exit(1);
    }
}
Err(e) =&gt; {
    error!(&quot;Critical error during file organization: {:?}&quot;, e);
    eprintln!(&quot;\nError: File organization failed critically. Check logs (stderr/file) for details.&quot;);
    std::process::exit(1);
}
    }
    info!(&quot;Rust File Organizer finished.&quot;);
    Ok(())
}

// --- Testing Notes ---
// To properly test this application, consider using crates like:
// - `assert_fs`: For creating temporary file/directory structures for tests.
// - `predicates`: For making assertions about file system state (e.g., file exists, content matches).
// - `assert_cmd`: For testing the command-line interface behavior, arguments, exit codes, and output.
//
// Example Test Scenarios (Conceptual):
// - Test basic copy/move by category and extension.
// - Test duplicate handling flags (skip, timestamp, overwrite) work correctly.
// - Test hidden file handling with and without the --include-hidden flag.
// - Test symbolic link handling with and without the --follow-links flag.
// - Test behavior with empty source or target directories.
// - Test custom configuration loading and verify correct categorization (including missing &#39;other&#39;).
// - Test empty directory removal after a successful move operation.
// - Test error handling for scenarios like insufficient permissions (harder to automate reliably).
// - Test long path handling specifically on Windows (requires careful test setup).
// - Test cross-device move fallback behavior.
// - Test handling of filenames with non-UTF8 characters (requires OsStr handling).</code>
</section>
  <h2 id="python-approach">
    
    
     <a href="#python-approach">#</a><a href="#" aria-label="Back to top">python approach</a>
        
    
  </h2>
      

<div class="language-python highlighter-rouge"><div class="highlight"><section><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">shutil</span>
<span class="kn">import</span> <span class="n">argparse</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">platform</span>
<span class="kn">import</span> <span class="n">traceback</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># --- Default Configuration ---
</span><span class="n">DEFAULT_CATEGORIES_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">images</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.jpg</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.jpeg</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.png</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.gif</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.bmp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.webp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.tiff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.svg</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.ico</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">documents</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.pdf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.docx</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.doc</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.txt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.rtf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.odt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.xlsx</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.xls</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.csv</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.pptx</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.ppt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.md</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.tex</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.chm</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.epub</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">videos</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.mp4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.avi</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.mkv</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.mov</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.wmv</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.flv</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.webm</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">audio</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.mp3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.wav</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.flac</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.aac</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.ogg</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.m4a</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">archives</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.zip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.rar</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.tar</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.gz</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.bz2</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.7z</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.iso</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">code</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.py</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.java</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.cpp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.h</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.cs</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.html</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.css</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.js</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.ts</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.jsx</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.tsx</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.xml</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.json</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.yaml</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.yml</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.sh</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.bat</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.ps1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.rb</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.php</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.go</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.rs</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.swift</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.kt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.ipynb</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.sql</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.toml</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">apps</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.exe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.msi</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.apk</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.dmg</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.deb</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.rpm</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.app</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">fonts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.ttf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.otf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.woff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.woff2</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">shortcuts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">.lnk</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.url</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">other</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="c1"># --- Utility Functions ---
</span>
<span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="n">log_file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Configures logging to console and optionally to a file.</span><span class="sh">"""</span>
    <span class="n">log_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nc">Formatter</span><span class="p">(</span><span class="sh">'</span><span class="s">%(asctime)s - %(levelname)s - %(message)s</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">'</span><span class="s">file_organizer</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span> <span class="c1"># Set base level
</span>
    <span class="c1"># Console Handler (prints INFO and above)
</span>    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nc">StreamHandler</span><span class="p">()</span>
    <span class="n">console_handler</span><span class="p">.</span><span class="nf">setFormatter</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

    <span class="c1"># File Handler (prints INFO and above if path provided)
</span>    <span class="k">if</span> <span class="n">log_file_path</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nc">FileHandler</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">file_handler</span><span class="p">.</span><span class="nf">setFormatter</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Logging initialized. Log file: </span><span class="si">{</span><span class="n">log_file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to initialize log file handler at </span><span class="si">{</span><span class="n">log_file_path</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>

<span class="k">def</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Prepends the long path prefix for Windows if necessary.</span><span class="sh">"""</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="nf">system</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Windows</span><span class="sh">"</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">259</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\\\\</span><span class="s">?</span><span class="se">\\</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\\\\</span><span class="s">?</span><span class="se">\\</span><span class="sh">"</span> <span class="o">+</span> <span class="n">path</span>
    <span class="k">return</span> <span class="n">path</span>

<span class="k">def</span> <span class="nf">load_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Loads category configuration from a JSON file.</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">config_path</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Loading category configuration from: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="nf">except </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="nb">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Could not load or parse config file </span><span class="sh">'</span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">. Using default categories.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Using default category configuration.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DEFAULT_CATEGORIES_CONFIG</span>

<span class="k">def</span> <span class="nf">categorize_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">categories_config</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Determines the category of a file based on its extension.</span><span class="sh">"""</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">no_extension</span><span class="sh">"</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">extensions</span> <span class="ow">in</span> <span class="n">categories_config</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">category</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">other</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">is_hidden_windows</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Checks if a file or directory is hidden on Windows.</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="nf">system</span><span class="p">()</span> <span class="o">!=</span> <span class="sh">"</span><span class="s">Windows</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">stat</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">st_file_attributes</span>
        <span class="k">return</span> <span class="n">attrs</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="c1"># FILE_ATTRIBUTE_HIDDEN = 2
</span>    <span class="k">except</span> <span class="nb">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span> <span class="c1"># Assume not hidden if stat fails
</span>
<span class="k">def</span> <span class="nf">create_target_folders</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">organize_by</span><span class="p">,</span> <span class="n">categories_config</span><span class="p">,</span> <span class="n">all_extensions</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Creates necessary target folders before processing files.</span><span class="sh">"""</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Ensuring target base directory exists: </span><span class="si">{</span><span class="n">base_dir</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># Ensure base exists first
</span>
    <span class="n">folders_to_create</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">organize_by</span> <span class="o">==</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">folders_to_create</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">categories_config</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span> <span class="o">|</span> <span class="p">{</span><span class="sh">"</span><span class="s">other</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">no_extension</span><span class="sh">"</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">organize_by</span> <span class="o">==</span> <span class="sh">"</span><span class="s">extension</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">folders_to_create</span> <span class="o">=</span> <span class="n">all_extensions</span> <span class="o">|</span> <span class="p">{</span><span class="sh">"</span><span class="s">no_extension</span><span class="sh">"</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Invalid organize_by option: </span><span class="si">{</span><span class="n">organize_by</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Invalid organize_by option.</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Creating target subfolders (</span><span class="si">{</span><span class="n">organize_by</span><span class="si">}</span><span class="s">)...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">created_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">folder_name</span> <span class="ow">in</span> <span class="n">folders_to_create</span><span class="p">:</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">created_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="nb">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to create target folder </span><span class="sh">'</span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Created </span><span class="si">{</span><span class="n">created_count</span><span class="si">}</span><span class="s"> new target subfolders.</span><span class="sh">"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_all_extensions</span><span class="p">(</span><span class="n">source_directory</span><span class="p">,</span> <span class="n">include_hidden</span><span class="p">,</span> <span class="n">follow_links</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Scans the source directory to find all unique file extensions.</span><span class="sh">"""</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="n">source_directory</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">source_directory</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Scanning for all unique file extensions...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">walk</span><span class="p">(</span><span class="n">source_directory</span><span class="p">,</span> <span class="n">followlinks</span><span class="o">=</span><span class="n">follow_links</span><span class="p">):</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_hidden</span><span class="p">:</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">is_hidden_windows</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">d</span><span class="p">))]</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">is_hidden_windows</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>

        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span><span class="p">:</span>
                <span class="n">extensions</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:].</span><span class="nf">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Log progress for large scans
</span>                 <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Scanned </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s"> files for extensions...</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">extensions</span><span class="p">)</span><span class="si">}</span><span class="s"> unique extensions.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">extensions</span>


<span class="c1"># --- Core Logic ---
</span>
<span class="k">def</span> <span class="nf">sort_files</span><span class="p">(</span>
    <span class="n">source_directory</span><span class="p">,</span>
    <span class="n">target_directory</span><span class="p">,</span>
    <span class="n">organize_by</span><span class="p">,</span>
    <span class="n">timestamp_duplicates</span><span class="p">,</span>
    <span class="n">move_files</span><span class="p">,</span>
    <span class="n">categories_config</span><span class="p">,</span>
    <span class="n">include_hidden</span><span class="p">,</span>
    <span class="n">follow_links</span><span class="p">,</span>
    <span class="n">skip_existing</span><span class="p">,</span>
    <span class="n">logger</span>
<span class="p">):</span>
    <span class="sh">"""</span><span class="s">Sorts files from source to target directory based on specified options.</span><span class="sh">"""</span>
    <span class="n">source_directory</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">source_directory</span><span class="p">)</span>
    <span class="n">target_directory</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">target_directory</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">source_directory</span><span class="p">):</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Source directory </span><span class="sh">'</span><span class="si">{</span><span class="n">source_directory</span><span class="si">}</span><span class="sh">'</span><span class="s"> is invalid or not found.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">target_directory</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">target_directory</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Created target directory: </span><span class="si">{</span><span class="n">target_directory</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Could not create target directory </span><span class="sh">'</span><span class="si">{</span><span class="n">target_directory</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">target_directory</span><span class="p">):</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Target path </span><span class="sh">'</span><span class="si">{</span><span class="n">target_directory</span><span class="si">}</span><span class="sh">'</span><span class="s"> exists but is not a directory.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="c1"># --- Pre-scan and Folder Creation ---
</span>    <span class="n">total_files</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">files_to_process</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Scanning source directory to count files...</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">walk</span><span class="p">(</span><span class="n">source_directory</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">followlinks</span><span class="o">=</span><span class="n">follow_links</span><span class="p">):</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">original_dirs</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="c1"># Keep original list for iteration if needed
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_hidden</span><span class="p">:</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">is_hidden_windows</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">d</span><span class="p">))]</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">is_hidden_windows</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>

        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
            <span class="c1"># Basic check if it's actually a file before adding
</span>            <span class="k">try</span><span class="p">:</span>
                 <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
                      <span class="n">files_to_process</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                      <span class="n">total_files</span> <span class="o">+=</span> <span class="mi">1</span>
                 <span class="k">else</span><span class="p">:</span>
                      <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Item listed as file is not a file (skipping count): </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Could not access item during scan (skipping count): </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s"> - Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>


    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s"> files to process.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_files</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">No files found to process.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">organize_by</span> <span class="o">==</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">create_target_folders</span><span class="p">(</span><span class="n">target_directory</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="n">categories_config</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">organize_by</span> <span class="o">==</span> <span class="sh">"</span><span class="s">extension</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">all_exts</span> <span class="o">=</span> <span class="nf">get_all_extensions</span><span class="p">(</span><span class="n">source_directory</span><span class="p">,</span> <span class="n">include_hidden</span><span class="p">,</span> <span class="n">follow_links</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="nf">create_target_folders</span><span class="p">(</span><span class="n">target_directory</span><span class="p">,</span> <span class="sh">"</span><span class="s">extension</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">all_exts</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># --- Process Files ---
</span>    <span class="n">processed_files</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">skipped_files</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">error_files</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting file processing...</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">files_to_process</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">progress_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span> <span class="c1"># Re-check existence before processing
</span>                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Skipping non-existent source file: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">skipped_files</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span> <span class="c1"># Ensure it's still a file
</span>                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Skipping item that is not a file: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">skipped_files</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># Determine target folder
</span>            <span class="k">if</span> <span class="n">organize_by</span> <span class="o">==</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">category</span> <span class="o">=</span> <span class="nf">categorize_file</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">categories_config</span><span class="p">)</span>
                <span class="n">target_folder</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">target_directory</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">organize_by</span> <span class="o">==</span> <span class="sh">"</span><span class="s">extension</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="n">ext_folder</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:].</span><span class="nf">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="sh">"</span><span class="s">no_extension</span><span class="sh">"</span>
                <span class="n">target_folder</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">target_directory</span><span class="p">,</span> <span class="n">ext_folder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Should not happen
</span>                 <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Invalid organization option for file </span><span class="si">{</span><span class="nb">file</span><span class="si">}</span><span class="s">. Skipping.</span><span class="sh">"</span><span class="p">)</span>
                 <span class="n">error_files</span> <span class="o">+=</span> <span class="mi">1</span>
                 <span class="k">continue</span>

            <span class="n">target_fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
            <span class="n">target_fullpath</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">target_fullpath</span><span class="p">)</span>

            <span class="c1"># Handle existing target files
</span>            <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">target_fullpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">skip_existing</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Skipping existing target: </span><span class="si">{</span><span class="n">target_fullpath</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                    <span class="n">skipped_files</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">timestamp_duplicates</span><span class="p">:</span>
                    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                    <span class="n">original_target_fullpath</span> <span class="o">=</span> <span class="n">target_fullpath</span> <span class="c1"># Store for logging
</span>                    <span class="k">while</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">target_fullpath</span><span class="p">):</span>
                        <span class="n">stamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y%m%d_%H%M%S</span><span class="sh">"</span><span class="p">)</span>
                        <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">stamp</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>
                        <span class="n">target_fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
                        <span class="n">target_fullpath</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">target_fullpath</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Target exists </span><span class="sh">'</span><span class="si">{</span><span class="n">original_target_fullpath</span><span class="si">}</span><span class="sh">'</span><span class="s">. Renaming duplicate to: </span><span class="si">{</span><span class="n">target_fullpath</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Overwriting existing target file: </span><span class="si">{</span><span class="n">target_fullpath</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                    <span class="c1"># Overwrite happens implicitly
</span>
            <span class="c1"># Perform file operation
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">move_files</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">target_fullpath</span><span class="p">)</span>
                    <span class="c1"># logger.info(f"{progress_prefix} Moved: {file} -&gt; {target_folder}") # Verbose
</span>                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="p">.</span><span class="nf">copy2</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">target_fullpath</span><span class="p">)</span> <span class="c1"># copy2 preserves metadata
</span>                    <span class="c1"># logger.info(f"{progress_prefix} Copied: {file} -&gt; {target_folder}") # Verbose
</span>                <span class="n">processed_files</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nf">except </span><span class="p">(</span><span class="nb">OSError</span><span class="p">,</span> <span class="n">shutil</span><span class="p">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1"># Catch specific shutil errors too
</span>                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Failed to </span><span class="si">{</span><span class="sh">'</span><span class="s">move</span><span class="sh">'</span> <span class="k">if</span> <span class="n">move_files</span> <span class="k">else</span> <span class="sh">'</span><span class="s">copy</span><span class="sh">'</span><span class="si">}</span><span class="s"> </span><span class="sh">'</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="sh">'</span><span class="s"> to </span><span class="sh">'</span><span class="si">{</span><span class="n">target_fullpath</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">error_files</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1"># Catch any other unexpected error during file op
</span>                 <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Unexpected error processing </span><span class="sh">'</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="sh">'</span><span class="s"> -&gt; </span><span class="sh">'</span><span class="si">{</span><span class="n">target_fullpath</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># Log traceback
</span>                 <span class="n">error_files</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1"># Catch errors during path manipulation, categorization etc.
</span>            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">progress_prefix</span><span class="si">}</span><span class="s"> Unexpected error processing path </span><span class="sh">'</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">error_files</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Optional: Print live progress to console (can be noisy)
</span>        <span class="c1"># print(f"Progress: {i+1}/{total_files} (P: {processed_files}, S: {skipped_files}, E: {error_files})", end="\r")
</span>

    <span class="c1"># Final Summary
</span>    <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">File organization completed. Processed: </span><span class="si">{</span><span class="n">processed_files</span><span class="si">}</span><span class="s">, Skipped: </span><span class="si">{</span><span class="n">skipped_files</span><span class="si">}</span><span class="s">, Errors: </span><span class="si">{</span><span class="n">error_files</span><span class="si">}</span><span class="sh">"</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># Also print final summary to console
</span>    <span class="k">return</span> <span class="n">processed_files</span><span class="p">,</span> <span class="n">skipped_files</span> <span class="o">+</span> <span class="n">error_files</span>

<span class="k">def</span> <span class="nf">remove_empty_folders</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Recursively removes empty folders starting from the bottom up.</span><span class="sh">"""</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">removed_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Attempting to remove empty directories from: </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># Walk from bottom up
</span>    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="nf">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="nf">handle_long_path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># Consider hidden status if needed, but generally just check emptiness
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dirs</span><span class="p">:</span> <span class="c1"># Directory is empty
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="p">.</span><span class="nf">rmdir</span><span class="p">(</span><span class="n">root_path</span><span class="p">)</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Removed empty directory: </span><span class="si">{</span><span class="n">root_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">removed_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="nb">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Common errors: permission denied, directory not empty (race condition?)
</span>                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Could not remove directory </span><span class="sh">'</span><span class="si">{</span><span class="n">root_path</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unexpected error removing directory </span><span class="sh">'</span><span class="si">{</span><span class="n">root_path</span><span class="si">}</span><span class="sh">'</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Finished removing empty directories. Removed: </span><span class="si">{</span><span class="n">removed_count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>


<span class="c1"># --- Main Execution ---
</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">Organize files by category or extension.</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">RawTextHelpFormatter</span>
        <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--source</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">-s</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Source directory containing files to organize.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--target</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">-t</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Target directory where organized files will be placed.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--config</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">-c</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to JSON config file for custom file categories and extensions.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">--organize-by</span><span class="sh">"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">extension</span><span class="sh">"</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Method for organizing files:</span><span class="se">\n</span><span class="sh">"</span>
             <span class="sh">"</span><span class="s">  category: Group into folders based on categories (default).</span><span class="se">\n</span><span class="sh">"</span>
             <span class="sh">"</span><span class="s">  extension: Group into folders named after file extensions.</span><span class="sh">"</span>
        <span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--move</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Move files instead of copying them.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--timestamp-duplicates</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Append timestamp+counter to duplicate filenames instead of overwriting/skipping.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--skip-existing</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Skip processing if a file with the same name exists in the target.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--include-hidden</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Include hidden files/folders (e.g., starting with </span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="s">) in processing.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--follow-links</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Follow symbolic links (process target, not link). Use with caution (potential loops).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--remove-empty-source-dirs</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">After moving (--move must be enabled), attempt to remove empty source directories.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--log-file</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Optional path to a file for logging progress and errors.</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="c1"># --- Argument Validation ---
</span>    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">timestamp_duplicates</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">skip_existing</span><span class="p">:</span>
        <span class="n">parser</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sh">"</span><span class="s">--timestamp-duplicates and --skip-existing cannot be used together.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">remove_empty_source_dirs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">.</span><span class="n">move</span><span class="p">:</span>
        <span class="n">parser</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sh">"</span><span class="s">--remove-empty-source-dirs requires --move to be enabled.</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># --- Setup ---
</span>    <span class="n">logger</span> <span class="o">=</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">log_file</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Script starting...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Arguments: </span><span class="si">{</span><span class="nf">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># Log arguments used
</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="nf">load_config_file</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># --- Execute Sorting ---
</span>    <span class="n">processed</span><span class="p">,</span> <span class="n">failed_or_skipped</span> <span class="o">=</span> <span class="nf">sort_files</span><span class="p">(</span>
        <span class="n">source_directory</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">source</span><span class="p">,</span>
        <span class="n">target_directory</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">target</span><span class="p">,</span>
        <span class="n">organize_by</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">organize_by</span><span class="p">,</span>
        <span class="n">timestamp_duplicates</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">timestamp_duplicates</span><span class="p">,</span>
        <span class="n">move_files</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">move</span><span class="p">,</span>
        <span class="n">categories_config</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span>
        <span class="n">include_hidden</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">include_hidden</span><span class="p">,</span>
        <span class="n">follow_links</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">follow_links</span><span class="p">,</span>
        <span class="n">skip_existing</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">skip_existing</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
    <span class="p">)</span>

    <span class="c1"># --- Optional Cleanup ---
</span>    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">move</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">remove_empty_source_dirs</span> <span class="ow">and</span> <span class="n">processed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nf">remove_empty_folders</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">source</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Script finished.</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Script finished. Check console and log file (if specified) for details.</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></section></div></div>

        </div>
        
          URL: https://ib.bsb.br/files-by-type
        
      </article>
      <nav class="post-navigation-combined" aria-label="Post navigation">
        <!-- Chronological Navigation (always visible at 40vh) -->
        
          <div class="nav-arrow chronological prev">
            <a href="/mlo-ru/" title="Planning System Based on MyLifeOrganized (MLO)" rel="prev">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
        
          <div class="nav-arrow chronological next">
            <a href="/dup-spotter/" title="Copy Spotter and Duplicate-File-Remover" rel="next">
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next article" width="45" height="45" loading="lazy">
            </a>
          </div>
        
            
            
              
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "software>rust"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-software-rust" style="display: block;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/rust-cli-parallel-processing-for-copymove-files/" title="Rust CLI parallel processing for copy/move files" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/rust-cli-parallel-processing-for-copymove-files/" title="Rust CLI parallel processing for copy/move files" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
            
            
              
              
                
                  
                  
              
              
              
              <!-- Navigation block for tag "scripts>python"; default display for the first tag -->
              <div class="nav-group tags" id="tag-nav-scripts-python" style="display: none;">
                <div class="nav-arrow tags prev">
                  
                    <a href="/f4p/" title="files for prompt (f4p)" rel="prev">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAxVJREFUaEPt18FqG1cUBuD/nLkzI42UiVInkFLTCAKhS+9KA+3Kq1L8AAHjhR7AKz+ADV55qUfoqhvThTfdmC4KzTKmYJrELshJW9PIlSeKRpqZe88pUtouihvVRknqMNoMzD1zdPXNrzMM4RJ+6BLuGeWm39RdK6VL6VcIlPEo41HG401loJQupS8mUM7pi7md/6p3UtoHUJzf4vVecZb0e0EQfB7H8b0kSeqqummt/eb1buN83SebNsZ8QkQCYHVpaenu/v7+ra2tLRwdHWF1ddWq6hfM3BCRE2b+FcBHACQAHo1E5v9c+5mIhkR0e3z0VQ8LotuqWlXVw/GRmT8QkdMK89McuAOAAfwoIu8z85yIHBPRKRGN1/IAeDx0rul53hivo6psrf2ejDGfEtFOu92u7O3tBWtra2i322g0GhgOh9je3ka325UPax7fCR0iw+lp4aLxr70aeOmgkChTRY3JGSb73EroERD73uB54WpOgdhwZkXNQNQLiVDzOU1yFymAhu+lqZVopIqISQKmPLFS+atHv3A1q8AVQ+lXP/VHRPQx+b6frKysxMvLy1hfX0ez2USv18PCwgLiOEaSJKhWq/jhwQN8dnIfVOS4dsWHqCJ5YREGjBuNEMfd0eTc9WshBqnFYGhRqxrUIoNuLwMT4eb1Cp6dZshywdW6mZzr9QsEPuPmXIhfno3gnGKuEWCUC14MLKoVb1L72+8Zvj3JOl/udZt/S7darUqn0wlarRZ2d3cxPz+PJ8dPsPP1Doq8kIbL+cawjxBIM8MRFAidpBlRpIbhFc55gM2NF5IIQtVBRlRTZgTWZQ4wzvc8spO1NPM4Gr9Wh1bSDIjU98C5E0PIC8OVSX+Rlz08hl+4/LsML6X/menFxcW7BwcHtzY2NvDw8CE21zf/NdMAHskFMs3MT/EfMg3gsTsr02f8byfTo16v3+v3+//f6fGKgXNp5vT5huZbqH4nH+NvwXH6V5bS041mU1FKz8ZxepdSerrRbCpK6dk4Tu9SSk83mk1FKT0bx+ldSunpRrOpuJTSfwBcuImxpyA7XgAAAABJRU5ErkJggg==" alt="Previous in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
                <div class="nav-arrow tags next">
                  
                    <a href="/list-senders/" title="List sender's email addresses from Gmail unread messages" rel="next">
                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAwdJREFUaEPtl01rG1cUht9z7p070ijKWLVS3I9YULtNMBRn2UIXxZtuvCjedNWfoKVXBvsHeOUfoIUx5AeY0pVXXSR052UxBJSi0kDiRplII83HvadI9CMtOFjCmBjubC7cc8+Zc555eYdLuIEP3cCe4Zu+rq/mSXvSbyHg5eHl4eVxXRrwpD3p+Qh4n56P2+xZnvTszC7MCAAUF0XfOdJa62+IaCeO40GSJA/zPP8RwB9vDjBtWmv9JRE5ImpZawdVpbo58CkAIyJnIrLAzEvOuXNm/h3AfQDOAGdj5z5m5gXn3G9ENCKilckaiDwpiFZEpCoiTyYrM3/knOtXmHs58BkABvCLc+4DZl6cxIjoh4ODA728vIzt7W2sra09PT4+fgTgQES4LMvHZIy5LyI/f/dJvfK6FKMJqAdqmBS2ZgWINY9zJyZ1whUiRJrTfmGjybSxUemwcFEmghqT1UxlUrpQEXD7jRq3NWelEz10okIi1AJOX+U2EgALgUrT0kVnmcKvQ+uazSZvbW2hWq2i3++j3W5jf38f6+vrebvdHovI5pT09+vN7teLYev990K8GpQYjS1u1TQqhnHez6EU4cM7FTw7z5AXDo16ACcyPRsaxp2FEM9ejKd7zUaIYVpiOCpRq2rUIo0XLzMwEZaaFTzvZ8hyh/iWnu69fF1AAoOfFr/A5w8eYDQaIY5jJEmC09NTNBoNdLtd7O3t4ejoCIeHh8k/pL8KUSkCZcg6hCLDjLk2ufYGpRuXAuOMYiosQiDNNEcQILQuzYgi0QxVWKuAMtcqJPdXDaKaMMOUNrOAtoFSVE5jaaY4mtQPS5dmQPS8WkdfGReYgDe/3cTdpbvo9XrY2NhAp9NBq9XKO53Ov6T/r2mlVBeX0DSAMzeHppm5h7doemdvR99buYfd3V2srq4+PTk5+a+mr9CmrqTU3+5Rr9cHg8HgYve4krddbZGb5dOXmf2d+7n4pi9D4LrOeHl40v42fl0a8KQ96fkIeJ+ej9vsWZ707Mzmy/Ck5+M2e9afhmuAz1BhwewAAAAASUVORK5CYII=" alt="Next in Tag" width="45" height="45" loading="lazy">
                    </a>
                  
                </div>
              </div>
            
          
          <!-- JavaScript to Toggle the Tag-based Navigation -->
          <script>
            document.addEventListener("DOMContentLoaded", function(){
              var tagLinks = document.querySelectorAll('.tag-option');
              tagLinks.forEach(function(link){
                link.addEventListener('click', function(event){
                  event.preventDefault();
                  // Remove "active" class from all tag options.
                  tagLinks.forEach(function(el){ el.classList.remove('active'); });
                  // Add active class to the clicked tag option.
                  this.classList.add('active');
                  // Hide all tag navigation blocks.
                  document.querySelectorAll('.nav-group.tags').forEach(function(block){
                    block.style.display = 'none';
                  });
                  // Show the navigation block corresponding to the selected tag.
                  var tagSlug = this.getAttribute('data-tag');
                  var target = document.getElementById('tag-nav-' + tagSlug);
                  if(target) {
                    target.style.display = 'block';
                  }
                });
              });
            });
          </script>
      </nav>
      
    </main>
    <footer id="bottom-of-page" class="site-footer">
      <div class="footer-content">
        <!-- Back to top link -->
        <a href="#" aria-label="Back to top" class="back2top-link">
          <span class="sronly">Back to top</span>
        </a>
    
        <!-- Liquid Time Calculation and Display -->
        
        
        
        <a href="https://ib.bsb.br/404" aria-label="404">
          2026-01-14 15:34:45
        </a>
        &#x23;
    
        <!-- Tag Selector -->
        <ul class="tag-selector">
          
            
            
              <li>
                <a href="#" class="tag-option active" data-tag="software-rust">
                  software>rust
                </a>
              </li>
            
          
            
            
              <li>
                <a href="#" class="tag-option " data-tag="scripts-python">
                  scripts>python
                </a>
              </li>
            
          
        </ul>
        &hArr;
    
        <!-- GitHub Link -->
        <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">
          &#8505;
        </a>
    
        <!-- Homepage Link -->
        <a href="/" aria-label="Homepage">
          infoBAG
        </a>
    
        <!-- Copy All Code Button -->
        <button id="copyAllButton" aria-label="Copy all code">
          &copy;
        </button>
      </div>
    </footer>
    <style>
      .back2top-link {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: url("/assets/Rope_(Old).gif") center center no-repeat;
        background-size: contain;
        text-decoration: none;
        vertical-align: middle;
      }
      .sronly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ib.bsb.br/files-by-type/"
        },
        "headline": "Organize files by type",
        "description": "",
        "datePublished": "2024-05-30T00:00:00+00:00",
        "dateModified": "2025-05-28T22:06:53+00:00",
        "author": {
          "@type": "Person",
          "name": "Author"
        },
        "publisher": {
          "@type": "Organization",
          "name": "infoBAG"
          
        }
        
      }
    </script>
    <script src="/assets/js/prism.js" defer></script>
    <script src="/assets/js/copy-all-code.js"></script>
  </body>
</html>
