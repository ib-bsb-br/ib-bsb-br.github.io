<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    {% if page.id == "home" %}
      {{ site.title | strip_html | strip }}
    {% else %}
      {{ page.title | strip_html | strip }} — {{ site.title | strip_html | strip }}
    {% endif %}
  </title>
  <meta name="title" content="{{ page.title | default: site.title | strip_html | strip }}">
  <meta name="description" content="{{ page.description | default: site.description | default: "can't steer unless already moving" | strip_html | truncate: 160 }}">

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="{% if page.id == "home" %}{{ site.title | strip_html | strip }}{% else %}{{ page.title | strip_html | strip }} — {{ site.title | strip_html | strip }}{% endif %}">
  <meta property="og:description" content="{{ page.description | default: site.description | default: "can't steer unless already moving" | strip_html | truncate: 160 }}">
  <meta property="og:url" content="{{ page.canonical_url | default: page.url | absolute_url }}">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="{{ site.title | strip_html | strip }}">
  {% if site.social.og_image %}
    <meta property="og:image" content="{{ site.social.og_image | absolute_url }}">
  {% endif %}

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% if page.id == "home" %}{{ site.title | strip_html | strip }}{% else %}{{ page.title | strip_html | strip }} — {{ site.title | strip_html | strip }}{% endif %}">
  <meta name="twitter:description" content="{{ page.description | default: site.description | default: "can't steer unless already moving" | strip_html | truncate: 160 }}">
  {% if site.social.twitter_image %}
    <meta name="twitter:image" content="{{ site.social.twitter_image | absolute_url }}">
  {% endif %}

  <link rel="canonical" href="{{ page.canonical_url | default: page.url | absolute_url }}">
  <link rel="alternate" type="application/rss+xml" title="{{ site.title | strip_html | strip }}" href="{{ '/rss.xml' | absolute_url }}">

  {% if page.tags %}
    <meta name="keywords" content="{{ page.tags | join: ',' | strip_html | strip }}">
    {% for tag in page.tags %}
      <meta property="article:tag" content="{{ tag | strip_html | strip }}">
    {% endfor %}
  {% endif %}

  <!-- Favicons and Icons -->
  <link rel="icon" href="{{ '/favicon.ico' | relative_url }}" type="image/x-icon">
  <link rel="shortcut icon" href="{{ '/favicon.ico' | relative_url }}" type="image/x-icon">
  {% if site.favicons %}
    {% for icon in site.favicons %}
      <link rel="{{ icon.rel }}" sizes="{{ icon.sizes }}" href="{{ icon.href | relative_url }}">
    {% endfor %}
  {% endif %}

  <link href="{{ '/style.css' | relative_url }}" rel="stylesheet">
</head>
<body class="post-content-body">

  {% assign source_line = '' %}
  {% assign normalized_content = content | replace: '\r\n', '\n' | replace: '\r', '\n' %}
  {% capture processed_content %}
    {% assign lines = normalized_content | split: '\n' %}
    {% for line in lines %}
      {% assign processed_line = line | strip | downcase %}
      {% if source_line == '' and processed_line starts_with 'source:' %}
        {% assign source_line = line | strip %}
      {% else %}
        {{ line }}
      {% endif %}
    {% endfor %}
  {% endcapture %}

  {% if source_line != '' %}
    {% assign my_comment = source_line | remove: 'source:' | strip %}
  {% else %}
    {% assign my_comment = page.comment %}
  {% endif %}

  <header class="header-container">
    <nav aria-label="Main navigation" class="header-content">
      <a href="{{ '/' | relative_url }}" aria-label="Home">
        <img src="{{ '/favicon.ico' | relative_url }}" alt="Home" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="{{ '/tags' | relative_url }}" aria-label="Tags">
        <img src="{{ '/assets/Label.gif' | relative_url }}" alt="Tags" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="{{ '/events' | relative_url }}" aria-label="Events">
        <img src="{{ '/assets/Paralyse_Rune.gif' | relative_url }}" alt="Events" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
      <a href="{{ '/archive' | relative_url }}" aria-label="Archive">
        <img src="{{ '/assets/Loose_Stone_Pile.gif' | relative_url }}" alt="Archive" class="favicon search-link" width="45" height="45" loading="lazy">
      </a>
    </nav>
    <h1 class="post-title">{{ page.title | strip_html | strip }}</h1>
    <div class="post-meta">
      <time datetime="{{ page.date | date_to_xmlschema }}" class="post-date">
        {{ page.date | date_to_string }}
      </time>
      {% if page.last_modified_at %}
        <span class="post-updated">
          ↣
          <time datetime="{{ page.last_modified_at | date_to_xmlschema }}">{{ page.last_modified_at | date_to_string }}</time>
        </span>
      {% endif %}
      {% if page.slug %}
        <p class="post-slug">
          Slug: <a href="{{ page.slug | absolute_url }}" class="tag">{{ page.slug }}</a>
        </p>
      {% endif %}
      {% if page.tags %}
        <p class="post-tags">
          Tags:
          {% for tag in page.tags %}
            <a href="{{ site.url }}{{ site.baseurl }}/tags/#{{ tag | slugify }}" class="tag">{{ tag }}</a>
          {% unless forloop.last %}
          {% endunless %}
          {% endfor %}
        </p>
      {% endif %}
    </div>
    <div class="post-actions">
      <div class="page-stats mt-3" role="status" aria-label="Page statistics">
        <span class="badge bg-primary">
          {{ page.content | size }} characters
        </span>
        <span class="separator mx-2" aria-hidden="true">•</span>
        <span class="badge bg-primary">
          {{ page.content | number_of_words }} words
        </span>
      </div>
      <div class="action-buttons d-flex flex-wrap gap-2">
        {% if page.path %}
          {% if page.info %}
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/{{ page.path | uri_escape }}"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                <span class="button-text">Improve this page?</span>
                <span class="info-text">{{ page.info | strip_html | strip | escape }}</span>
              </button>
            </form>
          {% else %}
            <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/edit/main/{{ page.path | uri_escape }}"
                  method="GET"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="d-inline-block">
              <button type="submit" class="btn btn-danger" aria-label="Edit page content">
                Improve this page
              </button>
            </form>
          {% endif %}
          <form action="https://github.com/ib-bsb-br/ib-bsb-br.github.io/commits/main/{{ page.path | uri_escape }}"
                method="GET"
                target="_blank"
                rel="noopener noreferrer"
                class="d-inline-block">
            <button type="submit" class="btn btn-danger" aria-label="View page revision history">
              View revision history
            </button>
          </form>
        {% else %}
          <div class="alert alert-warning" role="alert">
            Page information unavailable
          </div>
        {% endif %}
      </div>
    </div>
  </header>
  <main class="content">
    <article class="post-wrapper">
      <div class="post-content-body">
        {% include toc.html html=processed_content %}
        {% include anchor_headings.html html=processed_content anchorBody="#" %}
      </div>
      {% if page.slug %}
        URL: {{ page.slug | absolute_url }}
      {% else %}
        URL: {{ page.url | absolute_url }}
      {% endif %}
    </article>
    <nav class="post-navigation" aria-label="Post navigation">
      {% if page.previous %}
        <div class="nav-arrow prev">
          <a href="{{ page.previous.url | relative_url }}" title="{{ page.previous.title | strip_html | strip }}" rel="prev">
            <img src="data:image/png;base64," alt="Previous article" width="45" height="45" loading="lazy">
          </a>
        </div>
      {% endif %}
      {% if page.next %}
        <div class="nav-arrow next">
          <a href="{{ page.next.url | relative_url }}" title="{{ page.next.title | strip_html | strip }}" rel="next">
            <img src="data:image/png;base64," alt="Next article" width="45" height="45" loading="lazy">
          </a>
        </div>
      {% endif %}
    </nav>
    {% if my_comment %}
      <div class="comment-box">
        Reference:
        <a href="{{ my_comment }}" title="{{ my_comment }}">{{ my_comment }}</a>
      </div>
    {% endif %}
  </main>
  <footer class="site-footer">
    <p>
      <a href="#" aria-label="Back to top">
        <img src="{{ '/assets/Rope_(Old).gif' | relative_url }}" alt="Back to top" width="32" height="32" loading="lazy">
      </a>{% assign current_time = site.time | date: '%s' %}{% assign offset_seconds = 3 | times: 60 | times: 60 %}{% assign adjusted_time = current_time | minus: offset_seconds %}<a href="https://ib.bsb.br/404" aria-label="404">{{ adjusted_time | date: '%Y-%m-%d %H:%M:%S' }}</a>‎ ⇔‎ <a href="https://github.com/ib-bsb-br/ib-bsb-br.github.io" aria-label="GitHub">ℹ</a>‎ <a href="{{ '/' | relative_url }}" aria-label="Homepage">{{ site.title | strip_html | strip }}</a>
    </p>
  </footer>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ page.url | absolute_url }}"
    },
    "headline": "{{ page.title | strip_html | strip | truncate: 110 }}",
    "description": "{{ page.description | default: site.description | strip_html | truncate: 160 }}",
    "datePublished": "{{ page.date | date_to_xmlschema }}",
    "dateModified": "{{ page.last_modified_at | default: page.date | date_to_xmlschema }}",
    "author": {
      "@type": "Person",
      "name": "{{ site.author.name | default: 'Author' | strip_html | strip }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ site.title | strip_html | strip }}"
      {% if site.logo %}
      ,"logo": {
        "@type": "ImageObject",
        "url": "{{ site.logo | absolute_url }}"
      }
      {% endif %}
    }
    {% if site.social.og_image %}
    ,"image": {
      "@type": "ImageObject",
      "url": "{{ site.social.og_image | absolute_url }}"
    }
    {% endif %}
  }
  </script>
  <script src="{{ '/assets/js/prism.js' | relative_url }}" defer></script>
</body>
</html>
